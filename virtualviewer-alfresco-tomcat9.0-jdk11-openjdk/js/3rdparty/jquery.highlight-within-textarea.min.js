!function(t){let e="hwt",i=function(t,e){this.init(t,e)};i.prototype={init:function(t,e){this.$el=t,"function"===this.getType(e)&&(e={highlight:e}),"custom"===this.getType(e)?(this.highlight=e,this.generate()):console.error("valid config object not provided")},getType:function(t){let e=typeof t;if(!t)return"falsey";if(Array.isArray(t))return 2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]?"range":"array";if("object"===e){if(t instanceof RegExp)return"regexp";if(t.hasOwnProperty("highlight"))return"custom"}else if("function"===e||"string"===e)return e;return"other"},generate:function(){switch(this.$el.addClass(e+"-input "+e+"-content").on("input."+e,this.handleInput.bind(this)).on("scroll."+e,this.handleScroll.bind(this)),this.$highlights=t("<div>",{class:e+"-highlights "+e+"-content"}),this.$backdrop=t("<div>",{class:e+"-backdrop"}).append(this.$highlights),this.$container=t("<div>",{class:e+"-container"}).insertAfter(this.$el).append(this.$backdrop,this.$el).on("scroll",this.blockContainerScroll.bind(this)),this.browser=this.detectBrowser(),this.browser){case"firefox":this.fixFirefox();break;case"ios":this.fixIOS()}this.isGenerated=!0,this.handleInput()},detectBrowser:function(){let t=window.navigator.userAgent.toLowerCase();return t.indexOf("firefox")!==-1?"firefox":t.match(/msie|trident\/7|edge/)?"ie":t.match(/ipad|iphone|ipod/)&&t.indexOf("windows phone")===-1?"ios":"other"},fixFirefox:function(){let t=this.$highlights.css(["padding-top","padding-right","padding-bottom","padding-left"]),e=this.$highlights.css(["border-top-width","border-right-width","border-bottom-width","border-left-width"]);this.$highlights.css({padding:"0","border-width":"0"}),this.$backdrop.css({"margin-top":"+="+t["padding-top"],"margin-right":"+="+t["padding-right"],"margin-bottom":"+="+t["padding-bottom"],"margin-left":"+="+t["padding-left"]}).css({"margin-top":"+="+e["border-top-width"],"margin-right":"+="+e["border-right-width"],"margin-bottom":"+="+e["border-bottom-width"],"margin-left":"+="+e["border-left-width"]})},fixIOS:function(){this.$highlights.css({"padding-left":"+=3px","padding-right":"+=3px"})},handleInput:function(){let t=this.$el.val(),e=this.getRanges(t,this.highlight),i=this.removeStaggeredRanges(e),n=this.getBoundaries(i);this.renderMarks(n)},getRanges:function(t,e){let i=this.getType(e);switch(i){case"array":return this.getArrayRanges(t,e);case"function":return this.getFunctionRanges(t,e);case"regexp":return this.getRegExpRanges(t,e);case"string":return this.getStringRanges(t,e);case"range":return this.getRangeRanges(t,e);case"custom":return this.getCustomRanges(t,e);default:if(!e)return[];console.error("unrecognized highlight type")}},getArrayRanges:function(t,e){let i=e.map(this.getRanges.bind(this,t));return Array.prototype.concat.apply([],i)},getFunctionRanges:function(t,e){return this.getRanges(t,e(t))},getRegExpRanges:function(t,e){let i,n=[];for(;i=e.exec(t),null!==i&&(n.push([i.index,i.index+i[0].length]),e.global););return n},getStringRanges:function(t,e){let i=[],n=t.toLowerCase(),r=e.toLowerCase(),s=0;for(;s=n.indexOf(r,s),s!==-1;)i.push([s,s+r.length]),s+=r.length;return i},getRangeRanges:function(t,e){return[e]},getCustomRanges:function(t,e){let i=this.getRanges(t,e.highlight);return e.className&&i.forEach(function(t){t.className?t.className=e.className+" "+t.className:t.className=e.className}),i},removeStaggeredRanges:function(t){let e=[];return t.forEach(function(t){let i=e.some(function(e){let i=t[0]>e[0]&&t[0]<e[1],n=t[1]>e[0]&&t[1]<e[1];return i!==n});i||e.push(t)}),e},getBoundaries:function(t){let e=[];return t.forEach(function(t){e.push({type:"start",index:t[0],className:t.className}),e.push({type:"stop",index:t[1]})}),this.sortBoundaries(e),e},sortBoundaries:function(t){t.sort(function(t,e){return t.index!==e.index?e.index-t.index:"stop"===t.type&&"start"===e.type?1:"start"===t.type&&"stop"===e.type?-1:0})},renderMarks:function(t){let e=this.$el.val();t.forEach(function(t,i){let n;n="start"===t.type?"{{hwt-mark-start|"+i+"}}":"{{hwt-mark-stop}}",e=e.slice(0,t.index)+n+e.slice(t.index)}),e=e.replace(/\n(\{\{hwt-mark-stop\}\})?$/,"\n\n$1"),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;"),"ie"===this.browser&&(e=e.replace(/ /g," <wbr>")),e=e.replace(/\{\{hwt-mark-start\|(\d+)\}\}/g,function(e,i){var n=t[+i].className;return n?'<mark class="'+n+'">':"<mark>"}),e=e.replace(/\{\{hwt-mark-stop\}\}/g,"</mark>"),this.$highlights.html(e)},handleScroll:function(){let t=this.$el.scrollTop();this.$backdrop.scrollTop(t);let e=this.$el.scrollLeft();this.$backdrop.css("transform",e>0?"translateX("+-e+"px)":"")},blockContainerScroll:function(){this.$container.scrollLeft(0)},destroy:function(){this.$backdrop.remove(),this.$el.unwrap().removeClass(e+"-text "+e+"-input").off(e).removeData(e)}},t.fn.highlightWithinTextarea=function(n){return this.each(function(){let r=t(this),s=r.data(e);if("string"==typeof n)if(s)switch(n){case"update":s.handleInput();break;case"destroy":s.destroy();break;default:console.error("unrecognized method string")}else console.error("plugin must be instantiated first");else s&&s.destroy(),s=new i(r,n),s.isGenerated&&r.data(e,s)})}}(jQuery);