/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*! https://mths.be/startswith v0.2.0 by @mathias */

define("3rdparty/domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](u)}function t(){var t=d;l&&t.length&&(d=[],e(t))}function a(){l||(l=!0,r&&clearInterval(r),t())}function n(e){return l?e(u):d.push(e),n}var o,i,r,s="undefined"!=typeof window&&window.document,l=!s,u=s?document:null,d=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(window.attachEvent){window.attachEvent("onload",a),i=document.createElement("div");try{o=null===window.frameElement}catch(e){}i.doScroll&&o&&window.external&&(r=setInterval(function(){try{i.doScroll(),a()}catch(e){}},30))}"complete"===document.readyState&&a()}return n.version="2.0.1",n.load=function(e,t,a,o){o.isBuild?a(null):n(a)},n}),define("vvPoint",[],function(){function e(e,t){this.x=e,this.y=t}return e.prototype.getX=function(){return this.x},e.prototype.setX=function(e){this.x=e},e.prototype.getY=function(){return this.y},e.prototype.setY=function(e){this.y=e},e.prototype.rotate=function(e,t,a){var n=this.getX(),o=this.getY(),i=e;e===-90?i=270:e===-180?i=180:e===-270&&(i=90),90===i?(this.setX(t-o),this.setY(n)):180===i?(this.setX(t-n),this.setY(a-o)):270===i&&(this.setX(o),this.setY(a-n))},e.prototype.unrotate=function(e,t,a){var n=e;90===e?n=270:180===e?n=180:270===e&&(n=90),this.rotate(n,t,a)},e}),define("vvUtility",["user-config/config","vvDefines","vvPoint"],function(e,t,a){!function(){String.prototype.startsWith||!function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,a=t(e,e,e)&&t}catch(e){}return a}(),t={}.toString,a=function(e){if(null==this)throw TypeError();var a=String(this);if(e&&"[object RegExp]"==t.call(e))throw TypeError();var n=a.length,o=String(e),i=o.length,r=arguments.length>1?arguments[1]:void 0,s=r?Number(r):0;s!=s&&(s=0);var l=Math.min(Math.max(s,0),n);if(i+l>n)return!1;for(var u=-1;++u<i;)if(a.charCodeAt(l+u)!=o.charCodeAt(u))return!1;return!0};e?e(String.prototype,"startsWith",{value:a,configurable:!0,writable:!0}):String.prototype.startsWith=a}(),Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";var t=Object(this),a=parseInt(t.length)||0;if(0===a)return!1;var n,o=parseInt(arguments[1])||0;o>=0?n=o:(n=a+o,n<0&&(n=0));for(var i;n<a;){if(i=t[n],e===i||e!==e&&i!==i)return!0;n++}return!1}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){return new Uint8Array(Array.prototype.slice.call(this,e,t))}}),function(){"use strict";var e=/[-\/\\^$*+?.()|[\]{}]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}()}();var n=function(e){"use strict";return e*(Math.PI/180)},o=function(e){"use strict";return e*(180/Math.PI)},i=function(e){1===e.nodeType&&e.setAttribute("unselectable","on");for(var t=e.firstChild;t;)i(t),t=t.nextSibling},r=function(e){"use strict";for(var a=t.fontSizes,n=0;n<a.length;n+=1){if(e===a[n])return e;if(e<a[n]&&n>0){var o=Math.abs(e-a[n-1]),i=Math.abs(e-a[n]);return o>i?a[n]:a[n-1]}if(e>a[n]&&n===a.length-1)return a[n]}},s=function(){"use strict";return Modernizr.touchevents?e.polygonNubSizeTouch||40:e.polygonNubSize||10},l=function(e){"use strict";return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},u=function(){"use strict";if(e.imageScrollBars===!1){v();var t=$("#vvSplitPaneDiv");t.addClass("grabCursorOpen")}},d=function(){"use strict";if(e.imageScrollBars===!1){v();var t=$("#vvSplitPaneDiv");t.addClass("grabCursorClosed")}},c=function(){"use strict";v();var e=$("#vvSplitPaneDiv");e.addClass("selectTextCursor")},g=function(){"use strict";v();var e=$("#vvSplitPaneDiv");e.addClass("guidesCursor")},v=function(){"use strict";var e=$("#vvSplitPaneDiv");e.removeClass("guidesCursor selectTextCursor grabCursorClosed grabCursorOpen")},p=function(e,t){"use strict";var a,n,o,i;for(a=e.split(/\./),n=$.localize.data.vv,o=0,i=a.length;o<i;o++)e=a[o],n=n?n[e]:null;if(!n&&t)n=t;else if(!n)return{};return n},h=function(e,t){var a=p(e,t);return $("<div />").html(a).text()},m=function(e,t,a){"use strict";return{r:e,g:t,b:a}},f=function(e){"use strict";var t=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return m(t,a,n)},y=function(e,t){"use strict";var a=f(e),n=a.r,o=a.g,i=a.b;return t?"rgba("+n+","+o+","+i+","+t+")":"rgb("+n+","+o+","+i+")"},b=function(e){"use strict";var t=document.createElement("canvas"),a=e.width,n=e.height;t.width=a,t.height=n;var o=t.getContext("2d");o.drawImage(e,0,0,a,n);for(var i=o.getImageData(0,0,a,n),r=i.data,s=0,l=1,u=2,d=3,c=0;c<r.length;c+=4)255===r[c+s]&&255===r[c+l]&&255===r[c+u]&&(r[c+d]=0);return o.putImageData(i,0,0),t.toDataURL("image/png")},P=function(e){"use strict";return!(!e||"true"!==e)},A=function(e){"use strict";var t=[];if(e){e=e.split(";");for(var n=0;n<e.length;n+=1){var o=e[n].split(",");t[n]=new a(parseInt(o[0],10),parseInt(o[1],10))}}return t},T=function(e){"use strict";for(var t="",a=0;a<e.length;a+=1)t+=e[a].getX(),t+=",",t+=e[a].getY(),a!==e.length-1&&(t+=";");return t},S=function(e){"use strict";for(var t=[],a=e.getElementsByTagName("Note").length,n=0;n<a;n++){var o=e.getElementsByTagName("Note")[n],i={userId:decodeURIComponent($(o.getElementsByTagName("userId")[0]).text()),createDate:$(o.getElementsByTagName("createDate")[0]).text(),editDate:$(o.getElementsByTagName("modifyDate")[0]).text(),text:decodeURIComponent($(o.getElementsByTagName("noteText")[0]).text()),idxFlag:$(o.getElementsByTagName("idxFlag")[0]).text()};t.push(i)}return t},I=function(e){"use strict";for(var t=[],a=e.getElementsByTagName("tag").length,n=0;n<a;n++){var o=e.getElementsByTagName("tag")[n];t.push(decodeURIComponent($(o).text()))}return t},w=function(e,t){"use strict";var a=e.getElementsByTagName(t)[0];return a?$(a).text():null},D=function(e){"use strict";return""===e?0:parseFloat(e.substring(0,e.length-2))},C=function(e,t){"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9?"collapse"===t||"hidden"===t?e.style.display="none":e.style.display="":e.style.visibility=t},M=function(e){"use strict";e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},x=function(e,t,a,n){this.left=e,this.top=t,this.right=a,this.bottom=n,this.intersects=function(e){return!(e.left>this.right||e.right<this.left||e.top>this.bottom||e.bottom<this.top)},this.width=function(){return this.right-this.left},this.height=function(){return this.bottom-this.top}},L=function(e){"use strict";var t=e.replace(/\&/g,"&amp;");return t},N={SIXTY_FOUR_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",REVERSE_MAPPING:[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,63,void 0,void 0,void 0,64,53,54,55,56,57,58,59,60,61,62,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,void 0,void 0,void 0,void 0,void 0,void 0,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],encode:function(e){var t="";if(!e)return null;e=this.stringToBytes(e);for(var a=e.length,n=0;n<a;n+=3)for(var o=Math.min(3,a-n),i=(255&e[n])<<16|(o<=1?0:255&e[n+1])<<8|(o<=2?0:255&e[n+2]),r=0;r<4;r++)t+=o+1>r?this.SIXTY_FOUR_CHARS.charAt(63&i>>6*(3-r)):"=";return t.toString()},decode:function(e){var t=[];if(!e)return null;for(var a=0;a<e.length;a+=4){"\n"===e.charAt(a)&&(a+=1);for(var n=[this.mapCharToInt(e.charAt(a)),this.mapCharToInt(e.charAt(a+1)),this.mapCharToInt(e.charAt(a+2)),this.mapCharToInt(e.charAt(a+3))],o=(63&n[0])<<18|(63&n[1])<<12|(63&n[2])<<6|63&n[3],i=0;i<3;i++)n[i+1]>=0&&t.push(255&o>>8*(2-i))}for(var r="",s=0;s<t.length;s+=2)r+=this.fixedFromCharCode(this.getWordAt(t,s));return r},mapCharToInt:function(e){if(!e)return-1;var t=this.REVERSE_MAPPING[e.charCodeAt(0)];return 0!==t?t-1:-1},fixedFromCharCode:function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):String.fromCharCode(e)},getWordAt:function(e,t){return(e[t+0]<<8)+e[t+1]},stringToBytes:function(e){for(var t,a,n=[],o=0;o<e.length;o++)if(t=e.charCodeAt(o),a=[],t>255){do a.push(255&t),t>>=8;while(t);n=n.concat(a.reverse())}else n.push(0),n.push(t);return n}},V=function(e){"use strict";var t="vvTextAnnotation-"+e.getLayerName().replace(/[\W]/g,"")+"-"+e.page+"-"+e.getOrdinal();return t},k=function(e){"use strict";return moment(e).format("YYYY-MM-DDTHH:mm:ss.SSZZ")},R=function(e){"use strict";var t={};if(null===e)return null;if(void 0!==e){if(e.vvDeadEnd===!0||"object"==typeof e&&"string"==typeof e.jquery)return null;if("object"==typeof e){"undefined"!=typeof e.length&&(t=[]);for(var a in e)"object"==typeof e[a]?t[a]=R(e[a]):"string"==typeof e[a]?t[a]=e[a]:"number"==typeof e[a]?t[a]=e[a]:"boolean"==typeof e[a]?e[a]===!0?t[a]=!0:t[a]=!1:"function"==typeof e[a]&&(t[a]=e[a])}return t}},B=function(e,t,a){"use strict";if(!a)return"State object is required";var n=a.getPageCount();if("complex"===e){if(!t)return h("errors.complexRangeEmpty","Blank complex page range");for(var o=t.split(","),i=0;i<o.length;i++)for(var r=o[i],s=r.split("-"),l=0;l<s.length;l++){var u=+s[l];if(isNaN(u))return h("errors.complexRangeInvalidCharacter","Invalid character in complex page range:")+" "+u;if(u>n||u<1)return h("errors.complexRangePageOutOfBounds","One or more of the pages in the selected range are out of bounds");if(l<s.length-1&&u>+s[l+1])return h("errors.complexRangeUnsupportedSyntax","Incorrect syntax for the pages, make sure the lower number is on the left side of the dash.")}}return"OK"},F=function(e,t,a){"use strict";if(!a)return"State object is required";var n=a.getPageCount(),o=[];if("complex"===e)for(var i=t.split(","),r=0;r<i.length;r++){var s=i[r],l=s.split("-");if(1===l.length)o.push(+s-1);else for(var u=+l[0],d=+l[1],c=u;c<=d;c+=1)o.push(+c-1)}else if("all"===e)for(var g=0;g<n;g+=1)o.push(+g);else"current"===e&&o.push(+a.getPageNumber());return o},E=function(e){"use strict";for(var t=$(e).serializeArray(),a={},n=0;n<t.length;n++){var o=t[n];"true"===o.value?a[o.name]=!0:"false"===o.value?a[o.name]=!1:a[o.name]=o.value}return a},O=function(e,t){var a=t[0].x,n=t[0].y,o=t[1].x,i=t[1].y;if(o===a)return Math.abs(e.x-a);if(i===n)return Math.abs(e.y-n);var r=(i-n)/(o-a),s=i-r*o,l=Math.abs(s+r*e.x-e.y),u=Math.sqrt(1+Math.pow(r,2));return l/u},U=function(e){"use strict";return moment(e).format("ddd MMM D YYYY h:mm:ss A")},_=function(e){if(!e.canvas)throw"A canvas is required";if(!e.image)throw"Image is required";var t=e.canvas,a=t.getContext("2d"),n=e.image,o=e.srcx||0,i=e.srcy||0,r=e.srcw||n.naturalWidth,s=e.srch||n.naturalHeight,l=e.desx||o,u=e.desy||i,d=e.desw||r,c=e.desh||s,g=e.auto,v=window.devicePixelRatio||1,p=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1,h=v/p;if("undefined"==typeof g&&(g=!0),g&&v!==p){var m=t.width,f=t.height;t.width=m*h,t.height=f*h,t.style.width=m+"px",t.style.height=f+"px",a.scale(h,h)}a.drawImage(n,o,i,r,s,l,u,d,c)},z=function(){"use strict";return!("Explorer"===BrowserDetect.browser&&BrowserDetect.version<=8)&&($("body").tooltip({trigger:"hover focus",show:!1,hide:!1,selector:'[data-tooltip="tooltip"]'}),!0)},W=function(e){"use strict";return"string"==typeof e&&0===e.indexOf(t.redactionLayerPrefix)||(!(!e.displayName||0!==e.displayName.indexOf(t.redactionLayerPrefix))||(!(!e.layerName||0!==e.layerName.indexOf(t.redactionLayerPrefix))||!(!e.annotationId||0!==e.annotationId.indexOf(t.redactionLayerPrefix))))},H=function(e){"use strict";return 0===e.indexOf("VirtualDocument:")},Q=function(e){var t=new RegExp(/^VirtualDocument:([^,\[\]]*)(\[([0-9\-]+)\])?/),a=t.exec(e);if(a&&a.length){var n=a[3],o=0;return n&&(o=parseInt(n)-1),{documentId:a[1],pageIndex:o}}},j=function(e){"use strict";var t=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,a=new RegExp(t);return a.test(e)},q=function(e){var t=/^"?[a-z]{2}(-[A-Z]{2})?"?$/;return t.test(e)},G=function(e){"use strict";if(!e||e.length<=0)return"";for(var t=e.sort(function(e,t){return e-t}),a="",n=null,o=0;o<t.length;o++)o+1<t.length&&t[o+1]-t[o]===1?null===n&&(n=t[o]):null!==n?(a+=n+1+" - "+(t[o]+1)+", ",n=null):a+=t[o]+1+", ";return a.length>2&&(a=a.substr(0,a.length-2)),a},Y=function(e,t){"use strict";var a=[];try{e=e.replace(/\s/g,"");for(var n=e.split(","),o=0;o<n.length;o++){var i=n[o];if(i.includes("-"))for(var r=i.indexOf("-"),s=i.substring(0,r),l=i.substring(r+1),u=parseInt(s)-1,d=parseInt(l)-1,c=u;c<=d;c++)a.push(c);else{var g=parseInt(i)-1;if(!(g<t)){var v="Page "+g+" does not exist.";throw v}a.push(g)}}}catch(e){"string"==typeof e?console.log(e):console.log("Invalid Complex Range")}return a},X=function(){"use strict";var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Z=function(e){if(!e||e.length<4)return!1;e=e.toUpperCase();var t=e.substring(e.length-4);switch(t){case".MOV":case".MP4":case".OGG":case"WEBM":case".MKV":case".M4V":case".OGV":return!0;default:return!1}},K=function(e){"use strict";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"," ":"&nbsp;"};return String(e).replace(/[&<> \/"'`=]/g,function(e){return t[e]})},J=function(e){return!(!e||!e.src||""===e.src||e.src.indexOf("data:")===-1)||!(!e||!e.src||e.src.indexOf(t.bogusImageURL)!==-1)},ee=function(e){var t=e.map(function(e){var t=e.word,a=t.indexOf(";");return a>-1?t.slice(0,a+1):"&#"+t.charCodeAt(0)+";"}).join(""),a=document.createElement("textarea");return a.innerHTML=t,a.value},te=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};return jQuery.fn.extend({preventFocusOutlineOnClick:function(){var e=!1;return this.mousedown(function(){e=!0}).mouseleave(function(t){e=!1}).mouseup(function(t){e=!1}).focus(function(t){e&&$(t.target).addClass("unfocus")}).blur(function(e){$(e.target).removeClass("unfocus")})}}),{validImageObject:J,degreesToRadians:n,radiansToDegrees:o,findClosestFontSize:r,getNubSize:s,toTitleCase:l,Color:m,getColor:f,parseColorString:y,whiteToTransparent:b,fixBooleanString:P,parsePointArray:A,generatePointArrayString:T,parseAnnNotes:S,parseAnnTags:I,getValue:w,stripPx:D,setElementVisibility:C,cursorGrabOpen:u,cursorGrabClosed:d,cursorSelectText:c,cursorGuides:g,cursorAnnotate:g,cursorNormal:v,cancelEventBubbling:M,xmlEncodeEntities:L,deepObjCopy:R,getLocalizedValue:h,getLocalizedValueObject:p,validatePageRangeInput:B,normalizePageRangeInput:F,getFormData:E,Base64:N,getTextAnnDOMId:V,toSnowDateString:k,createAnnTimeStamp:U,drawImage:_,enableTooltips:z,isRedactionLayer:W,isVirtualDocument:H,getVirtualDocumentFirstPageInfo:Q,isValidEmailAddress:j,isValidISOCode:q,createComplexPageString:G,parseComplexPageString:Y,vvGUID:X,dumbVideoExtensionCheck:Z,encodeForHTML:K,makeUnselectable:i,ImageRect:x,getDistanceFromPointToLine:O,wordRectsToPageString:ee,isInteger:te}}),define("vvWidgets",["vvUtility","vvDefines"],function(e,t){function a(){}return a.expandColorPicker=function(e){var t=$(e).find(".vvColorInputPreview").css("height");$(e).find(".vvColorPickerSquare").css("height",t),$(e).find(".vvColorPickerSquare").css("width",t),$(e).find(".vvColorSquaresContainer").show()},a.shrinkColorPicker=function(e){$(e).find(".vvColorSquaresContainer").hide(),$(e).find(".vvColorPickerSquareSelected").removeClass("vvColorPickerSquareSelected"),$(e).find(".vvColorInputBox").attr("aria-invalid",!1)},a.setColorPickerColor=function(e,t){a.validateHexColor(t)&&($(e).find(".vvColorInputBox").attr("aria-invalid",!1),$(e).find(".vvColorInputPreview").css("background-color","#"+t),$(e).find(".vvColorInputBox").val(t))},a.createColorPicker=function(n,o){if(n){$(n).addClass("vvColorPickerOuterWrapper");var i=$("<div></div>").addClass("vvColorPickerContainer form-group");$(n).append(i);var r=$("<div></div>").addClass("input-group vvColorInputGroup");$(i).append(r);var s=$("<span></span>").addClass("input-group-addon vvColorInputPreview").attr("aria-label","Preview of the selected color.");$(r).append(s);var l=$("<input>").addClass("form-control vvColorInputBox").attr({type:"text",maxlength:"6",size:"6"});$(r).append(l);var u=null,d=null,c=$("<div></div>").addClass("vvColorSquaresContainer").attr("aria-label","Dropdown list of colors to choose from.");$(i).append(c);for(var g=0;g<t.annColors.length;g+=1){d=$("<div></div>");var v=t.annColors[g];$(d).css("background-color","#"+v).data("hex-color",v).addClass("vvColorPickerSquare"),$(c).append(d)}u=$("<div></div>").addClass("vvCustomColorRow vvColorChooserRow"),$(c).append(u);var p=$("<div></div>").text(e.getLocalizedValue("userPreferencesDialog.custom","Custom:")).addClass("vvCurrentCustomColorLabel");$(u).append(p),d=$("<div></div>").addClass("vvColorPickerSquare vvCustomColorPickerSquare").css("background-color","#C3C3C3").data("hex-color","C3C3C3"),$(u).append(d),$(c).hide(),$(c).find(".vvColorPickerSquare").on("click",function(){var e=$(this).data("hex-color"),t=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];$(t).find(".vvColorPickerSquareSelected").removeClass("vvColorPickerSquareSelected"),$(this).addClass("vvColorPickerSquareSelected"),$(t).find(".vvColorInputPreview").css("background-color","#"+e),$(t).find(".vvColorInputBox").val(e),o&&o(n,e)}),$(l).on("focus",function(){var e=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];a.expandColorPicker(e)}),$(s).on("click",function(){var e=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];"none"===$(e).find(".vvColorSquaresContainer").css("display")?a.expandColorPicker(e):a.shrinkColorPicker(e)}),$(l).on("change",function(){var e=$(this).val();if(!a.validateHexColor(e))return void $(this).attr("aria-invalid",!0);$(this).attr("aria-invalid",!1);var t=$(this).parentsUntil(".vvColorPickerOuterWrapper",".vvColorPickerContainer")[0];$(t).find(".vvColorInputPreview").css("background-color","#"+e);var n=$(t).find(".vvCustomColorPickerSquare");$(n).css("background-color","#"+e).data("hex-color",e),$(t).find(".vvColorPickerSquareSelected").removeClass("vvColorPickerSquareSelected"),o&&o(e)})}},a.validateHexColor=function(e){var t=/^([a-fA-F0-9]{6})$/;return!!t.test(e)},a}),define("vvDocViewStateElement",[],function(){function e(e){this.flipHorizontal=!1,this.flipVertical=!1,this.annotationLayers=void 0,this.dpi=void 0,this.bitDepth=0,this.compressionType="N/A",this.isBad=!1,this.isModified=!1,this.imageFormat="N/A",this.tiffTagHash={},this.originalWidth=0,this.originalHeight=0,this.requestedWidth=0,this.requestedHeight=0,this.scrollLeft=null,this.scrollTop=null,this.searchResults=null,this.pageText=null,this.undoObject={unchangedAnn:void 0,modifiedAnn:void 0,referenceAnn:void 0,layer:void 0,type:void 0},this.undoObjectArray=[],this.undoIndex=-1,this.poppedObjectArray=[],this.poppedIndex=-1,this.newTextAnn=!1,this.pageAlreadyRendered=!1,this.preferSVG=!0,this.imageInfoRequested=!1,this.imageInfoLoaded=!1}return e.prototype.initPageStateFromObject=function(e){this.flipHorizontal=e.flipHorizontal,this.flipVertical=e.flipVertical,this.annotationLayers=e.annotationLayers,this.dpi=e.dpi,this.bitDepth=e.bitDepth,this.compressionType=e.compressionType,this.preferSVG=e.preferSVG,this.isBad=e.isBad,this.imageFormat=e.imageFormat,this.tiffTagHash=e.tiffTagHash,this.originalWidth=e.originalWidth,this.originalHeight=e.originalHeight,this.requestedWidth=e.requestedWidth,this.requestedHeight=e.requestedHeight,this.scrollLeft=e.scrollLeft,this.scrollTop=e.scrollTop,this.searchResults=e.searchResults,this.pageText=e.pageText,this.undoObject=e.undoObject,this.undoObjectArray=e.undoObjectArray,this.undoIndex=e.undoIndex,this.poppedObjectArray=e.poppedObjectArray,this.poppedIndex=e.poppedIndex,this.newTextAnn=e.newTextAnn,this.imageInfoRequested=e.imageInfoRequested,this.imageInfoLoaded=e.imageInfoLoaded,this.pageAlreadyRendered=e.pageAlreadyRendered},e}),define("vvBoundingBox",["vvPoint","vvUtility","vvDefines"],function(e,t,a){function n(t,a,n,o){this.one=new e(t,a),this.two=new e(t+n,a+o)}return n.prototype.getX1=function(){return this.one.getX()},n.prototype.getY1=function(){return this.one.getY()},n.prototype.getPoint1=function(){return this.one},n.prototype.getPoint2=function(){return this.two},n.prototype.getX2=function(){return this.two.getX()},n.prototype.getY2=function(){return this.two.getY()},n.prototype.getWidth=function(){return this.getX2()-this.getX1()},n.prototype.getHeight=function(){return this.getY2()-this.getY1()},n.prototype.getSlope=function(){return this.getHeight()/this.getWidth()},n.prototype.contains=function(e,a,n,o){var i=t.getNubSize()/2/a;o&&(i=0);var r=e.getX()/a,s=e.getY()/n;return r>=this.getX1()-i&&r<=this.getX2()+i&&s>=this.getY1()-i&&s<=this.getY2()+i},n.prototype.intersects=function(e){return!(e.getX1()>this.getX2()||e.getX2()<this.getX1()||e.getY1()>this.getY2()||e.getY2()<this.getY1())},n.prototype.findCorner=function(e,n,o){var i=t.getNubSize()/2/n,r=t.getNubSize()/2/o,s=e.getX()/n,l=e.getY()/o;return s>=this.getX1()-i&&s<=this.getX1()+i&&l>=this.getY1()-r&&l<=this.getY1()+r?a.corners.upperLeft:s>=this.getX2()-i&&s<=this.getX2()+i&&l>=this.getY1()-r&&l<=this.getY1()+r?a.corners.upperRight:s>=this.getX1()-i&&s<=this.getX1()+i&&l>=this.getY2()-r&&l<=this.getY2()+r?a.corners.lowerLeft:s>=this.getX2()-i&&s<=this.getX2()+i&&l>=this.getY2()-r&&l<=this.getY2()+r?a.corners.lowerRight:null},n.prototype.rotate=function(e,t,a){this.one.rotate(e,t,a),this.two.rotate(e,t,a)},n.prototype.unrotate=function(e,t,a){this.one.unrotate(e,t,a),this.two.unrotate(e,t,a)},n.prototype.copyFrom=function(t){this.one=new e(t.one.x,t.one.y),this.two=new e(t.two.x,t.two.y)},n});var diff_match_patch=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff=function(e,t){this[0]=e,this[1]=t},diff_match_patch.Diff.prototype.length=2,diff_match_patch.Diff.prototype.toString=function(){return this[0]+","+this[1]},diff_match_patch.prototype.diff_main=function(e,t,a,n){if("undefined"==typeof n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new diff_match_patch.Diff(DIFF_EQUAL,e)]:[];"undefined"==typeof a&&(a=!0);var o=a,i=this.diff_commonPrefix(e,t);a=e.substring(0,i),e=e.substring(i),t=t.substring(i),i=this.diff_commonSuffix(e,t);var r=e.substring(e.length-i);return e=e.substring(0,e.length-i),t=t.substring(0,t.length-i),e=this.diff_compute_(e,t,o,n),a&&e.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),r&&e.push(new diff_match_patch.Diff(DIFF_EQUAL,r)),this.diff_cleanupMerge(e),e},diff_match_patch.prototype.diff_compute_=function(e,t,a,n){if(!e)return[new diff_match_patch.Diff(DIFF_INSERT,t)];if(!t)return[new diff_match_patch.Diff(DIFF_DELETE,e)];var o=e.length>t.length?e:t,i=e.length>t.length?t:e,r=o.indexOf(i);return-1!=r?(a=[new diff_match_patch.Diff(DIFF_INSERT,o.substring(0,r)),new diff_match_patch.Diff(DIFF_EQUAL,i),new diff_match_patch.Diff(DIFF_INSERT,o.substring(r+i.length))],e.length>t.length&&(a[0][0]=a[2][0]=DIFF_DELETE),a):1==i.length?[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]:(o=this.diff_halfMatch_(e,t))?(t=o[1],i=o[3],e=o[4],o=this.diff_main(o[0],o[2],a,n),a=this.diff_main(t,i,a,n),o.concat([new diff_match_patch.Diff(DIFF_EQUAL,e)],a)):a&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},diff_match_patch.prototype.diff_lineMode_=function(e,t,a){var n=this.diff_linesToChars_(e,t);e=n.chars1,t=n.chars2,n=n.lineArray,e=this.diff_main(e,t,!1,a),this.diff_charsToLines_(e,n),this.diff_cleanupSemantic(e),e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var o=n=t=0,i="",r="";t<e.length;){switch(e[t][0]){case DIFF_INSERT:o++,r+=e[t][1];break;case DIFF_DELETE:n++,i+=e[t][1];break;case DIFF_EQUAL:if(1<=n&&1<=o){for(e.splice(t-n-o,n+o),t=t-n-o,n=this.diff_main(i,r,!1,a),o=n.length-1;0<=o;o--)e.splice(t,0,n[o]);t+=n.length}n=o=0,r=i=""}t++}return e.pop(),e},diff_match_patch.prototype.diff_bisect_=function(e,t,a){for(var n=e.length,o=t.length,i=Math.ceil((n+o)/2),r=2*i,s=Array(r),l=Array(r),u=0;u<r;u++)s[u]=-1,l[u]=-1;s[i+1]=0,l[i+1]=0,u=n-o;for(var d=0!=u%2,c=0,g=0,v=0,p=0,h=0;h<i&&!((new Date).getTime()>a);h++){for(var m=-h+c;m<=h-g;m+=2){for(var f=i+m,y=m==-h||m!=h&&s[f-1]<s[f+1]?s[f+1]:s[f-1]+1,b=y-m;y<n&&b<o&&e.charAt(y)==t.charAt(b);)y++,b++;if(s[f]=y,y>n)g+=2;else if(b>o)c+=2;else if(d&&(f=i+u-m,0<=f&&f<r&&-1!=l[f])){var P=n-l[f];if(y>=P)return this.diff_bisectSplit_(e,t,y,b,a)}}for(m=-h+v;m<=h-p;m+=2){for(f=i+m,P=m==-h||m!=h&&l[f-1]<l[f+1]?l[f+1]:l[f-1]+1,y=P-m;P<n&&y<o&&e.charAt(n-P-1)==t.charAt(o-y-1);)P++,y++;if(l[f]=P,P>n)p+=2;else if(y>o)v+=2;else if(!d&&(f=i+u-m,0<=f&&f<r&&-1!=s[f]&&(y=s[f],b=i+y-f,P=n-P,y>=P)))return this.diff_bisectSplit_(e,t,y,b,a)}}return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]},diff_match_patch.prototype.diff_bisectSplit_=function(e,t,a,n,o){var i=e.substring(0,a),r=t.substring(0,n);return e=e.substring(a),t=t.substring(n),i=this.diff_main(i,r,!1,o),o=this.diff_main(e,t,!1,o),i.concat(o)},diff_match_patch.prototype.diff_linesToChars_=function(e,t){function a(e){for(var t="",a=0,r=-1,s=n.length;r<e.length-1;){r=e.indexOf("\n",a),-1==r&&(r=e.length-1);var l=e.substring(a,r+1);(o.hasOwnProperty?o.hasOwnProperty(l):void 0!==o[l])?t+=String.fromCharCode(o[l]):(s==i&&(l=e.substring(a),r=e.length),t+=String.fromCharCode(s),o[l]=s,n[s++]=l),a=r+1}return t}var n=[],o={};n[0]="";var i=4e4,r=a(e);i=65535;var s=a(t);return{chars1:r,chars2:s,lineArray:n}},diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var a=0;a<e.length;a++){for(var n=e[a][1],o=[],i=0;i<n.length;i++)o[i]=t[n.charCodeAt(i)];e[a][1]=o.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var a=0,n=Math.min(e.length,t.length),o=n,i=0;a<o;)e.substring(i,o)==t.substring(i,o)?i=a=o:n=o,o=Math.floor((n-a)/2+a);return o},diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var a=0,n=Math.min(e.length,t.length),o=n,i=0;a<o;)e.substring(e.length-o,e.length-i)==t.substring(t.length-o,t.length-i)?i=a=o:n=o,o=Math.floor((n-a)/2+a);return o},diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var a=e.length,n=t.length;if(0==a||0==n)return 0;if(a>n?e=e.substring(a-n):a<n&&(t=t.substring(0,a)),a=Math.min(a,n),e==t)return a;n=0;for(var o=1;;){var i=e.substring(a-o);if(i=t.indexOf(i),-1==i)return n;o+=i,0!=i&&e.substring(a-o)!=t.substring(0,o)||(n=o,o++)}},diff_match_patch.prototype.diff_halfMatch_=function(e,t){function a(e,t,a){for(var n,o,r,s,l=e.substring(a,a+Math.floor(e.length/4)),u=-1,d="";-1!=(u=t.indexOf(l,u+1));){var c=i.diff_commonPrefix(e.substring(a),t.substring(u)),g=i.diff_commonSuffix(e.substring(0,a),t.substring(0,u));d.length<g+c&&(d=t.substring(u-g,u)+t.substring(u,u+c),n=e.substring(0,a-g),o=e.substring(a+c),r=t.substring(0,u-g),s=t.substring(u+c))}return 2*d.length>=e.length?[n,o,r,s,d]:null}if(0>=this.Diff_Timeout)return null;var n=e.length>t.length?e:t,o=e.length>t.length?t:e;if(4>n.length||2*o.length<n.length)return null;var i=this,r=a(n,o,Math.ceil(n.length/4));if(n=a(n,o,Math.ceil(n.length/2)),!r&&!n)return null;if(r=n?r&&r[4].length>n[4].length?r:n:r,e.length>t.length){n=r[0],o=r[1];var s=r[2],l=r[3]}else s=r[0],l=r[1],n=r[2],o=r[3];return[n,o,s,l,r[4]]},diff_match_patch.prototype.diff_cleanupSemantic=function(e){for(var t=!1,a=[],n=0,o=null,i=0,r=0,s=0,l=0,u=0;i<e.length;)e[i][0]==DIFF_EQUAL?(a[n++]=i,r=l,s=u,u=l=0,o=e[i][1]):(e[i][0]==DIFF_INSERT?l+=e[i][1].length:u+=e[i][1].length,o&&o.length<=Math.max(r,s)&&o.length<=Math.max(l,u)&&(e.splice(a[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,o)),e[a[n-1]+1][0]=DIFF_INSERT,n--,n--,i=0<n?a[n-1]:-1,u=l=s=r=0,o=null,t=!0)),i++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),i=1;i<e.length;)e[i-1][0]==DIFF_DELETE&&e[i][0]==DIFF_INSERT&&(t=e[i-1][1],a=e[i][1],n=this.diff_commonOverlap_(t,a),o=this.diff_commonOverlap_(a,t),n>=o?(n>=t.length/2||n>=a.length/2)&&(e.splice(i,0,new diff_match_patch.Diff(DIFF_EQUAL,a.substring(0,n))),e[i-1][1]=t.substring(0,t.length-n),e[i+1][1]=a.substring(n),i++):(o>=t.length/2||o>=a.length/2)&&(e.splice(i,0,new diff_match_patch.Diff(DIFF_EQUAL,t.substring(0,o))),e[i-1][0]=DIFF_INSERT,e[i-1][1]=a.substring(0,a.length-o),e[i+1][0]=DIFF_DELETE,e[i+1][1]=t.substring(o),i++),i++),i++},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var a=e.charAt(e.length-1),n=t.charAt(0),o=a.match(diff_match_patch.nonAlphaNumericRegex_),i=n.match(diff_match_patch.nonAlphaNumericRegex_),r=o&&a.match(diff_match_patch.whitespaceRegex_),s=i&&n.match(diff_match_patch.whitespaceRegex_);a=r&&a.match(diff_match_patch.linebreakRegex_),n=s&&n.match(diff_match_patch.linebreakRegex_);var l=a&&e.match(diff_match_patch.blanklineEndRegex_),u=n&&t.match(diff_match_patch.blanklineStartRegex_);return l||u?5:a||n?4:o&&!r&&s?3:r||s?2:o||i?1:0}for(var a=1;a<e.length-1;){if(e[a-1][0]==DIFF_EQUAL&&e[a+1][0]==DIFF_EQUAL){var n=e[a-1][1],o=e[a][1],i=e[a+1][1],r=this.diff_commonSuffix(n,o);if(r){var s=o.substring(o.length-r);n=n.substring(0,n.length-r),o=s+o.substring(0,o.length-r),i=s+i}r=n,s=o;for(var l=i,u=t(n,o)+t(o,i);o.charAt(0)===i.charAt(0);){n+=o.charAt(0),o=o.substring(1)+i.charAt(0),i=i.substring(1);var d=t(n,o)+t(o,i);d>=u&&(u=d,r=n,s=o,l=i)}e[a-1][1]!=r&&(r?e[a-1][1]=r:(e.splice(a-1,1),a--),e[a][1]=s,l?e[a+1][1]=l:(e.splice(a+1,1),a--))}a++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,a=[],n=0,o=null,i=0,r=!1,s=!1,l=!1,u=!1;i<e.length;)e[i][0]==DIFF_EQUAL?(e[i][1].length<this.Diff_EditCost&&(l||u)?(a[n++]=i,r=l,s=u,o=e[i][1]):(n=0,o=null),l=u=!1):(e[i][0]==DIFF_DELETE?u=!0:l=!0,o&&(r&&s&&l&&u||o.length<this.Diff_EditCost/2&&3==r+s+l+u)&&(e.splice(a[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,o)),e[a[n-1]+1][0]=DIFF_INSERT,n--,o=null,r&&s?(l=u=!0,n=0):(n--,i=0<n?a[n-1]:-1,l=u=!1),t=!0)),i++;t&&this.diff_cleanupMerge(e)},diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var t,a=0,n=0,o=0,i="",r="";a<e.length;)switch(e[a][0]){case DIFF_INSERT:o++,r+=e[a][1],a++;break;case DIFF_DELETE:n++,i+=e[a][1],a++;break;case DIFF_EQUAL:1<n+o?(0!==n&&0!==o&&(t=this.diff_commonPrefix(r,i),0!==t&&(0<a-n-o&&e[a-n-o-1][0]==DIFF_EQUAL?e[a-n-o-1][1]+=r.substring(0,t):(e.splice(0,0,new diff_match_patch.Diff(DIFF_EQUAL,r.substring(0,t))),a++),r=r.substring(t),i=i.substring(t)),t=this.diff_commonSuffix(r,i),0!==t&&(e[a][1]=r.substring(r.length-t)+e[a][1],r=r.substring(0,r.length-t),i=i.substring(0,i.length-t))),a-=n+o,e.splice(a,n+o),i.length&&(e.splice(a,0,new diff_match_patch.Diff(DIFF_DELETE,i)),a++),r.length&&(e.splice(a,0,new diff_match_patch.Diff(DIFF_INSERT,r)),a++),a++):0!==a&&e[a-1][0]==DIFF_EQUAL?(e[a-1][1]+=e[a][1],e.splice(a,1)):a++,n=o=0,r=i=""}for(""===e[e.length-1][1]&&e.pop(),n=!1,a=1;a<e.length-1;)e[a-1][0]==DIFF_EQUAL&&e[a+1][0]==DIFF_EQUAL&&(e[a][1].substring(e[a][1].length-e[a-1][1].length)==e[a-1][1]?(e[a][1]=e[a-1][1]+e[a][1].substring(0,e[a][1].length-e[a-1][1].length),
e[a+1][1]=e[a-1][1]+e[a+1][1],e.splice(a-1,1),n=!0):e[a][1].substring(0,e[a+1][1].length)==e[a+1][1]&&(e[a-1][1]+=e[a+1][1],e[a][1]=e[a][1].substring(e[a+1][1].length)+e[a+1][1],e.splice(a+1,1),n=!0)),a++;n&&this.diff_cleanupMerge(e)},diff_match_patch.prototype.diff_xIndex=function(e,t){var a,n=0,o=0,i=0,r=0;for(a=0;a<e.length&&(e[a][0]!==DIFF_INSERT&&(n+=e[a][1].length),e[a][0]!==DIFF_DELETE&&(o+=e[a][1].length),!(n>t));a++)i=n,r=o;return e.length!=a&&e[a][0]===DIFF_DELETE?r:r+(t-i)},diff_match_patch.prototype.diff_prettyHtml=function(e){for(var t=[],a=/&/g,n=/</g,o=/>/g,i=/\n/g,r=0;r<e.length;r++){var s=e[r][0],l=e[r][1].replace(a,"&amp;").replace(n,"&lt;").replace(o,"&gt;").replace(i,"&para;<br>");switch(s){case DIFF_INSERT:t[r]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case DIFF_DELETE:t[r]='<del style="background:#ffe6e6;">'+l+"</del>";break;case DIFF_EQUAL:t[r]="<span>"+l+"</span>"}}return t.join("")},diff_match_patch.prototype.diff_text1=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==DIFF_INSERT&&(t[a]=e[a][1]);return t.join("")},diff_match_patch.prototype.diff_text2=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==DIFF_DELETE&&(t[a]=e[a][1]);return t.join("")},diff_match_patch.prototype.diff_levenshtein=function(e){for(var t=0,a=0,n=0,o=0;o<e.length;o++){var i=e[o][1];switch(e[o][0]){case DIFF_INSERT:a+=i.length;break;case DIFF_DELETE:n+=i.length;break;case DIFF_EQUAL:t+=Math.max(a,n),n=a=0}}return t+=Math.max(a,n)},diff_match_patch.prototype.diff_toDelta=function(e){for(var t=[],a=0;a<e.length;a++)switch(e[a][0]){case DIFF_INSERT:t[a]="+"+encodeURI(e[a][1]);break;case DIFF_DELETE:t[a]="-"+e[a][1].length;break;case DIFF_EQUAL:t[a]="="+e[a][1].length}return t.join("\t").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(e,t){for(var a=[],n=0,o=0,i=t.split(/\t/g),r=0;r<i.length;r++){var s=i[r].substring(1);switch(i[r].charAt(0)){case"+":try{a[n++]=new diff_match_patch.Diff(DIFF_INSERT,decodeURI(s))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var l=parseInt(s,10);if(isNaN(l)||0>l)throw Error("Invalid number in diff_fromDelta: "+s);s=e.substring(o,o+=l),"="==i[r].charAt(0)?a[n++]=new diff_match_patch.Diff(DIFF_EQUAL,s):a[n++]=new diff_match_patch.Diff(DIFF_DELETE,s);break;default:if(i[r])throw Error("Invalid diff operation in diff_fromDelta: "+i[r])}}if(o!=e.length)throw Error("Delta length ("+o+") does not equal source text length ("+e.length+").");return a},diff_match_patch.prototype.match_main=function(e,t,a){if(null==e||null==t||null==a)throw Error("Null input. (match_main)");return a=Math.max(0,Math.min(a,e.length)),e==t?0:e.length?e.substring(a,a+t.length)==t?a:this.match_bitap_(e,t,a):-1},diff_match_patch.prototype.match_bitap_=function(e,t,a){function n(e,n){var o=e/t.length,r=Math.abs(a-n);return i.Match_Distance?o+r/i.Match_Distance:r?1:o}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var o=this.match_alphabet_(t),i=this,r=this.Match_Threshold,s=e.indexOf(t,a);-1!=s&&(r=Math.min(n(0,s),r),s=e.lastIndexOf(t,a+t.length),-1!=s&&(r=Math.min(n(0,s),r)));var l=1<<t.length-1;s=-1;for(var u,d,c,g=t.length+e.length,v=0;v<t.length;v++){for(u=0,d=g;u<d;)n(v,a+d)<=r?u=d:g=d,d=Math.floor((g-u)/2+u);g=d,u=Math.max(1,a-d+1);var p=Math.min(a+d,e.length)+t.length;for(d=Array(p+2),d[p+1]=(1<<v)-1;p>=u;p--){var h=o[e.charAt(p-1)];if(d[p]=0===v?(d[p+1]<<1|1)&h:(d[p+1]<<1|1)&h|(c[p+1]|c[p])<<1|1|c[p+1],d[p]&l&&(h=n(v,p-1),h<=r)){if(r=h,s=p-1,!(s>a))break;u=Math.max(1,2*a-s)}}if(n(v+1,a)>r)break;c=d}return s},diff_match_patch.prototype.match_alphabet_=function(e){for(var t={},a=0;a<e.length;a++)t[e.charAt(a)]=0;for(a=0;a<e.length;a++)t[e.charAt(a)]|=1<<e.length-a-1;return t},diff_match_patch.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var a=t.substring(e.start2,e.start2+e.length1),n=0;t.indexOf(a)!=t.lastIndexOf(a)&&a.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,a=t.substring(e.start2-n,e.start2+e.length1+n);n+=this.Patch_Margin,(a=t.substring(e.start2-n,e.start2))&&e.diffs.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),(n=t.substring(e.start2+e.length1,e.start2+e.length1+n))&&e.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,n)),e.start1-=a.length,e.start2-=a.length,e.length1+=a.length+n.length,e.length2+=a.length+n.length}},diff_match_patch.prototype.patch_make=function(e,t,a){if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof a){var n=e;t=this.diff_main(n,t,!0),2<t.length&&(this.diff_cleanupSemantic(t),this.diff_cleanupEfficiency(t))}else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof a)t=e,n=this.diff_text1(t);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof a)n=e;else{if("string"!=typeof e||"string"!=typeof t||!a||"object"!=typeof a)throw Error("Unknown call format to patch_make.");n=e,t=a}if(0===t.length)return[];a=[],e=new diff_match_patch.patch_obj;for(var o=0,i=0,r=0,s=n,l=0;l<t.length;l++){var u=t[l][0],d=t[l][1];switch(o||u===DIFF_EQUAL||(e.start1=i,e.start2=r),u){case DIFF_INSERT:e.diffs[o++]=t[l],e.length2+=d.length,n=n.substring(0,r)+d+n.substring(r);break;case DIFF_DELETE:e.length1+=d.length,e.diffs[o++]=t[l],n=n.substring(0,r)+n.substring(r+d.length);break;case DIFF_EQUAL:d.length<=2*this.Patch_Margin&&o&&t.length!=l+1?(e.diffs[o++]=t[l],e.length1+=d.length,e.length2+=d.length):d.length>=2*this.Patch_Margin&&o&&(this.patch_addContext_(e,s),a.push(e),e=new diff_match_patch.patch_obj,o=0,s=n,i=r)}u!==DIFF_INSERT&&(i+=d.length),u!==DIFF_DELETE&&(r+=d.length)}return o&&(this.patch_addContext_(e,s),a.push(e)),a},diff_match_patch.prototype.patch_deepCopy=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],o=new diff_match_patch.patch_obj;o.diffs=[];for(var i=0;i<n.diffs.length;i++)o.diffs[i]=new diff_match_patch.Diff(n.diffs[i][0],n.diffs[i][1]);o.start1=n.start1,o.start2=n.start2,o.length1=n.length1,o.length2=n.length2,t[a]=o}return t},diff_match_patch.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var a=this.patch_addPadding(e);t=a+t+a,this.patch_splitMax(e);for(var n=0,o=[],i=0;i<e.length;i++){var r=e[i].start2+n,s=this.diff_text1(e[i].diffs),l=-1;if(s.length>this.Match_MaxBits){var u=this.match_main(t,s.substring(0,this.Match_MaxBits),r);-1!=u&&(l=this.match_main(t,s.substring(s.length-this.Match_MaxBits),r+s.length-this.Match_MaxBits),-1==l||u>=l)&&(u=-1)}else u=this.match_main(t,s,r);if(-1==u)o[i]=!1,n-=e[i].length2-e[i].length1;else if(o[i]=!0,n=u-r,r=-1==l?t.substring(u,u+s.length):t.substring(u,l+this.Match_MaxBits),s==r)t=t.substring(0,u)+this.diff_text2(e[i].diffs)+t.substring(u+s.length);else if(r=this.diff_main(s,r,!1),s.length>this.Match_MaxBits&&this.diff_levenshtein(r)/s.length>this.Patch_DeleteThreshold)o[i]=!1;else{this.diff_cleanupSemanticLossless(r),s=0;var d;for(l=0;l<e[i].diffs.length;l++){var c=e[i].diffs[l];c[0]!==DIFF_EQUAL&&(d=this.diff_xIndex(r,s)),c[0]===DIFF_INSERT?t=t.substring(0,u+d)+c[1]+t.substring(u+d):c[0]===DIFF_DELETE&&(t=t.substring(0,u+d)+t.substring(u+this.diff_xIndex(r,s+c[1].length))),c[0]!==DIFF_DELETE&&(s+=c[1].length)}}}return t=t.substring(a.length,t.length-a.length),[t,o]},diff_match_patch.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,a="",n=1;n<=t;n++)a+=String.fromCharCode(n);for(n=0;n<e.length;n++)e[n].start1+=t,e[n].start2+=t;n=e[0];var o=n.diffs;if(0==o.length||o[0][0]!=DIFF_EQUAL)o.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t;else if(t>o[0][1].length){var i=t-o[0][1].length;o[0][1]=a.substring(o[0][1].length)+o[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}return n=e[e.length-1],o=n.diffs,0==o.length||o[o.length-1][0]!=DIFF_EQUAL?(o.push(new diff_match_patch.Diff(DIFF_EQUAL,a)),n.length1+=t,n.length2+=t):t>o[o.length-1][1].length&&(i=t-o[o.length-1][1].length,o[o.length-1][1]+=a.substring(0,i),n.length1+=i,n.length2+=i),a},diff_match_patch.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,a=0;a<e.length;a++)if(!(e[a].length1<=t)){var n=e[a];e.splice(a--,1);for(var o=n.start1,i=n.start2,r="";0!==n.diffs.length;){var s=new diff_match_patch.patch_obj,l=!0;for(s.start1=o-r.length,s.start2=i-r.length,""!==r&&(s.length1=s.length2=r.length,s.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,r)));0!==n.diffs.length&&s.length1<t-this.Patch_Margin;){r=n.diffs[0][0];var u=n.diffs[0][1];r===DIFF_INSERT?(s.length2+=u.length,i+=u.length,s.diffs.push(n.diffs.shift()),l=!1):r===DIFF_DELETE&&1==s.diffs.length&&s.diffs[0][0]==DIFF_EQUAL&&u.length>2*t?(s.length1+=u.length,o+=u.length,l=!1,s.diffs.push(new diff_match_patch.Diff(r,u)),n.diffs.shift()):(u=u.substring(0,t-s.length1-this.Patch_Margin),s.length1+=u.length,o+=u.length,r===DIFF_EQUAL?(s.length2+=u.length,i+=u.length):l=!1,s.diffs.push(new diff_match_patch.Diff(r,u)),u==n.diffs[0][1]?n.diffs.shift():n.diffs[0][1]=n.diffs[0][1].substring(u.length))}r=this.diff_text2(s.diffs),r=r.substring(r.length-this.Patch_Margin),u=this.diff_text1(n.diffs).substring(0,this.Patch_Margin),""!==u&&(s.length1+=u.length,s.length2+=u.length,0!==s.diffs.length&&s.diffs[s.diffs.length-1][0]===DIFF_EQUAL?s.diffs[s.diffs.length-1][1]+=u:s.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,u))),l||e.splice(++a,0,s)}}},diff_match_patch.prototype.patch_toText=function(e){for(var t=[],a=0;a<e.length;a++)t[a]=e[a];return t.join("")},diff_match_patch.prototype.patch_fromText=function(e){var t=[];if(!e)return t;e=e.split("\n");for(var a=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<e.length;){var o=e[a].match(n);if(!o)throw Error("Invalid patch string: "+e[a]);var i=new diff_match_patch.patch_obj;for(t.push(i),i.start1=parseInt(o[1],10),""===o[2]?(i.start1--,i.length1=1):"0"==o[2]?i.length1=0:(i.start1--,i.length1=parseInt(o[2],10)),i.start2=parseInt(o[3],10),""===o[4]?(i.start2--,i.length2=1):"0"==o[4]?i.length2=0:(i.start2--,i.length2=parseInt(o[4],10)),a++;a<e.length;){o=e[a].charAt(0);try{var r=decodeURI(e[a].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+r)}if("-"==o)i.diffs.push(new diff_match_patch.Diff(DIFF_DELETE,r));else if("+"==o)i.diffs.push(new diff_match_patch.Diff(DIFF_INSERT,r));else if(" "==o)i.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,r));else{if("@"==o)break;if(""!==o)throw Error('Invalid patch mode "'+o+'" in: '+r)}a++}}return t},diff_match_patch.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},diff_match_patch.patch_obj.prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case DIFF_INSERT:e="+";break;case DIFF_DELETE:e="-";break;case DIFF_EQUAL:e=" "}t[a+1]=e+encodeURI(this.diffs[a][1])+"\n"}return t.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,define("3rdparty/diff_match_patch",function(){}),define("vvDiffManager",["vvUtility","3rdparty/diff_match_patch"],function(e){function t(){this.newDocument={state:null,ignore:[],diffReadableText:[],highlightRects:[]},this.oldDocument={state:null,ignore:[],diffReadableText:[],highlightRects:[]},this.changeObjects=[],this.showHighlights=!0,this.readyToDiff=!1,this.diffDisabled=!1,this.diffDisabledUntilSave=!1,this.diffIsComplete=!1,this.diffReportCallback=null,this.changeInFocus={added:{page:void 0,rects:[]},removed:{page:void 0,rects:[]}}}var a=new diff_match_patch;t.prototype.init=function(e,t){this.oldDocument.state=e,this.newDocument.state=t,this.processTextForDiff()},t.prototype.setDiffDisabled=function(e){this.diffDisabled=!!e},t.prototype.setDiffComplete=function(e){var t=this.diffIsComplete!==!!e;this.diffIsComplete=!!e,t&&this.diffIsComplete&&this.diffReportCallback&&this.diffReportCallback(this.getChangeReport())},t.prototype.getOldDocHighlightRects=function(e){if(this.diffDisabled||this.diffDisabledUntilSave)return[];if(this.oldDocument.highlightRects[e])return this.oldDocument.highlightRects[e];var t=n(this.oldDocument,this.changeObjects,DIFF_DELETE,e);return this.oldDocument.highlightRects[e]=t,t},t.prototype.getNewDocHighlightRects=function(e){if(this.diffDisabled||this.diffDisabledUntilSave)return[];if(this.newDocument.highlightRects[e])return this.newDocument.highlightRects[e];var t=n(this.newDocument,this.changeObjects,DIFF_INSERT,e);return this.newDocument.highlightRects[e]=t,t},t.prototype.focusOnChange=function(e,t){var a=this.changeObjects[e][t];return a[0]===DIFF_INSERT?(this.changeInFocus.added.page=e,this.changeInFocus.added.rects=this.getAllRectsOfChangeObject(e,t),this.changeInFocus.added.rects):(this.changeInFocus.removed.page=e,this.changeInFocus.removed.rects=this.getAllRectsOfChangeObject(e,t),this.changeInFocus.removed.rects)},t.prototype.getAllRectsOfChangeObject=function(e,t){this.newDocument.highlightRects[e]&&this.oldDocument.highlightRects[e]||(this.getNewDocHighlightRects(e),this.getOldDocHighlightRects(e));for(var a=this.changeObjects[e],n=a[t],o=0,i=0;i<t;i++){var r=a[i];r[0]===n[0]&&o++}return n[0]===DIFF_INSERT?this.newDocument.highlightRects[e][o]:this.oldDocument.highlightRects[e][o]};var n=function(e,t,a,n){var i=[],r=t[n];if(!r)return i;for(var s=0,l=0;l<r.length;l++){var u=r[l],d=s+u[1].length;if(u[0]===a){var c=e.state.pageStates[n].pageText.wordRects.slice(s,d),g=o(c);i.push(g),s=d}else u[0]===DIFF_EQUAL&&(s=d)}return i};t.prototype.allChangeObjectsToRects=function(e){if(!this.changeObjects[e])return[];for(var t=[],a=0,n=0,i=0;i<this.changeObjects[e].length;i++){var r,s,l=this.changeObjects[e][i];l[0]===DIFF_EQUAL?(r=a+l[1].length,s=this.oldDocument.state.pageStates[e].pageText.wordRects.slice(a,r),a=r,n+=l[1].length):l[0]===DIFF_INSERT?(r=n+l[1].length,s=this.newDocument.state.pageStates[e].pageText.wordRects.slice(n,r),n=r):l[0]===DIFF_DELETE&&(r=a+l[1].length,s=this.oldDocument.state.pageStates[e].pageText.wordRects.slice(a,r),a=r),l[2]=s,l[3]=o(s),t.push(l)}return t};var o=function(t){var a=null,n=[];if(!t||!t.length)return n;for(var o=0,i=0;i<t.length;i++)a?a.top!==t[i].top?(n.push(a),o++,a=new e.ImageRect(t[i].left,t[i].top,t[i].right,t[i].bottom)):a.right=t[i].right:(o++,a=new e.ImageRect(t[i].left,t[i].top,t[i].right,t[i].bottom));return!n.length!==o&&n.push(a),n};t.prototype.processPageTextForDiff=function(e){this.newDocument.state&&this.oldDocument.state&&!this.diffDisabled&&!this.diffDisabledUntilSave&&(i(this.newDocument,e),i(this.oldDocument,e))},t.prototype.processTextForDiff=function(){if(this.newDocument.state&&this.oldDocument.state&&this.newDocument.state.documentFullyLoaded()&&this.oldDocument.state.documentFullyLoaded()&&!this.diffDisabled&&!this.diffDisabledUntilSave){for(var e=0;e<this.newDocument.state.getPageCount();e++)i(this.newDocument,e);for(e=0;e<this.oldDocument.state.getPageCount();e++)i(this.oldDocument,e)}};var i=function(t,a){if(t.state&&t.state.documentFullyLoaded()&&!(!t.state.getPageCount()>a)){if(null===t.state.getPageText(a))return void(t.diffReadableText[a]="");var n=t.state.getPageText(a).wordRects;t.diffReadableText[a]=e.wordRectsToPageString(n)}};t.prototype.startDiff=function(){if(!this.diffDisabled&&!this.diffDisabledUntilSave)for(var e=0;e<Math.max(this.oldDocument.state.getPageCount(),this.newDocument.state.getPageCount());e++)this.diffPage(e)},t.prototype.diffPage=function(e){if(!this.diffDisabled&&!this.diffDisabledUntilSave){var t=this.oldDocument.diffReadableText[e]||"",n=this.newDocument.diffReadableText[e]||"";this.changeObjects[e]=a.diff_main(t,n),a.diff_cleanupSemantic(this.changeObjects[e]),this.changeObjects[e]&&this.changeObjects[e].length&&(this.oldDocument.highlightRects[e]=null,this.newDocument.highlightRects[e]=null)}},t.prototype.getChangeReport=function(){var e=$.templates("#documentCompareReportTemplate"),t=e.render(this.changeObjects),a=$("<div></div>").attr("id","vvDocumentCompareReport").append(t);return a[0]},t.prototype.displayChangeObjects=function(e,t){if(this.diffDisabled||this.diffDisabledUntilSave)return null;var a;e=e||0;for(var n=0;n<this.changeObjects.length;n++)if(a=r(n),n<e)a.children().length||($("<img />").attr("src","resources/loader.gif").appendTo(a),a.addClass("diffPageLoading").attr("aria-expanded","true"),this.setDiffComplete(!1));else{if(null===this.newDocument.state.getPageText(n)||null===this.oldDocument.state.getPageText(n))return a.empty(),$("<img />").attr("src","resources/loader.gif").appendTo(a),a.addClass("diffPageLoading").attr("aria-expanded","true"),this.setDiffComplete(!1),!1;this.fillPageChangeObjects(n,a),a.find(".vvChangeObject").on("click",t)}var o=0===$(".diffPageLoading").length;return this.setDiffComplete(o),o},t.prototype.fillDiffPane=function(t,a){return this.diffDisabledUntilSave?($("#vvDocCompareInternal").empty(),$("<div></div>").addClass("vvCannotDiffMessage").text(e.getLocalizedValue("documentCompare.cannotCompareUntilSave","Document compare will resume when cropped or reordered documents have been saved.")).appendTo("#vvDocCompareInternal"),!0):this.diffDisabled?($("#vvDocCompareInternal").empty(),$("<div></div>").addClass("vvCannotDiffMessage").text(e.getLocalizedValue("documentCompare.cannotCompare","These documents cannot be compared. One or more of them contains no text.")).appendTo("#vvDocCompareInternal"),!0):t||0===t?($("#vvLoadMoreButton").remove(),this.displayChangeObjects(t,a)):($("#vvDocCompareInternal").empty(),this.displayChangeObjects(0,a))};var r=function(t){var a=$("#vvDocCompareInternal .diffPageContainer[pageNumber='"+t+"']");return a.length||($("<a></a>").text(e.getLocalizedValue("thumbPageLabel","Page ")+(t+1)).attr({href:".diffPageContainer[pageNumber='"+t+"']",role:"button","data-toggle":"collapse",pageNumber:t}).addClass("vvDiffPageCollapseButton btn").on("dragstart",function(){return!1}).append("<span class='caret'></span>").appendTo("#vvDocCompareInternal"),a=$("<div></div>").addClass("diffPageContainer collapse").attr("pageNumber",t),a.appendTo("#vvDocCompareInternal"),$("<div></div>").addClass("vvDocComparePageDivider").appendTo("#vvDocCompareInternal")),a};t.prototype.fillPageChangeObjects=function(t,a){if(!this.changeObjects[t])return a;if(a.empty().removeClass("diffPageLoading"),1===this.changeObjects[t].length&&this.changeObjects[t][0][0]===DIFF_EQUAL){var n=$("<div></div").addClass("vvNoChangesObject");return $("<div></div>").addClass("vvChangedText").append($("<span></span>").text(e.getLocalizedValue("documentCompare.noChangesOnPage","No changes to display"))).appendTo(n),n.appendTo(a),a}for(var o=0;o<this.changeObjects[t].length;o++)if(this.changeObjects[t][o][0]!==DIFF_EQUAL&&13!==this.changeObjects[t][o][1].charCodeAt(0)){var i=s(this.changeObjects[t][o],o);i&&a.append(i)}return a};var s=function(t,a){var n=$("<div></div").addClass("vvChangeObject").data("changeIndex",a);$("<label></label>").addClass("vvChangeType").appendTo(n);var o=$("<div></div>").addClass("vvChangedText").addClass("ellipsis").append($("<span></span>").text(t[1])).appendTo(n),i=t[1];if(i=i.replace(/\u200B/g,""),0!==i.length)return 0===i.trim().length&&o.find("span").css("white-space","pre"),t[0]===DIFF_INSERT?(n.find(".vvChangeType").text(e.getLocalizedValue("documentCompare.changeTypes.added","Added")),n.addClass("vvChangeAdded"),n):t[0]===DIFF_DELETE?(n.find(".vvChangeType").text(e.getLocalizedValue("documentCompare.changeTypes.removed","Removed")),n.addClass("vvChangeRemoved"),n):void 0};return t}),define("vvLayerManager",["require","vvUtility","user-config/config","vvDefines","vvAnnotationManager","vvStateManager"],function(e,t,a,n){function o(){this.invisibleLayers=[],this.imageLayerVisibilityHasChanged=!1}var i="imageLayer-",r="annLayer-";o.prepareLayerDialog=function(){$("#vvImageLayersVisibleAll").on("click",function(e){e.stopPropagation(),A($("#vvImageLayersList").hasClass("vvAllLayerVisibilityNotSet"))}),$("#vvAnnLayersVisibleAll").on("click",function(e){e.stopPropagation(),A($("#vvAnnotationLayersList").hasClass("vvAllLayerVisibilityNotSet"),!0)}),a.enableConsolidateAnnotationLayer?$("#vvConsolidateLayersButton").on("click",function(){if("true"!==$(this).prop("disabled")){$(this).prop("disabled",!0);var e={layerName:"Master Layer",visibility:!0};$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer");var t=c(e,!0);t.addClass("vvConsolidatedLayerItem vvAnnLayerAdded"),$("#vvAnnotationLayersList").append(t)}}):$("#vvConsolidateLayersButton").remove(),$("#vvAnnLayersAdd").on("click",function(){var e=$("#vvAnnotationLayersList");return e.hasClass("vvAddingNewLayer")?void $("#vvAddNewLayerListItem input").focus():(e.addClass("vvAddingNewLayer"),void $("#vvAddNewLayerListItem input").focus())}),$("#vvAddNewLayerListItem .okButton").on("click",l),$("#vvAddNewLayerListItem .cancelButton").on("click",s),$("#vvLayerManagerOK").on("click",function(){d(),u(),$("#vvLayerManagerDiv").modal("hide")}),$("#vvLayerManagerCancel").on("click",function(){$("#vvLayerManagerDiv").modal("hide")})};var s=function(e){e.stopPropagation(),M(),$("#vvAnnotationLayersList").removeClass("vvAddingNewLayer")},l=function(e){e&&e.stopPropagation();var t=$("#vvAddNewLayerListItem input"),a=t.val();if(!D(a))return void P(t,!0);P(t,!1),t.val("");var n=$("#vvAnnotationLayersList");n.removeClass("vvAddingNewLayer vvEmptyOfLayers");var o={layerName:a,visibility:!0};$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer");var i=c(o,!0);i.addClass("vvAnnLayerAdded").appendTo(n),$("#vvAnnotationLayersList .vvConsolidatedLayerItem").length||$("#vvConsolidateLayersButton").prop("disabled",!1)},u=function(){var t=e("vvStateManager").getActivePaneState(),n=!1;if(!a.oneLayerPerAnnotation){$("#vvAnnotationLayersList .vvConsolidatedLayerItem").length&&($("#vvAnnotationLayersList .vvConsolidatedLayerItem").remove(),n=!0);for(var o=$(".vvLayerMarkedForDeletion"),i=0;i<o.length;i++){var s=$(o[i]).attr("id").slice(r.length);w(s,t),$(o[i]).remove()}for(var u=$(".vvLayerListItemEditing"),d=0;d<u.length;d++)h(null,$(u[d]));var c=$("#vvAnnotationLayersList");c.hasClass("vvAddingNewLayer")&&(l(),$("#vvAddNewLayerListItem input").val(""),c.removeClass("vvAddingNewLayer"));for(var g=t.getPageNumber(),v=$("#vvAnnotationLayersList .vvLayerListItem").not("#vvAddNewLayerListItem, .vvEmptyLayerItem"),p=!1,m=null,f=v.length,y=0;y<f;y++){var b=$(v[y]),P=$(b).attr("id");if(P){var A,T=P.slice(r.length),D=b.find(".vvLayerNameText").text().trim();if(b.hasClass("vvAnnLayerAdded")?(T=D,A=e("vvAnnotationManager").createLayer(T,g,t),C(A,t)):A=t.getLayerFromPage(g,T),A){var M=$(b).hasClass("vvLayerVisible")&&!c.hasClass("vvAllLayersInvisible");M!==A.visibility&&S(T,M,t),D===T||$(b).hasClass(".vvLayerListItemEditing")||I(T,D,t),p&&C(A),b.hasClass("activeAnnLayer")&&(m=A)}}}m&&t.setCurrentLayer(m),n&&f&&virtualViewer.consolidateAnnotationLayers(),virtualViewer.fillAnnotationList(),virtualViewer.delayedPaintCanvases()}},d=function(){var t=e("vvStateManager"),a=t.getActivePaneState().getLayerManager();if(t.getActivePaneState().imageLayers&&t.getActivePaneState().imageLayers.length){for(var n=$("#vvImageLayersList .vvLayerListItem.vvLayerInvisible"),o=[],r=a.invisibleLayers.length,s=0;s<n.length;s++){var l=n.eq(s).attr("id");if(l){var u=l.slice(i.length),d=a.invisibleLayers.indexOf(u);d>-1&&a.invisibleLayers.splice(d,1),o.push(u)}}return a.invisibleLayers.length||o.length>r?(a.invisibleLayers=o,a.imageLayerVisibilityHasChanged=!0,void virtualViewer.paintCanvases()):void(a.invisibleLayers=o)}};o.prototype.showLayerDialog=function(e){this.clearLayerDialog(),this.fillLayerDialog(e),$("#vvLayerManagerDiv").modal("show")},o.prototype.clearLayerDialog=function(){$(".vvLayerListItem").remove(),$(".vvLayerMarkedForDeletion").remove(),M()},o.prototype.fillLayerDialog=function(e){T(!1,!0);var t=this.fillAnnotationLayers(e),a=this.fillImageLayers(e);a&&t?($("#vvLayerManagerTabs").show(),$("#vvImageLayersTab a").tab("show")):a&&!t?($("#vvImageLayersTab a").tab("show"),$("#vvLayerManagerTabs").hide()):($("#vvAnnotationLayersTab a").tab("show"),$("#vvLayerManagerTabs").hide())},o.prototype.fillImageLayers=function(t){t||(t=e("vvStateManager").getActivePaneState());var a=t.imageLayers;if(!a||!a.length)return!1;for(var n=0;n<a.length;n++)$("#vvImageLayersList").append(this.imageLayerItem(a[n].layer,a[n].color));return!0},o.prototype.imageLayerItem=function(e,a){if(!e)return $();var n=e;$.isNumeric(e)&&(n=t.getLocalizedValue("layerManager.numericLayerLabel","Layer ")+e);var o={color:a||"white",layerName:n,canHide:!0,layerHidden:this.invisibleLayers.indexOf(e)>-1},r=$.templates("#singleLayerItemTemplate"),s=$(r.render(o));return s.attr("id",i+e),s.find(".vvLayerVisButton").on("click",function(e){e.stopPropagation(),$(this).parents(".vvLayerListItem").toggleClass("vvLayerVisible").toggleClass("vvLayerInvisible"),T(!1)}),s},o.prototype.fillAnnotationLayers=function(o){var i=$("#vvAnnotationLayersList");if(a.oneLayerPerAnnotation)return i.addClass("vvEmptyOfLayers"),$("#vvAnnLayersHeadButtons .btn").attr("disabled",!0),!1;$("#vvAnnLayersHeadButtons .btn").attr("disabled",!1),o=o||e("vvStateManager").getActivePaneState();var r=o.getLayerNames(),s=!1,l=0,u=o.getPageNumber(),d="";e("vvAnnotationManager").getCurrentLayer()&&(d=e("vvAnnotationManager").getCurrentLayer().layerName);for(var g=0;g<r.length;g++){var v=r[g],p=o.getLayerFromPage(u,v);if(p&&(!t.isRedactionLayer(p)||!n.hideRedactionLayerFromManager)){"Master Layer"===v&&(s=!0);var h=!1;p.layerName===d&&(h=!0),p&&p.permissionLevel>=n.permissionLevels.PERM_VIEW&&(i.append(c(p,h)),l+=1)}}return l?i.removeClass("vvEmptyOfLayers"):i.addClass("vvEmptyOfLayers"),s||!l?$("#vvConsolidateLayersButton").prop("disabled",!0):$("#vvConsolidateLayersButton").prop("disabled",!1),!0};var c=function(a,o){var i=a.layerName,s=i.indexOf("Master Layer")>-1;s&&$("#vvConsolidateLayersButton").prop("disabled",!0);var l=i;$.isNumeric(i)&&(l=t.getLocalizedValue("layerManager.numericLayerLabel","Layer ")+i);var u={layerName:l,canEdit:e("vvAnnotationManager").checkLayerPermission(a,n.permissionLevels.PERM_EDIT)&&!s,canDelete:e("vvAnnotationManager").checkLayerPermission(a,n.permissionLevels.PERM_DELETE),canHide:!t.isRedactionLayer(a),layerHidden:!a.visibility||$("#vvAnnotationLayersList").hasClass("vvAllLayersInvisible")},d=$.templates("#singleLayerItemTemplate"),c=$(d.render(u));return c.attr("id",r+i),c.find(".vvLayerText").on("click",v),c.on("click",m),c.find(".vvLayerVisButton").on("click",g),c.find(".vvAnnDeleteLayerButton").on("click",f),c.find(".vvEditLayerNameDiv .okButton").on("click",h),c.find(".vvEditLayerNameDiv .cancelButton").on("click",p),c.find(".vvDeleteLayerConfirmation .okButton").on("click",y),c.find(".vvDeleteLayerConfirmation .cancelButton").on("click",b),o&&c.addClass("activeAnnLayer"),c},g=function(e){e.stopPropagation(),$(this).parents(".vvLayerListItem").toggleClass("vvLayerVisible").toggleClass("vvLayerInvisible"),T(!0)},v=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");$(t).addClass("vvLayerListItemEditing"),$(t).find(".vvEditLayerNameDiv input").focus()},p=function(e){e.stopPropagation(),M();var t=$(this).parents(".vvLayerListItem");t.removeClass("vvLayerListItemEditing");var a=t.find(".vvEditLayerNameDiv input");P(a,!1),a.val("")},h=function(e,t){var a=null;e?(e.stopPropagation(),a=$(this).parents(".vvLayerListItem")):a=t;var n=a.find(".vvEditLayerNameDiv input"),o=a.find(".vvLayerNameText"),i=n.val(),r=o.text();return i===r||D(i)?(P(n,!1),n.val(""),a.removeClass("vvLayerListItemEditing"),void o.text(i)):void P(n,!0)},m=function(e){$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer"),$(this).addClass("activeAnnLayer")},f=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");t.addClass("vvLayerDeletionInquiry")},y=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");if(t.addClass("vvLayerMarkedForDeletion"),t.removeClass("vvLayerDeletionInquiry"),t.removeClass("vvLayerListItem"),$(t).hasClass("activeAnnLayer")){$(t).removeClass("activeAnnLayer");var a=$("#vvAnnotationLayersList .vvLayerListItem");a.length?$($(a)[0]).addClass("activeAnnLayer"):($("#vvAnnotationLayersList").addClass("vvEmptyOfLayers"),$("#vvConsolidateLayersButton").prop("disabled",!0))}var n=$(t).get(0).id.indexOf("Master Layer")>-1;($(t).hasClass("vvConsolidatedLayerItem")||n)&&$("#vvConsolidateLayersButton").prop("disabled",!1),t.hasClass("vvAnnLayerAdded")&&t.remove()},b=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");t.removeClass("vvLayerDeletionInquiry")},P=function(e,a){return a?($(e).attr("aria-invalid",!0),void M(t.getLocalizedValue("errors.invalidLayerName","Invalid layer name. Please choose a new layer name."))):($(e).attr("aria-invalid",!1),void M())},A=function(e,t){var a;a=t?$("#vvAnnotationLayersList"):$("#vvImageLayersList"),a.toggleClass("vvAllLayerVisibilityNotSet",!e).toggleClass("vvAllLayersInvisible",e),a.find(".vvLayerListItem").toggleClass("vvLayerInvisible",e).toggleClass("vvLayerVisible",!e)},T=function(e,t){var a;a=t?$("#vvImageLayersList, #vvAnnotationLayersList"):e?$("#vvAnnotationLayersList"):$("#vvImageLayersList"),a.toggleClass("vvAllLayerVisibilityNotSet",!0).toggleClass("vvAllLayersInvisible",!1)};o.prototype.toggleAllAnnotationLayersVisibility=function(e,t){t||(t=virtualViewer.getActivePaneState());var a=t.getLayerNames();if("undefined"==typeof e&&a.length>0){var n=t.getLayerFromPage(0,a[0]);e=!n.visibility}for(var o=0;o<a.length;o++)S(a[o],e,t);virtualViewer.delayedPaintCanvases()};var S=function(t,a,n){n||(n=e("vvStateManager").getActivePaneState());for(var o=0;o<n.getPageCount();o++){var i=n.getLayerFromPage(o,t);i&&(i.visibility=a)}virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null)},I=function(t,a,n){n||(n=e("vvStateManager").getActivePaneState()),e("vvAnnotationManager").renameLayerCore(t,a),n.renameLayer(t,a),n.getDocumentModel().renameLayer(t,a)},w=function(t,a){a||(a=e("vvStateManager").getActivePaneState());var n=a.getLayerNames(),o=n.indexOf(t);n.splice(o,1),a.setLayerNames(n),a.deleteLayer(t)},D=function(e){if(!e)return!1;if(e.length>50)return!1;for(var t=$(".vvLayerNameText"),a=0;a<t.length;a++)if(t.eq(a).text()===e)return!1;return!0},C=function(t,a){a||(a=e("vvStateManager").getActivePaneState()),a.getDocumentModel().markLayerDirty(t)},M=function(e){return e?($("#vvLayerManagerErrorBanner").show(),void $("#vvLayerManagerErrorBanner > span").text(e)):($("#vvLayerManagerErrorBanner > span").empty(),void $("#vvLayerManagerErrorBanner").hide())};return o.prototype.getHiddenImageLayers=function(e){if(!this.invisibleLayers.length)return null;if(!e)return this.invisibleLayers.join(",");for(var t=[],a=0;a<this.invisibleLayers.length;a++)t.push(encodeURIComponent(this.invisibleLayers[a]));return t.join(",")},o}),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("3rdparty/pica.min",[],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pica=e()}(function(){return function e(t,a,n){function o(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var d=a[r]={exports:{}};t[r][0].call(d.exports,function(e){return o(t[r][1][e]||e)},d,d.exports,e,t,a,n)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";function n(e){var t=e||[],a={js:0<=t.indexOf("js"),wasm:0<=t.indexOf("wasm")};i.call(this,a),this.features={js:a.js,wasm:a.wasm&&this.has_wasm()
},this.use(r),this.use(s)}var o=e("inherits"),i=e("multimath"),r=e("multimath/lib/unsharp_mask"),s=e("./mm_resize");o(n,i),n.prototype.resizeAndUnsharp=function(e,t){var a=this.resize(e,t);return e.unsharpAmount&&this.unsharp_mask(a,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold),a},t.exports=n},{"./mm_resize":4,inherits:15,multimath:16,"multimath/lib/unsharp_mask":19}],2:[function(e,t,a){"use strict";function n(e){return e<0?0:255<e?255:e}t.exports={convolveHorizontally:function(e,t,a,o,i,r){var s,l,u,d,c,g,v,p,h,m,f,y=0,b=0;for(h=0;h<o;h++){for(m=c=0;m<i;m++){for(g=r[c++],v=r[c++],p=y+4*g|0,s=l=u=d=0;0<v;v--)d=d+(f=r[c++])*e[p+3]|0,u=u+f*e[p+2]|0,l=l+f*e[p+1]|0,s=s+f*e[p]|0,p=p+4|0;t[b+3]=n(d+8192>>14),t[b+2]=n(u+8192>>14),t[b+1]=n(l+8192>>14),t[b]=n(s+8192>>14),b=b+4*o|0}b=4*(h+1)|0,y=(h+1)*a*4|0}},convolveVertically:function(e,t,a,o,i,r){var s,l,u,d,c,g,v,p,h,m,f,y=0,b=0;for(h=0;h<o;h++){for(m=c=0;m<i;m++){for(g=r[c++],v=r[c++],p=y+4*g|0,s=l=u=d=0;0<v;v--)d=d+(f=r[c++])*e[p+3]|0,u=u+f*e[p+2]|0,l=l+f*e[p+1]|0,s=s+f*e[p]|0,p=p+4|0;t[b+3]=n(d+8192>>14),t[b+2]=n(u+8192>>14),t[b+1]=n(l+8192>>14),t[b]=n(s+8192>>14),b=b+4*o|0}b=4*(h+1)|0,y=(h+1)*a*4|0}}}},{}],3:[function(e,t,a){"use strict";t.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="},{}],4:[function(e,t,a){"use strict";t.exports={name:"resize",fn:e("./resize"),wasm_fn:e("./resize_wasm"),wasm_src:e("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(e,t,a){"use strict";var n=e("./resize_filter_gen"),o=e("./convolve").convolveHorizontally,i=e("./convolve").convolveVertically;t.exports=function(e){var t=e.src,a=e.width,r=e.height,s=e.toWidth,l=e.toHeight,u=e.scaleX||e.toWidth/e.width,d=e.scaleY||e.toHeight/e.height,c=e.offsetX||0,g=e.offsetY||0,v=e.dest||new Uint8Array(s*l*4),p=void 0===e.quality?3:e.quality,h=e.alpha||!1,m=n(p,a,s,u,c),f=n(p,r,l,d,g),y=new Uint8Array(s*r*4);return o(t,y,a,r,s,m),i(y,v,r,s,l,f),h||function(e,t,a){for(var n=3,o=t*a*4|0;n<o;)e[n]=255,n=n+4|0}(v,s,l),v}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(e,t,a){"use strict";function n(e){return Math.round(e*((1<<i)-1))}var o=e("./resize_filter_info"),i=14;t.exports=function(e,t,a,i,r){var s,l,u,d,c,g,v,p,h,m,f,y,b,P,A,T,S,I=o[e].filter,w=1/i,D=Math.min(1,i),C=o[e].win/D,M=Math.floor(2*(1+C)),x=new Int16Array((M+2)*a),L=0,N=!x.subarray||!x.set;for(s=0;s<a;s++){for(l=(s+.5)*w+r,u=Math.max(0,Math.floor(l-C)),c=(d=Math.min(t-1,Math.ceil(l+C)))-u+1,g=new Float32Array(c),v=new Int16Array(c),h=u,m=p=0;h<=d;h++,m++)p+=f=I((h+.5-l)*D),g[m]=f;for(m=y=0;m<g.length;m++)y+=b=g[m]/p,v[m]=n(b);for(v[a>>1]+=n(1-y),P=0;P<v.length&&0===v[P];)P++;if(P<v.length){for(A=v.length-1;0<A&&0===v[A];)A--;if(T=u+P,S=A-P+1,x[L++]=T,x[L++]=S,N)for(m=P;m<=A;m++)x[L++]=v[m];else x.set(v.subarray(P,A+1),L),L+=S}else x[L++]=0,x[L++]=0}return x}},{"./resize_filter_info":7}],7:[function(e,t,a){"use strict";t.exports=[{win:.5,filter:function(e){return-.5<=e&&e<.5?1:0}},{win:1,filter:function(e){if(e<=-1||1<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},{win:2,filter:function(e){if(e<=-2||2<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},{win:3,filter:function(e){if(e<=-3||3<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}}]},{}],8:[function(e,t,a){"use strict";function n(e,t,a){if(i)t.set(function(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),a);else for(var n=a,o=0;o<e.length;o++){var r=e[o];t[n++]=255&r,t[n++]=r>>8&255}}var o=e("./resize_filter_gen"),i=!0;try{i=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(e){}t.exports=function(e){var t=e.src,a=e.width,i=e.height,r=e.toWidth,s=e.toHeight,l=e.scaleX||e.toWidth/e.width,u=e.scaleY||e.toHeight/e.height,d=e.offsetX||0,c=e.offsetY||0,g=e.dest||new Uint8Array(r*s*4),v=void 0===e.quality?3:e.quality,p=e.alpha||!1,h=o(v,a,r,l,d),m=o(v,i,s,u,c),f=this.__align(0+Math.max(t.byteLength,g.byteLength)),y=this.__align(f+i*r*4),b=this.__align(y+h.byteLength),P=b+m.byteLength,A=this.__instance("resize",P),T=new Uint8Array(this.__memory.buffer),S=new Uint32Array(this.__memory.buffer),I=new Uint32Array(t.buffer);return S.set(I),n(h,T,y),n(m,T,b),(A.exports.convolveHV||A.exports._convolveHV)(y,b,f,a,i,r,s),new Uint32Array(g.buffer).set(new Uint32Array(this.__memory.buffer,0,s*r)),p||function(e,t,a){for(var n=3,o=t*a*4|0;n<o;)e[n]=255,n=n+4|0}(g,r,s),g}},{"./resize_filter_gen":6}],9:[function(e,t,a){"use strict";function n(e,t){this.create=e,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}n.prototype.acquire=function(){var e,t=this;return 0!==this.available.length?e=this.available.pop():((e=this.create()).id=this.lastId++,e.release=function(){return t.release(e)}),this.acquired[e.id]=e},n.prototype.release=function(e){var t=this;delete this.acquired[e.id],e.lastUsed=Date.now(),this.available.push(e),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return t.gc()},100))},n.prototype.gc=function(){var e=this,t=Date.now();this.available=this.available.filter(function(a){return!(t-a.lastUsed>e.idle&&(a.destroy(),1))}),0!==this.available.length?this.timeoutId=setTimeout(function(){return e.gc()},100):this.timeoutId=0},t.exports=n},{}],10:[function(e,t,a){"use strict";t.exports=function(e,t,a,n,o,i){var r=a/e,s=n/t,l=(2*i+2+1)/o;if(.5<l)return[[a,n]];var u=Math.ceil(Math.log(Math.min(r,s))/Math.log(l));if(u<=1)return[[a,n]];for(var d=[],c=0;c<u;c++){var g=Math.round(Math.pow(Math.pow(e,u-c-1)*Math.pow(a,c+1),1/u)),v=Math.round(Math.pow(Math.pow(t,u-c-1)*Math.pow(n,c+1),1/u));d.push([g,v])}return d}},{}],11:[function(e,t,a){"use strict";function n(e){var t=Math.round(e);return Math.abs(e-t)<i?t:Math.floor(e)}function o(e){var t=Math.round(e);return Math.abs(e-t)<i?t:Math.ceil(e)}var i=1e-5;t.exports=function(e){var t,a,i,r,s,l,u=e.toWidth/e.width,d=e.toHeight/e.height,c=n(e.srcTileSize*u)-2*e.destTileBorder,g=n(e.srcTileSize*d)-2*e.destTileBorder;if(c<1||g<1)throw new Error("Internal error in pica: target tile width/height is too small.");var v,p=[];for(r=0;r<e.toHeight;r+=g)for(i=0;i<e.toWidth;i+=c)(t=i-e.destTileBorder)<0&&(t=0),t+(s=i+c+e.destTileBorder-t)>=e.toWidth&&(s=e.toWidth-t),(a=r-e.destTileBorder)<0&&(a=0),a+(l=r+g+e.destTileBorder-a)>=e.toHeight&&(l=e.toHeight-a),v={toX:t,toY:a,toWidth:s,toHeight:l,toInnerX:i,toInnerY:r,toInnerWidth:c,toInnerHeight:g,offsetX:t/u-n(t/u),offsetY:a/d-n(a/d),scaleX:u,scaleY:d,x:n(t/u),y:n(a/d),width:o(s/u),height:o(l/d)},p.push(v);return p}},{}],12:[function(e,t,a){"use strict";function n(e){return Object.prototype.toString.call(e)}t.exports.isCanvas=function(e){var t=n(e);return"[object HTMLCanvasElement]"===t||"[object Canvas]"===t},t.exports.isImage=function(e){return"[object HTMLImageElement]"===n(e)},t.exports.limiter=function(e){function t(){a<e&&n.length&&(a++,n.shift()())}var a=0,n=[];return function(e){return new Promise(function(o,i){n.push(function(){e().then(function(e){o(e),a--,t()},function(e){i(e),a--,t()})}),t()})}},t.exports.cib_quality_name=function(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},t.exports.cib_support=function(){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;var e=document.createElement("canvas");return e.width=100,e.height=100,createImageBitmap(e,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(t){var a=10===t.width;return t.close(),e=null,a})}).catch(function(){return!1})}},{}],13:[function(e,t,a){"use strict";t.exports=function(){var t,a=e("./mathlib");onmessage=function(e){var n=e.data.opts,o=(t=t||new a(e.data.features)).resizeAndUnsharp(n);postMessage({result:o},[o.buffer])}}},{"./mathlib":1}],14:[function(e,t,a){function n(e,t,a,n,o,i){var r,s,l,u,d,c,g,v,p,h,m,f,y,b;for(p=0;p<i;p++){for(v=0,u=d=(r=e[c=(g=p)*o])*n[6],m=n[0],f=n[1],y=n[4],b=n[5],h=0;h<o;h++)l=(s=e[c])*m+r*f+u*y+d*b,d=u,u=l,r=s,a[v]=u,v++,c++;for(v--,g+=i*(o-1),u=d=(r=e[--c])*n[7],s=r,m=n[2],f=n[3],h=o-1;0<=h;h--)l=s*m+r*f+u*y+d*b,d=u,u=l,r=s,s=e[c],t[g]=a[v]+u,c--,v--,g-=i}}var o,i,r,s,l,u;t.exports=function(e,t,a,d){if(d){var c=new Uint16Array(e.length),g=new Float32Array(Math.max(t,a)),v=function(e){e<.5&&(e=.5);var t=Math.exp(.527076)/e,a=Math.exp(-t),n=Math.exp(-2*t),d=(1-a)*(1-a)/(1+2*t*a-n);return i=(o=d)*(t-1)*a,r=d*(1+t)*a,s=-d*n,l=2*a,u=-n,new Float32Array([o,i,r,s,l,u,(o+i)/(1-l-u),(r+s)/(1-l-u)])}(d);n(e,c,g,v,t,a),n(c,e,g,v,a,t)}}},{}],15:[function(e,t,a){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){function a(){}t&&(e.super_=t,a.prototype=t.prototype,e.prototype=new a,e.prototype.constructor=e)}},{}],16:[function(e,t,a){"use strict";function n(e){if(!(this instanceof n))return new n(e);var t=o({},s,e||{});if(this.options=t,this.__cache={},this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}var o=e("object-assign"),i=e("./lib/base64decode"),r=e("./lib/wa_detect"),s={js:!0,wasm:!0};n.prototype.has_wasm=r,n.prototype.use=function(e){return this.__modules[e.name]=e,this.options.wasm&&this.has_wasm()&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},n.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map(function(t){var a=e.__modules[t];return e.options.wasm&&e.has_wasm()&&a.wasm_fn?e.__wasm[t]?null:WebAssembly.compile(e.__base64decode(a.wasm_src)).then(function(a){e.__wasm[t]=a}):null})).then(function(){return e}),this.__init_promise},n.prototype.__base64decode=i,n.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},n.prototype.__instance=function(e,t,a){if(t&&this.__reallocate(t),!this.__wasm[e]){var n=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[e]){var i={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:o(i,a||{})})}return this.__cache[e]},n.prototype.__align=function(e,t){var a=e%(t=t||8);return e+(a?t-a:0)},t.exports=n},{"./lib/base64decode":17,"./lib/wa_detect":23,"object-assign":24}],17:[function(e,t,a){"use strict";t.exports=function(e){for(var t=e.replace(/[\r\n=]/g,""),a=t.length,n=new Uint8Array(3*a>>2),o=0,i=0,r=0;r<a;r++)r%4==0&&r&&(n[i++]=o>>16&255,n[i++]=o>>8&255,n[i++]=255&o),o=o<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t.charAt(r));var s=a%4*6;return 0==s?(n[i++]=o>>16&255,n[i++]=o>>8&255,n[i++]=255&o):18==s?(n[i++]=o>>10&255,n[i++]=o>>2&255):12==s&&(n[i++]=o>>4&255),n}},{}],18:[function(e,t,a){"use strict";t.exports=function(e,t,a){for(var n,o,i,r,s,l=t*a,u=new Uint16Array(l),d=0;d<l;d++)n=e[4*d],o=e[4*d+1],i=e[4*d+2],s=o<=n&&i<=n?n:i<=o&&n<=o?o:i,r=n<=o&&n<=i?n:o<=i&&o<=n?o:i,u[d]=257*(s+r)>>1;return u}},{}],19:[function(e,t,a){"use strict";t.exports={name:"unsharp_mask",fn:e("./unsharp_mask"),wasm_fn:e("./unsharp_mask_wasm"),wasm_src:e("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":20,"./unsharp_mask_wasm":21,"./unsharp_mask_wasm_base64":22}],20:[function(e,t,a){"use strict";var n=e("glur/mono16"),o=e("./hsl_l16");t.exports=function(e,t,a,i,r,s){var l,u,d,c,g,v,p,h,m,f,y,b,P;if(!(0===i||r<.5)){2<r&&(r=2);var A=o(e,t,a),T=new Uint16Array(A);n(T,t,a,r);for(var S=i/100*4096+.5|0,I=257*s|0,w=t*a,D=0;D<w;D++)b=2*(A[D]-T[D]),Math.abs(b)>=I&&(l=e[P=4*D],u=e[1+P],d=e[2+P],v=257*((h=u<=l&&d<=l?l:l<=u&&d<=u?u:d)+(p=l<=u&&l<=d?l:u<=l&&u<=d?u:d))>>1,c=p===h?g=0:(g=v<=32767?4095*(h-p)/(h+p)|0:4095*(h-p)/(510-h-p)|0,l===h?65535*(u-d)/(6*(h-p))|0:u===h?21845+(65535*(d-l)/(6*(h-p))|0):43690+(65535*(l-u)/(6*(h-p))|0)),65535<(v+=S*b+2048>>12)?v=65535:v<0&&(v=0),0===g?l=u=d=v>>8:(m=2*v-(f=v<=32767?v*(4096+g)+2048>>12:v+((65535-v)*g+2048>>12))>>8,f>>=8,l=43690<=(y=c+21845&65535)?m:32767<=y?m+(6*(f-m)*(43690-y)+32768>>16):10922<=y?f:m+(6*(f-m)*y+32768>>16),u=43690<=(y=65535&c)?m:32767<=y?m+(6*(f-m)*(43690-y)+32768>>16):10922<=y?f:m+(6*(f-m)*y+32768>>16),d=43690<=(y=c-21845&65535)?m:32767<=y?m+(6*(f-m)*(43690-y)+32768>>16):10922<=y?f:m+(6*(f-m)*y+32768>>16)),e[P]=l,e[1+P]=u,e[2+P]=d)}}},{"./hsl_l16":18,"glur/mono16":14}],21:[function(e,t,a){"use strict";t.exports=function(e,t,a,n,o,i){if(!(0===n||o<.5)){2<o&&(o=2);var r=t*a,s=4*r,l=2*r,u=2*r,d=4*Math.max(t,a),c=s,g=c+l,v=g+u,p=v+u,h=p+d,m=this.__instance("unsharp_mask",s+l+2*u+d+32,{exp:Math.exp}),f=new Uint32Array(e.buffer);new Uint32Array(this.__memory.buffer).set(f);var y=m.exports.hsl_l16||m.exports._hsl_l16;y(0,c,t,a),(y=m.exports.blurMono16||m.exports._blurMono16)(c,g,v,p,h,t,a,o),(y=m.exports.unsharp||m.exports._unsharp)(0,0,c,g,t,a,n,i),f.set(new Uint32Array(this.__memory.buffer,0,r))}}},{}],22:[function(e,t,a){"use strict";t.exports="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},{}],23:[function(e,t,a){"use strict";var n;t.exports=function(){if(void 0!==n)return n;if(n=!1,"undefined"==typeof WebAssembly)return n;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(n=!0),n}catch(e){}return n}},{}],24:[function(e,t,a){"use strict";var n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},a=0;a<10;a++)t["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var a,r,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var u in a=Object(arguments[l]))o.call(a,u)&&(s[u]=a[u]);if(n){r=n(a);for(var d=0;d<r.length;d++)i.call(a,r[d])&&(s[r[d]]=a[r[d]])}}return s}},{}],25:[function(e,t,a){var n=arguments[3],o=arguments[4],i=arguments[5],r=JSON.stringify;t.exports=function(e,t){for(var a,s=Object.keys(i),l=0,u=s.length;l<u;l++){var d=s[l],c=i[d].exports;if(c===e||c&&c.default===e){a=d;break}}if(!a){a=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var g={};for(l=0,u=s.length;l<u;l++)g[d=s[l]]=d;o[a]=["function(require,module,exports){"+e+"(self); }",g]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[a]=a,o[v]=["function(require,module,exports){var f = require("+r(a)+");(f.default ? f.default : f)(self);}",p];var h={};!function e(t){h[t]=!0;for(var a in o[t][1]){var n=o[t][1][a];h[n]||e(n)}}(v);var m="("+n+")({"+Object.keys(h).map(function(e){return r(e)+":["+o[e][0]+","+r(o[e][1])+"]"}).join(",")+"},{},["+r(v)+"])",f=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return y;var b=f.createObjectURL(y),P=new Worker(b);return P.objectURL=b,P}},{}],"/":[function(e,t,a){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,o=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(){return{value:s(c),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var e=window.URL||window.webkitURL||window.mozURL||window.msURL;e&&e.revokeObjectURL&&this.value.objectURL&&e.revokeObjectURL(this.value.objectURL)}}}}function i(e){if(!(this instanceof i))return new i(e);this.options=r({},b,e||{});var t="lk_".concat(this.options.concurrency);this.__limit=p[t]||d.limiter(this.options.concurrency),p[t]||(p[t]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}var r=e("object-assign"),s=e("webworkify"),l=e("./lib/mathlib"),u=e("./lib/pool"),d=e("./lib/utils"),c=e("./lib/worker"),g=e("./lib/stepper"),v=e("./lib/tiler"),p={},h=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(h=0<=navigator.userAgent.indexOf("Safari"))}catch(e){}var m=1;"undefined"!=typeof navigator&&(m=Math.min(navigator.hardwareConcurrency||1,4));var f,y,b={tile:1024,concurrency:m,features:["js","wasm","ww"],idle:2e3},P={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};i.prototype.init=function(){var t=this;if(this.__initPromise)return this.__initPromise;if(!1!==f&&!0!==f&&(f=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),f=!0}catch(e){}!1!==y&&!0!==y&&(y=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?y=!0:this.debug("ImageBitmap does not support .close(), disabled")));var a=this.options.features.slice();if(0<=a.indexOf("all")&&(a=["cib","wasm","js","ww"]),this.__requested_features=a,this.__mathlib=new l(a),0<=a.indexOf("ww")&&"undefined"!=typeof window&&"Worker"in window)try{e("webworkify")(function(){}).terminate(),this.features.ww=!0;var n="wp_".concat(JSON.stringify(this.options));p[n]?this.__workersPool=p[n]:(this.__workersPool=new u(o,this.options.idle),p[n]=this.__workersPool)}catch(e){}var i,s=this.__mathlib.init().then(function(e){r(t.features,e.features)});return i=y?d.cib_support().then(function(e){t.features.cib&&a.indexOf("cib")<0?t.debug("createImageBitmap() resize supported, but disabled by config"):0<=a.indexOf("cib")&&(t.features.cib=e)}):Promise.resolve(!1),this.__initPromise=Promise.all([s,i]).then(function(){return t}),this.__initPromise},i.prototype.resize=function(e,t,a){var o=this;this.debug("Start resize...");var i=r({},P);if(isNaN(a)?a&&(i=r(i,a)):i=r(i,{quality:a}),i.toWidth=t.width,i.toHeight=t.height,i.width=e.naturalWidth||e.width,i.height=e.naturalHeight||e.height,0===t.width||0===t.height)return Promise.reject(new Error("Invalid output size: ".concat(t.width,"x").concat(t.height)));2<i.unsharpRadius&&(i.unsharpRadius=2);var s=!1,l=null;i.cancelToken&&(l=i.cancelToken.then(function(e){throw s=!0,e},function(e){throw s=!0,e}));var u=Math.ceil(Math.max(3,2.5*i.unsharpRadius|0));return this.init().then(function(){function a(e,t,a){function n(t){return o.__limit(function(){if(s)return l;var n;if(d.isCanvas(e))o.debug("Get tile pixel data"),n=i.getImageData(t.x,t.y,t.width,t.height);else{o.debug("Draw tile imageBitmap/image to temporary canvas");var u=document.createElement("canvas");u.width=t.width,u.height=t.height;var g=u.getContext("2d",{alpha:Boolean(a.alpha)});g.globalCompositeOperation="copy",g.drawImage(r||e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),o.debug("Get tile pixel data"),n=g.getImageData(0,0,t.width,t.height),g=u=null}var v={src:n.data,width:t.width,height:t.height,toWidth:t.toWidth,toHeight:t.toHeight,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:t.offsetX,offsetY:t.offsetY,quality:a.quality,alpha:a.alpha,unsharpAmount:a.unsharpAmount,unsharpRadius:a.unsharpRadius,unsharpThreshold:a.unsharpThreshold};return o.debug("Invoke resize math"),Promise.resolve().then(function(){return function(e){return Promise.resolve().then(function(){return o.features.ww?new Promise(function(t,a){var n=o.__workersPool.acquire();l&&l.catch(function(e){return a(e)}),n.value.onmessage=function(e){n.release(),e.data.err?a(e.data.err):t(e.data.result)},n.value.postMessage({opts:e,features:o.__requested_features,preload:{wasm_nodule:o.__mathlib.__}},[e.src.buffer])}):o.__mathlib.resizeAndUnsharp(e,p)})}(v)}).then(function(e){if(s)return l;var a;if(n=null,o.debug("Convert raw rgba tile result to ImageData"),f)a=new ImageData(new Uint8ClampedArray(e),t.toWidth,t.toHeight);else if((a=c.createImageData(t.toWidth,t.toHeight)).data.set)a.data.set(e);else for(var i=a.data.length-1;0<=i;i--)a.data[i]=e[i];return o.debug("Draw tile"),h?c.putImageData(a,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth+1e-5,t.toInnerHeight+1e-5):c.putImageData(a,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth,t.toInnerHeight),null})})}var i,r,c;return Promise.resolve().then(function(){if(c=t.getContext("2d",{alpha:Boolean(a.alpha)}),d.isCanvas(e))return i=e.getContext("2d",{alpha:Boolean(a.alpha)}),null;if(d.isImage(e))return y?(o.debug("Decode image via createImageBitmap"),createImageBitmap(e).then(function(e){r=e})):null;throw new Error('".from" should be image or canvas')}).then(function(){function e(){r&&(r.close(),r=null)}if(s)return l;o.debug("Calculate tiles");var i=v({width:a.width,height:a.height,srcTileSize:o.options.tile,toWidth:a.toWidth,toHeight:a.toHeight,destTileBorder:u}).map(function(e){return n(e)});return o.debug("Process tiles"),Promise.all(i).then(function(){return o.debug("Finished!"),e(),t},function(t){throw e(),t})})}if(s)return l;if(o.features.cib){var c=t.getContext("2d",{alpha:Boolean(i.alpha)});return o.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:i.toWidth,resizeHeight:i.toHeight,resizeQuality:d.cib_quality_name(i.quality)}).then(function(e){if(s)return l;if(!i.unsharpAmount)return c.drawImage(e,0,0),e.close(),c=null,o.debug("Finished!"),t;o.debug("Unsharp result");var a=document.createElement("canvas");a.width=i.toWidth,a.height=i.toHeight;var n=a.getContext("2d",{alpha:Boolean(i.alpha)});n.drawImage(e,0,0),e.close();var r=n.getImageData(0,0,i.toWidth,i.toHeight);return o.__mathlib.unsharp_mask(r.data,i.toWidth,i.toHeight,i.unsharpAmount,i.unsharpRadius,i.unsharpThreshold),c.putImageData(r,0,0),r=n=a=c=null,o.debug("Finished!"),t})}var p={};return function e(t,o,i,u){if(s)return l;var d,c=n(t.shift(),2),g=c[0],v=c[1],p=0===t.length;return u=r({},u,{toWidth:g,toHeight:v,quality:p?u.quality:Math.min(1,u.quality)}),p||((d=document.createElement("canvas")).width=g,d.height=v),a(o,p?i:d,u).then(function(){return p?i:(u.width=g,u.height=v,e(t,d,i,u))})}(g(i.width,i.height,i.toWidth,i.toHeight,o.options.tile,u),e,t,i)})},i.prototype.resizeBuffer=function(e){var t=this,a=r({},P,e);return this.init().then(function(){return t.__mathlib.resizeAndUnsharp(a)})},i.prototype.toBlob=function(e,t,a){return t=t||"image/png",new Promise(function(n){if(e.toBlob)e.toBlob(function(e){return n(e)},t,a);else{for(var o=atob(e.toDataURL(t,a).split(",")[1]),i=o.length,r=new Uint8Array(i),s=0;s<i;s++)r[s]=o.charCodeAt(s);n(new Blob([r],{type:t}))}})},i.prototype.debug=function(){},t.exports=i},{"./lib/mathlib":1,"./lib/pool":9,"./lib/stepper":10,"./lib/tiler":11,"./lib/utils":12,"./lib/worker":13,"object-assign":24,webworkify:25}]},{},[])("/")}),define("vvCallbackManager",[],function(){function e(){var t={onDocumentLoad:null,onPageLoadAndRendered:null,onThumbLoadAndRendered:null,saveDocumentBegin:null,saveDocument:null,saveDocumentError:null,saveAsDocumentBegin:null,saveAsDocument:null,saveAsDocumentError:null,uploadDocumentBegin:null,uploadDocument:null,uploadDocumentError:null,exportDocumentBegin:null,exportDocumentError:null,emailDocumentBegin:null,emailDocument:null,emailDocumentError:null,printDocumentBegin:null,printDocument:null,printDocumentError:null,zoomDocumentBegin:null,zoomDocument:null,zoomDocumentError:null,zoomRubberbandBegin:null,zoomRubberband:null,zoomRubberbandError:null,magnifierBegin:null,magnifier:null,fitDocumentBegin:null,fitDocument:null,sendDocument:null,switchToTab:null,pageChange:null,pageChangeBegin:null,pageChangeError:null,pageCopied:null,pagePasted:null,pageDeleted:null,rotation:null,rotationBegin:null,rotationError:null,cropDocumentBegin:null,cropDocumentError:null,cropDocument:null,textSelect:null,imageLoadCompleted:null,overlayImageLoadCompleted:null,imageLoadRequested:null,annotationCreation:null,annotationDeletion:null,mediaLoaded:null,switchBetweenTabs:null,requestDocumentModelError:null,saveUsername:null,saveTabPreferences:null,saveAnnotationPreferences:null,saveAnnotations:null,saveToolbarPreferences:null,saveCustomStamps:null,saveNoteTemplates:null,saveVideoPreferences:null,saveZoomPreferences:null,postLoadPreferencesVideo:null,postLoadPreferencesAudio:null,onLoadUsername:null,annotationChanged:null,afterTabClosed:null,onShowSelectTextContextMenu:null,pageLoaded:null,pageLoadError:null,pageCountUpdated:null,invertImageBegin:null,brightnessAdjustBegin:null,gammaAdjustBegin:null,contrastAdjustBegin:null,imageManipulation:null,annotationLoadCompleted:null,annotationLoadError:null,onWindowResize:null,onSplitScreenComplete:null},a={disableTextContextMenu:null,disablePageManipulationContextMenuOptions:null};e.prototype.init=function(){$("#externalCallbackCenter").length||$("<div id='externalCallbackCenter' style='width=0px; height=0px; display: none;'></div").appendTo("#virtualViewerMain"),$("#internalCallbackCenter").length||$("<div id='internalCallbackCenter' style='width=0px; height=0px; display: none;'></div").appendTo("#virtualViewerMain"),this.setInternalCallback("saveAsDocument",virtualViewer.defaultSaveAsDocumentCallback),this.setInternalCallback("uploadDocument",virtualViewer.defaultUploadDocumentCallback),this.setInternalCallback("onDocumentLoad",virtualViewer.onDocumentModelLoad),this.setInternalCallback("pageLoaded",virtualViewer.onPageLoaded),this.setInternalCallback("requestDocumentModelError",virtualViewer.onDocumentModelError)},e.prototype.call=function(e,a){t[e]&&($("#internalCallbackCenter").trigger(e,a),$("#externalCallbackCenter").trigger(e,a))},e.prototype.callWithReturn=function(e,t){return a[e]&&"function"==typeof a[e]?a[e](t):null},e.prototype.setInternalCallback=function(e,t){return"function"==typeof t&&(!!i(e,t)||r(e,t))},e.prototype.setCallback=function(e,t){return"function"==typeof t&&(!!s(e,t)||r(e,t))},e.prototype.removeCallback=function(e,i){return!(!e||"string"!=typeof e||!a[e]&&!t[e])&&(!!n(e,i)||o(e))};var n=function(e,a){return!(!t[e]&&null!==t[e])&&($("#externalCallbackCenter").off(e),a&&$("#internalCallbackCenter").off(e),t[e]=null,!0)},o=function(e){return("function"==typeof a[e]||null===a[e])&&(a[e]=null,!0)},i=function(e,a){return!(null!==t[e]&&!t[e])&&(t[e]=!0,$("#internalCallbackCenter").on(e,function(e,t){a(t)}),!0)},r=function(e,t){return(null===a[e]||"function"==typeof a[e])&&(a[e]=t,!0)},s=function(e,a){return!(null!==t[e]&&!t[e])&&(t[e]=!0,$("#externalCallbackCenter").on(e,function(e,t){a(t)}),!0)}}var t;return function(){return t=t||new e}()}),define("vvImageManager",["vvUtility","user-config/config","vvDefines","3rdparty/pica.min","vvCallbackManager"],function(e,t,a,n,o){function i(e){this.state=e,this.scaleThrottleTimeoutId=0,this.thumbnailImageBuffer=[],this.originalImageBuffer=[],this.scaledImageBuffer=[],this.manipulatedImageBuffer=[],this.errorFallbackImageBuffer=[],this.originalImageIsSVG=[],this.imageCompletionTimeoutBuffer=[],this.upcomingQueue=[],this.picaID=0,this.requestTimeout=0,this.serverScale=t.serverScaling,this.forceBrowserScaling=t.useBrowserScaling,this.pica=new n({idle:a.picaCacheTimeout||2e3}),this.overlayImage=null,this.overlayDataArray=[],this.overlayDocumentId=null,this.pageLockOverlayOffset={offsetX:0,offsetY:0,locked:!0},this.overlayImageStripped=!1}i.prototype.setThumbnailOnPage=function(e,t){this.thumbnailImageBuffer[e]=t},i.prototype.getThumbnailFromPage=function(e){
return this.thumbnailImageBuffer[e]},i.prototype.setOriginalOnPage=function(e,t){this.originalImageBuffer[e]=t},i.prototype.getOriginalFromPage=function(e){return this.originalImageBuffer[e]},i.prototype.setFallbackImageOnPage=function(e,t){this.errorFallbackImageBuffer[e]=t},i.prototype.setScaledOnPage=function(e,t){this.scaledImageBuffer[e]=t},i.prototype.getScaledFromPage=function(e){return this.scaledImageBuffer[e]},i.prototype.getManipulatedFromPage=function(e){return this.manipulatedImageBuffer[e]},i.prototype.setManipulatedOnPage=function(e,t){this.manipulatedImageBuffer[e]=t},i.prototype.setForceBrowserScaling=function(e){this.forceBrowserScaling=e},i.prototype.cleanOverlayOffset=function(){this.overlayDataArray=[],this.pageLockOverlayOffset&&(this.pageLockOverlayOffset={offsetX:0,offsetY:0,locked:!0})},i.prototype.getOverlayOffsetForPage=function(e){return e=e||0,e<0?null:null===this.overlayDataArray[e]?null:this.pageLockOverlayOffset.locked?this.pageLockOverlayOffset:(this.overlayDataArray[e]||(this.overlayDataArray[e]={offsetX:this.pageLockOverlayOffset.offsetX||0,offsetY:this.pageLockOverlayOffset.offsetY||0}),this.overlayDataArray[e])},i.prototype.addRequestedOriginalImage=function(e,t,n){var o=this.getOriginalFromPage(e);if(!o||t){o=new Image,this.setOriginalOnPage(e,o),$(o).data("awaitingBlob",!0),Modernizr.cors&&a.imageCrossOriginAttributeValue&&(o.crossOrigin=a.imageCrossOriginAttributeValue);var i=this;return $(o).on("load",function(){u(i,o,e,i.state)}),$(o).on("error",function(e){!o.fromObjectURL&&!o.complete||"Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser?g(n):v(n)}),o}},i.prototype.loadOriginalImageFromData=function(e,t,a,n,o){e=e||this.getOriginalFromPage(t),e||(e=this.addRequestedOriginalImage(t,!1,o)),r(e,a,n)};var r=function(e,a,n){t.enableCacheObfuscation&&(a=p(a)),n||(n=h(a));var o=new Blob([a],{type:n}),i=URL.createObjectURL(o);e.fromObjectURL=!0,e.svg="image/svg+xml"===n,e.src=i,$(e).data("awaitingBlob",!1)};i.prototype.getBestImageFromPage=function(e,t){var a,n=this.state;if(n.pageStates&&n.pageStates[e]&&n.pageStates[e].imageInfoLoaded){n.getLayerManager().imageLayerVisibilityHasChanged&&(n.getLayerManager().imageLayerVisibilityHasChanged=!1,c(n,!1,e,!0));var o=this.originalImageBuffer&&this.originalImageBuffer[e],i=!!o&&s(this.originalImageBuffer[e]),r=!!i&&this.checkIsOriginalImageValidOnIE(e),l=i||s(this.errorFallbackImageBuffer[e]);if(this.originalImageIsSVG[e]&&i&&r)a=this.originalImageBuffer[e];else if(n.isPageCropped(e)&&l)a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e],n.isPageManipulated(e)&&(this.scaledImageBuffer[e]&&this.scaledImageBuffer[e].width===this.originalImageBuffer[e].width?this.scaledImageBuffer[e]&&!this.manipulatedImageBuffer[e]?this.createManipulatedPage(e,n):this.manipulatedImageBuffer&&this.manipulatedImageBuffer[e]&&(a=this.manipulatedImageBuffer[e]):this.scalePageByPercentage(0,1));else if(this.manipulatedImageBuffer&&s(this.manipulatedImageBuffer[e]))a=this.manipulatedImageBuffer[e];else if(n.isPageManipulated(e)&&l&&s(this.scaledImageBuffer[e]))this.createManipulatedPage(e,n),a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e];else if(this.scaledImageBuffer&&s(this.scaledImageBuffer[e]))a=this.scaledImageBuffer[e];else if(l){var u=n.getZoomDecimal();this.scaleDocumentByPercentage(u),a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e]}else this.thumbnailImageBuffer&&s(this.thumbnailImageBuffer[e])&&(a=this.thumbnailImageBuffer[e]);return o||this.errorFallbackImageBuffer[e]||(t?c(n,!1,e):this.throttledRequestImageBatch(n)),a}},i.prototype.cacheImages=function(e){var a=this.state;e=e||a.pageNumber;var n=t.continuousScrollBufferBeforeSize||1,o=t.continuousScrollBufferAfterSize||3,i=e-n;i<0&&(i=0);var r=e+o;r>a.pageCount&&(r=a.pageCount);for(var s=i;s<r;s++)this.originalImageBuffer[s]||this.getBestImageFromPage(s)},i.prototype.invalidateImageObject=function(e){e&&($(e).off("load"),$(e).off("error"),e.src=a.bogusImageURL)},i.prototype.usePica=function(){var e="Explorer"===BrowserDetect.browser;return!(this.serverScale||this.state.getZoom()>=100||this.forceBrowserScaling||e)},i.prototype.proceedWithScale=function(e,t,a){if(this.upcomingQueue=this.upcomingQueue||[],!this.originalImageBuffer||!this.originalImageBuffer[e])return this.upcomingQueue[0]&&this.upcomingQueue[0].page===e&&this.upcomingQueue.shift(),!1;if(this.cleanQueue(),!this.usePica())return!0;var n={page:e,width:t,height:a};if(0===this.picaID){if(!this.upcomingQueue.length)return this.upcomingQueue.push(n),!0;if(this.upcomingQueue[0].page===e)return!0}for(var o=0;o<this.upcomingQueue.length;o++)if(this.upcomingQueue[o].page===e)return this.upcomingQueue[o].width=t,this.upcomingQueue[o].height=a,!1;return this.upcomingQueue.push(n),!1},i.prototype.cleanQueue=function(){if(!this.originalImageBuffer)return void(this.upcomingQueue=[]);for(var e=0;this.upcomingQueue.length&&e<this.upcomingQueue.length;){var t=this.upcomingQueue[e].page;this.originalImageBuffer[t]||this.errorFallbackImageBuffer[t]?e++:this.upcomingQueue.splice(e,1)}},i.prototype.scalePageToDimensions=function(e,t,n){if(0!==t&&0!==n&&this.proceedWithScale(e,t,n)){var o=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e];if(s(o)){if(this.scaledImageBuffer&&this.scaledImageBuffer[e]){var i=this.scaledImageBuffer[e];if(i.width===t&&i.height===n)return}var r=document.createElement("canvas"),l=r.getContext("2d");r.width=o.width,r.height=o.height;try{l.drawImage(o,0,0,o.width,o.height)}catch(e){return}if(!this.usePica())return void this.setScaledOnPage(e,r);var u=document.createElement("canvas");u.width=t,u.height=n;var d=this;this.picaID=1,this.pica.resize(r,u,{quality:a.picaQuality,alpha:a.picaAlpha,unsharpAmount:a.picaUnsharpAmount,unsharpRadius:a.picaUnsharpRadius,unsharpThreshold:a.picaUnsharpThreshold}).then(function(){if(d.setScaledOnPage(e,u),d.upcomingQueue[0].page===e&&d.upcomingQueue.shift(),d.manipulatedImageBuffer[e]&&d.createManipulatedPage(e,d.state),virtualViewer.delayedPaintCanvases(),d.picaID=0,d.upcomingQueue.length>0){var t=d.upcomingQueue[0];d.scalePageToDimensions(t.page,t.width,t.height)}}).catch(function(){if(d.picaID=0,d.upcomingQueue[0]&&d.upcomingQueue[0].page===e&&d.upcomingQueue.shift(),d.upcomingQueue.length>0){var t=d.upcomingQueue[0];d.scalePageToDimensions(t.page,t.width,t.height)}})}}},i.prototype.scalePageByPercentage=function(e,t){var a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e],n=this.scaledImageBuffer[e];if(s(a)){var o=Math.round(this.state.getOriginalWidthForPage(e)*t),i=Math.round(this.state.getOriginalHeightForPage(e)*t);(!n||n.width!==o&&n.height!==i)&&this.scalePageToDimensions(e,o,i)}},i.prototype.scaleDocumentByPercentage=function(e){this.scaleThrottleTimeoutId&&clearTimeout(this.scaleThrottleTimeoutId);var a=t.zoomTimeout||500,n=(t.continuousScrollBufferBeforeSize||1,t.continuousScrollBufferAfterSize||3,this);this.scaleThrottleTimeoutId=setTimeout(function(){for(var a=n.state,o=t.continuousScrollBufferBeforeSize||t.continuousScrollBufferSize,i=t.continuousScrollBufferAfterSize||t.continuousScrollBufferSize,r=Math.max(a.pageNumber-o,0),s=Math.min(a.getPageCount()-1,a.pageNumber+i),l=r;l<=s;l++)n.serverScale&&!n.originalImageIsSVG[l]?c(a,!1,l,!0):n.scalePageByPercentage(l,e)},a)},i.prototype.requestOverlayImage=function(n){if(!n)return!1;var i="getImage",r=!1,s=0;this.cleanOverlayOffset(),this.overlayImageStripped=!1;var l=new Image;this.overlayImage=l,this.overlayDocumentId=n,t.enableSVGSupport&&this.state.getSVGEnabledForPage(s)&&Modernizr.svg&&(t.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(t.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)&&(r=!0);var u=this.serverScale;this.serverScale=!1;var d=m(this.state,i,!1,s,r,n);this.serverScale=u,Modernizr.cors&&a.imageCrossOriginAttributeValue&&(l.crossOrigin=a.imageCrossOriginAttributeValue);var c=this;$(l).on("load",function(){l.fromObjectURL&&URL.revokeObjectURL(l.src),o.call("overlayImageLoadCompleted",{val:!0,documentId:c.state.getDocumentId(),overlayDocumentID:n});var e=50;"Explorer"!==BrowserDetect.browser||9!==BrowserDetect.version&&10!==BrowserDetect.version&&11!==BrowserDetect.version||(e=a.ie9DrawDelay),virtualViewer.delayedPaintCanvases(e),virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),virtualViewer.setDragMode(a.dragModes.overlay)}),$(l).on("error",function(){virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1);var t=e.getLocalizedValue("errors.imageFailedToLoad","Image failed to load.");c.state.markBadPage(s,!0),c.currentExceptionDialog=$("#vvCurrentExceptionDialog"),$("#vvCurrentExceptionDialog").modal("show"),$("#vvCurrentExceptionText").html(t),$("#vvCurrentExceptionOKButton").click(function(){c.currentExceptionDialog=null}),virtualViewer.positionCanvases(state)}),o.call("imageLoadRequested",{documentId:c.state.getDocumentId(),val:!0}),c.requestImageViaXHR(d,l,{imageManager:c,page:null,overlay:!0})},i.prototype.stripWhite=function(t){this.overlayImageStripped||(t.src=e.whiteToTransparent(t),this.overlayImageStripped=!0)},i.prototype.checkIsImageComplete=function(e){return s(e)},i.prototype.checkIsOriginalImageValidOnIE=function(e){var t=this.originalImageBuffer[e];if(!s(t))return!1;var a=this.state.getDPIForPage(e);if(("Explorer"===BrowserDetect.browser||"Edge"===BrowserDetect.browser)&&t.width>1e3&&a>=300){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;try{n.getContext("2d").drawImage(t)}catch(e){return!1}}return!0};var s=function(e){if(!e)return!1;var t=e.naturalWidth||e.width;return!("CANVAS"!==e.tagName||!t)||(!(!t||!e.complete)||!!e.complete&&(!("Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser||t)&&e.complete))},l=function(e,t,a,n){return s(t)?(e.imageCompletionTimeoutBuffer[a]=null,void d(e,t,a,n)):!e.originalImageBuffer[a]&&e.imageCompletionTimeoutBuffer[a]?(clearTimeout(e.imageCompletionTimeoutBuffer[a].timeoutId),void(e.imageCompletionTimeoutBuffer[a]=null)):(e.imageCompletionTimeoutBuffer[a]||(e.imageCompletionTimeoutBuffer[a]={timeoutId:0,polls:0}),e.imageCompletionTimeoutBuffer[a].polls++,void(e.imageCompletionTimeoutBuffer[a].timeoutId=setTimeout(function(){l(e,t,a,n)},50)))},u=function(e,t,a,n){t.fromObjectURL&&URL.revokeObjectURL(t.src),e.originalImageIsSVG[a]=t.svg,l(e,t,a,n),virtualViewer.getAllText(a,n)},d=function(e,n,i,r){n.width&&n.height||(n.width=r.getOriginalWidthForPage(i),n.height=r.getOriginalHeightForPage(i)),e.originalImageIsSVG[i]||e.scalePageByPercentage(i,r.getZoomDecimal()),r.setViewedForPage(i,!0);var s=50;"Explorer"!==BrowserDetect.browser||9!==BrowserDetect.version&&10!==BrowserDetect.version&&11!==BrowserDetect.version||(s=a.ie9DrawDelay),virtualViewer.delayedPaintCanvases(s);var l={state:r};t.positionLastBetweenDocuments&&0===i&&(l.applyAndResetCachedScroll=!0),virtualViewer.sizeScroller(l),virtualViewer.updateImageInfoDialog(),virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),o.call("imageLoadCompleted",{documentId:r.documentId,page:i,val:!0})},c=function(n,i,r,s,l){var d="getImage",c=!1;if(n&&n.pageStates[r].imageInfoLoaded&&(r||0===r||(r=n.getPageNumber()),!n.isBadDocument()&&!n.isBadPage(r))){var p=n.getImageManager(),h=p.getOriginalFromPage(r);if(!p.errorFallbackImageBuffer[r]||s){var f={imageManager:p,recoveringFromError:i,page:r};if((!h||i||l)&&(h=new Image,l?p.setFallbackImageOnPage(r,h):p.setOriginalOnPage(r,h),$(h).on("load",function(){u(p,h,r,p.state)}),$(h).on("error",function(){!h.fromObjectURL&&!h.complete||"Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser?g(f):v(f)})),t.enableSVGSupport&&n.getSVGEnabledForPage(r)&&Modernizr.svg&&(t.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(t.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)&&(c=!0),!e.validImageObject(h)&&!$(h).data("awaitingBlob")||s){if(p.cleanBuffers(),!Modernizr.webworkers)switch(t.singleThreadedScalingMode){case"browser":case"js":this.serverScale=!1;break;default:this.serverScale=!0}var y=m(n,d,!1,r,c,"",l);Modernizr.cors&&a.imageCrossOriginAttributeValue&&(h.crossOrigin=a.imageCrossOriginAttributeValue),o.call("imageLoadRequested",{documentId:n.documentId,page:r,val:!0}),p.requestImageViaXHR(y,h,f)}}}};i.prototype.throttledRequestImageBatch=function(e){clearTimeout(this.requestTimeout);var t=this;this.requestTimeout=setTimeout(function(){t.requestCurrentBufferOfImages(e)},"number"==typeof a.imageRequestThrottle?a.imageRequestThrottle:20)},i.prototype.requestCurrentBufferOfImages=function(e){var a=t.continuousScrollBufferBeforeSize||t.continuousScrollBufferSize,n=t.continuousScrollBufferAfterSize||t.continuousScrollBufferSize;"number"==typeof a&&"number"==typeof n||(a=1,n=2);for(var o=Math.max(e.pageNumber-a,0),i=Math.min(e.getPageCount()-1,e.pageNumber+n),r=o;r<=i;r++)c(e,!1,r)},i.prototype.requestFullImage=function(e,t,a){e=e||this.state,c(e,t,a)};var g=function(t){if(t=t||{},!t.thumbnail&&!t.overlay&&t.imageManager){var a=t.imageManager.state;if(virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),t.imageManager.imageCompletionTimeoutBuffer[t.page]&&clearTimeout(t.imageManager.imageCompletionTimeoutBuffer[t.page].timeoutId),t.recoveringFromError){var n=e.getLocalizedValue("errors.imageFailedToLoad","Image failed to load."),o={client:!0,disable:virtualViewer.disableErrorModals.imageFailedToLoad};a.markBadPage(t.page,!0),virtualViewer.displayExceptionMessage(n,o)}else console.log("Error requesting page "+t.page+" of document "+a.getDocumentId()+". Retrying with a bitmap display."),a.setSVGEnabledForPage(t.page,!1),c(a,!0,t.page);virtualViewer.positionCanvases(a)}},v=function(t){var a=t.imageManager,n=a.state;if(a.imageCompletionTimeoutBuffer[t.page]&&(clearTimeout(a.imageCompletionTimeoutBuffer[t.page].timeoutId),a.imageCompletionTimeoutBuffer[t.page]=null),t.recoveringFromError||a.checkIsOriginalImageValidOnIE(t.page)||a.errorFallbackImageBuffer[t.page]){var o=e.getLocalizedValue("imageLoading.IEImageLoadError","Internet Explorer has failed to load the requested image due to memory limitations."),i={client:!0,disable:virtualViewer.disableErrorModals.IEImageLoadError};virtualViewer.displayExceptionMessage(o,i)}else console.log("Internet Explorer has failed to load the image on page "+t.page+" due to a memory issue. Falling back to a lower-resolution image."),a.originalImageBuffer[t.page].src="",a.originalImageBuffer[t.page]=null,c(n,!0,t.page,!1,!0)};i.prototype.requestImageViaXHR=function(e,t,a){$(t).data("awaitingBlob",!0);var n=this,o=new XMLHttpRequest,i=e.query();e.query(""),o.open("POST",e,!0),o.responseType="arraybuffer",o.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){if(4===o.readyState){if(500===o.status)return virtualViewer.handle500Status(o.response,n.state.getDocumentId(),n.state.currentPaneIndex),void g(a);if(200===o.status){var e=o.response,i=new Uint8Array(e);r(t,i,null),$(t).data("awaitingBlob",!1)}else $(t).data("awaitingBlob",!1),g(a)}},o.send(i)};var p=function(e){for(var t=[13,3,9,11,15,6,8,14,4,0,11,3,4,2,13,6,9,4,8,9,4,3,7,10,7,2,11,3,11,7,5,10],a=0;a<e.length;a+=1)e[a]=e[a]^t[a%t.length];return e},h=function(e){for(var t=[60,63,120,109,108],a=[137,80,78,71],n=!0,o=!0,i=0;i<4;i+=1)e[i]!==t[i]&&(o=!1),e[i]!==a[i]&&(n=!1);return n?"image/png":o?"image/svg+xml":"image/jpeg"},m=function(e,n,o,i,r,s,l){i||0!==i&&(i=e.pageNumber);var u=document.getElementById("vvOuterDiv"),d=new URI(t.servletPath);if(d.addQuery("action",n),s||(s=virtualViewer.getDocumentIdForPage(i,e)),o===!0?(d.addQuery("documentId",encodeURIComponent(s)),d.addQuery("clientInstanceId",encodeURIComponent(virtualViewer.getClientInstanceId())),d.addQuery("hiddenImageLayers",e.getLayerManager().getHiddenImageLayers(!0))):(d.addQuery("documentId",s),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("hiddenImageLayers",e.getLayerManager().getHiddenImageLayers())),d.addQuery("preferSvg",r),d.addQuery("pageNumber",virtualViewer.getPageIndexForPage(i,e)),d.addQuery("despeckle",e.getDespeckleForPage(i)),d.addQuery("antiAliasOff",e.getAntiAliasOffForPage(i)),e.getImageManager().serverScale)d.addQuery("requestedScale",e.getZoomDecimal());else if(l&&0!==e.getDPIForPage(i)){var c=72/e.getDPIForPage(i);d.addQuery("requestedScale",c)}else d.addQuery("requestedScale",1);return d.addQuery("clientWidth",u.clientWidth),d.addQuery("clientHeight",u.clientHeight),null!==virtualViewer.getOverlayPath()&&d.addQuery("overlayPath",virtualViewer.getOverlayPath()),a.cacheBuster===!0&&d.addQuery("cacheBuster",Math.random()),d.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),d};return i.prototype.cutPages=function(e){var t=[];e.sort(function(e,t){return e-t});for(var a=0,n=0;n<e.length;n+=1){var o=e[n]-a,i={thumb:this.thumbnailImageBuffer.splice(o,1)[0],original:this.originalImageBuffer.splice(o,1)[0],scaled:this.scaledImageBuffer.splice(o,1)[0],errorFallback:this.errorFallbackImageBuffer.splice(o,1)[0]};t.push(i),a+=1}return t},i.prototype.copyPages=function(e){var t=this,a=[];e.sort(function(e,t){return e-t});for(var n=0;n<e.length;n+=1){var o={thumb:t.thumbnailImageBuffer[e[n]],original:t.originalImageBuffer[e[n]],scaled:t.scaledImageBuffer[e[n]],errorFallback:t.errorFallbackImageBuffer[e[n]]};a.push(o)}return a},i.prototype.getPastedPages=function(e,t){for(var a=t;a<t+e;a++)this.cleanPageFromBuffers(a),this.getBestImageFromPage(a,!0)},i.prototype.createManipulatedPage=function(e,t){t||(t=virtualViewer.getCurrentState()),e||0===e||(e=t.pageNumber);var a=document.createElement("canvas"),n=a.getContext("2d");if(!this.scaledImageBuffer||!this.scaledImageBuffer[e])return a.width=0,a.height=0,this.manipulatedImageBuffer[e]=a,this.getBestImageFromPage(e,!0),!1;var i=t.getContrastForPage(e),r=t.getBrightnessForPage(e),s=t.getGammaForPage(e),l=!1,u=t.getInvertImageForPage(e),d=this.scaledImageBuffer[e],c=d.getContext("2d").getImageData(0,0,d.width,d.height),g=this.processImageManipulations(c,i,r,s,l,u);return a.width=d.width,a.height=d.height,n.putImageData(g,0,0),this.manipulatedImageBuffer[e]=a,o.call("imageManipulation",{documentId:t.getDocumentId(),page:e,gamma:t.getGammaForPage(e),brightness:t.getBrightnessForPage(e),contrast:t.getContrastForPage(e),invert:t.getInvertImageForPage(e)}),virtualViewer.delayedPaintCanvases(),!0},i.prototype.processImageManipulations=function(e,t,a,n,o,i){var r=e.data;n/=100;var s=1/n;t*=2;var l=259*(t+255)/(255*(259-t));a*=2;for(var u=0;u<r.length;u+=4){if(0!==t&&(r[u]=this.truncate(l*(r[u]-128)+128),r[u+1]=this.truncate(l*(r[u+1]-128)+128),r[u+2]=this.truncate(l*(r[u+2]-128)+128)),0!==a&&(r[u]=r[u]+a,r[u+1]=r[u+1]+a,r[u+2]=r[u+2]+a),n>1&&n<4&&(r[u]=255*Math.pow(r[u]/255,s),r[u+1]=255*Math.pow(r[u+1]/255,s),r[u+2]=255*Math.pow(r[u+2]/255,s)),o){var d=.299*r[u]+.587*r[u+1]+.114*r[u+2];r[u]=d,r[u+1]=d,r[u+2]=d}i&&(r[u]=255-r[u],r[u+1]=255-r[u+1],r[u+2]=255-r[u+2])}return e.data=r,e},i.prototype.truncate=function(e){return e>255?e=255:e<0&&(e=0),Math.floor(e)},i.prototype.processContrast=function(e,t){var a=t.data;e*=2;for(var n=259*(e+255)/(255*(259-e)),o=0;o<a.length;o+=4)a[o]=this.truncate(n*(a[o]-128)+128),a[o+1]=this.truncate(n*(a[o+1]-128)+128),a[o+2]=this.truncate(n*(a[o+2]-128)+128);return t},i.prototype.processBrightness=function(e,t){for(var a=t.data,n=0;n<a.length;n+=4)a[n]=a[n]+e,a[n+1]=a[n+1]+e,a[n+2]=a[n+2]+e;return t.data=a,t},i.prototype.processGamma=function(e,t){var a=t.data;e/=100;for(var n=1/e,o=0;o<a.length;o+=4)a[o]=255*Math.pow(a[o]/255,n),a[o+1]=255*Math.pow(a[o+1]/255,n),a[o+2]=255*Math.pow(a[o+2]/255,n);return t.data=a,t},i.prototype.processGreyscaleWeighted=function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=.299*t[a]+.587*t[a+1]+.114*t[a+2];t[a]=n,t[a+1]=n,t[a+2]=n}return e.data=t,e},i.prototype.processGreyscaleMean=function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=(t[a]+t[a+1]+t[a+2])/3;t[a]=n,t[a+1]=n,t[a+2]=n}return e.data=t,e},i.prototype.processInvert=function(e){for(var t=e.data,a=0;a<t.length;a+=4)t[a]=255-t[a],t[a+1]=255-t[a+1],t[a+2]=255-t[a+2];return e.data=t,e},i.prototype.nukeBuffers=function(){this.originalImageBuffer=[],this.scaledImageBuffer=[],this.manipulatedImageBuffer=[],this.thumbnailImageBuffer=[],this.errorFallbackImageBuffer=[]},i.prototype.cleanPageFromBuffers=function(e){this.originalImageBuffer[e]=null,this.scaledImageBuffer[e]=null,this.manipulatedImageBuffer[e]=null,this.errorFallbackImageBuffer[e]=null},i.prototype.cleanBuffers=function(e){var a=this.state;e||(e=a.pageNumber);var n,o,i=virtualViewer.scrollPageFinder(a),r=t.continuousScrollBufferBeforeSize||1,s=t.continuousScrollBufferAfterSize||3,l=a.getPageCount();n=e<i?e-r:i-r,o=e>i?e+s:i+s;for(var u=0;u<l;u++)u>=n&&u<=o||this.cleanPageFromBuffers(u)},i}),define("vvMediaManager",["user-config/config"],function(e){function t(e){this.mediaDiv=document.createElement("div"),this.mediaDiv.className="vvMediaDiv",this.outerDiv=virtualViewer.getOuterDivFromState(e),this.outerDiv.append(this.mediaDiv),this.documentId=e.documentId,this.isVideoShown=!1,this.mediaType=null}return t.prototype.getVideo=function(){var t,a,n,o=this;return o.player?(o.showMediaDiv(),void o.resizeVideo()):(t="getMedia",a=new URI(e.servletPath),n=virtualViewer.getClientInstanceId(),a.addQuery("action",t),a.addQuery("documentId",o.documentId),a.addQuery("clientInstanceId",n),void o.fetchMedia(a,o))},t.prototype.fetchMedia=function(e,t){var a,n=t.mediaSource=document.createElement("source");n.src=e,t.mediaType===vvDefines.mediaType.video?(a=t.player=document.createElement("video"),a.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.ceil(100*(e.loaded/e.total));$("#waitIndicatorProgressBar").show(),$("#waitIndicatorProgressBar").attr("aria-valuenow",t).css("width",t+"%")}}),a.addEventListener("loadstart",function(){$("#vvVideoWaitIndicator").modal("hide"),t.setUpVideo({player:this,self:t})}),a.addEventListener("canplay",function(){t.resizeVideo()}),a.addEventListener("error",function(){var e=utility.getLocalizedValue("videoUnavailable","Video Unavailable"),a={client:!0,disable:virtualViewer.disableErrorModals.media};virtualViewer.displayExceptionMessage(e,a),virtualViewer.closeTab(t.documentId)})):t.mediaType===vvDefines.mediaType.audio&&(a=t.player=document.createElement("audio"),a.addEventListener("progress",function(e){var t=Math.ceil(100*(e.loaded/e.total));$("#waitIndicatorProgressBar").show(),$("#waitIndicatorProgressBar").attr("aria-valuenow",t).css("width",t+"%")}),a.addEventListener("loadstart",function(){t.setUpAudio({player:this,self:t})}),a.addEventListener("error",function(){var e=utility.getLocalizedValue("audioUnavailable","Audio Unavailable"),a={client:!0,disable:virtualViewer.disableErrorModals.media};virtualViewer.displayExceptionMessage(e,a),virtualViewer.closeTab(t.documentId)})),t.mediaDiv.appendChild(a),a.appendChild(n),virtualViewer.displayWaitIndicator(!0)},t.prototype.setUpVideo=function(e){var t=e.self||this,a=e.player||t.player,n=virtualViewer.getUserPreferences().videoPreferences;return null==n.autoplay?void virtualViewer.getCallbackManager().setInternalCallback("postLoadPreferencesVideo",this.setUpVideo):(a.controls=n.controls,a.autoplay=n.autoplay,a.muted=n.mute,a.preload="auto",t.showMediaDiv(),t.resizeVideo(e),void virtualViewer.displayWaitIndicator(!1))},t.prototype.setUpAudio=function(e){var t=e.self||this,a=e.player||t.player,n=virtualViewer.getUserPreferences().audioPreferences;return null===n.loop?void virtualViewer.getCallbackManager().setInternalCallback("postLoadPreferencesAudio",this.setUpAudio):(a.preload="auto",a.mute=!1,a.controls=!0,a.autoplay=!1,a.style.display="block",this.applyMediaPreferences(n),t.showMediaDiv(),virtualViewer.displayWaitIndicator(!1),void this.resizeAudio(t))},t.prototype.fixMediaDivs=function(e){e&&(this.mediaType=e.documentModel.getMediaType()),e&&!$(this.mediaDiv).parent().length&&(this.outerDiv=virtualViewer.getOuterDivFromState(e),this.outerDiv.append(this.mediaDiv),this.documentId=e.documentId)},t.prototype.hideMediaDiv=function(e){var t=virtualViewer.getUserPreferences().audioPreferences;e=e||this.outerDiv.find(".vvInner"),$(this.mediaDiv).hide(),(this.mediaType===vvDefines.mediaType.audio&&!t.background||this.mediaType===vvDefines.mediaType.video)&&this.player.pause(),$(this.player).hide(),$(e).show(),this.outerDiv.find(".vvCanvas").show(),$(this.outerDiv).css({overflow:"auto"}),virtualViewer.getEventManager().eventSwitch(!0),this.isVideoShown=!1},t.prototype.showMediaDiv=function(e){if(e=e||this.outerDiv.find(".vvInner"),$(this.mediaDiv).show(),this.player.autoplay){var t=this.player.play(),a=function(e){console.log(e.message)};t&&t.then(null,a)}$(this.player).show(),$(e).hide(),this.outerDiv.find(".vvCanvas").hide(),$(this.outerDiv).css({overflow:"hidden"}),virtualViewer.getEventManager().eventSwitch(!1),this.isVideoShown=!0},t.prototype.applyMediaPreferences=function(e){if(!e)return!1;var t=this.player;return null!==e.autoplay&&(t.autoplay=e.autoplay),null!==e.mute&&(t.muted=e.mute),null!==e.controls&&(t.controls=e.controls),null!==e.loop&&(t.loop=e.loop),!0},t.prototype.resizeAudio=function(e){var t,a;e||(e=this);var n=$(this.outerDiv).width(),o=e.player;n<360?(a=n,t=0):(a=300,t=30),$(o).width(a);var i=(n-a)/2+t;$(this.mediaDiv).css({left:i,position:"fixed"})},t.prototype.resizeVideo=function(e){var t,a;self=this,e||(e=virtualViewer.getUserPreferences().videoPreferences);var n=$(this.outerDiv).width(),o=$(this.outerDiv).height();self.mediaType===vvDefines.mediaType.audio?(t=300,a=100,self.resizeVideoTheater(t,a,n,o)):e.stretch?self.resizeVideoStretch(t,a,n,o):self.resizeVideoTheater(t,a,n,o)},t.prototype.resizeVideoStretch=function(e,t,a,n){e||(e=a),t||(t=n),this.player.width=e,this.player.height=t,"fixed"===$(this.mediaDiv).css("position")&&$(this.mediaDiv).css({top:0,left:0,position:"relative"})},t.prototype.resizeVideoTheater=function(e,t,a,n){(!e||e>a)&&(e=a),(!t||t>n)&&(t=n),e>this.player.videoWidth&&(e=this.player.videoWidth),t>this.player.videoHeight&&(t=this.player.videoHeight),t<300&&(t=300),e<400&&(e=400),this.player.width=e,this.player.height=t;var o=(a-e)/2+35,i=(n-t)/2+75;$(this.mediaDiv).css({top:i,left:o,position:"fixed"})},t}),define("vvThumbs",["require","vvUtility","user-config/config","vvDefines","vvImageManager","vvStateManager","vvCallbackManager"],function(e,t,a,n,o){var i=function(){var i=null,r=function(e){virtualViewer.openInTab($(this).data("thumbInfo").documentId)},s=function(e){var t=$(e.target).offset();$(e.target).closest(".vvThumbBox").trigger($.Event("contextmenu",{pageX:t.left-100,pageY:t.top}))},l=function(e){e.preventDefault(),virtualViewer.addPageToSelection($(e.target).closest(".vvThumbBox").data("thumb-info").pageNumber)},u=function(e){if(e.tapCount>1)return void l(e);virtualViewer.draggingPage=!0;var t=virtualViewer.getDocumentModel(),a=$(this).data("thumbInfo");a||(a=$(e.target).closest(".vvThumbBox").data("thumbInfo"));var n=a.pageNumber;e.ctrlKey===!0||e.metaKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.togglePageSelection(n):e.shiftKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.selectRange(n):(virtualViewer.checkPageManipulationsEnabled()&&(t.clearPageSelection(),t.addPageToSelection(n)),virtualViewer.currentMatch=0,virtualViewer.setPage(n),virtualViewer.skipScrollEvent=!0,$("#vvOuterDiv").scrollTop(virtualViewer.findPagePosition(n)))},d=function(e){this.src="resources/pageNotFound.png",$(this).parents(".vvThumbBox").find(".vvLoadingGif").remove(),$(this).removeClass(".vvImageLoading"),$(this).show(),$(this).addClass("displayedThumb");var t=parseInt($(this).css("width"),10),a=parseInt($(this).css("height"),10),o=n.thumbnailSize;t>a?($(this).css("height",a/(t/o)+"px"),$(this).css("width",o+"px")):($(this).css("width",t/(a/o)+"px"),$(this).css("height",o+"px"));var i=$(this).parents(".vvThumbBox").find(".vvThumbFooter");$(this).parents(".vvThumbBox").find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage"),i.width($(this).width()-2*parseInt(i.css("padding-left"),10))},c=function(t){var a=e("vvStateManager").getCurrentState(),n=$(this).closest(".vvThumbBox");if(n.find(".vvLoadingGif").remove(),$(this).removeClass("vvImageLoading"),a&&$(this).parents("#vvPageThumbs").length){var o=a.getImageManager();o.setThumbnailOnPage(n.data("thumbInfo").pageNumber,this)}$(this).addClass("displayedThumb vvImgLoaded"),$(this).show(),R(n),e("vvCallbackManager").call("onThumbLoadAndRendered",{documentId:n.data("thumbInfo").documentId,pageNumber:n.data("thumbInfo").pageNumber})},g=function(e){var t=$(e).closest(".vvThumbBox"),a=t.data("thumbInfo").pageNumber;return 0===a||a?a:-1},v=function(t){if(virtualViewer.cleanupDrag(),virtualViewer.checkPageManipulationsEnabled()&&t.originalEvent&&t.originalEvent.dataTransfer){t.preventDefault();var a=g(this),n=t.originalEvent.dataTransfer.getData("text");if(n){var o=JSON.parse(n);if(!virtualViewer.clipIsVVObject(o))return M($("#vvPageThumbs .thumbPanel")),L(),void y($("#vvPageThumbs .thumbPanel"));var i=a;if(p($(this),t.clientY)||(i=a+1),virtualViewer.fixClipState(o),virtualViewer.draggingPage&&o.sessionGUID===virtualViewer.viewerSessionID){if(o.pageNums.indexOf(a)>-1||!virtualViewer.deleteSelection(o))return!1;for(var r=0;r<=o.pageNums.length-1&&o.pageNums[r]<=i;r++)i-=1}virtualViewer.draggingPage=!1,i>e("vvStateManager").getCurrentState().pageCount&&(i=e("vvStateManager").getCurrentState().pageCount),virtualViewer.pasteClip(o,null,i)}}},p=function(e,t){var a=e.height(),n=e.offset().top,o=n+a/2;return t<=o},h=function(e){var t=g(e.target);if(t>=0){var a=e.clientY;m(t,p($(this),a))}},m=function(e,t){var a=$("#vvPageThumbs .vvThumbBox").eq(e);$(".vvThumbDivider").remove(),t?$(a).before($("<div></div>").addClass("vvThumbDivider")):$(a).after($("<div></div>").addClass("vvThumbDivider"))},f=function(t){if(virtualViewer.checkPageManipulationsEnabled()&&t.originalEvent&&t.originalEvent.dataTransfer){var a=g(t.target);if(!(a<0)){virtualViewer.draggingPage=!0;var n=e("vvStateManager").getCurrentState().getDocumentModel();t.ctrlKey?n.addPageToSelection(a):t.shiftKey||t.metaKey===!0?n.selectRange(a):n.isPageSelected(a)||(n.clearPageSelection(),n.addPageToSelection(a));var o=t.originalEvent.dataTransfer;o.setData("text",JSON.stringify(virtualViewer.createClipObject())),o.dropEffect="move",o.effectAllowed="move"}}},y=function(t){if(t=t||E(),t.hasClass("thumbPanel")||(t=t.find(".thumbPanel")),t.length){var n=t.attr("id");n||(n=t.parent(".tab-pane").attr("id"));var i=F(t),r=e("vvStateManager").getCurrentState(),s=$(i).filter(function(){return $(this).hasClass("vvEmptyStandInThumb")});if(i=$(i).filter(function(){return!$(this).hasClass("vvEmptyStandInThumb")}),s.length){for(var l=$("#thumbnailPaneTemplate"),u=r.getDocumentModel().model.pageData,g=0;g<s.length;g++){var v=s.eq(g).data("subDocumentPageNumber"),p=s.eq(g).data("wholeDocumentPageNumber"),h={documentId:virtualViewer.getDocumentIdForPage(p,r),subDocumentPageNumber:v,wholeDocumentPageNumber:p,displayName:u[p].displayName},m={useFooter:!!a.displayThumbFooters,thumbList:[h],useImage:!a.doNotLoadPageThumbs,pageCount:r.getPageCount()},f=$(l.render(m));s.eq(g).replaceWith(f),s.eq(g).hasClass("activeThumbBox")&&f.addClass("activeThumbBox"),N(f),i.push(f)}R(i)}for(var y=0;y<i.length;y++){var P=$(i[y]),A=P.find("img.vvLoadingGif"),T=P.find("img.vvImageLoading");if(A.length&&!T.length){var S=U(P.data("thumbInfo")),I=new Image;$(I).on("load",c),$(I).on("error",d),$(I).insertBefore(A).hide(),$(I).addClass("vvThumbImage vvImageLoading"),P.hasClass("activeThumbBox")&&($(I).addClass("activeThumb"),P.find(".vvThumbFooter").addClass("activeThumb"));var w=P.data("thumbInfo").pageNumber;r&&r.getDocumentModel()&&r.getDocumentModel().selection[w]&&b(w,!0),P.hasClass("selectedThumbBox")&&($(I).addClass("selectedThumb"),P.find(".vvThumbFooter").addClass("selectedThumb")),I.draggable="true"===P.attr("draggable"),
P.on("dragstart",function(e){"false"===P.attr("draggable")&&e.preventDefault()}),Modernizr.touchevents&&(Hammer(I).on("press",function(e){e.preventDefault()}),Hammer(P[0]).on("pressup",function(e){e.preventDefault()}));var D;r&&(D=r.getImageManager()),D||(D=new o),D.requestImageViaXHR(S,I,{thumbnail:!0})}}}},b=function(e,t){var a=$("#vvPageThumbs .vvThumbBox").eq(e);return t?(a.addClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(a.removeClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").removeClass("selectedThumb"))},P=function(e,t,a){var n=$("#vvPageThumbs .vvThumbBox").slice(e,t);return a?(n.addClass("selectedThumbBox"),void n.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(n.removeClass("selectedThumbBox"),void n.find(".selectedThumb").removeClass("selectedThumb"))},A=function(t){$(".activeThumbBox").removeClass("activeThumbBox"),$(".activeThumb").removeClass("activeThumb");var a;if(t=t||e("vvStateManager").getCurrentState()){var n=t.getPageNumber();a=$("#vvPageThumbs .vvThumbBox").eq(n),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb"),a=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").pageNumber===n}),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")}var o=virtualViewer.getDocumentId(0),i=$("#vvDocThumbs .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").documentId===o});0===i.length&&(i=$("#vvDocThumbs .vvThumbBox:visible").first()),i.addClass("activeThumbBox"),i.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")},T=function(t){t=t||e("vvStateManager").getCurrentState();var a=0;t&&(a=t.getPageNumber());var n=$("#vvPageThumbs .vvThumbBox").eq(a);k($("#vvPageThumbs"),n)},S=function(e){e=e||virtualViewer.getDocumentId(0);var t=$("#vvDocThumbs .vvThumbBox").filter(function(t){return $(this).data("thumbInfo").documentId===e});t.length||(t=$("#vvDocThumbs .vvThumbBox").eq(0)),k($("#vvDocThumbs"),t)},I=function(t){t=t||e("vvStateManager").getCurrentState();var a=0;t&&(a=t.getPageNumber());var n=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").pageNumber===a});k($("#vvSearchResults"),n)},w=function(e){e?($("#vvImagePanel").removeClass("noThumbs"),$("#vvThumbs").show(),L(),x(virtualViewer.documentList),y($("#vvPageThumbs .thumbPanel")),y($("#vvDocThumbs .thumbPanel"))):($("#vvImagePanel").addClass("noThumbs"),$("#vvThumbs").hide()),virtualViewer.processWindowResize()},D=function(){$(".thumbPanel").click(function(e){var t=virtualViewer.getDocumentModel(),a=$(e.target).closest("div.vvThumbBox, div.thumbStandIn");!a.length||a.hasClass("vvThumbBox")||a.hasClass("thumbStandIn")||t&&t.clearPageSelection()}).preventFocusOutlineOnClick().focus(function(e){A()}).keydown(function(e){var t=$(this),a=function(e){var a=t.find(".activeThumbBox");0===a.length&&(a=t.find(".vvThumbBox").first()),a.removeClass("activeThumbBox").find(".activeThumb").removeClass("activeThumb");var n=C(a,e);0===n.length&&(n=a),n.addClass("activeThumbBox").find(".displayedThumb, .vvThumbFooter").addClass("activeThumb");var o=n[0];o.scrollIntoViewIfNeeded?o.scrollIntoViewIfNeeded():o.scrollIntoView&&o.scrollIntoView()};if("ArrowUp"===e.key||"Up"===e.key)a(!1),e.preventDefault();else if("ArrowDown"===e.key||"Down"===e.key)a(!0),e.preventDefault();else if("Enter"===e.key||" "===e.key||"Spacebar"===e.key){if("vvSearch"===e.currentTarget.id)return;var n=t.find(".activeThumbBox");if(!n)return;var o=t.find(".selectedThumbBox");o&&(o.removeClass("selectedThumbBox"),o.find(".displayedThumb").removeClass("selectedThumb"));var i=n.data().thumbInfo;i.documentListThumb?virtualViewer.openInTab(i.documentId):(b(i.pageNumber,!0),virtualViewer.setPage(i.pageNumber)),e.preventDefault()}})},C=function(e,t){if(t){var a=e.nextUntil(".vvThumbBox:visible");return 0===a.length?e.next():a.last().next()}var n=e.prevUntil(".vvThumbBox:visible");return 0===n.length?e.prev():n.last().prev()},M=function(e){e&&!e.hasClass("thumbPanel")&&e.find(".thumbPanel"),e=e||E(),e.find(".vvThumbBox, .vvThumbDivider").tooltip("hide").remove()},x=function(e){var t=$("#vvDocThumbs .thumbPanel");if(M(t),e=e||virtualViewer.documentList,e.length){var a={thumbList:e,useImage:!0,isDocThumb:!0};O(t,a);var n=t.children(".vvThumbBox");if(n.on("click",r),n.contextMenu("vvDocThumbContextMenu",virtualViewer.docThumbContextMenu),Modernizr.touchevents)for(var o=0;o<n.length;o++){var l=new Hammer(n[o]);l.get("press").set({enable:!0}),l.on("press",s)}W(n,i)}},L=function(t){if(t=t||e("vvStateManager").getCurrentState(),t&&t.documentFullyLoaded()){var n=$("#vvPageThumbs .thumbPanel");if(M(n),a.showPageThumbnails){var o=virtualViewer.getDocumentModel(t).model.pageData,i={thumbList:o,useImage:!a.doNotLoadPageThumbs,pageCount:t.getPageCount()};O(n,i)}}},N=function(e){if(e.on("dragstart",f),e.on("dragover",h),e.on("drop",v),e.contextMenu("vvThumbContextMenu",virtualViewer.pageThumbContextMenuOptions),virtualViewer.showAllAnnotationIndicators(),!Modernizr.touchevents)return void e.on("click",u);for(var t=0;t<e.length;t++){var a=new Hammer(e[t]);a.get("press").set({enable:!0}),a.on("press",s),a.get("doubletap").set({domEvents:!0,enable:!0}),a.get("doubletap").recognizeWith("tap"),a.get("tap").requireFailure("doubletap"),a.on("tap",u)}BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&e.bind("touchstart",function(e){var t=e.timeStamp,a=$(this).data("lastTouch")||t,n=t-a,o=e.originalEvent.touches.length;$(this).data("lastTouch",t),!n||n>500||o>1||e.preventDefault()})},V=function(t,n){if(t=t||e("vvStateManager").getCurrentState(),t&&t.documentFullyLoaded()){var o=$("#vvSearchResults"),i=t.getDocumentModel().model.pageData,r=[];n=n||[];for(var s=0;s<n.length;s++){var l=n[s],d={};i[l]&&(d.documentId=virtualViewer.getDocumentIdForPage(l,t),d.wholeDocumentPageNumber=l,d.subDocumentPageNumber=virtualViewer.getPageIndexForPage(l,t),r.push(d))}var c={isSearchThumb:!0,thumbList:r,useImage:!a.doNotLoadPageThumbs,pageCount:t.getPageCount()},g=O(o,c,!0);g.on("click",u)}},k=function(e,t){if(!e||e.hasClass("thumbPanel")||e.hasClass("tab-pane")||(e=e.find(".thumbPanel")),t&&t.length&&e&&e.length){var a=e[0].scrollTop,n=a+e[0].clientHeight,o=t[0].offsetTop,i=o+t[0].clientHeight;(i>n||o<a)&&e.scrollTop(o)}},R=function(e){if(e.length)for(var t=0;t<e.length;t++){var a=$(e[t]);if(a.find(".displayedThumb").length){a.find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage");var n=a.find(".vvThumbImage"),o=140;n.length&&(o=n.width()||n[0].width||o),a.find(".vvThumbFooter").width(o),a.find(".vvThumbShadowWrapper").width(o),B(a)}}},B=function(e){var a=e.find(".vvThumbImage"),n=e.data(),o=e.parents(".tab-pane").attr("id"),i="";n.thumbInfo?i=n.thumbInfo.displayName||n.thumbInfo.documentId:virtualViewer.getCurrentState(0)&&(i=virtualViewer.getCurrentState(0).getDisplayName()||virtualViewer.getCurrentState(0).getDocumentId());var r,s="number"==typeof n.wholeDocumentPageNumber?n.wholeDocumentPageNumber:n.thumbInfo.pageNumber;"vvPageThumbs"===o?r=t.getLocalizedValue("altText.pageThumbs.page","Thumbnail image for page ")+(s+1)+t.getLocalizedValue("altText.pageThumbs.doc"," of the document ")+i:"vvDocThumbs"===o?r=t.getLocalizedValue("altText.docThumbs","Thumbnail image for the document ")+i:"vvSearchResults"===o&&(r=t.getLocalizedValue("altText.searchThumbs.page","Search Result thumbnail image for page ")+(s+1)+t.getLocalizedValue("altText.searchThumbs.doc"," of the document ")+displayName),a.attr("alt",r)},F=function(e){if(e&&!e.hasClass("thumbPanel")&&(e=e.find(".thumbPanel")),!e.length)return[];var t=e;e.hasClass("tab-pane")||(t=e.parents(".tab-pane"));var a=e.find(".vvThumbBox"),n=$(a[0]).height()||1;n=n+parseInt($(a[0]).css("margin-top"),10)+parseInt($(a[0]).css("margin-bottom"),10);for(var o=t.scrollTop(),i=o+t[0].clientHeight,r=Math.max(parseInt(o/n,10)-2,0),s=[],l=r;l<a.length;l++)if(a[l].offsetTop+a[l].clientHeight>o&&a[l].offsetTop<i&&s.push(a[l]),a[l].offsetTop>i)return s;return s},E=function(){var e=$(".tab-pane.active .thumbPanel");return e},O=function(e,t,n){if(n||e.find(".vvThumbBox").remove(),t.useFooter=!!a.displayThumbFooters,e.parents("#vvPageThumbs").length){for(var o=document.createDocumentFragment(),i=0;i<t.thumbList.length;i++){var r=document.createElement("img");r.src="resources/loader.gif";var s=document.createElement("div");s.appendChild(r),s.classList.add("vvEmptyStandInThumb"),s.classList.add("vvThumbBox"),s.dataset.subDocumentPageNumber=t.thumbList[i].pageIndex,s.dataset.wholeDocumentPageNumber=i,o.appendChild(s)}return e[0].appendChild(o),void(t.useImage||y(e))}var l=$.templates("#thumbnailPaneTemplate"),u=$(l(t));return u.appendTo(e),n&&a.doNotLoadPageThumbs&&a.displayThumbFooters&&R(u),u},U=function(e){var t=new URI(a.servletPath);return t.addQuery("action","getThumbnail"),t.addQuery("pageNumber",e.subDocumentPageNumber),t.addQuery("searchThumb",!!e.searchThumb),t.addQuery("documentListThumb",!!e.documentListThumb),t.addQuery("documentId",e.documentId),t.addQuery("thumbnailSize",n.thumbnailSize),t.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t.addQuery("virtualPageNumber",e.pageNumber),t.addQuery("pageCount",e.pageCount||1),virtualViewer.getOverlayPath()&&t.addQuery("overlayPath",virtualViewer.getOverlayPath()),n.cacheBuster!==!0&&"Explorer"!==BrowserDetect.browser||t.addQuery("cacheBuster",Math.random()),t.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),t},_=function(e,t){var a=$("#vvDocThumbs .vvThumbBox.activeThumbBox");if(!a.length||a.data("thumb-info").documentId!==e)for(var n=$("#vvDocThumbs .vvThumbBox"),o=0;o<n.length;o++)if($(n[o]).data("thumb-info").documentId===e){a=$(n[o]);break}a.attr("data-original-title",t),a.find(".vvThumbFooter > div").text(t)},z=function(e){var t=$("#vvDocThumbs .thumbPanel"),a=t.find(".vvThumbBox");W(a,e),i=e,y(t)},W=function(e,t){t?e.each(function(e,a){var n=$(a),o=n.data().thumbInfo,i=o.displayName||o.documentId;i&&i.toLowerCase().indexOf(t.toLowerCase())>=0?n.show():n.hide()}):e.show()};return{prepareThumbPanels:D,fillDocThumbs:x,fillPageThumbs:L,fillSearchThumbs:V,buildThumbURI:U,loadVisibleThumbs:y,removeThumbs:M,setPageRangeThumbSelection:P,setPageThumbSelection:b,highlightActiveThumbnail:A,ensurePageThumbIsVisible:T,ensureDocThumbIsVisible:S,ensureSearchThumbIsVisible:I,setThumbPanelVisibility:w,updateDocumentDisplayName:_,filterDocumentThumbsByDisplayName:z}}();return i}),define("vvDocumentModel",["vvUtility","vvThumbs","vvDefines","user-config/config"],function(e,t,a,n){function o(e){return e?(this.model=e,this.selection=[],this.model.propertyHash={},this.lastSelectedPageNumber=0,this.model.watermarks||(this.model.watermarks=[]),void(this.model.documentNotes||(this.model.documentNotes={},this.model.documentNotes.notes=[]))):null}return o.prototype.init=function(){this.setPagesModifiedSinceInit(!1),this.setMetadataModifiedSinceInit(!1),this.setAnnotationsModifiedSinceInit(!1),this.setBookmarksModifiedSinceInit(!1),this.setNotesModifiedSinceInit(!1),this.setWatermarksModifiedSinceInit(!1),this.selection.length=this.getDocumentLength(),this.resetPageViewed()},o.prototype.addPageToSelection=function(e){this.lastSelectedPageNumber=e,this.selection[e]=!0,t.setPageThumbSelection(e,!0)},o.prototype.removePageFromSelection=function(e){this.selection[e]=!1,t.setPageThumbSelection(e,!1)},o.prototype.togglePageSelection=function(e){this.selection[e]=!this.selection[e],t.setPageThumbSelection(e,this.selection[e])},o.prototype.isPageSelected=function(e){return!!this.selection[e]},o.prototype.isInitialized=function(){return!!(this.model&&this.model.pageData.length>0)},o.prototype.selectRange=function(e){var a=this.lastSelectedPageNumber,n=e+1;n<=a&&(a=e,n=this.lastSelectedPageNumber);for(var o=a;o<n;o+=1)this.selection[o]=!0;t.setPageRangeThumbSelection(a,n,!0)},o.prototype.selectAll=function(){this.lastSelectedPageNumber=0,this.selectRange(this.selection.length-1)},o.prototype.clearPageSelection=function(){this.lastSelectedPageNumber=0,this.selection=[],this.selection.length=this.model.pageData.length,t.setPageRangeThumbSelection(0,this.model.pageData.length,!1)},o.prototype.cleanAfterSave=function(t,n){var o=this.model.pageData,i=encodeURIComponent(t);t&&(this.model.documentId=i),this.setPagesModifiedSinceInit(!1),this.setMetadataModifiedSinceInit(!1),this.setAnnotationsModifiedSinceInit(!1),this.setBookmarksModifiedSinceInit(!1),this.setNotesModifiedSinceInit(!1),this.setWatermarksModifiedSinceInit(!1),this.setAnnotationsAsNotNew(),this.model.annotationLayersDeletedSinceInit=[];for(var r=0;r<o.length;r+=1){var s=o[r];e.isVirtualDocument(t)||(s.pageIndex=r),t&&!e.isVirtualDocument(t)&&(s.documentId=i,s.annotationHash&&$.each(s.annotationHash,function(e,t){t&&t.documentId&&(t.documentId=i)})),n&&0!==s.rotateAngle&&n.rotatePageTextSelectionBoxes(r,s.rotateAngle),s.rotateAngle=0,s.invertImage=!1,s.brightness=0,s.contrast=0,s.gamma=a.defaultGammaValue,s.despeckle=0}},o.prototype.cutSelection=function(e){var t=[];this.setPagesModifiedSinceInit(!0);for(var a=0;a<this.model.pageData.length;a+=1)e.indexOf(a)<0&&t.push(this.model.pageData[a]);this.model.pageData=t,this.clearPageSelection()},o.prototype.copySelection=function(){for(var t=[],a=0;a<this.selection.length;a+=1)if(this.selection[a]===!0){var n=this.model.pageData[a],o=e.deepObjCopy(n);t.push(o)}return t},o.prototype.paste=function(t,a){var n=0;this.setPagesModifiedSinceInit(!0);for(var o=0;o<t.length;o+=1)this.model.pageData.splice(a+n,0,e.deepObjCopy(t[o])),n+=1;this.clearPageSelection()},o.prototype.getMediaType=function(){return this.model.mediaType},o.prototype.getModifiedSinceInit=function(){return this.model.pagesModifiedSinceInit||this.model.metadataModifiedSinceInit||this.model.annotationsModifiedSinceInit||this.model.bookmarksModifiedSinceInit||this.model.notesModifiedSinceInit||this.model.watermarksModifiedSinceInit},o.prototype.getPagesModifiedSinceInit=function(){return this.model.pagesModifiedSinceInit},o.prototype.setPagesModifiedSinceInit=function(e,t,a){var n=this.model;if(n.pagesModifiedSinceInit=e,"number"==typeof t)n.pageData[t].isModified=e;else if(!e)for(var o=0;o<n.pageData.length;o++)n.pageData[o].isModified=!1;virtualViewer.updateTabName(a)},o.prototype.getMetadataModifiedSinceInit=function(){return this.model.metadataModifiedSinceInit},o.prototype.setMetadataModifiedSinceInit=function(e,t){this.model.metadataModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.getAnnotationsModifiedSinceInit=function(){return this.model.annotationsModifiedSinceInit},o.prototype.setAnnotationsModifiedSinceInit=function(e,t){if(this.model.annotationsModifiedSinceInit=e,!e)for(var a=this.model.layerManager.layers,n=0;n<a.length;n+=1)a[n].dirty=!1;virtualViewer.updateTabName(t)},o.prototype.getBookmarksModifiedSinceInit=function(){return this.model.bookmarksModifiedSinceInit},o.prototype.setBookmarksModifiedSinceInit=function(e,t){this.model.bookmarksModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.getNotesModifiedSinceInit=function(){return this.model.notesModifiedSinceInit},o.prototype.setNotesModifiedSinceInit=function(e,t){this.model.notesModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.getWatermarksModifiedSinceInit=function(){return this.model.watermarksModifiedSinceInit},o.prototype.setWatermarksModifiedSinceInit=function(e,t){this.model.watermarksModifiedSinceInit=e,virtualViewer.updateTabName(t)},o.prototype.setAnnotationsAsNotNew=function(){for(var e=this.model.layerManager.layers,t=0;t<e.length;t+=1)e[t].newLayer=!1},o.prototype.getSelectedPageNumbers=function(){for(var e=[],t=0;t<this.selection.length;t+=1)this.selection[t]===!0&&e.push(t);return e},o.prototype.renameLayer=function(e,t){for(var a=this.model.layerManager.layers,n=null,o=0;o<a.length;o+=1)if(n=a[o],decodeURIComponent(n.annotationId)===e){n.annotationId=encodeURIComponent(t);break}for(var i=this.model.pageData,r=0;r<i.length;r+=1){var s=i[r],l=s.annotationHash;l&&(n=l[e],n&&(n.layerAnnotationId=t,l[t]=n,l[e]=void 0))}var u=(this.model.annotationLayersDeletedSinceInit||[]).indexOf(t);u>-1&&this.model.annotationLayersDeletedSinceInit.shift(u)},o.prototype.deleteLayer=function(e){for(var t=this.model.layerManager.layers,a=null,o=!1,i=!1,r=0;r<t.length;r++)if(a=t[r],decodeURIComponent(a.annotationId)===e){this.markLayerDirty(a),i=a.newLayer,a.annotationId=void 0,t.splice(r,1),o=!0;break}for(var s=this.model.pageData,l=0;l<s.length;l++){var u=s[l],d=u.annotationHash;d&&(a=d[e],a&&(delete d[e],a.layerAnnotationId=void 0,d[e]=void 0,o=!0),n.showAnnIndicators&&(virtualViewer.pageContainsAnnotations(l)||virtualViewer.removeAnnotationIndicators(l)))}o&&!i&&(this.model.annotationLayersDeletedSinceInit||(this.model.annotationLayersDeletedSinceInit=[]),this.model.annotationLayersDeletedSinceInit.indexOf(e)===-1&&this.model.annotationLayersDeletedSinceInit.push(e))},o.prototype.getDocumentLength=function(){return this.model.pageData.length},o.prototype.markLayerDirty=function(e){this.setAnnotationsModifiedSinceInit(!0);for(var t=this.model.layerManager.layers,a=0;a<t.length;a+=1)if(e.layerName===decodeURIComponent(t[a].annotationId)){t[a].dirty=!0;break}},o.prototype.setProperty=function(e,t){null===this.model.propertyHash&&(this.model.propertyHash={}),this.model.propertyHash[e]=t,this.setMetadataModifiedSinceInit(!0)},o.prototype.getProperty=function(e){return null===this.model.propertyHash?null:this.model.propertyHash[e]},o.prototype.setPropertyHash=function(e){this.model.propertyHash=e},o.prototype.isLayerDirty=function(e){this.isLayerDirtyByName(e.layerName)},o.prototype.isLayerDirtyByName=function(e){for(var t=this.model.layerManager.layers,a=0;a<t.length;a+=1)if(e===decodeURIComponent(t[a].annotationId))return!!t[a].dirty},o.prototype.resetPageViewed=function(){for(var e=this.model.pageData,t=0;t<e.length;t+=1)e[t].pageViewed=!1},o.prototype.hasRedactions=function(){for(var e=this.model.layerManager.layers,t=0;t<e.length;t+=1){var n=e[t];if(n&&n.isRedaction&&n.permissionLevel<a.permissionLevels.PERM_VIEW)return!0}return!1},o}),define("vvBookmarks",["vvUtility"],function(e){function t(){this.bookmark={page:null,note:null},this.bookmarkArray=[],a=this,this.editingBookmark=null,this.pageToAdd=-1}var a;return t.prototype.addBookmark=function(t,a,n,o){try{var i=virtualViewer.getCurrentState();if(i.isVirtualDocument())throw new Error(e.getLocalizedValue("errors.virtualDocumentBookmark","VirtualDocuments can't use Bookmarks"));var r=i.getDocumentModel();if(this.editingBookmark&&(this.editingBookmark=null),null===a||"undefined"==typeof a)if(this.pageToAdd!==-1)a=this.pageToAdd,this.pageToAdd=-1;else{var s=r.getSelectedPageNumbers();if(s.length>1)throw new Error(e.getLocalizedValue("errors.tooManyPagesSelected","Multiple pages are selected, and bookmarks may only be applied to a single page"));s.length<1&&(s=[i.pageNumber]),a=s[0]}var l=a>=0&&a<i.pageCount;if("number"!=typeof a||!l)return!1;if(this.bookmarkExists(a)){var u=e.getLocalizedValue("errors.bookmarkExists","Bookmark already exists!");throw new Error(u)}this.bookmark.page=a,0===t.length?this.bookmark.note=e.getLocalizedValue("bookmarks.bookmarkDefault","Bookmark"):this.bookmark.note=t;var d=this.copyBookmark(this.bookmark);this.bookmarkArray.push(d);var c=e.encodeForHTML(this.bookmark.note),g=$('<div id="page'+this.bookmark.page+'" class="vvBookmark"> ');return g.append("<hr>"),g.append('<div class="vvBookmarkPageNumber"> <a href=<b> Page: '+(this.bookmark.page+1)+"</b></a> <button type ='button' id = 'vvBookmarksCloseButton' class='smallClose vvBookmarksCloseButton'><span aria-hidden='true'>x</span></button></div>"),g.append('<span class="vvBookmarkContent ellipsis">'+c+"</span></div>"),$("#vvBookmarksInternal").prepend(g),$("#vvBookmarksCloseButton").attr("title",e.getLocalizedValue("bookmarks.deleteButton","Delete Bookmark")),$("#vvBookmarksCloseButton").attr("data-tooltip","tooltip"),this.addClickEvent(g,a),this.removeClickDefaults(),this.addXButton(a),o||r.setBookmarksModifiedSinceInit(!0,i),n||this.orderBookmarks(),!0}catch(e){var v={client:!0,disable:virtualViewer.disableErrorModals.bookmark,e:e};return virtualViewer.displayExceptionMessage(e.message,v),!1}},t.prototype.updateBookmarkDisplay=function(e){var t="#page"+e,a=$(t+" .vvBookmarkContent");a.text(this.editingBookmark.note)},t.prototype.editBookmark=function(t){try{if(!t&&0!==t)throw new Error(e.getLocalizedValue("bookmarkDialog.errors.noPage","Please pass a page number to edit a bookmark"));if(virtualViewer.getCurrentState().isVirtualDocument())throw new Error(e.getLocalizedValue("bookmarkDialog.errors.virtualDocument","Bookmarks are not supported on Virtual Documents"));for(var a,n=0;n<this.bookmarkArray.length;n++)if(this.bookmarkArray[n].page===t){this.editingBookmark=this.copyBookmark(this.bookmarkArray[n]),a=this.bookmarkArray[n];break}if(!a)throw new Error(e.getLocalizedValue("bookmarkDialog.errors.noBookmarks","No bookmark exists for the provided page"));var o=e.getLocalizedValue("bookmarkDialog.editTitle","Edit Bookmark");$("#vvBookmarkTitle").text(o),$("#vvBookmarkDialogNoteInput").val(a.note),$(".ui-widget-overlay ui-front").onContextMenu=function(){return!1},$("#vvBookmarkDialog").modal("show")}catch(e){var i={client:!0,disable:virtualViewer.disableErrorModals.bookmarks,e:e};return virtualViewer.displayExceptionMessage(e.message,i),!1}},t.prototype.saveEditedBookmark=function(t){for(var a=virtualViewer.getCurrentState(),n=a.getDocumentModel(),o=-1,i=0;i<this.bookmarkArray.length;i++)if(this.bookmarkArray[i].page===this.editingBookmark.page){o=i;break}return o===-1?void(this.editingBookmark=null):(this.editingBookmark.note=t,0===this.editingBookmark.note.length&&(this.editingBookmark.note=e.getLocalizedValue("bookmarks.bookmarkDefault","Bookmark")),this.bookmarkArray[i]=this.editingBookmark,this.updateBookmarkDisplay(this.editingBookmark.page),void n.setBookmarksModifiedSinceInit(!0,a))},t.prototype.restoreBookmark=function(){null!==this.deletedBookmark&&(this.addBookmark(this.deletedBookmark.note,this.deletedBookmark.page,!1,!1),this.deletedBookmark=null)},t.prototype.bookmarkExists=function(e){for(var t=0;t<this.bookmarkArray.length;t++)if(this.bookmarkArray[t].page===e)return!0;return!1},t.prototype.removeClickDefaults=function(){$(".vvBookmark").click(function(e){e.preventDefault()}),$(".vvBookmarkPageNumber").click(function(e){e.preventDefault()}),$(".vvBookmarkContent").click(function(e){e.preventDefault()})},t.prototype.addClickEvent=function(e,t){$(e).click(function(e){return 2!==e.button&&(virtualViewer.getSplit()&&virtualViewer.setActivePane(0),virtualViewer.setPage(t),!1)}),$(e).on("contextmenu",function(e){e.preventDefault(),virtualViewer.getBookmarks().editBookmark(t)})},t.prototype.addXButton=function(e){for(var t=$("#vvBookmarksInternal")[0].children,a=0;a<t.length;a++){var n=parseInt(t[a].children[1].children[0].text.substring(7))-1;n===e&&$(t[a].children[1].children[1]).click(function(){return virtualViewer.getBookmarks().deleteBookmark(this,e),this.remove(),!1})}},t.prototype.deleteBookmark=function(t,n,o){try{var i,r=$("#vvBookmarksInternal")[0];if(0===r.children.length)throw new Error(e.getLocalizedValue("errors.pageHasNoBookmark","Page has no bookmark to delete."));var s=virtualViewer.getCurrentState();if(s.isVirtualDocument())throw new Error(e.getLocalizedValue("bookmarkDialog.errors.virtualDocument","Bookmarks are not supported on Virtual Documents"));if(null===n||void 0===n){if(!this.bookmark)throw new Error(e.getLocalizedValue("errors.invalidBookmark","Invalid Page or Bookmark"));n=this.bookmark.page}for(var l=!1,u=0;u<this.bookmarkArray.length;u++)if(this.bookmarkArray[u].page===n){l=!0;break}if(!l)throw i=e.getLocalizedValue("errors.pageHasNoBookmark","Page has no bookmark to delete."),new Error(i);var d=s.getDocumentModel();if(r&&t){var c=t.parentElement.parentElement,g=$(r).children().index(c);if(g<0||g>$(r).children().length)return;$($(r).children()[g]).remove(),g=this.bookmarkArray.length-(g+1),a.deletedBookmark=this.bookmarkArray.splice(g,1)[0],d.setBookmarksModifiedSinceInit(!0,s)}else if(r){for(var v=r.children,p=0;p<v.length;p++){var h=$(v[p]).html();h=h.substring(h.indexOf("Page:")+5,h.indexOf("</a>"));var m=parseInt(h)-1;if(m===n)break}$($(r).children()[p]).remove(),p=this.bookmarkArray.length-(p+1),a.deletedBookmark=this.bookmarkArray.splice(p,1)[0],this.clearBookmark(),d.setBookmarksModifiedSinceInit(!0,s)}}catch(e){if(!o){var f={client:!0,disable:virtualViewer.disableErrorModals.bookmarks,e:e};virtualViewer.displayExceptionMessage(e.message,f)}return!1}},t.prototype.deleteBookmarks=function(e){if(!e)return!1;for(var t=e.length-1;t>=0;t--)this.deleteBookmark(null,e[t],!0);return!0},t.prototype.cutBookmarks=function(e){var t=[],a=$("#vvBookmarksInternal")[0],n=virtualViewer.getCurrentState(),o=n.getDocumentModel();if(a){if((null===e||void 0===e)&&this.bookmark)return null;for(var i=a.children,r=0;r<e.length;r++){var s=e[r];if(this.bookmarkArray[s]){var l=this.bookmarkArray[s].note;if(null===l)return!1;for(var u=0;u<i.length;u++){var d=i[u].innerText,c=parseInt(d.substring(d.indexOf(":")+1,d.indexOf(l)))-1;if(c===s)break}$($(a).children()[u]).remove(),u=this.bookmarkArray.length-(u+1),t.push(this.bookmarkArray.splice(u,1)[0]),this.clearBookmark(),o.setBookmarksModifiedSinceInit(!0,n)}}return t}return null},t.prototype.clearBookmark=function(){this.bookmark={page:null,note:null}},t.prototype.clearAllBookmarks=function(){this.clearBookmark();for(var e=$("#vvBookmarksInternal")[0],t=e.children.length-1;t>=0;t--)$(e.children[t]).remove();this.bookmarkArray=[]},t.prototype.copyBookmark=function(e){var t={page:e.page,note:e.note};return t},t.prototype.loadBookmarks=function(e){if(null!==e&&void 0!==e||(e=virtualViewer.getCurrentState()),e.isVirtualDocument())return!1;this.clearAllBookmarks();var t=e.getDocumentModel(),a=t.model.bookmarks;for(var n in a)if(n){var o=parseInt(n);this.addBookmark(decodeURIComponent(a[o][0]),o,!0,!0)}this.orderBookmarks()},t.prototype.saveBookmarks=function(e){null!==e&&void 0!==e||(e=virtualViewer.getCurrentState());for(var t=e.getDocumentModel(),a={},n=0;n<this.bookmarkArray.length;n++){var o=this.bookmarkArray[n];a[o.page]=[encodeURIComponent(o.note)]}t.model.bookmarks=a},t.prototype.addPages=function(e,t){for(var a=0;a<this.bookmarkArray.length;a++)this.bookmarkArray[a].page>=e&&(this.bookmarkArray[a].page+=t)},t.prototype.reducePages=function(e){for(var t=0;t<this.bookmarkArray.length;t++)for(var a=e.length-1;a>=0;a--)this.bookmarkArray[t].page>e[a]&&this.bookmarkArray[t].page--},t.prototype.shiftBookmarks=function(e,t,a){a?this.addPages(e,t.length):this.reducePages(t),this.orderBookmarks()},t.prototype.orderBookmarks=function(){for(var e=[],t=virtualViewer.getCurrentState(),a=0;a<t.pageCount;a++){for(var n=0;n<this.bookmarkArray.length;n++)this.bookmarkArray[n].page===a&&e.push(this.copyBookmark(this.bookmarkArray[n]));if(e.length==this.bookmarkArray.length)break}for(this.clearAllBookmarks(),a=e.length-1;a>=0;a--)this.addBookmark(e[a].note,e[a].page,!0,!0)},t.prototype.copyBookmarksForPageRange=function(e){for(var t=[],a=this.bookmarkArray.length-1;a>=0;a--)for(var n=this.bookmarkArray[a],o=0;o<e.length;o++)if(n.page===e[o]&&t.push(n),e.length===t.length)return t;return t},t.prototype.shiftPastePageNumbers=function(e,t,a){for(var n=[],o=0;o<e.length;o++)for(var i=0;i<t.length;i++)if(t[i].page===e[o]){book={page:o+a,note:t[i].note},n.push(book);break}return n},t.prototype.switchTabs=function(e,t){e&&e.getDocumentModel()&&this.saveBookmarks(e),this.clearAllBookmarks(),t&&t.getDocumentModel()&&this.loadBookmarks(t)},t}),define("vvWatermarks",["user-config/config","vvPoint","vvStateManager"],function(e,t,a){var n=function(){var n=function(e){if(e=e||a.getActivePaneState(),e.getDocumentModel().model.watermarks){var t=e.getDocumentModel().model.watermarks;e.watermarks=[];for(var n=0;n<t.length;n++)e.watermarks[n]=$.extend(!0,{},t[n]),e.watermarks[n].text=decodeURIComponent(e.watermarks[n].text)}else e.watermarks=[]},o=function(e){e=e||a.getActivePaneState();for(var t=[],n=$("#vvImageCanvas")[0].getContext("2d"),o=0;o<e.watermarks.length;o++){var i=$.extend(!0,{},e.watermarks[o]);if(i.text.indexOf(D.pageNumber.tagText)>=0)i.widthAtTenPx=0;else{var r=I(i,{state:e,pageNumber:0});n.save(),n.font="10px "+i.format.font;for(var s=0,l=0;l<r.length;l++)r[l].length>r[s].length&&(s=l);i.widthAtTenPx=Math.round(n.measureText(r[s]).width),n.restore()}i.text=encodeURIComponent(i.text),i.dynamicData=i.dynamicData||{},i.dynamicData.printTime=D.printTime.callback(),i.dynamicData.username=virtualViewer.getUserPreferences().getUsername(),t.push(i)}e.getDocumentModel().model.watermarks=t},i=function(e,t){m(e).push(t),h(e).push(t),e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)},r=function(e,t){e=e||a.getActivePaneState();var n=h(e);if(n&&n.length){var o=function(e,t){return e-t};t=t.sort(o);for(var i=0;i<n.length;i++){var r=n[i];if(!r.allPages&&r.pages){r.pages=r.pages.sort(o);for(var s=[],l=0,u=0;u<t.length;u++)for(var d=l;d<r.pages.length;d++)if(r.pages[d]!==t[u]){if(r.pages[d]>t[u]&&r.pages[d]>t[u+1]){l=d;break}r.pages[d]<t[u]?s.push(r.pages[d]-u):s.push(r.pages[d]-(u+1))}r.pages=s}}e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)}},s=function(e,t,a){var n=a.getPageCount(),o=t.pages||[];if(t.allPages)for(var i=n-1;i>=0;i--)o.push(i);var r=o.indexOf(e);r>-1&&o.splice(r,1),t.pages=o},l=function(e,t){t=t||a.getActivePaneState(),"number"!=typeof e&&(e=t.getPageNumber());var n=h(t);if(n){for(var o=0;o<n.length;o++){var i=n[o];(i.allPages||i.pages.indexOf(e)>-1)&&(s(e,i,t),i.allPages=!1)}t.getDocumentModel().setWatermarksModifiedSinceInit(!0,t)}},u=function(e,t,n){e=e||a.getActivePaneState();for(var o=h(e),i=[],r=0;r<o.length;r++){var s=o[r],l=$.extend(!0,{},s);if(n||(l.allPages=!1),s.pages=s.pages||[],l.pages=[],s.allPages)for(var u=0;u<t.length;u++)l.pages.push(u);else for(var d=0;d<s.pages.length;d++)(s.allPages||t.indexOf(s.pages[d])>-1)&&l.pages.push(d);i.push(l)}return i},d=function(e,t,n){e=e||a.getActivePaneState();var o=h(e);o||(o=e.watermarks=[]);for(var i=t.pageNums.length,r=t.watermarks.slice()||[],s=0;s<o.length;s++)o[s].allPages||(o[s].pages=o[s].pages.map(function(e){return e>=n?e+i:e}));for(var l=0;l<r.length;l++)r[l].pages=r[l].pages.map(function(e){return e+n});r=g(r,o),e.watermarks=r.concat(o),e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)},c=function(e,t){for(var a,n=[];e.length&&t.length;)a=e.shift(),a===t[0]&&t.shift(),n.push(a);return n=n.concat(e).concat(t),n.sort(function(e,t){return e-t}),n},g=function(e,t){if(!e.length||!t.length)return e;for(var a=[],n=0;n<e.length;n++){for(var o=!1,i=0;i<t.length;i++)if(o=v(e[n],t[i]),o&&!t[i].allPages){t[i].pages=c(e[n].pages,t[i].pages);break}if(!o){var r=e[n],s=$.extend(!0,{},r);a.push(s)}}return a},v=function(e,t){return!(!e||!t)&&(e.position.direction===t.position.direction&&(e.position.vertical===t.position.vertical&&e.text===t.text))},p=function(e,t){var a=h(e),n=m(e);if(n&&n.length>t){var o=a[t],i=n.indexOf(o);i>-1&&(m(e).splice(i,1),0===m(e).length?e.getDocumentModel().setWatermarksModifiedSinceInit(!1,e):e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e))}else e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e);return a&&a.length>t?a.splice(t,1):null},h=function(e){return e.watermarks},m=function(e){return e.newWatermarks},f=function(e,t,a){if(a&&t&&(e||0===e))for(var n=h(t),o=0;o<n.length;o++){var i=n[o];(i.allPages||i.pages.indexOf(e)>-1)&&b(i,e,t,a)}},y=function(t){e.adminCreated=status},b=function(e,t,a,n){n.save();var o,i=a.getRequestedWidthForPage(t),r=a.getRequestedHeightForPage(t);if(a.isPageCropped(t)){var s=a.getOriginalWidthForPage(t)/i,l=a.getPageCropBox(t);i=Math.ceil(l.cropWidth/s),r=Math.ceil(l.cropHeight/s),o={cropWidth:i,cropHeight:r,cropLeft:Math.ceil(l.cropLeft/s),cropTop:Math.ceil(l.cropTop/s)
}}var u=15*a.getZoomDecimal(),d={state:a,pageNumber:t},c=I(e,d),g=T(e,i,r),v=P(i,r,u,e,n,g,c),p=v/.85,h=c.length*p/2,m=A(e,i,r,u,o),f=S(e);n.translate(m.x,m.y),n.rotate(g),n.font=v+"px "+e.format.font,n.textAlign=f,n.fillStyle="#"+e.format.color,e.transparency&&(n.globalAlpha=.4);var y=0,b=0;e.position.vertical===C.TOP&&(n.textBaseline="hanging"),e.position.vertical!==C.CENTER&&"center"!==f||(b-=h,n.textBaseline="top");for(var w=0;w<c.length;w++)n.fillText(c[w],y,b),b+=p;n.restore()},P=function(e,t,a,n,o,i,r){for(var s=0,l=10,u=0;u<r.length;u++)r[u].length>r[s].length&&(s=u);o.font=l+"px "+n.format.font;var d=o.measureText(r[s]).width,c=e*n.stretchPercent,g=t;if(n.position.direction===M.VERTICAL)c=t*n.stretchPercent,g=e;else if(n.position.direction===M.DIAGONAL){n.position.vertical===C.BOTTOM&&(i=2*Math.PI-i);var v=r.length*l*.85/2,p=v/d,h=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),m=h*p/(Math.pow(Math.tan(i),-1)+2*p);c=h-2*m}c-=2*a,g-=2*a;var f=c/d,y=l*f,b=r.length*y;return b>g&&(y=g/r.length),y},A=function(e,a,n,o,i){var r=new t(o,o),s=new t(a/2,n/2),l=new t(a-o,n-o);i&&(r=new t(o+i.cropLeft,o+i.cropTop),s=new t(i.cropLeft+i.cropWidth/2,i.cropTop+i.cropHeight/2),l=new t(i.cropLeft+i.cropWidth-o,i.cropTop+i.cropHeight-o));var u=r;return e.position.vertical===C.BOTTOM?u.y=l.y:e.position.vertical===C.CENTER&&(u.y=s.y-o),e.position.direction===M.DIAGONAL&&(u=s),u},T=function(e,t,a){var n;return n=e.position.vertical===C.BOTTOM&&e.position.direction===M.DIAGONAL?2*Math.PI-Math.atan(a/t):e.position.vertical===C.TOP&&e.position.direction===M.DIAGONAL?Math.atan(a/t):e.position.direction===M.VERTICAL?Math.PI/2:0},S=function(e){return e.position.direction===M.DIAGONAL?"center":"left"},I=function(e,t){var a=e.text;for(var n in D)if(n&&D[n]&&D[n].tagText){var o=D[n].callback(t),i=D[n].tagText.replace("@@","/@/@").replace("@@","/@/@"),r=new RegExp(D[n].tagText,"ig");a=a.replace(r,o);var s=new RegExp(i,"ig");a=a.replace(s,D[n].tagText)}return a.split("\n")},w="LLL",D={username:{tagText:"@@username@@",callback:function(e){return virtualViewer.getUserPreferences().getUsername()}},totalPages:{tagText:"@@totalPages@@",callback:function(e){return e.state.pageCount}},pageNumber:{tagText:"@@pageNumber@@",callback:function(e){return e.pageNumber+1}},printTime:{tagText:"@@printTime@@",callback:function(e){return moment().format(w)}},serverTime:{tagText:"@@serverTime@@",callback:function(e){return moment().format(w)}},docName:{tagText:"@@documentName@@",callback:function(e){return e.state.getDisplayName()}}},C={TOP:0,CENTER:1,BOTTOM:2},M={HORIZONTAL:0,VERTICAL:1,DIAGONAL:2};return{loadWatermarks:n,saveWatermarks:o,addWatermark:i,removePages:r,copyWatermarksForPageRange:u,pastePagesWithWatermarks:d,removeWatermark:p,removeWatermarksFromPage:l,getWatermarksArray:h,paintPageWatermarks:f,setAdminStatus:y,renderFormattedText:I,tags:D,verticalPositionOptions:C,textDirectionOptions:M}}();return n}),define("vvDocViewState",["require","vvUtility","vvDocViewStateElement","vvLayerManager","vvImageManager","vvMediaManager","vvCallbackManager","vvDocumentModel","vvBookmarks","vvWatermarks","vvDefines","user-config/config","annotations","vvAnnotationManager","vvThumbs"],function(e,t,a,n,o,i,r,s,l,u,d,c){function g(e,t,a,r,s,l){this.documentId=e,this.documentModel=t,this.documentByteSize=0,this.pageCount=a,this.pageNumber=r,this.tabNumber=s,this.currentPaneIndex=0,this.awaitingPageCount=!a,this.preferSVG=c.enableSVGSupport,this.closedTab=!0,this.currentLayer=null,this.autoLayerCounter=0,this.layerNames=[],this.layerManager=new n,this.imageManager=new o(this),this.mediaManager=new i(this),this.displayName=null,this.isSearchable=null,this.badDocument=!1,this.docFormat=null,this.documentNoteArray=[],this.cachedSearch=null,this.cachedScroll={},this.zoom=100,this.zoomMode=l,this.timeout=-1,this.watermarks=null,this.demerits=0,this.initPageStatesArray(l),this.temporaryDocumentModelPropertyHash=null,this.xlsxPageLimited=!1,this.newAnnotations=[],this.trueAnnChange=!1,this.newWatermarks=[]}g.prototype.documentFullyLoaded=function(){return!this.awaitingPageCount&&(!!(this.getDocumentModel()&&this.getDocumentModel().model&&this.getDocumentModel().model.pageData)&&!!(this.pageStates&&this.pageStates.length&&this.pageStates[this.getPageCount()-1]))},g.prototype.proceedWithRequestPage=function(e,a,n,o){if(e<0||e>=this.getPageCount())return!1;if(!this.pageStates||!this.pageStates[e])return!1;if(c.delayFirstPageLoad&&!this.documentFullyLoaded())return!1;if(this.isVirtualDocument()&&0!==e&&!this.documentFullyLoaded())return!1;if(this.pageStates[e].imageInfoRequested)return!1;var i=this.imageManager.getOriginalFromPage(e);if(this.pageStates[e].imageInfoLoaded&&t.validImageObject(i)&&(!n||!a))return!1;var r=t.validImageObject(i);return o&&o.recoveringFromImageError?(this.setSVGEnabledForPage(e,!1),!1):!(this.pageStates[e].imageInfoLoaded&&r&&n&&!a||this.pageStates[e].imageInfoLoaded&&r)},g.prototype.requestPage=function(e,a,n,o){if(this.proceedWithRequestPage(e,a,n,o)){this.imageManager.addRequestedOriginalImage(e,a||n,{imageManager:this.imageManager,page:e,recoveringFromError:!1}),r.call("imageLoadRequested",{documentId:this.getDocumentId(),page:e,val:!0});var i=new URI(c.servletPath);i.addQuery("action","getPage"),i.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.cacheBuster===!0&&i.addQuery("cacheBuster",Math.random()),i.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),c.enableSVGSupport&&Modernizr.svg&&(c.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(c.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)?i.addQuery("preferSvg",!0):i.addQuery("preferSvg",!1),this.getLayerManager()&&i.addQuery("hiddenImageLayers",this.getLayerManager().getHiddenImageLayers(!0));var s,l;if(this.documentFullyLoaded())s=virtualViewer.getDocumentIdForPage(e,this),l=this.getDocumentModel().model.pageData[e].pageIndex;else if(this.isVirtualDocument()){var u=t.getVirtualDocumentFirstPageInfo(this.getDocumentId());s=u.documentId,l=u.pageIndex}else s=this.getDocumentId(),l=e;i.addQuery("documentId",s),i.addQuery("pageNumber",l),i.addQuery("imageInfoFields",JSON.stringify(c.imageInfoFields)),this.imageManager.serverScale?i.addQuery("requestedScale",this.getZoomDecimal()):i.addQuery("requestedScale",1),null!==virtualViewer.getOverlayPath()&&i.addQuery("overlayPath",virtualViewer.getOverlayPath());var g=this;this.pageStates[e].imageInfoRequested=!0;var v=new XMLHttpRequest,p=i.query();i.query(""),v.open("POST",i.toString(),!0),v.responseType="arraybuffer",v.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),v.onreadystatechange=function(){if(4===v.readyState){if(500===v.status){var t;if(v.response){var i=new Uint8Array(v.response),s=(new TextDecoder).decode(i);try{t=JSON.parse(s)}catch(e){t=null}}return t&&virtualViewer.checkServerException(t,g.getDocumentId(),g.currentPaneIndex),o&&o.recoveringFromInfoError?(g.markBadPage(e,!0),void r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:e,finalTry:!0})):(g.pageStates&&(g.pageStates[e].imageInfoRequested=!1),r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:e,finalTry:!1}),void g.requestPage(e,a,n,{recoveringFromInfoError:!0}))}for(var l=v.response,u=new Uint8Array(l),d=0,c="";d<=5&&!isNaN(parseInt(String.fromCharCode(u[d])))&&(c+=String.fromCharCode(u[d]),d++,"{"!==String.fromCharCode(u[d])););var p=parseInt(c);if(!c||!p)return o&&o.recoveringFromInfoError?void g.markBadPage(e,!0):(g.pageStates[e].imageInfoRequested=!1,void g.requestPage(e,a,n,{recoveringFromInfoError:!0}));var h=c.length,m=u.slice(h,p+h),f=(new TextDecoder).decode(m),y={};try{y=JSON.parse(f)}catch(e){y=null}if(!y)return o&&o.recoveringFromInfoError?(g.markBadPage(e,!0),void r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:pageNumber,finalTry:!0})):(g.pageStates[e].imageInfoRequested=!1,r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:pageNumber,finalTry:!1}),void g.requestPage(e,a,n,{recoveringFromInfoError:!0}));if(y.isMedia)return;g.processPage(e,y);var b=u.slice(p+h,u.length);if(!b)return void r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:pageNumber,finalTry:!1});var P=y.pageImageMimeType;g.imageManager.loadOriginalImageFromData(null,e,b,P,{imageManager:this.imageManager,page:e,recoveringFromError:!1})}},v.send(p)}},g.prototype.processPage=function(e,t){e===this.pageCount-1&&this.awaitingPageCount&&t.hasNextPage&&this.extendPageCount();var a=this.pageStates[e];a.imageInfoLoaded=!0;var n=this.getDocFormat();null!==n&&""!==n||this.setDocFormat(t.fileExtension);var o=this.getIsSearchable();this.setIsSearchable(t.isSearchable),a.originalWidth=t.imageWidth,a.originalHeight=t.imageHeight,a.dpi=t.imageDPI,a.bitDepth=t.imageBitDepth,a.imageFormat=t.imageFormat,a.compressionType=t.compressionType,this.setDocumentByteSize(t.documentByteSize),this.setImageLayers(t.imageLayerNames);var i=t.customerMetadataKeys||[],s=t.customerMetadataValues||[],l=t.tiffTagDataValues||[],u=t.tiffTagDataLabels||[],d={};if(i){for(var c=0;c<i.length;c++)d[i[c]]=s[c];this.setDocumentModelPropertyHash(d)}for(var g={},v=0;v<u.length;v++)g[u[v]]=l[v];return this.setTiffTagHashForPage(e,g),this.isPageManipulated(e)&&(this.getSVGEnabledForPage(e)?(this.setSVGEnabledForPage(e,!1),this.imageManager.cleanPageFromBuffers(e),this.imageManager.getBestImageFromPage(e,!0)):(this.imageManager.manipulatedImageBuffer[e]=null,this.imageManager.createManipulatedPage(e,this))),r.call("pageLoaded",{documentId:this.documentId,newDisplayName:decodeURIComponent(t.displayName),paneIndex:this.currentPaneIndex,loadedPageNumber:e,searchableStatusBeforeLoad:o}),!0},g.prototype.extendPageCount=function(){if(this.awaitingPageCount){this.pageStates[this.pageCount]=new a(this.zoomMode);var e=this.pageCount;this.setPageCount(e+1),r.call("pageCountUpdated",{documentId:this.documentId,paneIndex:this.currentPaneIndex,oldPageCount:e,newPageCount:this.pageCount})}},g.prototype.requestDocumentModel=function(e,t){var a=new URI(c.servletPath);a.addQuery("action","getDocumentModel"),a.addQuery("documentId",this.getDocumentId()),a.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();if(a.query(""),!this.getDocumentModel()||e){var o=this;$.ajax({url:a.toString(),type:"POST",data:n,dataType:"json",success:function(e){o.onDocumentModelLoadSuccess(e,t)},error:function(e){virtualViewer.checkServerException(e,o.getDocumentId(),o.currentPaneIndex),o.documentModelError(e)}})}},g.prototype.onDocumentModelLoadSuccess=function(e,t){if(virtualViewer.checkServerException(e,this.getDocumentId(),this.currentPaneIndex))return void this.documentModelError(e);var a=new s(e);a.init(),this.setDocumentModel(a),this.processDocumentModel(),r.call("onDocumentLoad",{documentId:this.getDocumentId(),paneIndex:this.currentPaneIndex}),"function"==typeof t&&t(this)},g.prototype.processDocumentModel=function(e){if(e||(e=this.documentModel),(this.awaitingPageCount||this.getPageCount()!==e.model.pageData.length)&&(this.setPageCount(e.model.pageData.length),this.awaitingPageCount=!1,this.updatePageStatesArray(this.getPageCount(),this.zoomMode)),e.model.xlsxPageLimited){this.xlsxPageLimited=!0;var a=t.getLocalizedValue("errors.xlsxPageLimited","This XLSX document has been limited by an administrator, to render a maximum number of pages. The final page displayed will be page: ")+this.pageCount,n={client:!1,disable:virtualViewer.disableErrorModals.xlsxPageLimited};virtualViewer.displayExceptionMessage(a,n)}e.lastSelectedPageNumber=this.getPageNumber(),u.loadWatermarks(this),this.temporaryDocumentModelPropertyHash&&!e.model.propertyHash&&(e.setPropertyHash(this.temporaryDocumentModelPropertyHash),this.temporaryDocumentModelPropertyHash=null),this.displayName&&(this.documentModel.model.displayName=encodeURIComponent(this.displayName))},g.prototype.documentModelError=function(e){var t={documentId:this.getDocumentId(),paneIndex:this.currentPaneIndex,exceptionMessage:e.exceptionMessage,statusText:e.statusText};r.call("requestDocumentModelError",t)},g.prototype.initPageStatesArray=function(e){this.pageStates=[new a(e)]},g.prototype.updatePageStatesArray=function(e,t){for(var n=new Array(e),o=0;o<e;o++)this.pageStates&&this.pageStates[o]?n[o]=this.pageStates[o]:n[o]=new a(t);this.pageStates=n},g.prototype.cutPages=function(e,t){var a=[];e.sort(function(e,t){return e-t});for(var n=0,o=0;o<e.length;o+=1){var i=e[o]-n;a.push(this.pageStates.splice(i,1)[0]),n+=1}return this.pageCount-=e.length,this.pageNumber=t,this.fixAnnPages(),a},g.prototype.copyPages=function(e){var a=[];e.sort(function(e,t){return e-t});for(var n=0;n<e.length;n+=1){var o=this.pageStates[e[n]],i=t.deepObjCopy(o);a.push(i)}return a},g.prototype.pastePages=function(e,t){for(var a=0;a<e.length;a++)this.pageStates.splice(t+a,0,e[a])},g.prototype.fixAnnPages=function(){for(var t=0;t<this.pageStates.length;t++){e("vvAnnotationManager").checkLayerIntegrity(t);for(var a=this.pageStates[t].annotationLayers,n=0;n<this.layerNames.length;n++){var o=a[this.layerNames[n]];if(o){for(var i=0;i<o.anns.length;i++)o.anns[i].page=t;o.pageNumber=t,this.getDocumentModel().markLayerDirty(o)}}}},g.prototype.saveAnnotationLayers=function(e){var t=this,a=this.getAnnotationLayers(e,!0,!0);if(a.length>0){var n=new URI(c.servletPath);n.addQuery("action","saveAnnotationModel"),n.addQuery("documentId",t.getDocumentId()),n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),n.addQuery("pageCount",t.getPageCount()),n.addQuery("modelJSON",JSON.stringify(a)),d.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var o=n.query();n.query(""),$.ajax({type:"POST",url:n.toString(),dataType:"json",data:o,success:function(e){var a=virtualViewer.getCallbackManager();if(a.call("saveAnnotation",{documentId:t.getDocumentId(),clientInstanceId:virtualViewer.getClientInstanceId(),documentIdToReload:e.documentIdToReload}),virtualViewer.checkServerException(e,t.getDocumentId(),t.currentPaneIndex)!==!0){for(var n=t.documentModel.model.layerManager.layers,o=0;o<n.length;o+=1)n[o].dirty=!1;0===t.currentPaneIndex&&virtualViewer.updateTabName(t)}},error:function(e){virtualViewer.checkServerException(e,t.getDocumentId(),t.currentPaneIndex)===!0}})}virtualViewer.displaySaveIndicator(!1)};var v=function(t,a){for(var n={},o=Object.keys(t),i=0;i<o.length;i++)n[o[i]]=t[o[i]];n.anns=[];for(var r=a.pageStates[t.pageNumber].originalWidth,s=a.pageStates[t.pageNumber].originalHeight,l=0;l<t.anns.length;l++){var u=(new(e("annotations"))).copyFrom(t.anns[l]),d=r/u.pageWidth;u.pageWidth=r,u.pageHeight=s,u.scaleAnn(d),u.getFontSize()&&u.setFontSize(u.getFontSize(!0)*d,!0),n.anns.push(u)}return n.pageWidth=r,n.pageHeight=s,n.docDPI=72,n};return g.prototype.getAnnotationLayers=function(a,n,o,i,r,s,l){var u=this,g=[];if(!u.pageStates)return g;for(var p=0;p<u.pageStates.length;p+=1){var h=u.pageStates[p];if(h.annotationLayers){n&&u.rotateLayersForPage(p,u.getRotationForPage(p),o);for(var m=0;m<u.layerNames.length;m+=1){var f=u.layerNames[m],y=h.annotationLayers[f],b=u.getDocumentModel().isLayerDirtyByName(f),P=null;if(y){if(e("vvAnnotationManager").checkLayerPermission(y,d.permissionLevels.PERM_EDIT)===!1||c.oneLayerPerAnnotation&&(!y.anns||!y.anns.length))continue;if(b||a){l&&h.dpi&&h.dpi<72&&y.anns.length&&72*y.pageWidth/y.docDPI*(72*y.pageHeight/y.docDPI)>1e9&&(y=v(y,u)),y.pageNumber=p,P='<?xml version="1.0" encoding="ISO-8859-1"?><document xmlns="http://snowbound.com/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://snowbound.com/XMLSchema flexAnn.xsd"><docMeta><docID>DOC_ID</docID><docName>ANNOTATED_FILE_NAME</docName><docDPI>',P+=y.docDPI>0?y.docDPI:h.dpi,P+="</docDPI></docMeta><docLayers><layer/></docLayers><docPages><page><pageMeta><pageNumber>",P+=y.pageNumber+"</pageNumber><pageWidth>",P+=y.pageWidth+"</pageWidth><pageHeight>",P+=y.pageHeight+"</pageHeight><doubleByte>",P+=y.doubleByte+"</doubleByte></pageMeta><pageObjects>";var A=!1;t.isRedactionLayer(y)&&(A=!0);for(var T=!1,S=!1,I=u.getRotationForPage(y.pageNumber),w=0;w<y.anns.length;w++)y.anns[w].getTextString()&&y.anns[w].getTextString().length&&(T=!0),S=A&&i||T&&r,A||T||!s||(S=!0),P+=y.anns[w].toXML(A,S,I),S=!1,T=!1;P+="</pageObjects></page></docPages></document>"}}P&&g.push({layerName:u.layerNames[m],isRedaction:y.isRedaction,pageNumber:y.pageNumber,layerXML:P})}}}return g},g.prototype.validatePageNumber=function(e){return(isNaN(e)||e===1/0||void 0===e||null===e||e<0)&&(e=this.getPageNumber()),e>=this.pageCount&&(e=this.pageCount-1),e},g.prototype.rotateLayersForPage=function(e,t,a){e=this.validatePageNumber(e);var n=this.pageStates[e];if(n.annotationLayers)for(var o=0;o<this.layerNames.length;o+=1){var i=n.annotationLayers[this.layerNames[o]];if(i){for(var r=0;r<i.anns.length;r++)i.anns[r].rotate(t,a);if(0!==t&&this.getDocumentModel().markLayerDirty(i),!a&&(90===Math.abs(t)||270===Math.abs(t))){var s=i.pageWidth,l=i.pageHeight;i.pageHeight=s,i.pageWidth=l}}}},g.prototype.renameLayer=function(e,t){for(var a=0;a<this.layerNames.length;a+=1)if(this.layerNames[a]===e){this.layerNames[a]=t;break}for(var n=0;n<this.pageStates.length;n+=1){var o=this.getLayersForPage(n);if(o){var i=o[e];if(i){for(var r=0;r<i.anns.length;r+=1)i.anns[r].setLayerName(t);i.layerName=t,o[e]=null,o[t]=i}}}},g.prototype.deleteLayer=function(e){for(var t=0;t<this.pageStates.length;t++){var a=this.getLayersForPage(t);a&&delete a[e]}this.documentModel.deleteLayer(e)},g.prototype.deleteAnnotationsOnLayer=function(e){for(var t=this.pageNumber,a=0;a<this.pageStates.length;a+=1){virtualViewer.setPage(a);var n=this.getLayersForPage(a);if(n)for(var o=n[e].anns,i=0;i<o.length;i++)o[i].setDelete(!0)}virtualViewer.setPage(t)},g.prototype.deleteAllLayers=function(){for(var e=0;e<this.layerNames.length;e++)this.deleteAnnotationsOnLayer(this.layerNames[e])},g.prototype.deleteAllAnnsOnPage=function(e){for(var t=this.getLayersForPage(e),a=0;a<this.layerNames.length;a++)for(var n=this.layerNames[a],o=t[n],i=0;i<o.anns.length;i++)o.anns[i].setDelete(!0),r.call("annotationDeletion",{type:o.anns[i].type})},g.prototype.getDocumentId=function(){return this.documentId},g.prototype.isVirtualDocument=function(){return t.isVirtualDocument(this.documentId)},g.prototype.getVirtualDocumentComponents=function(){var e=[];if(this.isVirtualDocument())for(var t=this.documentId.split(":")[1],a=t.split(","),n=0;n<a.length;n+=1)e.push(a[n].split("[")[0]);else e.push(this.documentId);return e},g.prototype.isMedia=function(){if(!this.documentModel)return!1;var e=this.documentModel.getMediaType();return e===d.mediaType.video||e===d.mediaType.audio||void 0},g.prototype.isVideo=function(){if(!this.documentModel)return!1;var e=this.documentModel.getMediaType();return e===d.mediaType.video||void 0},g.prototype.isAudio=function(){if(!this.documentModel)return!1;var e=this.documentModel.getMediaType();return e===d.mediaType.audio||void 0},g.prototype.isMediaLoaded=function(){return Boolean(this.isMedia()&&this.mediaManager.player&&this.mediaManager.mediaSource)},g.prototype.getTabNumber=function(){return this.tabNumber},g.prototype.setTabNumber=function(e){this.tabNumber=e},g.prototype.getClosedTab=function(){return this.closedTab},g.prototype.setClosedTab=function(e){this.closedTab=e},g.prototype.getDisplayName=function(){return this.displayName},g.prototype.setDisplayName=function(e){this.displayName=e,this.documentModel&&(this.documentModel.model.displayName=encodeURIComponent(e))},g.prototype.setPageDisplayNames=function(t){t=t||[];for(var a=this.getDocumentModel().model.pageData,n=0;n<a.length;n++)a[n].displayName=t[n];e("vvThumbs").fillPageThumbs(this),e("vvThumbs").loadVisibleThumbs($("#vvPageThumbs"))},g.prototype.getDocumentByteSize=function(){return this.documentByteSize},g.prototype.setDocumentByteSize=function(e){this.documentByteSize=e},g.prototype.getIsSearchable=function(){return this.isSearchable},g.prototype.setIsSearchable=function(e){this.isSearchable=e},g.prototype.isBadDocument=function(){return this.badDocument},g.prototype.markBadDocument=function(e){this.badDocument=e},g.prototype.setDocFormat=function(e){this.docFormat=e},g.prototype.getDocFormat=function(){return this.docFormat},g.prototype.resetDocFormat=function(){this.docFormat=null},g.prototype.getDocumentModel=function(){return this.documentModel},g.prototype.setDocumentModel=function(e){this.documentModel=e},g.prototype.getPageCount=function(){return this.pageCount},g.prototype.setPageCount=function(e){this.pageCount=e},g.prototype.getPageNumber=function(){return this.pageNumber},g.prototype.setPageNumber=function(e){isNaN(e)&&(e=0),this.pageNumber=e},g.prototype.getLayerNames=function(){return this.layerNames},g.prototype.setLayerNames=function(e){this.layerNames=e},g.prototype.getZoom=function(){return this.zoom},g.prototype.setZoom=function(e){this.zoom=e},g.prototype.getZoomDecimal=function(){return this.zoom/100},g.prototype.setZoomDecimal=function(e){this.zoom=100*e},g.prototype.getZoomMode=function(){return this.zoomMode},g.prototype.setZoomMode=function(e){this.zoomMode=e},g.prototype.zoomPage=function(e,t){var a=this.getOriginalWidthForPage(t),n=this.getOriginalHeightForPage(t);this.setRequestedWidthForPage(t,Math.round(a*e)),this.setRequestedHeightForPage(t,Math.round(n*e))},g.prototype.getCurrentLayer=function(){var e=this.pageStates[this.getPageNumber()];return this.currentLayer&&e.annotationLayers?e.annotationLayers[this.currentLayer]:null},g.prototype.setCurrentLayer=function(e){e?this.currentLayer=e.layerName:this.currentLayer=void 0},g.prototype.getCurrentLayerOnPage=function(e){var t=this.pageStates[e];return this.currentLayer&&t.annotationLayers?t.annotationLayers[this.currentLayer]:null},g.prototype.setCurrentLayerOnPage=function(e,t){t?this.currentLayer=t.layerName:this.currentLayer=void 0},g.prototype.getLayerManager=function(){return this.layerManager},g.prototype.getMediaManager=function(){return this.mediaManager},g.prototype.getImageManager=function(){return this.imageManager},g.prototype.getVideo=function(){if(this.mediaManager)return this.mediaManager.getVideo()},g.prototype.getViewedForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].pageViewed},g.prototype.setViewedForPage=function(e,t){e=this.validatePageNumber(e),t||(t=!0),this.documentModel&&(this.documentModel.model.pageData[e].pageViewed=t)},g.prototype.isBadPage=function(e){return e=this.validatePageNumber(e),this.pageStates[e].isBad},g.prototype.markBadPage=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].isBad=t},g.prototype.getSVGEnabledForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>e)return!!this.preferSVG&&this.pageStates[e].preferSVG},g.prototype.setSVGEnabledForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].preferSVG=t},g.prototype.setPreferSVGForDocument=function(e){this.preferSVG=e},g.prototype.resetSVGSupport=function(e){null!==e&&void 0!==e||(e=c.enableSVGSupport),this.setPreferSVGForDocument(e);var t=this.getImageManager();t.nukeBuffers()},g.prototype.getOriginalHeightForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].originalHeight:0},g.prototype.getOriginalWidthForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].originalWidth:0},g.prototype.getRequestedHeightForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].requestedHeight:0},g.prototype.setRequestedHeightForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&(this.pageStates[e].requestedHeight=t)},g.prototype.getRequestedWidthForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].requestedWidth:0},g.prototype.setRequestedWidthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&(this.pageStates[e].requestedWidth=t)},g.prototype.getRotationForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].rotateAngle/100},g.prototype.widthIsOnXAxis=function(e){var t=this.getRotationForPage(e);switch(t){case 0:case 180:case 18e3:return!0;case 90:case 9e3:case 270:case 27e3:return!1;default:return!0}},g.prototype.setRotationForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&this.documentModel.model.pageData[e].rotateAngle!==t&&(this.documentModel.model.pageData[e].rotateAngle=100*t,this.documentModel.setPagesModifiedSinceInit(!0,e))},g.prototype.getHorizontalFlipForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].flipHorizontal},g.prototype.setHorizontalFlipForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].flipHorizontal=t)},g.prototype.getVerticalFlipForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].flipVertical},g.prototype.setVerticalFlipForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].flipVertical=t)},g.prototype.getInvertImageForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].invertImage},g.prototype.setInvertImageForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&this.documentModel.model.pageData[e].invertImage!==t&&(this.documentModel.model.pageData[e].invertImage=t,this.documentModel.setPagesModifiedSinceInit(!0,e),this.imageManager&&this.imageManager.createManipulatedPage(e,this))},g.prototype.getBrightnessForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].brightness},g.prototype.setBrightnessForPage=function(e,t){e=this.validatePageNumber(e),r.call("brightnessAdjustBegin",{documentId:this.getDocumentId(),page:e,currentBrightness:this.getBrightnessForPage(e),requestedBrightness:t}),this.documentModel&&(this.documentModel.model.pageData[e].brightness=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].brightness=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},g.prototype.getContrastForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].contrast},g.prototype.setContrastForPage=function(e,t){e=this.validatePageNumber(e),r.call("contrastAdjustBegin",{documentId:this.getDocumentId(),page:e,currentContrast:this.getContrastForPage(e),requestedContrast:t}),this.documentModel&&(this.documentModel.model.pageData[e].contrast=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].contrast=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},g.prototype.getGammaForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].gamma},g.prototype.setGammaForPage=function(e,t){e=this.validatePageNumber(e),r.call("gammaAdjustBegin",{documentId:this.getDocumentId(),page:e,currentGamma:this.getGammaForPage(e),requestedGamma:t}),0===t?t=1:400===t&&(t=399),this.documentModel&&(this.documentModel.model.pageData[e].gamma=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].gamma=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},g.prototype.getDespeckleForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].despeckle},g.prototype.setDespeckleForPage=function(e){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].despeckle=50,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&this.pageStates[e].despeckle+30<=100&&(this.pageStates[e].despeckle+=30)},g.prototype.getAntiAliasOffForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].antiAliasOff},g.prototype.setAntiAliasOffForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].antiAliasOff=t,this.documentModel.setPagesModifiedSinceInit(!0,e))},g.prototype.isPageManipulated=function(e){e=this.validatePageNumber(e);var t=!1;if(this.documentModel){var a=this.documentModel.model.pageData[e];(100!==a.gamma||0!==a.brightness||0!==a.contrast||a.invertImage)&&(t=!0)}return t},g.prototype.getAnnotationsForPage=function(t,a){for(var n=this.getLayersForPage(t)||{},o=[],i=Object.keys(n),r=0;r<i.length;r++){var s=n[i[r]]||{anns:[]};if(!a||e("vvAnnotationManager").checkLayerPermission(s,d.permissionLevels.PERM_VIEW))for(var l=0;l<s.anns.length;l++)a&&s.anns[l].annDelete||o.push(s.anns[l])}return o},g.prototype.getLayersForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&this.pageStates[e].annotationLayers)return this.pageStates[e].annotationLayers},g.prototype.pageContainsAnnotations=function(e){if(this.documentFullyLoaded()){if(e<0||e>=this.getPageCount())return!1;var t=this.getDocumentModel().model,a=t.layerManager.layers;if(!a||0===a.length)return!1;var n=t.pageData[e];if(!n)return!1;var o=n.annotationHash;if(!o)return!1;for(var i=0;i<a.length;i++){var r=o[a[i].annotationId];if(r&&r.annExists){var s=this.getLayersForPage(e);if(!s)return!0;for(var l=s[a[i].annotationId],u=l.anns,d=0;d<u.length;d++){var c=u[d];if(!c.annDelete)return!0}}}return!1}},g.prototype.documentContainsAnnotations=function(){for(var e=0;e<this.getPageCount();e++){var t=this.pageContainsAnnotations(e);if(t)return!0}return!1},g.prototype.setImageLayers=function(e){e&&e.length&&(this.imageLayers=e)},g.prototype.getImageLayers=function(){return this.imageLayers},g.prototype.setLayersForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].annotationLayers=t)},g.prototype.getLayerFromPage=function(e,t){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates[e].annotationLayers)return this.pageStates[e].annotationLayers[t]},g.prototype.addLayerToPage=function(e,t){e=this.validatePageNumber(e),this.addLayerToLayerNames(t.layerName),this.pageStates&&(this.pageStates[e].annotationLayers||this.setLayersForPage(e,{}),this.pageStates[e].annotationLayers[t.layerName]=t)},g.prototype.addLayerToLayerNames=function(e){this.layerNames.indexOf(e)<0&&this.layerNames.push(e)},g.prototype.clearAllLayers=function(){this.layerNames=[];for(var e=0;e<this.pageStates.length;e+=1){var t=this.pageStates[e];t.annotationLayers=void 0}this.documentModel.setMetadataModifiedSinceInit(!0,this)},g.prototype.getDPIForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].dpi},g.prototype.setDPIForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].dpi=t)},g.prototype.getCompressionTypeForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].compressionType},g.prototype.setCompressionTypeForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].compressionType=t)},g.prototype.getBitDepthForPage=function(e){if(e=this.validatePageNumber(e),
this.pageStates&&this.pageStates.length>0)return this.pageStates[e].bitDepth},g.prototype.setBitDepthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].bitDepth=t)},g.prototype.getFormatForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].imageFormat},g.prototype.setFormatForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].imageFormat=t)},g.prototype.getTiffTag=function(e,t){if(e=this.validatePageNumber(e),this.pageStates)return this.pageStates[e].tiffTagHash[t]},g.prototype.setTiffTag=function(e,t,a){e=this.validatePageNumber(e),this.pageStates&&(null===this.pageStates[e].tiffTagHash&&(this.pageStates[e].tiffTagHash={}),this.pageStates[e].tiffTagHash[t]=a)},g.prototype.setTiffTagHashForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].tiffTagHash=t)},g.prototype.getOriginalWidthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalWidth},g.prototype.setOriginalWidthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].originalWidth=t)},g.prototype.getOriginalHeightForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalHeight},g.prototype.setOriginalHeightForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].originalHeight=t)},g.prototype.getCachedScrollLeft=function(){return this.cachedScroll.left},g.prototype.setCachedScrollLeft=function(e){"number"==typeof e&&(this.cachedScroll.left=e)},g.prototype.getCachedScrollTop=function(){return this.cachedScroll.top},g.prototype.setCachedScrollTop=function(e){"number"==typeof e&&(this.cachedScroll.top=e)},g.prototype.clearCachedScroll=function(){this.cachedScroll={}},g.prototype.setDocumentModelProperty=function(e,t){return this.documentModel?void this.documentModel.setProperty(e,t):(this.temporaryDocumentModelPropertyHash=this.temporaryDocumentModelPropertyHash||{},void(this.temporaryDocumentModelPropertyHash[e]=t))},g.prototype.getDocumentModelProperty=function(e){return!this.documentModel&&this.temporaryDocumentModelPropertyHash?this.temporaryDocumentModelPropertyHash[e]:this.documentModel.getProperty(e)},g.prototype.setDocumentModelPropertyHash=function(e){return this.documentModel?void this.documentModel.setPropertyHash(e):void(this.temporaryDocumentModelPropertyHash=e)},g.prototype.resetAfterSave=function(){for(var e=0;e<this.pageCount;e+=1)this.setRotationForPage(e,0),this.pageStates[e].imageInfoRequested=!1,this.pageStates[e].imageInfoLoaded=!1,this.pageStates[e].requestedWidth=0,this.pageStates[e].requestedHeight=0;this.imageManager.nukeBuffers(),this.removeAllCrop(),this.getDocumentModel().setPagesModifiedSinceInit(!1),this.getDocumentModel().setMetadataModifiedSinceInit(!1),this.getDocumentModel().setAnnotationsModifiedSinceInit(!1),this.getDocumentModel().setBookmarksModifiedSinceInit(!1),this.getDocumentModel().setNotesModifiedSinceInit(!1),this.getDocumentModel().setWatermarksModifiedSinceInit(!1)},g.prototype.isPageCropped=function(e){return e||0===e||(e=this.pageNumber),!this.isMedia()&&this.getPageCropBox(e).cropTop>=0},g.prototype.setPageCropBox=function(e,t){e||0===e||(e=this.pageNumber),!this.isMedia()&&this.documentFullyLoaded()&&(this.getDocumentModel().model.pageData[e].cropTop=t.cropTop,this.getDocumentModel().model.pageData[e].cropLeft=t.cropLeft,this.getDocumentModel().model.pageData[e].cropWidth=t.cropWidth,this.getDocumentModel().model.pageData[e].cropHeight=t.cropHeight)},g.prototype.getPageCropBox=function(e){return e||0===e||(e=this.pageNumber),this.isMedia()||!this.documentFullyLoaded()?{}:{cropTop:this.getDocumentModel().model.pageData[e].cropTop,cropLeft:this.getDocumentModel().model.pageData[e].cropLeft,cropWidth:this.getDocumentModel().model.pageData[e].cropWidth,cropHeight:this.getDocumentModel().model.pageData[e].cropHeight}},g.prototype.isDocumentCropped=function(){for(var e=0;e<this.pageCount;e++)if(this.isPageCropped(e))return!0;return!1},g.prototype.removeCropOnPage=function(e){"number"!=typeof e&&(e=this.pageNumber),this.setPageCropBox(e,{}),this.resetSVGSupport(!0)},g.prototype.removeAllCrop=function(){for(var e=0;e<this.pageCount;e++)this.removeCropOnPage(e);this.resetSVGSupport(!0)},g.prototype.getAllTextOnPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates[e])return this.pageStates[e].allText},g.prototype.getPageText=function(e){if(this.pageStates&&!(this.pageStates.length<1))return e=this.validatePageNumber(e),this.pageStates[e]?this.pageStates[e].pageText:void 0},g.prototype.getDocumentText=function(){for(var e=[],t=0;t<this.pageCount;t++)e.push(this.getPageText(t));return e},g.prototype.addPageText=function(e,t){!this.pageStates||this.pageStates.length<1||(t=this.validatePageNumber(t),this.pageStates[t]&&(this.pageStates[t].pageText=e))},g.prototype.logPageText=function(e){e=this.validatePageNumber(e);var t=this.pageStates[e].pageText,a=t.wordRects;console.log("logPageText"),console.log(a.length)},g.prototype.removePageText=function(e){e=this.validatePageNumber(e),this.pageStates[e].pageText=null},g.prototype.rotatePageTextSelectionBoxes=function(e,t){var a=this.pageStates[e];if(a.pageText&&a.pageText.wordRects)for(var n=0;n<a.pageText.wordRects.length;n++){var o,i=a.pageText.wordRects[n];9e3===t?(o=i.top,i.top=i.left,i.left=a.originalHeight-i.bottom,i.bottom=i.right,i.right=a.originalHeight-o):18e3===t?(o=i.top,i.top=a.originalHeight-i.bottom,i.bottom=a.originalHeight-o,o=i.left,i.left=a.originalWidth-i.right,i.right=a.originalWidth-o):27e3===t&&(o=i.top,i.top=a.originalWidth-i.right,i.right=i.bottom,i.bottom=a.originalWidth-i.left,i.left=o)}},g.prototype.removeDocumentNote=function(e){e=this.documentNoteArray.length-e-1,this.documentNoteArray.splice(e,1)},g.prototype.pushUndoObject=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].undoObjectArray.length=this.pageStates[e].undoIndex+1,this.pageStates[e].undoObjectArray.push(this.cloneUndoObject(t)),this.pageStates[e].undoIndex=this.pageStates[e].undoObjectArray.length-1,this.pageStates[e].poppedObjectArray.length=0},g.prototype.pushPoppedObject=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].poppedObjectArray.length=this.pageStates[e].poppedIndex+1,this.pageStates[e].poppedObjectArray.push(t),this.pageStates[e].poppedIndex=this.pageStates[e].poppedObjectArray.length-1},g.prototype.popPoppedObject=function(e){e=this.validatePageNumber(e);var t=this.pageStates[e].poppedObjectArray.pop();return this.pageStates[e].poppedIndex=this.pageStates[e].poppedObjectArray.length-1,t},g.prototype.resetUndoObject=function(e){e=this.validatePageNumber(e),this.pageStates[e].undoObject.unchangedAnn=void 0,this.pageStates[e].undoObject.modifiedAnn=void 0,this.pageStates[e].undoObject.referenceAnn=void 0,this.pageStates[e].undoObject.layer=void 0,this.pageStates[e].undoObject.type=void 0},g.prototype.getUndoObject=function(e){if(this.pageStates&&!(this.pageStates.length<1))return e=this.validatePageNumber(e),this.pageStates[e].undoObject},g.prototype.cloneUndoObject=function(e){var t={unchangedAnn:e.unchangedAnn,modifiedAnn:e.modifiedAnn,referenceAnn:e.referenceAnn,layer:e.layer,type:e.type};return t},g.prototype.getUndoObjectArray=function(e){return e=this.validatePageNumber(e),this.pageStates[e].undoObjectArray},g.prototype.getPoppedObjectArray=function(e){return e=this.validatePageNumber(e),this.pageStates[e].poppedObjectArray},g.prototype.getUndoIndex=function(e){return e=this.validatePageNumber(e),this.pageStates[e].undoIndex},g.prototype.setUndoIndex=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].undoIndex=t},g.prototype.getPoppedIndex=function(e){return e=this.validatePageNumber(e),this.pageStates[e].poppedIndex},g.prototype.setPoppedIndex=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].poppedIndex=t},g.prototype.setUndoIndexToMax=function(e){e=this.validatePageNumber(e),this.pageStates[e].undoIndex=this.pageStates[e].undoObjectArray.length-1},g.prototype.getNewAnnList=function(){return this.newAnnotations},g.prototype.clearNewAnnList=function(){return this.newAnnotations=[]},g.prototype.addAnnToNewAnnList=function(e){return this.newAnnotations.push(e),this.newAnnotations},g.prototype.removeNewAnnFromList=function(e){return this.newAnnotations.splice(e,1),this.newAnnotations},g.prototype.getTrueAnnChange=function(){return this.trueAnnChange},g.prototype.setTrueAnnChange=function(e){this.trueAnnChange=e},g.prototype.getNewWMList=function(){return this.newWatermarks},g.prototype.clearNewWMList=function(){this.newWatermarks=[]},g.prototype.addWMToNewWMList=function(e){return this.newWatermarks.push(e),this.newWatermarks},g.prototype.cleanBeforeRemoval=function(){this.imageManager.nukeBuffers()},g}),define("vvStateManager",["vvDiffManager","vvDocViewState"],function(e,t){"use strict";function a(){this.states=[{},{}],this.displayedDocuments=[],this.splitInstance=null,this.activePane=0,this.diffs={}}var n;a.prototype.setSplit=function(e){this.splitInstance=e},a.prototype.getActivePaneState=function(){var e=this.displayedDocuments[this.activePane];if(e)return this.states[this.activePane][e]},a.prototype.getInactivePaneState=function(){var e;e=0===this.activePane?1:0;var t=this.displayedDocuments[e];if(t)return this.states[e][t]},a.prototype.getCurrentState=function(e){if(e=e||0,!(e>this.displayedDocuments.length)&&this.displayedDocuments[e]){var t=this.displayedDocuments[e];return this.states[e][t]}},a.prototype.getOpenDocumentId=function(e){return e=e||0,this.displayedDocuments[e]},a.prototype.getOuterDivFromState=function(e){if(!e)return $();var t=e.currentPaneIndex||0;return this.states[t][e.getDocumentId()]?$(".vvOuter").eq(t):$(".vvOuter").eq(this.activePane)},a.prototype.setActivePane=function(e){this.activePane=e},a.prototype.setStateForDocumentId=function(e,t,a){return a=a||0,this.states[a][e]=t,t.currentPaneIndex=a,t},a.prototype.openNewState=function(e){var a=e.paneIndex||0;if(e.documentId){var n=new t(e.documentId,e.documentModel,e.pageCount,e.pageNumber,e.tabNumber,e.zoomMode);return n.displayName=e.displayName,this.setStateForDocumentId(e.documentId,n,a),n}},a.prototype.getStateForDocumentId=function(e,t){var a=t||0;if(this.states[a][e])return this.states[a][e];if(!(t>=0))return this.states[1][e]},a.prototype.getAllStates=function(){for(var e=[],t=0;t<this.states.length;t++)for(var a=Object.keys(this.states[t]),n=0;n<a.length;n++)e.push(this.getStateForDocumentId(a[n],t));return e},a.prototype.removeStateForDocumentId=function(e,t){t=t||0,this.displayedDocuments[t]===e&&(this.displayedDocuments[t]=""),this.states[t][e]&&(this.states[t][e].cleanBeforeRemoval(),delete this.states[t][e])},a.prototype.setDisplayedState=function(e,t){t=t||0,this.displayedDocuments[t]=e.getDocumentId()},a.prototype.isVideoOpen=function(){for(var e=!1,t=0;t<this.displayedDocuments.length;t++)if(this.displayedDocuments[t]){var a=this.getStateForDocumentId(this.displayedDocuments[t]);if(!a)return!1;e=e||a.isMedia()}return e},a.prototype.getCurrentDiff=function(){var e=this.displayedDocuments[0],t=this.displayedDocuments[1];if(e&&this.diffs[e]&&t&&!this.states[0][e].closedTab&&!this.states[1][t].closedTab)return this.diffs[e][t]},a.prototype.setDiff=function(e){var t=this.displayedDocuments[0],a=this.displayedDocuments[1];a&&(this.diffs[t]={},this.diffs[t][a]=e)};var o=function(){return n=n||new a};return o()}),define("vvNoteBase",["vvUtility","vvStateManager","vvAnnotationManager"],function(e,t){function a(){n=this,this.username="",this.ableToAddNote=!0,this.timestamp=null,this.displayedTimestamp=null,this.createdTag=null,this.note={text:null,createDate:null,editDate:null,idxFlag:null,userId:null}}var n;a.prototype.getAbleToAddNote=function(){return this.ableToAddNote},a.prototype.setAbleToAddNote=function(e){this.ableToAddNote=e},a.prototype.getUsername=function(){return this.username&&e.encodeForHTML(this.username)===$("#vvAnnotationNoteAdderAuthor").html()||n.setUsername(),this.username},a.prototype.setUsername=function(e){e&&0!==e.length?(this.username=e,virtualViewer.getUserPreferences().setUsername(e)):this.username=virtualViewer.getUserPreferences().getUsername()},a.prototype.getNote=function(){return this.note},a.prototype.getTimestamp=function(){return this.timestamp},a.prototype.setTimestamp=function(e){this.timestamp=e},a.prototype.getDisplayedTimestamp=function(){return this.displayedTimestamp},a.prototype.setDisplayedTimestamp=function(e){this.displayedTimestamp=e},a.prototype.createTimestamp=function(){var e=new Date,t=e.toUTCString();t=t.replace(/,/g,""),n.setTimestamp(t);var a=new Date(t);a=a.toDateString()+" "+a.toLocaleTimeString(),n.setDisplayedTimestamp(a)},a.prototype.addNote=function(a,r){if(n.getAbleToAddNote()){n.resetNote();var s,l,u=t.getCurrentState(),d=u.getDocumentModel(),c="";if("Document"===a)s="#vvDocumentNoteContentInput",l="#vvDocumentNotesInternal";else{if("Annotation"!==a)return;s="#vvAnnotationNoteContentInput",l="#vvAnnotationNotesInternal",r||(r=virtualViewer.getCurrentAnnObject())}if(""!==$(s).val().trim()){n.createTimestamp();var g=n.getNote();if(g.userId=n.getUsername(),g.text=$(s).val(),g.createDate=n.getTimestamp(),"Document"===a){var v=d.model.documentNotes.notes,p=n.copyNote(g);p.userId=encodeURIComponent(p.userId),p.text=encodeURIComponent(p.text),c=" ellipsis",v.splice(0,0,p),d.setNotesModifiedSinceInit(!0,u)}else if("Annotation"===a){r.noteArray.unshift(n.copyNote(g));var h=virtualViewer.getCurrentAnnObject();h.markRevised(),require("vvAnnotationManager").markLayerWithAnnDirty(h)}var m=$("<div class=\"vvNote\"> <button type ='button' title = '"+e.getLocalizedValue("notes.deleteNote","Delete Note")+"'class='smallClose vvNotesCloseButton' data-tooltip='tooltip'><span aria-hidden='true'>x</span></button> </div>");m.append('<div class="vvNoteAuthor"> <b>'+e.encodeForHTML(g.userId)+"</b> </div>"),m.append('<span class="vvNoteContent'+c+'">'+e.encodeForHTML(g.text)+"</span>"),m.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited"></span><span id="vvNoteTimeStamp">'+n.getDisplayedTimestamp()+"</span></div>"),$(l).prepend(m),o(a,r),$("#vvCreatedOrEdited").text(e.getLocalizedValue("notes.created","Created: ")),i(a,r,m),$(s).val(""),n.setAbleToAddNote(!0)}}};var o=function(e,a){$(".vvNotesCloseButton").click(function(){var o=this.parentElement.parentElement;if(o){var i=$(o).children().index(this.parentElement);$($(o).children()[i]).remove();var r=t.getCurrentState(),s=r.getDocumentModel();if("Document"===e){var l=s.model.documentNotes.notes;l.splice(i,1),virtualViewer.docHasNotes()||$("#vvNotesTabSpan").removeClass("docNotesExist"),s.setNotesModifiedSinceInit(!0,r)}else if("Annotation"===e){a.removeNoteFromArray(i);var u=virtualViewer.getCurrentAnnObject();u.markRevised(),require("vvAnnotationManager").markLayerWithAnnDirty(u)}n.setAbleToAddNote(!0)}})},i=function(e,t,a){if(a&&a.length){var o=function(a){if(1!==a.tapCount){a.tapCount>1&&a.preventDefault();var o=$(".vvNotesInternal").find("input");if(o.length)return void o.focus();var i=$(this);$(this).hasClass("vvNote")||(i=$(a.target).closest(".vvNote")),n.getAbleToAddNote()&&n.editNote(i,e,t)}};if(Modernizr.touchevents){var i=new Hammer(a[0]);i.on("tap",o)}a.dblclick(o)}};a.prototype.editNote=function(a,o,i){n.setAbleToAddNote(!1),n.resetNote();var l=$(a).find(".vvNoteContent"),u=$(a).find(".vvNoteDate");u.remove(),l.remove();var d,c,g=$(a).parent().children().index($(a)),v=t.getCurrentState();if("Document"===o){var p=v.getDocumentModel(),h=p.model.documentNotes.notes,m=h[g];c=decodeURIComponent(m.text),d="vvDocumentNoteEditContentInput"}else if("Annotation"===o){var m=i.noteArray[g];c=m.text,d="vvAnnotationNoteEditContentInput"}a.append("<input id="+d+' type="text" name="vvNoteEditContentInputName">'),$("#"+d).val(c),a.append('<button id="vvNoteEditButton" type="button"></button>'),a.append('<button id="vvNoteCancelEditButton" type="button"></button>'),$("#vvNoteEditButton").text(e.getLocalizedValue("notes.applyButton","Apply")),$("#vvNoteCancelEditButton").text(e.getLocalizedValue("notes.cancelButton","Cancel"));var f=v.getDocumentId(),y=v.currentPaneIndex;$("#vvNoteEditButton").click(function(){var e=t.getStateForDocumentId(f,y);""!==$("#"+d).val().trim()&&(r(a,o,i),e.getNewAnnList().indexOf(i)===-1&&e.setTrueAnnChange(!0))}),$("#vvNoteCancelEditButton").click(function(){s(a,o,c,u.text())}),n.setAbleToAddNote(!0)};var r=function(e,a,o){var i;if("Document"===a)i="vvDocumentNoteEditContentInput";else{if("Annotation"!==a)return;i="vvAnnotationNoteEditContentInput"}var r=$("#"+i).val();n.createTimestamp();var s,l=t.getCurrentState(),u=l.getDocumentModel(),d=e.parent().children().index(e);if("Document"===a){var c=u.model.documentNotes.notes;s=c[d],s.userId=encodeURIComponent(n.getUsername()),s.text=encodeURIComponent(r),u.setNotesModifiedSinceInit(!0,l)}else{if("Annotation"!==a)return;s=o.noteArray[d],s.userId=n.getUsername(),s.text=r;var g=virtualViewer.getCurrentAnnObject();g.markRevised(),require("vvAnnotationManager").markLayerWithAnnDirty(g)}s.editDate=n.getTimestamp(),n.setAbleToAddNote(!0),"Document"===a?virtualViewer.getDocumentNotes().loadDocumentNotes():"Annotation"===a&&o.loadAnnotationNotes()},s=function(t,a,o,i){var r,s="";if("Document"===a)r="vvDocumentNoteEditContentInput",s=" ellipsis";else{if("Annotation"!==a)return;r="vvAnnotationNoteEditContentInput"}$("#"+r).remove(),$("#vvNoteEditButton").remove(),$("#vvNoteCancelEditButton").remove(),t.append('<span class="vvNoteContent'+s+' ">'+e.encodeForHTML(o)+"</span>"),t.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited"> </span> <span id="vvNoteTimeStamp">'+i+"</span></div>"),n.setAbleToAddNote(!0)};return a.prototype.addExistingNote=function(t,a,r){var s;n.resetNote();var l=n.getNote();l.userId=t.userId,l.text=t.text;var u="",d="",c="";t.editDate?(u=e.getLocalizedValue("notes.edited","Edited: "),d=t.editDate):(u=e.getLocalizedValue("notes.created","Created: "),d=t.createDate),d=d.replace(/,/g,""),d=d.replace("Z","UTC"),"Document"===a?(s="#vvDocumentNotesInternal",c=" ellipsis",l.userId=decodeURIComponent(l.userId),l.text=decodeURIComponent(l.text)):"Annotation"===a&&(s="#vvAnnotationNotesInternal");var g=new Date(d);g=g.toDateString()+" "+g.toLocaleTimeString();var v=$("<div class=\"vvNote\"> <button type ='button' title = '"+e.getLocalizedValue("notes.deleteNote","Delete Note")+"' data-tooltip='tooltip' class='smallClose vvNotesCloseButton'><span aria-hidden='true'>x</span></button></div>");v.append('<div class="vvNoteAuthor"> <b>'+e.encodeForHTML(l.userId)+"</b> </div>"),v.append('<span class="vvNoteContent'+c+'">'+e.encodeForHTML(l.text)+"</span>"),v.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited">'+u+'</span><span id="vvNoteTimeStamp">'+g+"</span></div>"),$(s).append(v),o(a,r),i(a,r,v)},a.prototype.resetNote=function(){this.note={text:null,createDate:null,editDate:null,idxFlag:null,userId:null}},a.prototype.copyNote=function(e){var t={text:e.text,createDate:e.createDate,editDate:e.editDate,idxFlag:e.idxFlag,userId:e.userId};return t},a}),define("annotations",["vvUtility","vvDefines","user-config/config","vvNoteBase","vvBoundingBox","vvPoint","vvStateManager"],function(e,t,a,n,o,i,r){function s(){}s.prototype.init=function(e,o,i,r,s,l,u,d,c,g,v,p){this.page=i,this.pageWidth=r,this.pageHeight=s,this.preview=!1,this.annDelete=!1,this.doubleByte=u,this.index=d,this.docDPI=c,this.isFilenet=g,this.isDaeja=v,this.isIDM=p,this.layerName=l,this.opacity=1,this.slope,this.revisionHistory=[],this.currentRevision={user:"",date:"",modificationType:""},a.collapseStickiesByDefault&&this.getType()===t.annotationTypes.SANN_POSTIT?this.collapsed=!0:this.collapsed=!1,this.notes=new n,this.wrappedText=[],this.wrappedTextIsStale=!0,this.pasteLocation=null,e&&this.initFromXML(e),o&&this.initFromObject(o)},s.prototype.initFromXML=function(t){this.annId=e.getValue(t,"annID"),this.isDaeja=e.fixBooleanString(e.getValue(t,"isDaeja")),this.createDate=e.getValue(t,"annCreateDate"),this.modifyDate=e.getValue(t,"annModifyDate"),this.fontName=e.getValue(t,"fontName"),this.fontSize=e.getValue(t,"fontSize"),this.fontBold=e.fixBooleanString(e.getValue(t,"fontBold")),this.fontItalic=e.fixBooleanString(e.getValue(t,"fontItalic")),this.fontStrike=e.fixBooleanString(e.getValue(t,"fontStrike")),this.fontUnderline=e.fixBooleanString(e.getValue(t,"fontUnderline")),this.fontColor=e.getValue(t,"fontColor"),this.type=e.getValue(t,"annType"),this.createUser=decodeURIComponent(e.getValue(t,"annCreateUser")),this.revisionHistory=l(t),this.ordinal=parseInt(e.getValue(t,"annOrdinal"),10),this.lineStyle=e.getValue(t,"lineStyle"),this.setRotationAngle(e.getValue(t,"rotationAngle")),this.lineColor=e.getValue(t,"lineColor"),this.fillColor=e.getValue(t,"fillColor"),this.lineWidth=e.getValue(t,"lineWidth"),this.setTextString(e.getValue(t,"textString"),!0),this.bitmapData=e.getValue(t,"bitmapData"),this.annotationTags=e.parseAnnTags(t),this.noteArray=e.parseAnnNotes(t),this.box=new o(parseInt(e.getValue(t,"annStartX"),10),parseInt(e.getValue(t,"annStartY"),10),parseInt(e.getValue(t,"annWidth"),10),parseInt(e.getValue(t,"annHeight"),10));var a=e.getValue(t,"fillTransparent"),n=e.getValue(t,"annLayerID"),i=e.getValue(t,"pointArray");this.fontSize?this.setFontSize(parseInt(this.fontSize,10),!0):this.fontSize=0,i&&(this.pointArray=e.parsePointArray(i),this.fixBoundingBox()),a?"true"===a&&(this.opacity=.5):this.opacity=1,"ANNOTATION_LAYER_ID"!==n&&(this.layerName=n),this.lineWidth?this.lineWidth=parseInt(this.lineWidth,10):this.lineWidth=1,this.rotationAngle?this.setRotationAngle(parseInt(this.rotationAngle,10)):this.setRotationAngle(0)},s.prototype.initFromObject=function(e){if(this.annId=e.annId,this.isDaeja=e.isDaeja,this.annDelete=e.annDelete,this.createDate=e.createDate,this.modifyDate=e.modifyDate,this.fontName=e.fontName,this.fontSize=e.fontSize,this.fontBold=e.fontBold,this.fontItalic=e.fontItalic,this.fontStrike=e.fontStrike,this.fontUnderline=e.fontUnderline,this.fontColor=e.fontColor,this.type=e.type,this.createUser=e.createUser,this.revisionHistory=e.revisionHistory||[],this.ordinal=e.ordinal,this.lineStyle=e.lineStyle,this.setRotationAngle(e.rotationAngle),this.lineColor=e.lineColor,this.fillColor=e.fillColor,this.lineWidth=e.lineWidth,this.setTextString(e.textString,!0),this.bitmapData=e.bitmapData,this.layerTemp=e.layerName,this.annotationTags=e.annotationTags,this.noteArray=e.noteArray,e.pointArray){this.pointArray=[];for(var t=0;t<e.pointArray.length;t++)this.pointArray.push(new i(e.pointArray[t].x,e.pointArray[t].y))}this.box=new o(e.box.one.x,e.box.one.y,e.box.two.x-e.box.one.x,e.box.two.y-e.box.one.y),this.opacity=e.opacity},s.prototype.isSameAs=function(e){var t=this,a=e;if(void 0===t||void 0===a)return!1;if(t.page!==a.page)return!1;if(t.annDelete!==a.annDelete)return!1;var n=t.getBoundingBox(),o=a.getBoundingBox();if(n.one.x!==o.one.x)return!1;if(n.one.y!==o.one.y)return!1;if(n.two.x!==o.two.x)return!1;if(n.two.y!==o.two.y)return!1;if(t.doubleByte!==a.doubleByte)return!1;if(t.fillColor!==a.fillColor)return!1;if(t.fontBold!==a.fontBold)return!1;if(t.fontColor!==a.fontColor)return!1;if(t.fontItalic!==a.fontItalic)return!1;if(t.fontName!==a.fontName)return!1;if(t.fontSize!==a.fontSize)return!1;if(t.fontStrike!==a.fontStrike)return!1;if(t.fontUnderline!==a.fontUnderline)return!1;if(t.index!==a.index)return!1;if(t.layerName!==a.layerName)return!1;if(t.lineColor!==a.lineColor)return!1;if(t.lineStyle!==a.lineStyle)return!1;if(t.lineWidth!==a.lineWidth)return!1;if(t.opacity!==a.opacity)return!1;if(t.ordinal!==a.ordinal)return!1;if(t.pageHeight!==a.pageHeight)return!1;if(t.pageWidth!==a.pageWidth)return!1;var i=t.pointArray,r=a.pointArray;if(i||r){if(!i)return!1;if(!r)return!1;var s=i.length;r.length>i.length&&(s=r.length);for(var l=0;l<s;l+=1){if(i[l].x!==r[l].x)return!1;if(i[l].y!==r[l].y)return!1}}if(t.preview!==a.preview)return!1;if(t.getRotationAngle()!==a.getRotationAngle())return!1;if(t.textString!==a.textString)return!1;if(t.type!==a.type)return!1;for(var u=0;u<t.noteArray.length;u++)if(t.noteArray[u]!==a.noteArray[u])return!1;return!0},s.prototype.copyFrom=function(e){var t=this,a=e;t.annDelete=a.annDelete;var r=a.annotationTags;if(t.annotationTags=[],r)for(var s=0;s<r.length;s+=1)t.annotationTags.push(r[s]);t.bitmapData=a.bitmapData,t.isDaeja=a.isDaeja,t.box=new o,t.box.copyFrom(a.box),t.collapsed=a.collapsed,t.createDate=a.createDate,t.modifyDate=a.modifyDate,t.createUser=a.createUser,t.modifyUser=a.modifyUser,t.docDPI=a.docDPI,t.doubleByte=a.doubleByte,t.fillColor=a.fillColor,t.fontBold=a.fontBold,t.fontColor=a.fontColor,t.fontItalic=a.fontItalic,t.fontName=a.fontName,t.fontSize=a.fontSize,t.fontStrike=a.fontStrike,t.fontUnderline=a.fontUnderline,t.index=a.index,t.layerName=a.layerName,t.annId=a.annId,t.lineColor=a.lineColor,t.lineStyle=a.lineStyle,t.lineWidth=a.lineWidth,t.opacity=a.opacity,t.ordinal=a.ordinal,t.page=a.page,t.pageHeight=a.pageHeight,t.pageWidth=a.pageWidth;var l=a.pointArray;if(t.pointArray=[],l)for(var u=0;u<l.length;u+=1)t.pointArray.push(new i(l[u].x,l[u].y));else t.pointArray=null;t.preview=a.preview,t.setRotationAngle(a.rotationAngle),t.textString=a.textString,t.type=a.type,t.notes=new n,t.revisionHistory=[],a.revisionHistory=a.revisionHistory||[];for(var d=0;d<a.revisionHistory.length;d++){var c={user:a.revisionHistory[d].user,date:a.revisionHistory[d].date,modificationType:a.revisionHistory[d].modificationType};t.revisionHistory.push(c)}t.currentRevision={user:a.currentRevision.user,date:a.currentRevision.date,modificationType:a.currentRevision.modificationType};var g=a.noteArray;if(t.noteArray=[],g)for(var v=0;v<g.length;v+=1)t.noteArray.push(g[v]);else t.noteArray=null;return t},s.prototype.useLineResize=function(){return!(!this.pointArray||2!==this.pointArray.length)&&(this.getType()===t.annotationTypes.SANN_ARROW||this.getType()===t.annotationTypes.SANN_LINE)};var l=function(t){if(!t)return[];var a=t.getElementsByTagName("annModificationItem");if(!a||!a.length){var n=e.getValue(t,"annModifyDate");return n?[{user:e.getLocalizedValue("annPopUp.annUnknownUser","Unknown User"),date:n,modificationType:""}]:[]}for(var o=[],i=0;i<a.length;i++){var r=a[i];if(r){var s={};s.user=decodeURIComponent(e.getValue(r,"annModifyUser")),s.date=e.getValue(r,"annModifyDate"),s.modificationType=e.getValue(r,"annModifyType"),o.push(s)}}return o};return s.prototype.clone=function(){var e=new s;return e.init(),e.copyFrom(this),e},s.prototype.getType=function(){return this.type},s.prototype.getRefinedType=function(){return this.type===t.annotationTypes.SANN_RECTANGLE&&e.isRedactionLayer(this.layerName)?t.annotationTypes.SANN_REDACTION_RECT:this.type===t.annotationTypes.SANN_RECTANGLE&&this.fillColor&&this.opacity<1?t.annotationTypes.SANN_HIGHLIGHT_RECT:this.type===t.annotationTypes.SANN_LINE&&this.pointArray.length>2?t.annotationTypes.SANN_FREEHAND:this.type},s.prototype.getLocalizedTypeName=function(){var t=this.getRefinedType(),a=e.getLocalizedValue("annotationInfoList.annotationTypes."+t);return a||(a=e.getLocalizedValue("annotationInfoList.annotationTypes.general","Annotation")),a},s.prototype.getDelete=function(){return this.annDelete},s.prototype.setDelete=function(e){this.annDelete=e},s.prototype.getDoubleByte=function(){return this.doubleByte},s.prototype.setDoubleByte=function(e){this.doubleByte=e},s.prototype.setAbleToAddNote=function(e){this.ableToAddNote=e},s.prototype.getAbleToAddNote=function(){return this.ableToAddNote},s.prototype.fixCoordinates=function(){if(this.getWidthRatio()>0&&this.getHeightRatio()>0&&(this.box=new o(Math.round(this.box.getX1()/this.getWidthRatio()),Math.round(this.box.getY1()/this.getHeightRatio()),Math.round(this.box.getWidth()/this.getWidthRatio()),Math.round(this.box.getHeight()/this.getHeightRatio())),this.pointArray))for(var e=0;e<this.pointArray.length;e+=1)this.pointArray[e].setX(Math.round(this.pointArray[e].getX()/this.getWidthRatio())),this.pointArray[e].setY(Math.round(this.pointArray[e].getY()/this.getHeightRatio()))},s.prototype.fixedBox=function(){if(this.getWidthRatio()>0&&this.getHeightRatio()>0){var e=new o(Math.round(this.box.getX1()/this.getWidthRatio()),Math.round(this.box.getY1()/this.getHeightRatio()),Math.round(this.box.getWidth()/this.getWidthRatio()),Math.round(this.box.getHeight()/this.getHeightRatio()));return e}return!1},s.prototype.fixBoundingBox=function(e,a){var n=null,i=null,s=null,l=null,u=this.box;e&&(u=e);var d=this.pointArray;if(a&&(d=a),d&&d.length>1){var c=d[0].getX(),g=d[0].getY(),v=d[0].getX(),p=d[0].getY();if(d)for(var h=0;h<d.length;h+=1)d[h].getX()<c&&(c=d[h].getX()),d[h].getY()<g&&(g=d[h].getY()),d[h].getX()>v&&(v=d[h].getX()),d[h].getY()>p&&(p=d[h].getY());if(n=c,i=g,s=v-c,l=p-g,this.type===t.annotationTypes.SANN_CIRCLE){var m=r.getActivePaneState(),f=m.getRotationForPage(m.getPageNumber());0===f?l=s:90===f?s=l:180===f?(l=s*-1,i=p):270===f&&(s=l*-1,n=v)}return void(e?e=new o(n,i,s,l):this.box=new o(n,i,s,l))}n=u.getX1(),i=u.getY1(),s=u.getWidth(),l=u.getHeight(),s<0&&(s*=-1,n-=s),l<0&&(l*=-1,i-=l),e?e=new o(n,i,s,l):this.box=new o(n,i,s,l)},s.prototype.rotate=function(e,t){this.rotateAnnotation(e,t),this.fixBoundingBox()},s.prototype.rotatePointArray=function(e,t,a,n){if(!this.pointArray&&!t)return null;a||(a=this.pageWidth),n||(n=this.pageHeight);var o;o=t?this.pointArray.length:t.length;for(var i=0;i<o;i+=1)t?t[i].rotate(e,a,n):this.pointArray[i].rotate(e,a,n)},s.prototype.getPointRotatedForAnn=function(e,t){t||(t=r.getActivePaneState());var a,n=this.getRotationAngle(),o=t.getRequestedWidthForPage(this.page),s=t.getRequestedHeightForPage(this.page);return a=90===n?new i(e.y,o-e.x):180===n?new i(o-e.x,s-e.y):270===n?new i(s-e.y,e.x):new i(e.x,e.y)},s.prototype.updatePageDimensions=function(e){e||(e=r.getActivePaneState());var t=e.getOriginalWidthForPage(this.page),a=e.getOriginalHeightForPage(this.page),n=e.getDPIForPage(this.page),o=this.getPageWidth(),i=this.getPageHeight();this.docDPI;if(this.isFilenet&&3300===i&&2550===o){var s=this.docDPI/n;0!==t&&this.setPageWidth(t*s),0!==a&&this.setPageHeight(a*s)}if(0===this.rotationAngle||180===this.rotationAngle){if(t>=a&&this.getPageWidth()>=this.getPageHeight()||t<a&&this.getPageWidth()<this.getPageHeight())return}else if((90===this.rotationAngle||270===this.rotationAngle)&&(t>=a&&this.getPageWidth()<=this.getPageHeight()||t<a&&this.getPageWidth()>this.getPageHeight()))return;var l=this.getPageHeight();this.setPageHeight(this.getPageWidth()),this.setPageWidth(l)},s.prototype.getIndex=function(){return this.index},s.prototype.setIndex=function(e){this.index=e},s.prototype.getOrdinal=function(){return this.ordinal},s.prototype.setCreateDate=function(e){this.createDate=e},s.prototype.getCreateDate=function(){return this.createDate},s.prototype.setModifyDate=function(e){this.modifyDate=e},s.prototype.getModifyDate=function(){return this.modifyDate},s.prototype.getCreateUser=function(){return this.createUser},s.prototype.setCreateUser=function(e){this.createUser=e},s.prototype.getModifyUser=function(){return this.modifyUser},s.prototype.setModifyUser=function(e){this.modifyUser=e},s.prototype.setOrdinal=function(e){this.ordinal=e},s.prototype.getWidthRatio=function(e){e||(e=r.getActivePaneState());var t=this.page,a=e.getRequestedWidthForPage(t),n=e.getRequestedHeightForPage(t),o=1;return o=a>n&&this.pageWidth>this.pageHeight||a<n&&this.pageWidth<this.pageHeight?a/this.pageWidth:n/this.pageWidth,0===o&&(o=1),o},s.prototype.getHeightRatio=function(e){e||(e=r.getActivePaneState());var t,a=this.page,n=e.getRequestedWidthForPage(a),o=e.getRequestedHeightForPage(a);return t=n>o&&this.pageWidth>this.pageHeight||n<o&&this.pageWidth<this.pageHeight?o/this.pageHeight:n/this.pageHeight,0===t&&(t=1),t},s.prototype.setHeight=function(e){if(e&&!(e<1)){
e=parseInt(e,10);var t=this.box.getY1(),a=t+e;this.updatePageDimensions(),a>this.pageHeight&&(e=this.pageHeight-t);var n=new o(this.box.getX1(),t,this.box.getWidth(),e);this.stretchPointArray(this.box,n),this.box=n}},s.prototype.getHeight=function(){return this.box.getHeight()},s.prototype.getWidth=function(){return this.box.getWidth()},s.prototype.setWidth=function(e){if(e&&!(e<1)){e=parseInt(e,10);var t=this.box.getX1(),a=t+e;this.updatePageDimensions(),a>this.pageWidth&&(e=this.pageWidth-t);var n=new o(t,this.box.getY1(),e,this.box.getHeight());this.stretchPointArray(this.box,n),this.box=n}},s.prototype.scaleAnn=function(e){if(e&&!(e<0)){var t=this.box.getX1()*e,a=this.box.getX2()*e,n=this.box.getY1()*e,i=this.box.getY2()*e,r=a-t,s=i-n,l=new o(t,n,r,s);this.stretchPointArray(this.box,l),this.box=l}},s.prototype.getAdjustedHeight=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t||270===t?parseInt(this.box.getWidth()*this.getWidthRatio(e),10):parseInt(this.box.getHeight()*this.getHeightRatio(e),10)},s.prototype.getAdjustedWidth=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t||270===t?parseInt(this.box.getHeight()*this.getHeightRatio(e),10):parseInt(this.box.getWidth()*this.getWidthRatio(e),10)},s.prototype.getAdjustedTop=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t?this.box.getX1()*this.getWidthRatio(e):180===t?(this.pageHeight-this.box.getY2())*this.getHeightRatio(e):270===t?(this.pageWidth-this.box.getX2())*this.getWidthRatio(e):this.box.getY1()*this.getHeightRatio(e)},s.prototype.getAdjustedLeft=function(){var e,t=r.getActivePaneState(),a=(this.getRotationAngle()+t.getRotationForPage(this.page))%360;return e=90===a?(this.pageHeight-this.box.getY2())*this.getHeightRatio(t):180===a?(this.pageWidth-this.box.getX2())*this.getWidthRatio(t):270===a?this.box.getY1()*this.getHeightRatio(t):this.box.getX1()*this.getWidthRatio(t),parseInt(e,10)},s.prototype.fitBoxToText=function(e){var n=virtualViewer.getActivePane(),o=r.getActivePaneState();if(a.autoResizeTextAnnotations&&this.getType()===t.annotationTypes.SANN_EDIT||a.autoResizeStickyNoteAnnotations&&this.getType()===t.annotationTypes.SANN_POSTIT){var i=0;this.getType()===t.annotationTypes.SANN_POSTIT&&(i=a.annotationDefaults.stickyMargin),e||(e=0===n?$("#vvImageCanvas")[0].getContext("2d"):$("#vvSplitCanvas")[0].getContext("2d")),this.updatePageDimensions(),e.save();var s=this.getFontSize(!0)*this.getHeightRatio(o),l="";this.getFontBold()&&(l+="bold "),this.getFontItalic()&&(l+="italic "),e.font=l+s+"px "+this.getFontName();for(var u=this.pageWidth-this.box.getX1(),d=this.getTextString().split("\n"),c=0,g=0;g<d.length;g++){var v=e.measureText(d[g]+"M").width/this.getWidthRatio();v>c&&(c=Math.round(v))}var p=Math.min(u,c);this.setWidth(p);var h=this.wrapTextString(e,i,o);e.restore();var m=this.getFontSize(!0)/.85,f=m/1.5;if(f+=h.length*m,f=parseInt(f,10),this.getType()===t.annotationTypes.SANN_POSTIT){var y=1.25*virtualViewer.collapsedStickySize(o.getZoomDecimal());f=Math.max(f,y)}this.setHeight(f)}},s.prototype.getPageWidth=function(){return this.pageWidth},s.prototype.setPageWidth=function(e){this.pageWidth=e},s.prototype.getPageHeight=function(){return this.pageHeight},s.prototype.setPageHeight=function(e){this.pageHeight=e},s.prototype.getLayerName=function(){return this.layerName?this.layerName:"ANNOTATION_LAYER_ID"},s.prototype.setLayerName=function(e){this.layerName=e},s.prototype.getBoundingBox=function(e){var t=r.getActivePaneState();if(e){var a=virtualViewer.collapsedStickySize()/this.getWidthRatio(t),n=new o(this.box.getX1(),this.box.getY1(),a,a);return n}return this.box},s.prototype.setBoundingBox=function(e){this.box=e},s.prototype.getLineColor=function(){return this.lineColor&&"NO_COLOR"!==this.lineColor?e.parseColorString(this.lineColor):null},s.prototype.setLineColor=function(e){this.lineColor=e},s.prototype.getFillColor=function(){return this.fillColor?e.parseColorString(this.fillColor,this.opacity):null},s.prototype.setFillColor=function(e){this.fillColor=e},s.prototype.getLineColorRGB=function(){return this.lineColor?this.lineColor:null},s.prototype.setLineColorRGB=function(e){this.lineColor=e},s.prototype.getFillColorRGB=function(){return this.fillColor?this.fillColor:null},s.prototype.setFillColorRGB=function(e){this.fillColor=e},s.prototype.getRotationAngle=function(){return this.rotationAngle?this.rotationAngle:0},s.prototype.setRotationAngle=function(e){e=e||0,this.xmlRotate=e,this.rotationAngle=e,a.rotateTextAnnotations||(this.wrappedTextIsStale=!0)},s.prototype.rotateAnnotation=function(e,t){var a=this.getRotationAngle()+e;a<0?t?this.xmlRotate=360+a%360:this.setRotationAngle(360+a%360):t?this.xmlRotate=a%360:this.setRotationAngle(a%360)},s.prototype.getLineWidth=function(e,t){var a=1/this.getWidthRatio(t);if(e)return this.lineWidth;var n=Math.round(this.lineWidth/a);return n<1&&(n=1),n},s.prototype.setLineWidth=function(e,t){var a=1/this.getWidthRatio();t?this.lineWidth=e:this.lineWidth=Math.round(e*a)},s.prototype.getLineStyle=function(){return this.lineStyle},s.prototype.setLineStyle=function(e){this.lineStyle=e},s.prototype.getOpacity=function(){return this.opacity},s.prototype.setOpacity=function(e){this.opacity=e},s.prototype.getPointArray=function(){return this.pointArray},s.prototype.setPointArray=function(e){this.pointArray=e},s.prototype.getFontName=function(){return this.fontName},s.prototype.setFontName=function(e){this.fontName=e},s.prototype.getFontSize=function(e){var a=Math.max(this.docDPI,t.minimumAnnotationDPI);return e?this.fontSize:this.isIDM?Math.round(7.2*this.fontSize/120):Math.round(72*this.fontSize/a)},s.prototype.setFontSize=function(e,a){var n=Math.max(this.docDPI,t.minimumAnnotationDPI);a?this.fontSize=e:this.isIDM?this.fontSize=120*e/7.2:this.fontSize=e*n/72},s.prototype.getFontBold=function(){return this.fontBold},s.prototype.setFontBold=function(e){this.fontBold=e},s.prototype.getFontItalic=function(){return this.fontItalic},s.prototype.setFontItalic=function(e){this.fontItalic=e},s.prototype.getFontStrike=function(){return this.fontStrike},s.prototype.setFontStrike=function(e){this.fontStrike=e},s.prototype.getFontUnderline=function(){return this.fontUnderline},s.prototype.setFontUnderline=function(e){this.fontUnderline=e},s.prototype.getPreview=function(){return this.preview},s.prototype.setPreview=function(e){this.preview=e},s.prototype.getFontColor=function(){return this.fontColor},s.prototype.setFontColor=function(e){this.fontColor=e},s.prototype.getMinimizeButtonSize=function(e){if(this.type!==t.annotationTypes.SANN_POSTIT)return 0;var a=t.annMinimizeButtonSize,n=e.getZoomDecimal(),o=this.getBoundingBox(this.collapsed),i=o.getWidth()*this.getWidthRatio(e),r=o.getHeight()*this.getHeightRatio(e);return(i/3<a||r/3<a)&&(a=Math.max(t.annMinimizeButtonSize*n,5)),i<=5||r<=5?0:a+2>i/2||a+2>r/2?0:a},s.prototype.getTextString=function(a){return this.type!==t.annotationTypes.SANN_POSTIT&&this.type!==t.annotationTypes.SANN_EDIT?"":a||!this.doubleByte?this.textString:e.Base64.decode(this.textString)},s.prototype.setTextString=function(t,n){if(!t){var o=a.annotationDefaults.textString;return void(o&&this.setTextString(o))}n||!this.doubleByte?this.textString=t:(this.textString=e.Base64.encode(t),this.doubleByte=!0),virtualViewer.updateAnnotationListItem(this)},s.prototype.saveTextString=function(){this.previousTextStrings||(this.previousTextStrings=[]),this.previousTextStrings.push(this.getTextString(!0))},s.prototype.restoreTextString=function(){return this.previousTextStrings?void this.setTextString(this.previousTextString.pop()):void(this.previousTextStrings=[])},s.prototype.wrapTextString=function(e,t,n){var o=virtualViewer.getActivePane();if(e||(e=0===o?$("#vvImageCanvas")[0].getContext("2d"):$("#vvSplitCanvas")[0].getContext("2d")),!this.getTextString())return[];var i=this,r=this.getTextString(),s=r.split("\n"),l=(this.box.getWidth()-2*t)*this.getWidthRatio(n)-this.getMinimizeButtonSize(n);if(!a.rotateTextAnnotations){var u=(this.getRotationAngle()+n.getRotationForPage(this.page))%360;90!==u&&270!==u||(l=(this.box.getHeight()-2*t)*this.getWidthRatio(n))}if(l<1)return[];l-=5,this.wrappedTextIsStale=!1;var d=function(t){for(var a=t.split(""),n="",o=0;o<a.length;o++){var r=n+a[o];e.measureText(r).width>=l&&o>0?(i.wrappedText.push(n),n=a[o]):n+=a[o]}n.trim()&&i.wrappedText.push(n)};this.wrappedText=[];for(var c=0;c<s.length;c++){for(var g=s[c].split(" "),v="",p=0,h=0;h<g.length;h++){var m=v+g[h],f=e.measureText(m).width;f>l?(v.length&&1===p?d(v):v.length&&this.wrappedText.push(v),v=g[h]+" ",p=g[h].trim().length?1:0):(v=m+" ",g[h].trim().length&&(p+=1))}1===p?d(v):this.wrappedText.push(v)}return this.wrappedText},s.prototype.getWrappedText=function(){return this.wrappedText||(this.wrappedText=[]),this.wrappedText},s.prototype.move=function(e){var t=this.box;this.box=new o(Math.round(e.getX()/this.getWidthRatio()),Math.round(e.getY()/this.getHeightRatio()),t.getWidth(),t.getHeight());var a=this.box.getX1()-t.getX1(),n=this.box.getY1()-t.getY1();return this.movePointArray(a,n),0!==a||0!==n},s.prototype.stretchLine=function(e,a,n){var o=Math.round(a/this.getWidthRatio()),r=Math.round(n/this.getHeightRatio());return e===t.lineEnds.start?this.pointArray[0]=new i(o,r):e===t.lineEnds.end&&(this.pointArray[1]=new i(o,r)),!0},s.prototype.stretch=function(e,n,i,r){n>$("#vvDummyScroller").width()?n=$("#vvDummyScroller").width():n<0&&(n=0),i>$("#vvDummyScroller").height()?i=$("#vvDummyScroller").height():i<0&&(i=0);var s,l=n/this.getWidthRatio(),u=i/this.getHeightRatio(),d=this.box;if(this.getType()===t.annotationTypes.SANN_POSTIT){var c=1.25*virtualViewer.collapsedStickySize()/this.getWidthRatio();s=r?this.stretchWithLockedAspectRatio(d,l,u,e,c):this.basicStretchMath(d,l,u,e,c)}else s=a.enableStampAspectRatioLock&&this.getType()===t.annotationTypes.SANN_BITMAP||r?this.stretchWithLockedAspectRatio(d,l,u,e):this.basicStretchMath(d,l,u,e);return s.height>0&&s.width>0&&(this.box=new o(s.x,s.y,s.width,s.height),this.pointArray&&this.stretchPointArray(d,this.box)),this.getTextString()&&this.getTextString().length&&(this.wrappedTextIsStale=!0),!0},s.prototype.stretchWithLockedAspectRatio=function(a,n,o,i,r){this.slope||(this.slope=a.getSlope());var s,l,u,d,c,g,v,p,h=r||e.getNubSize();i===t.corners.upperLeft?(u=Math.abs(n-a.getX1()),d=Math.abs(o-a.getY1()),s=Math.min(u,d),l=s===u,l?(c=n,v=a.getX2()-c,p=this.slope*v,g=a.getY2()-p):(g=o,p=a.getY2()-g,v=p/this.slope,c=a.getX2()-v),p<h&&(p=h,g=a.getY2()-p),v<h&&(v=h,c=a.getX2()-v)):i===t.corners.upperRight?(u=Math.abs(n-a.getX2()),d=Math.abs(o-a.getY1()),s=Math.min(u,d),l=s===u,l?(c=a.getX1(),v=n-c,p=this.slope*v,g=a.getY2()-p):(c=a.getX1(),g=o,p=a.getY2()-g,v=p/this.slope),v<h&&(v=h),p<h&&(p=h,g=a.getY2()-p)):i===t.corners.lowerLeft?(u=Math.abs(n-a.getX1()),d=Math.abs(o-a.getY2()),s=Math.min(u,d),l=s===u,l?(c=n,v=a.getX2()-c,p=this.slope*v,g=a.getY1()):(g=a.getY1(),p=o-g,v=p/this.slope,c=a.getX2()-v),v<h&&(v=h,c=a.getX2()-v),p<h&&(p=h)):i===t.corners.lowerRight&&(c=a.getX1(),g=a.getY1(),u=Math.abs(n-a.getX2()),d=Math.abs(o-a.getY2()),s=Math.min(u,d),l=s===u,l?(v=n-c,p=this.slope*v):(p=o-g,v=p/this.slope),v<h&&(v=h),p<h&&(p=h));var m={x:c,y:g,width:v,height:p};return m},s.prototype.basicStretchMath=function(a,n,o,i,r){var s,l,u,d,c=r||e.getNubSize();i===t.corners.upperLeft?(s=n,l=o,u=a.getX2()-s,d=a.getY2()-l,u<c&&(u=c,s=a.getX2()-u),d<c&&(d=c,l=a.getY2()-d)):i===t.corners.upperRight?(s=a.getX1(),l=o,u=n-s,d=a.getY2()-l,u<c&&(u=c),d<c&&(d=c,l=a.getY2()-d)):i===t.corners.lowerLeft?(s=n,l=a.getY1(),u=a.getX2()-s,d=o-l,u<c&&(u=c,s=a.getX2()-u),d<c&&(d=c)):i===t.corners.lowerRight&&(s=a.getX1(),l=a.getY1(),u=n-s,d=o-l,u<c&&(u=c),d<c&&(d=c));var g={x:s,y:l,width:u,height:d};return g},s.prototype.movePointArray=function(e,t){if(this.pointArray)for(var a=0;a<this.pointArray.length;a+=1)this.pointArray[a].setX(Math.round(this.pointArray[a].getX()+e)),this.pointArray[a].setY(Math.round(this.pointArray[a].getY()+t))},s.prototype.stretchPointArray=function(e,t){var a=t.getX1(),n=t.getY1(),o=t.getWidth()/e.getWidth(),i=t.getHeight()/e.getHeight();if(this.pointArray)for(var r=0;r<this.pointArray.length;r+=1)this.pointArray[r].setX(Math.round(a+(this.pointArray[r].getX()-e.getX1())*o)),this.pointArray[r].setY(Math.round(n+(this.pointArray[r].getY()-e.getY1())*i))},s.prototype.getRevisionHistory=function(){return this.revisionHistory},s.prototype.getMostRecentModifyDateFormatted=function(){var t;return t=this.currentRevision.date?this.currentRevision.date:this.revisionHistory.length?this.revisionHistory[0].date:this.createDate,t?e.createAnnTimeStamp(t):""},s.prototype.getCreateDateFormatted=function(){return this.createDate?e.createAnnTimeStamp(this.createDate):""},s.prototype.getMostRecentModifyUser=function(){return this.currentRevision.user?this.currentRevision.user:this.revisionHistory.length?this.revisionHistory[0].user:this.createUser},s.prototype.markRevised=function(t){var a=this.currentRevision.user,n=new Date(this.currentRevision.date);this.currentRevision={},this.currentRevision.user=virtualViewer.getUserPreferences().getUsername(),this.currentRevision.date=e.toSnowDateString(new Date);var o=new Date(this.currentRevision.date),i=o-n;(this.currentRevision.user!==a||isNaN(i)||i>500)&&virtualViewer.updateAnnotationListItem(this)},s.prototype.toXML=function(n,r,s){var l=this.getType();if(l===t.annotationTypes.SANN_CIRCLE&&(l=t.annotationTypes.SANN_ELLIPSE),l===t.annotationTypes.SANN_REDACTION_RECT&&(l=t.annotationTypes.SANN_RECTANGLE),this.annDelete===!0)return"";var u=l===t.annotationTypes.SANN_EDIT||l===t.annotationTypes.SANN_BUBBLE||l===t.annotationTypes.SANN_POSTIT||l===t.annotationTypes.SANN_CLOUD_EDIT,d=this.pointArray,c=this.rotationAngle;this.isFilenet&&(c=this.xmlRotate||c);var g=this.getBoundingBox(!1);if(r||this.isFilenet&&!u){if(this.pointArray){d=[];for(var v=0;v<this.pointArray.length;v+=1)d.push(new i(this.pointArray[v].x,this.pointArray[v].y))}g=new o(g.getX1(),g.getY1(),g.getWidth(),g.getHeight()),this.updatePageDimensions();var p=this.pageWidth,h=this.pageHeight;if((90===c||270===c)&&!this.isFilenet){var m=p;p=h,h=m}g.rotate(c,p,h),this.rotatePointArray(c,d,p,h),this.fixBoundingBox(g,d)}var f="";f=this.annId?"<annObject><annMeta><annID>"+this.annId+"</annID>":"<annObject><annMeta><annID>ANN_ID</annID>",this.isDaeja&&(f+="<isDaeja>true</isDaeja>"),f+="<annType>",f+=l+"</annType><annLayerID>",f+=this.getLayerName()+"</annLayerID><annOrdinal>",f+=this.getOrdinal()+"</annOrdinal><annDelete>false</annDelete><annHistory><annCreateDate>",f+=this.getCreateDate()+"</annCreateDate><annModifyDate>",f+=(this.currentRevision.date||this.getModifyDate())+"</annModifyDate>",f+=this.getCreateUser()&&""!==this.getCreateUser()?"<annCreateUser>"+encodeURIComponent(this.getCreateUser())+"</annCreateUser>":"<annCreateUser/>",this.currentRevision&&this.currentRevision.user&&(this.revisionHistory.unshift(this.currentRevision),this.currentRevision={user:"",date:"",modificationType:""}),f+="<annModifications>";for(var v=0;v<this.revisionHistory.length;v++)f+="<annModificationItem>",f+="<annModifyUser>"+encodeURIComponent(this.revisionHistory[v].user)+"</annModifyUser>",f+="<annModifyDate>"+this.revisionHistory[v].date+"</annModifyDate>",f+="<annModifyType />",f+="</annModificationItem>";if(f+="</annModifications>",f+="</annHistory></annMeta>",this.annotationTags.length>0){f+="<annTags>";for(var y=0;y<this.annotationTags.length;y++)f+="<tag>"+encodeURIComponent(this.annotationTags[y])+"</tag>";f+="</annTags>"}else f+="<annTags/>";if(this.noteArray.length>0){f+="<annNotes>";for(var b=0;b<this.noteArray.length;b++){var P=this.noteArray[b];f+="<Note>",f+="<userId>"+encodeURIComponent(P.userId)+"</userId>",f+="<createDate>"+P.createDate+"</createDate>",f+=P.editDate?"<modifyDate>"+P.editDate+"</modifyDate>":"<modifyDate/>",f+="<noteText>"+encodeURIComponent(P.text)+"</noteText>",f+="<idxFlag>"+P.idxFlag+"</idxFlag>",f+="</Note>"}f+="</annNotes>"}else f+="<annNotes/>";f+="<annTransparent>false</annTransparent>",this.bitmapData&&(f+="<bitmapData>"+this.bitmapData+"</bitmapData>"),u&&(f+="<fontInfo><fontName>",f+=this.getFontName()+"</fontName><fontSize>",f+=Math.round(this.getFontSize(!0))+"px</fontSize><fontBold>",f+=this.getFontBold()+"</fontBold><fontItalic>",f+=this.getFontItalic()+"</fontItalic><fontStrike>",f+=this.getFontStrike()+"</fontStrike><fontUnderline>",f+=this.getFontUnderline()+"</fontUnderline><fontColor>",f+=this.getFontColor()+"</fontColor></fontInfo><textString>",f+=this.getTextString(!0)+"</textString>"),(!this.getFillColor()&&this.getLineColor()||l===t.annotationTypes.SANN_POLYGON)&&(f+="<lineInfo><lineStyle>Solid</lineStyle><lineWidth>",f+=Math.round(this.getLineWidth(!0))+"</lineWidth>",f+=l===t.annotationTypes.SANN_POLYGON&&this.getFillColor()?"<lineColor>NO_COLOR</lineColor>":"<lineColor>"+this.getLineColorRGB()+"</lineColor>",f+="<lineTransparent>false</lineTransparent>",d?(f+="<pointArray>",f+=e.generatePointArrayString(d),f+="</pointArray>"):f+="<pointArray/>",f+="</lineInfo>"),this.getFillColor()&&(f+="<fillInfo><fillColor>",f+=this.getFillColorRGB()+"</fillColor>",1===this.getOpacity()||n?(f+="<fillTransparent>false</fillTransparent>",f+="<fillTransparentPercent />"):(f+="<fillTransparent>true</fillTransparent>",f+="<fillTransparentPercent/>"),f+="</fillInfo>"),r?f+=u&&!a.rotateTextAnnotations?"<rotationAngle>"+(360-s)+"</rotationAngle>":"<rotationAngle>"+c+"</rotationAngle>":"undefined"===this.xmlRotate?(this.xmlRotate=0,f+="<rotationAngle>"+this.xmlRotate+"</rotationAngle>"):f+="<rotationAngle>"+this.xmlRotate+"</rotationAngle>";var A=Math.round(g.getX1()),T=Math.round(g.getY1()),S=Math.round(g.getHeight()),I=Math.round(g.getWidth());return f+="<annStartX>"+A+"</annStartX><annStartY>",f+=T+"</annStartY><annHeight>",f+=S+"</annHeight><annWidth>",f+=I+"</annWidth></annObject>"},s.prototype.lineAnnotationContains=function(t,a,n){var o=Math.max(this.lineWidth,e.getNubSize()/a),r=new i(t.x/a,t.y/n);if(!this.box.contains(t,a,n))return!1;var s=e.getDistanceFromPointToLine(r,this.pointArray);return!(s>o)},s.prototype.drawnAnnotationContains=function(e,a,n){return this.type!==t.annotationTypes.SANN_LINE&&this.type!==t.annotationTypes.SANN_ARROW||2!==this.pointArray.length?this.box.contains(e,a,n,this.collapsed):this.lineAnnotationContains(e,a,n)},s.prototype.findLineEndpoint=function(a,n,o){var i=e.getNubSize()/2/n,r=a.getX()/n,s=a.getY()/o,l=this.pointArray[0].getX(),u=this.pointArray[0].getY(),d=this.pointArray[1].getX(),c=this.pointArray[1].getY();return r>=l-i&&r<=l+i&&s>=u-i&&s<=u+i?t.lineEnds.start:r>=d-i&&r<=d+i&&s>=c-i&&s<=c+i?t.lineEnds.end:null},s.prototype.addNewNote=function(){this.notes.addNote("Annotation",this)},s.prototype.editNote=function(e){this.notes.editNote(e,"Annotation",this)},s.prototype.removeNoteFromArray=function(e){this.noteArray.splice(e,1)},s.prototype.loadAnnotationNotes=function(){$("#vvAnnotationNotesInternal").empty();var e=r.getActivePaneState();if(e&&e.pageStates&&!(e.pageStates.length<1)){this.noteArray.sort(function(e,t){return e=e.editDate?new Date(e.editDate):new Date(e.createDate),t=t.editDate?new Date(t.editDate):new Date(t.createDate),t-e});for(var t=0;t<this.noteArray.length;t++)this.notes.addExistingNote(this.noteArray[t],"Annotation",this)}},s.prototype.loadAnnotationInformation=function(){$("#vvAnnCreateUser").html(e.encodeForHTML(this.createUser));var t=e.createAnnTimeStamp(this.createDate);if($("#vvAnnCreateDate").html(t),$("#vvAnnotationRevisionHistory").empty(),$.views.helpers({createAnnTimeStamp:e.createAnnTimeStamp}),this.revisionHistory&&this.revisionHistory.length){$("#vvAnnViewRevisions").show();var a=$($("#vvAnnPopUpRevisionItemTmpl").render(this.revisionHistory));a.appendTo("#vvAnnotationRevisionHistory")}else $("#vvAnnViewRevisions").hide()},s.prototype.fixDimensionsForPage=function(){var e=this.getWidth()/this.pageWidth,t=this.getHeight()/this.pageHeight,a=Math.max(e,t);if(a>1){var n=new o(this.box.one.x,this.box.one.y,this.box.getWidth()/a,this.box.getHeight()/a);this.stretchPointArray(this.box,n),this.box=n}var r=Math.max(this.box.getX1()*this.getWidthRatio(),0),s=Math.max(this.box.getY1()*this.getHeightRatio(),0);this.box.getX2()>this.pageWidth&&(r=(this.pageWidth-this.box.getWidth())*this.getWidthRatio()),this.box.getY2()>this.pageHeight&&(s=(this.pageHeight-this.box.getHeight())*this.getHeightRatio()),this.move(new i(r,s))},s.prototype.fixForPaste=function(t,a,n){a||(a=r.getActivePaneState()),null!==t&&void 0!==t||(t=a.getPageNumber());var i=a.pageStates[t];if(n||(n=i.annotationLayers[this.getLayerName()]),this.doubleByte!==n.doubleByte&&(n.doubleByte?(this.textString=e.Base64.encode(this.textString),this.doubleByte=!0):(this.textString=e.Base64.decode(this.textString),this.doubleByte=!1)),this.page=t,this.pageWidth=n.pageWidth,this.pageHeight=n.pageHeight,this.setRotationAngle(0),n.docDPI&&n.docDPI!==this.docDPI){var s=this.getFontSize(),l=new o(this.box.getX1()*(n.docDPI/this.docDPI),this.box.getY1()*(n.docDPI/this.docDPI),this.getWidth()*(n.docDPI/this.docDPI),this.getHeight()*(n.docDPI/this.docDPI));this.stretchPointArray(this.box,l),this.box=l,this.docDPI=n.docDPI||200,s&&this.setFontSize(s,!1)}if(this.fixDimensionsForPage(),this.bitmapData&&!this.bitmapImage){this.bitmapImage=new Image,this.bitmapImage.vvDeadEnd=!0,this.bitmapImage.src="data:image/png;base64,"+this.bitmapData;var u=this;$(this.bitmapImage).on("error",function(){u.bitmapImage=null})}this.revisionHistory=[],this.currentRevision={},this.createDate=e.toSnowDateString(new Date),this.createUser=virtualViewer.getUserPreferences().getUsername()},s}),define("vvAnnotationManager",["vvUtility","annotations","user-config/config","vvDefines","vvPoint","vvStateManager"],function(e,t,a,n,o,i){function r(){}var s=null,l=new Image(14,14);l.src="resources/annMinimize.svg",r.prototype.getCurrentLayer=function(e){var t=virtualViewer.getActivePaneState(),a=t.getLayerNames();e||(e=t.getPageNumber());var o=t.getLayersForPage(e);if(!t.getCurrentLayerOnPage(e)&&a.length>0){if(!o)return;var i=o.Default;if(i&&this.checkLayerPermission(i,n.permissionLevels.PERM_EDIT))t.setCurrentLayer(i);else{for(var r=!1,s=0;s<a.length;s+=1){var l=o[a[s]];if(this.checkLayerPermission(l,n.permissionLevels.PERM_EDIT)){r=!0,t.setCurrentLayer(l);break}}if(!r){var u=this.createLayer("Default "+Math.floor(1024*Math.random()));t.setCurrentLayer(u)}}}return t.getCurrentLayer()},r.prototype.getRedactionLayer=function(t,o){o=o||virtualViewer.getActivePaneState();var i;a.oneLayerPerAnnotation?i=this.createLayer(n.redactionLayerPrefix+"-"+e.vvGUID(),t):(i=o.getLayerFromPage(t,n.redactionLayerPrefix),i||(i=this.createLayer(n.redactionLayerPrefix,t)));var r=o.getDPIForPage(0),s=o.getRequestedWidthForPage(0),l=o.getRequestedHeightForPage(0);return o.pageStates[t]&&o.pageStates[t].imageInfoLoaded?i&&(i.docDPI=o.getDPIForPage(t)||72):(o.setDPIForPage(t,r),0===r&&(r=72),i&&(i.docDPI=r),0===o.getRequestedWidthForPage(t)&&o.setRequestedWidthForPage(t,s),0===o.getRequestedHeightForPage(t)&&o.setRequestedHeightForPage(t,l)),o.setViewedForPage(t,!0),i},r.prototype.staleAnnTextWrapping=function(e,t){if(e&&"number"==typeof t){var a=e.getLayersForPage(t),o=e.getLayerNames();if(a&&o)for(var i=o.length,r=0;r<i;r++){var s=a[o[r]];if(void 0!==s&&s.permissionLevel>=n.permissionLevels.PERM_VIEW&&s.visibility===!0)for(var l=0;l<s.anns.length;l++)s.anns[l].getDelete()!==!0&&s.anns[l].page===t&&(s.anns[l].wrappedTextIsStale=!0)}}},r.prototype.parseLayer=function(n,o,i){var r=n.getElementsByTagName("pageMeta")[0],s=n.getElementsByTagName("annObject"),l=e.fixBooleanString(e.getValue(n,"isFilenet")),u=e.fixBooleanString(e.getValue(n,"isDaeja")),d=e.fixBooleanString(e.getValue(n,"isIDM"));if(r){var c={};c.layerName=e.getValue(n,"annLayerID"),c.pageNumber=parseInt(e.getValue(r,"pageNumber"),10),c.pageWidth=parseInt(e.getValue(r,"pageWidth"),10),c.pageHeight=parseInt(e.getValue(r,"pageHeight"),10),c.doubleByte=e.fixBooleanString(e.getValue(n,"doubleByte")),c.visibility=!0,c.docDPI=parseInt(e.getValue(n,"docDPI"),10)||72,c.isFilenet=l,c.isDaeja=u,c.isIDM=d,null!==i&&void 0!==i?c.pageNumber=i:i=c.pageNumber,d&&(c.docDPI=200);var g=o.getOriginalWidthForPage(i),v=o.getOriginalHeightForPage(i);if(l&&3300===c.pageHeight&&2550===c.pageWidth){var p=o.getDPIForPage(i);if(0!==p){var h=c.docDPI/p;0!==g&&(c.pageWidth=parseInt(g*h,10)),0!==v&&(c.pageHeight=parseInt(v*h,10))}}else u&&0===c.pageWidth&&0===c.pageHeight&&(c.pageWidth=o.getOriginalWidthForPage(i),c.pageHeight=o.getOriginalHeightForPage(i));c.anns=[];var m=virtualViewer.getDocumentModel(o);if(!m)return;for(var f=m.model.layerManager.layers.length,y=0;y<f;y++){var b=m.model.layerManager.layers[y],P=decodeURIComponent(b.annotationId);if(P===c.layerName){c.displayName=decodeURIComponent(b.displayName),c.isRedaction=b.isRedaction,c.isDeletable=b.isDeletable,c.permissionLevel=b.permissionLevel;break}}for(var A=0;A<s.length;A++){var T=new t;T.init(s[A],null,i,c.pageWidth,c.pageHeight,c.layerName,c.doubleByte,A,c.docDPI,l,u,d),e.isRedactionLayer(c)&&(virtualViewer.showRedactionWarningDialog(),T.setFillColorRGB(a.annotationDefaults.redactionFillColor),T.setOpacity(a.annotationDefaults.redactionOpacity)),c.anns[A]=T}o.addLayerToPage(i,c)}},r.prototype.checkLayerPermission=function(e,t){return!e||!(e.permissionLevel<t)},r.prototype.createLayer=function(e,t,a){if(a=a||virtualViewer.getActivePaneState(),!a.pageStates)return null;var n=a.getDocumentModel();t||0===t||(t=a.getPageNumber());for(var o,i=0;i<a.getPageCount();i++){var r=a.pageStates[i].annotationLayers;if(!r||!r[e]){var s=this.createAnnotationLayer(e,i,a.pageStates[i]);a.addLayerToPage(i,s),this.addLayerToPageHash(e,i,a),i===t&&(o=s,a.setCurrentLayer(o))}}if(o){var l=this.createModelAnnotationLayer(o);n.model.layerManager.layers.push(l),n.setAnnotationsModifiedSinceInit(!0,a);var u=(n.model.annotationLayersDeletedSinceInit||[]).indexOf(o.layerName);u>-1&&n.model.annotationLayersDeletedSinceInit.shift(u)}return o},r.prototype.addLayerToPageHash=function(e,t,a){a=a||virtualViewer.getActivePaneState();var n=a.getDocumentModel(),o=n.model.pageData[t];o.annotationHash||(o.annotationHash={});var i=o.annotationHash[e];if(i)i.annExists=!0;else{var r={annExists:!0,documentId:a.getDocumentId(),layerAnnotationId:e,layersToMerge:[],pageIndex:t,rotateAngle:a.getRotationForPage()};o.annotationHash[e]=r}},r.prototype.createDefaultLayer=function(e){var t="Default",a=(e.getLayerNames(),e.getLayersForPage(e.getPageNumber())),n=null;return a&&a[t]||(n=this.createLayer(t)),n},r.prototype.createModelAnnotationLayer=function(e){return{newLayer:!0,annotationId:encodeURIComponent(e.layerName),isDeletable:!0,isRedaction:!1,permissionLevel:e.permissionLevel,dirty:!0,visible:!0}},r.prototype.createAnnotationLayer=function(e,t,o){o=o||virtualViewer.getActivePaneState().pageStates[t];var i=o.dpi;void 0===i&&(i=virtualViewer.getActivePaneState().getDPIForPage(0)),0===i&&(i=72);var r={};return r.layerName=e,r.pageNumber=t,r.pageWidth=o.originalWidth,r.pageHeight=o.originalHeight,r.docDPI=i,a.createIDMAnnotations&&(r.pageWidth=1e4,r.pageHeight=1e4,r.docDPI=200,r.isIDM=!0),a.base64EncodeAnnotations?r.doubleByte=!0:r.doubleByte=!1,r.visibility=!0,r.isRedaction=!1,r.isDeletable=!0,r.permissionLevel=n.permissionLevels.PERM_DELETE,r.anns=[],r},r.prototype.renameLayerCore=function(e,t){var o=virtualViewer.getActivePaneState().getDocumentId();if(!o)return null;var i=new URI(a.servletPath);i.addQuery("action","renameAnnotationLayer"),i.addQuery("documentId",o),i.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),i.addQuery("pageCount",virtualViewer.getPageCount()),i.addQuery("oldLayerName",e),i.addQuery("newLayerName",t),n.cacheBuster===!0&&i.addQuery("cacheBuster",Math.random()),i.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var r=i.query();i.query(""),$.ajax({url:i.toString(),type:"POST",data:r,success:function(e){virtualViewer.checkServerException(e)},error:function(e){virtualViewer.checkServerException(e,o),console.log("error")}})},r.prototype.deleteCurrentLayer=function(){for(var e=virtualViewer.getActivePaneState(),t=e.getLayerNames(),a=this.getCurrentLayer(),n=[],o=0;o<t.length;o+=1){var i=t[o];i!==a.layerName&&this.newLayerNames.push(i)}e.setLayerNames(n),e.deleteLayer(a.layerName),"Master Layer"===a.layerName&&$("#vvLayerManagerConsolidateLayerButton").prop("disabled",!1).css("opacity",1),e.setCurrentLayer(void 0),this.getCurrentLayer(),virtualViewer.delayedPaintCanvases()},r.prototype.renameCurrentLayer=function(e){if(this.getCurrentLayer()){var t=this.getCurrentLayer().layerName;this.renameLayerCore(t,e);var a=virtualViewer.getCurrentState();a.renameLayer(t,e),virtualViewer.getDocumentModel().renameLayer(t,e)}},r.prototype.markCurrentLayerDirty=function(){var e=virtualViewer.getActivePaneState();e.getDocumentModel().markLayerDirty(this.getCurrentLayer())},r.prototype.markLayerDirty=function(e){var t=virtualViewer.getActivePaneState();t.getDocumentModel().markLayerDirty(e)},r.prototype.markLayerWithAnnDirty=function(e){var t=virtualViewer.getActivePaneState();if(t){var a=this.getLayerWithAnn(e);a&&(this.markLayerDirty(a),virtualViewer.getCallbackManager().call("annotationChanged",{documentId:t.getDocumentId(),annotationLayerId:a.layerName,annotationId:e.annId}))}},r.prototype.getLayerWithAnn=function(e){var t=virtualViewer.getActivePaneState();if(!e||!t)return null;var a=t.getLayersForPage(e.page);if(!a)return null;var n=e.layerName;if(!n)return null;var o=a[n];return o?o:null},r.prototype.checkLayerIntegrity=function(e,t){t=t||virtualViewer.getActivePaneState();var a=t.pageStates[e].annotationLayers;a||(a={},t.pageStates[e].annotationLayers=a);for(var n=t.getLayerNames(),o=0;o<n.length;o++)a[n[o]]||(a[n[o]]=this.createLayer(n[o],e,t));t.pageStates[e].annotationLayers=a},r.prototype.getAnnotationAtPoint=function(e,t){t=t||virtualViewer.getActivePaneState();var a=t.getPageNumber(),o=t.getLayersForPage(a),i=t.getLayerNames();if(o){for(var r=null,s=0;s<i.length;s++){var l=o[i[s]];if(this.checkLayerPermission(l,n.permissionLevels.PERM_EDIT)&&l&&l.visibility)for(var u=l.anns.length-1;u>=0;u--){var d=l.anns[u];if(d.getDelete()===!1&&d.page===t.pageNumber){var c=d.getPointRotatedForAnn(e,t);if(d.drawnAnnotationContains(c,d.getWidthRatio(t),d.getHeightRatio(t)))return r=d}}}return r}},r.prototype.isAnnotationAtPoint=function(e,t){var a=this.getAnnotationAtPoint(e,t,!0);return!!a},r.prototype.getAnnotationAtIndex=function(e){return this.getCurrentLayer().anns[e]},r.prototype.getAnnotationCount=function(){return this.getCurrentLayer().anns.length},r.prototype.paintAnnotations=function(e,t,a,o){e=e||virtualViewer.getActivePaneState(),o||0!==o&&(o=e.getPageNumber());var i=e.getLayersForPage(o),r=e.getLayerNames();if(i&&r)for(var s=r.length,l=0;l<s;l++){var u=i[r[l]];if(void 0!==u&&u.permissionLevel>=n.permissionLevels.PERM_VIEW&&u.visibility===!0)for(var d=0;d<u.anns.length;d++)u.anns[d].getDelete()!==!0&&u.anns[d].page===o&&this.paintAnnotation(e,t,a,u.anns[d])}},r.prototype.addAnnotation=function(t,o,i,r,s){var l=virtualViewer.getActivePaneState();if(null!==o&&void 0!==o||(o=l.getPageNumber()),!i){var u=l.getLayersForPage(o),d=l.getLayerNames(),c=d.length;if(!this.areDimensionsValid(t))return null;if(t.getType()===n.annotationTypes.SANN_POSTIT&&t.setLineColor(null),0===c)this.createDefaultLayer(l),c=d.length;else if(this.getCurrentLayer())e.isRedactionLayer(this.getCurrentLayer())&&(u.Default?l.setCurrentLayer(u.Default):this.createDefaultLayer(l));else{for(var g=0;g<c;g+=1){var v=this.checkLayerPermission(u[d[g]],n.permissionLevels.PERM_CREATE);if(v===!0){l.setCurrentLayer(u[d[g]]);break}}this.getCurrentLayer()||this.createDefaultLayer(l)}i=this.getCurrentLayer()}if(this.checkLayerPermission(this.getCurrentLayer(),n.permissionLevels.PERM_CREATE)===!1)return alert(e.getLocalizedValue("errors.createAnnOnLayerPermission","You do not have permission to create annotations on this layer.")),
null;var p=-1;0===i.pageWidth&&(i.pageWidth=l.getOriginalWidthForPage(o)),0===i.pageHeight&&(i.pageHeight=l.getOriginalHeightForPage(o)),t.setLayerName(i.layerName),t.setPageWidth(i.pageWidth),t.setPageHeight(i.pageHeight),r||t.fixCoordinates();for(var h=0;h<i.anns.length;h++)i.anns[h].getOrdinal()>p&&(p=i.anns[h].getOrdinal());t.setOrdinal(p+1),t.setIndex(i.anns.length),i.anns.push(t),this.addLayerToPageHash(i.layerName,o),s||l.getDocumentModel().markLayerDirty(i),a.showAnnIndicators&&(virtualViewer.pageContainsAnnotations(o)&&!virtualViewer.pageHasIndicator(o)&&(virtualViewer.showAnnotationIndicator(o),virtualViewer.addToPagesWithAnnotations(o)),virtualViewer.createNavigationOptionsLabels()),virtualViewer.addSingleAnnotationListItem(t);var m=virtualViewer.getCallbackManager();m.call("annotationCreation",{type:t.type});var f=l.getNewAnnList().indexOf(t);return f===-1&&l.addAnnToNewAnnList(t),t},r.prototype.deleteAnn=function(e){e||(e=virtualViewer.getActivePaneState());var t=virtualViewer.getCurrentAnnObject(),a=e.pageNumber;if(t){var n=e.getUndoObject(a);n.referenceAnn=t,n.unchangedAnn=t.clone(),n.layer=this.getLayerWithAnn(t),t.setDelete(!0),this.markLayerWithAnnDirty(t),n.modifiedAnn=t.clone(),n.type="modify",n.modifiedAnn.isSameAs(n.unchangedAnn)||e.pushUndoObject(a,n),e.resetUndoObject(),virtualViewer.setCurrentAnnObject(null),virtualViewer.updateAnnotationListItem(t);var o=e.getNewAnnList().indexOf(t);if(o>-1){if(e.removeNewAnnFromList(o),0===e.getNewAnnList().length&&e.getTrueAnnChange()===!1){var i=e.getDocumentModel();i.setAnnotationsModifiedSinceInit(!1,e)}}else e.setTrueAnnChange(!0);var r=virtualViewer.getCallbackManager();r.call("annotationDeletion",{type:t.type})}virtualViewer.pageContainsAnnotations(a)||(virtualViewer.removeAnnotationIndicators(a),virtualViewer.removeFromPagesWithAnnotations(a)),virtualViewer.delayedPaintCanvases()},r.prototype.copyAnn=function(){var e=virtualViewer.getCurrentAnnObject();virtualViewer.setAnnClipboard(e.clone())},r.prototype.cutAnn=function(e){this.copyAnn(),e||(e=virtualViewer.getActivePaneState()),this.deleteAnn(e)},r.prototype.pasteAnn=function(t,n){null!==t&&void 0!==t||(t=virtualViewer.getActivePaneState()),null!==n&&void 0!==n||(n=t.pageNumber);var o=virtualViewer.getAnnClipboard(),i=o.getLayerName(),r=t.getLayersForPage(n),s=null,l=!1;"vvRedaction"===i.substring(0,11)&&(l=!0),a.oneLayerPerAnnotation?(s=virtualViewer.createAutoLayer(l),i=s.layerName,o.setLayerName(i)):r&&r[i]?(s=r[i],0===s.pageWidth&&(s.pageWidth=t.getOriginalWidthForPage(n)),0===s.pageHeight&&(s.pageHeight=t.getOriginalHeightForPage(n))):(s=this.createLayer(i,n,t),t.addLayerToLayerNames(i),t.addLayerToPage(n,s),this.addLayerToPageHash(i,n,t));var d=o.clone();d.fixForPaste(n,t,s);var c=u(o.pasteLocation,d,t);d.move(c),o.pasteLocation=null,d.revisionHistory=[],d.setCreateUser(virtualViewer.getUserPreferences().getUsername()),d.setCreateDate(e.toSnowDateString(new Date)),this.addAnnotation(d,n,s,!0),virtualViewer.delayedPaintCanvases()};var u=function(e,t,a){var n=t.pageWidth*t.getWidthRatio(a),i=t.pageHeight*t.getHeightRatio(a);return e.getX()<0?e=new o(0,e.getY()):e.getX()+t.box.getWidth()*t.getWidthRatio()>n&&(e=new o(n-t.box.getWidth()*t.getWidthRatio(),e.getY())),e.getY()<0?e=new o(e.getX(),0):e.getY()+t.box.getHeight()*t.getHeightRatio()>i&&(e=new o(e.getX(),i-t.box.getHeight()*t.getHeightRatio())),e};return r.prototype.rotateContextForAnnotation=function(t,a,n,o,i,r){o||(o=virtualViewer.getActivePaneState()),i||(i=$("#vvOuterDiv")),r||(r=$("#vvDummyScroller"));var s=o.getRotationForPage(n.page),l=n.getRotationAngle(),u={page:n.page,state:o,pageWidth:n.pageWidth*n.getWidthRatio(o),pageHeight:n.pageHeight*n.getHeightRatio(o),rotateAngle:(s+l)%360,dummyScroller:r,outerDiv:i,canvas:t},d=virtualViewer.getTransformedPageLeft(u),c=virtualViewer.getTransformedPageTop(u),g=Math.sin(e.degreesToRadians(s+l)),v=Math.cos(e.degreesToRadians(s+l));a.setTransform(v,g,-g,v,d,c)},r.prototype.paintAnnotation=function(e,t,a,o){e=e||virtualViewer.getActivePaneState(),a.save();var i=o.getType();o.updatePageDimensions(e),e.currentPaneIndex>0?this.rotateContextForAnnotation(t,a,o,e,$("#vvSplit1Panel"),$("#vvSplitScroller")):this.rotateContextForAnnotation(t,a,o,e,null,null),a.lineWidth=o.getLineWidth(!0,e)*o.getHeightRatio(e),o.getLineColor()&&(a.strokeStyle=o.getLineColor()),o.getFillColor()&&(a.fillStyle=o.getFillColor()),i===n.annotationTypes.SANN_RECTANGLE?o.getFillColor()?this.rectanglePrimitive(a,o,!0,e):o.getLineColor()&&this.rectanglePrimitive(a,o,!1,e):i===n.annotationTypes.SANN_REDACTION_RECT?this.rectanglePrimitive(a,o,!0,e):i===n.annotationTypes.SANN_LINE?this.linePrimitive(a,o,!1,!1,e):i===n.annotationTypes.SANN_ELLIPSE?this.ellipsePrimitive(a,o,e):i===n.annotationTypes.SANN_BITMAP?this.bitmapPrimitive(a,o,e):i===n.annotationTypes.SANN_POSTIT?this.stickyPrimitive(a,o,e):i===n.annotationTypes.SANN_POLYGON?this.linePrimitive(a,o,!1,!0,e):i===n.annotationTypes.SANN_ARROW?this.linePrimitive(a,o,!0,!1,e):i===n.annotationTypes.SANN_EDIT?this.textPrimitive(a,o,0,e):i===n.annotationTypes.SANN_TRANSPARENT_BITMAP||(i===n.annotationTypes.SANN_BUBBLE?this.ellipsePrimitive(a,o,e):i===n.annotationTypes.SANN_CLOUD_EDIT?this.ellipsePrimitive(a,o,e):i===n.annotationTypes.SANN_CUSTOM_STAMP||i===n.annotationTypes.SANN_CIRCLE),virtualViewer.getCurrentAnnObject()&&o.isSameAs(virtualViewer.getCurrentAnnObject())&&this.addResizeNubs(a,o),a.restore()},r.prototype.addResizeNubs=function(e,t){if(!a.readOnlyAnnotationMode){var o=t.getBoundingBox(t.collapsed),i=virtualViewer.getActivePaneState(),r=t.getPointArray(),s=null,l=null;if(r&&(s=r[0],l=r[1]),t.getType()!==n.annotationTypes.SANN_ARROW&&t.getType()!==n.annotationTypes.SANN_LINE||2!==r.length){var u=o.getX1()*t.getWidthRatio(i),d=o.getY1()*t.getHeightRatio(i),c=o.getWidth()*t.getWidthRatio(i),g=o.getHeight()*t.getHeightRatio(i);e.lineWidth=1,e.strokeStyle="rgb(0,0,0)",e.strokeRect(u,d,c,g),t.collapsed||(this.createNub(e,t,u,d),this.createNub(e,t,u+c,d),this.createNub(e,t,u,d+g),this.createNub(e,t,u+c,d+g))}else this.createNub(e,t,s.getX()*t.getWidthRatio(i),s.getY()*t.getHeightRatio(i)),this.createNub(e,t,l.getX()*t.getWidthRatio(i),l.getY()*t.getHeightRatio(i));virtualViewer.getEventManager().setDragMode(n.dragModes.moveAnnotation)}},r.prototype.createNub=function(t,n,o,i){var r=e.getNubSize(),s=r/2;t.fillStyle=a.polygonNubFillColor||"rgba(0, 0, 255, .40)",t.fillRect(o-s,i-s,r,r)},r.prototype.rectanglePrimitive=function(e,t,a,n){n||(n=virtualViewer.getActivePaneState());var i=t.getBoundingBox(t.collapsed);if(a)return e.fillStyle=t.getFillColor(),void e.fillRect(i.getX1()*t.getWidthRatio(n),i.getY1()*t.getHeightRatio(n),i.getWidth()*t.getWidthRatio(n),i.getHeight()*t.getHeightRatio(n));var r=[];r[0]=new o(i.getX1(),i.getY1()),r[1]=new o(i.getX2(),i.getY1()),r[2]=new o(i.getX2(),i.getY2()),r[3]=new o(i.getX1(),i.getY2()),r[4]=new o(i.getX1(),i.getY1()),t.setPointArray(r),this.linePrimitive(e,t,!1,a,n),t.setPointArray(null)},r.prototype.redactionRectanglePrimitive=function(e,t,n){n||(n=virtualViewer.getActivePaneState()),t.setFillColorRGB(a.annotationDefaults.redactionFillColor),t.setOpacity(a.annotationDefaults.redactionOpacity),this.rectanglePrimitive(e,t,!0,n)},r.prototype.bubblePrimitive=function(e,t,a){a=a||virtualViewer.getActivePaneState(),this.textPrimitive(e,t,a)},r.prototype.cloudPrimitive=function(t,a,n){n=n||virtualViewer.getActivePaneState(),this.ellipsePrimitive(t,a,n),this.textPrimitive(t,a,n);var o=e.getTextAnnDOMId(a),i=document.getElementById(o);i.style.textAlign="center"},r.prototype.areDimensionsValid=function(e){if(e.collapsed)return!0;var t=e.getBoundingBox(),o=t.getX1(),i=t.getY1(),r=t.getWidth(),s=t.getHeight();if(isNaN(o)||isNaN(i)||isNaN(r)||isNaN(s))return!1;if((e.getType()===n.annotationTypes.SANN_EDIT||e.getType()===n.annotationTypes.SANN_CLOUD_EDIT)&&(r<n.minTextAnnDrawSize||s<n.minTextAnnDrawSize))return!1;if(e.getType()===n.annotationTypes.SANN_POSTIT){var l=t.getWidth(),u=5,d=a.annotationDefaults.stickyMargin+1;if(l-u-d<n.minTextAnnDrawSize)return!1}return!0},r.prototype.stickyPrimitive=function(e,t,n){if(this.areDimensionsValid(t)){n=n||virtualViewer.getActivePaneState(),e.save(),e.shadowColor="#777777",e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowBlur=2,this.rectanglePrimitive(e,t,!0,n),e.restore();var o=t.getBoundingBox(t.collapsed),i=n.getZoomDecimal(),r=t.getMinimizeButtonSize(n);if(r){var s=Math.ceil(a.annotationDefaults.stickyMargin*i);e.drawImage(l,o.getX2()*t.getWidthRatio(n)-r-s,o.getY1()*t.getHeightRatio(n)+s,r,r)}t.collapsed||this.textPrimitive(e,t,a.annotationDefaults.stickyMargin,n)}},r.prototype.textPrimitive=function(t,n,o,i){i=i||virtualViewer.getActivePaneState();var r=Math.round(n.getFontSize(!0)*n.getHeightRatio(i)),s=n.getFontName();n.isIDM&&"Explorer"===BrowserDetect.browser&&"TIMES ROMAN"===n.getFontName()&&(s="Times New Roman");var l=r/.85,u=0,d=l/1.5;o||(o=0);var c="";n.getFontBold()&&(c+="bold "),n.getFontItalic()&&(c+="italic "),t.save(),t.font=c+r+"px "+s,t.fillStyle="#"+n.getFontColor(),t.translate((n.getBoundingBox().getX1()+o)*n.getWidthRatio(i),(n.getBoundingBox().getY1()+o)*n.getHeightRatio(i));var g=n.getBoundingBox().getHeight()*n.getHeightRatio(i),v=(n.getRotationAngle()+i.getRotationForPage(n.page))%360;a.rotateTextAnnotations||90!==v?a.rotateTextAnnotations||180!==v?a.rotateTextAnnotations||270!==v||(g=n.getBoundingBox().getWidth()*n.getHeightRatio(i),t.rotate(-e.degreesToRadians(v)),t.translate(0,-n.getWidth()*n.getWidthRatio(i))):(t.rotate(-e.degreesToRadians(v)),t.translate(-n.getWidth()*n.getWidthRatio(i),-n.getHeight()*n.getHeightRatio(i))):(g=n.getBoundingBox().getWidth()*n.getHeightRatio(i),t.rotate(-e.degreesToRadians(v)),t.translate(-n.getHeight()*n.getHeightRatio(i),0));var p=n.getWrappedText();p.length&&!n.wrappedTextIsStale||(p=n.wrapTextString(t,o,i));for(var h=0;h<p.length&&!(d>g&&h>0);h++)t.fillText(p[h],u,d),d+=l;t.restore()},r.prototype.ellipsePrimitive=function(e,t,a){var n=t.getBoundingBox();a=a||virtualViewer.getActivePaneState();var o=n.getX1()*t.getWidthRatio(a),i=n.getY1()*t.getHeightRatio(a),r=n.getX2()*t.getWidthRatio(a),s=n.getY2()*t.getHeightRatio(a),l=4*((Math.sqrt(2)-1)/3),u=(r-o)/2,d=(s-i)/2,c=o+u,g=i+d;e.save(),e.beginPath(),e.moveTo(c,g-d),e.bezierCurveTo(c+l*u,g-d,c+u,g-l*d,c+u,g),e.bezierCurveTo(c+u,g+l*d,c+l*u,g+d,c,g+d),e.bezierCurveTo(c-l*u,g+d,c-u,g+l*d,c-u,g),e.bezierCurveTo(c-u,g-l*d,c-l*u,g-d,c,g-d),t.getFillColor()&&(e.strokeStyle=t.getFillColor(),t.isIDM&&(e.globalAlpha=.5),e.fill()),e.closePath(),e.stroke(),e.restore()},r.prototype.linePrimitive=function(t,o,i,r,s){s=s||virtualViewer.getActivePaneState();var l=o.getFillColor(),u=o.getPointArray();if(u){t.beginPath(),t.moveTo(u[0].getX()*o.getWidthRatio(s),u[0].getY()*o.getHeightRatio(s));for(var d=1;d<u.length;d+=1)t.lineTo(u[d].getX()*o.getWidthRatio(s),u[d].getY()*o.getHeightRatio(s));if(l&&(t.strokeStyle=l,t.fill()),r&&o.getPreview()!==!0&&t.closePath(),t.stroke(),o.getPreview()===!0&&o.getType()===n.annotationTypes.SANN_POLYGON){t.fillStyle=a.polygonNubFillColor||"rgba(0, 0, 255, .40)";var c=e.getNubSize();t.fillRect(u[0].getX()-c/2,u[0].getY()-c/2,c,c)}}if(i===!0){var g=u[0].getX()*o.getWidthRatio(s),v=u[0].getY()*o.getHeightRatio(s),p=u[1].getX()*o.getWidthRatio(s),h=u[1].getY()*o.getHeightRatio(s),m=this.lineAngle(g,v,p,h),f=this.lineLength(g,v,p,h),y=.11*f;y<8&&(y=8),y>25&&(y=25);var b=30;t.save(),t.moveTo(p,h),t.translate(p,h),t.rotate(m),t.rotate(e.degreesToRadians(b)),t.moveTo(0,y),t.lineTo(0,0),t.moveTo(p,h),t.rotate(e.degreesToRadians(2*b*-1)),t.moveTo(0,y),t.lineTo(0,0),t.stroke(),t.restore()}},r.prototype.bitmapPrimitive=function(e,t,n){if(t.bitmapData){var o=new Image;if(t.bitmapImage)this.paintBitmapStamp(e,t,t.bitmapImage,n);else{var r=this,s=n.getDocumentId(),l=n.currentPaneIndex;$(o).on("load",function(){if(t.bitmapImage=this,t.bitmapImage.vvDeadEnd=!0,a.enableSingleClickImageRubberStamp){var e=i.getStateForDocumentId(s,l);r.paintBitmapStamp(null,t,this,e)}});var u=t.bitmapData;u&&!u.includes("data:image/png;base64")&&(u="data:image/png;base64,"+t.bitmapData),o.src=u,$(o).ready(function(){if(!a.enableSingleClickImageRubberStamp){var n=i.getStateForDocumentId(s,l);r.rotateContextForAnnotation(e.canvas,e,t,n),r.paintBitmapStamp(e,t,o,n)}})}}},r.prototype.paintBitmapStamp=function(e,t,a,n){var o=t.getBoundingBox(),i=o.getX1()*t.getWidthRatio(n),r=o.getY1()*t.getHeightRatio(n),s=o.getWidth()*t.getWidthRatio(n),l=o.getHeight()*t.getHeightRatio(n),u=!e;if(u){var d=$(".vvOuter").eq(n.currentPaneIndex),c=d.find(".vvCanvas");e=c[0].getContext("2d"),e.save(),n.currentPaneIndex>0?this.rotateContextForAnnotation(c,e,t,n,$("#vvSplit1Panel"),$("#vvSplitScroller")):this.rotateContextForAnnotation(c,e,t,n,null,null)}e.drawImage(a,i,r,s,l),u&&e.restore()},r.prototype.lineLength=function(e,t,a,n){return Math.sqrt(Math.pow(a-e,2)+Math.pow(n-t,2))},r.prototype.lineSlope=function(e,t,a,n){return(n-t)/(a-e)},r.prototype.lineAngle=function(t,a,n,o){var i=t,r=a,s=t,l=o,u=this.lineSlope(t,a,n,o),d=(n-t)*(s-i)+(o-a)*(l-r),c=Math.sqrt(Math.pow(n-t,2)+Math.pow(o-a,2)),g=Math.sqrt(Math.pow(s-i,2)+Math.pow(l-r,2)),v=Math.acos(d/(c*g));return v=isNaN(v)===!0?90:e.radiansToDegrees(v),u>0&&(v=90-v),n>t?u>0&&(v+=90):n===t?v=u<0?0:180:v+=u>0?270:180,e.degreesToRadians(v)},r.getInstance=function(){return null==s&&(s=new r),s},r.getInstance()}),define("vvSearch",["user-config/config"],function(e){function t(){this.documentId="",this.searchCursor={page:0,match:0},this.performOCR=!1,this.searchTerm="",this.pattern="",this.patternIndex=-1,this.inProgress=!1,this.firstPageToSearch=null,this.lastPageToSearch=null,this.firstResultPage=null,this.lastResultPage=null,this.firstPageOfCurrentBatch=0,this.searchCancelled=!1,this.searchAnnotationResults=[],this.searchDocumentResults=[],this.caseSensitive=!!e.searchCaseSensitive,this.exactMatch=!1,this.matchRedactions=[],this.annotationSearch=!1}return t.prototype.clearResults=function(){this.firstResultPage=null,this.lastResultPage=null,this.firstPageOfCurrentBatch=0,this.searchCancelled=!1,this.searchAnnotationResults=[],this.searchDocumentResults=[]},t.prototype.getCurrentMatch=function(){var e=this.getPageResults(this.searchCursor.page);if(!e||!e.matches||!e.matches.length)return null;var t=e.matches;return this.searchCursor.match>t.length||this.searchCursor.match<0?null:t[this.searchCursor.match]},t.prototype.getResults=function(){return this.searchAnnotationResults.length&&this.annotationSearch?this.searchAnnotationResults:this.searchDocumentResults||[]},t.prototype.getMatchedPages=function(){for(var e=this.getResults(),t=[],a=0;a<e.length;a++)e[a]&&e[a].matches&&e[a].matches.length&&t.push(a);return t},t.prototype.getPageResults=function(e){if("number"!=typeof e||e<0)return null;var t=this.getResults();return t[e]||{matches:[]}},t.prototype.noResultsFound=function(){if(!this.searchTerm&&!this.pattern)return!1;var e=this.getPageResults(this.firstResultPage);return!e||!e.matches.length},t.prototype.addAnnotationSearchResultToPage=function(e,t){e&&"number"==typeof t&&(this.searchAnnotationResults[t]=this.searchAnnotationResults[t]||{matches:[]},this.searchAnnotationResults[t].matches.push(e),this.updateFirstOrLastSearchPage(t))},t.prototype.addDocumentSearchResults=function(e,t){var a=[];if(!e)return a;t=t||0;for(var n=0;n<e.length;n++)if(e[n]&&e[n].matches&&e[n].matches.length&&!(e[n].pageNumber<0)){var o=e[n].pageNumber+t;e[n].pageNumber=o,a.push(o),this.searchDocumentResults[o]=e[n],this.updateFirstOrLastSearchPage(o)}return a},t.prototype.updateFirstOrLastSearchPage=function(e){this.firstResultPage||0===this.firstResultPage||(this.firstResultPage=e),this.lastResultPage||0===this.lastResultPage||(this.lastResultPage=e),e<this.firstResultPage&&(this.firstResultPage=e),e>this.lastResultPage&&(this.lastResultPage=e)},t}),define("vvPrintManager",["vvUtility","vvWatermarks","user-config/config","vvDefines","vvStateManager","vvCallbackManager"],function(e,t,a,n,o,i){var r=function(){var r=function(a){p(),$("#vvPrintIndicator").modal("hide"),a||(a={});var r=o.getActivePaneState(),l={};if(a.documentId){var u=o.getStateForDocumentId(a.documentId);if(!u){var d=e.getLocalizedValue("errors.printDocumentMustBeOpened","The document you asked to print is not open in VirtualViewer."),c={client:!0,disable:virtualViewer.disableErrorModals.print};return void virtualViewer.displayExceptionMessage(d,c)}r=u,l.state=r}t.saveWatermarks(r);var g=r.getDocumentModel();l.state=r,l.model=g,a.includeAnnotations?(l.includeTextAnnotations=!0,l.includeNonTextAnnotations=!0):(l.includeTextAnnotations=!1,l.includeNonTextAnnotations=!1),l.includeRedactions=a.includeRedactions,l.includeRedactionTags=a.includeRedactionTags,l.includeWatermarks=a.includeWatermarks,l.includeDocumentNotes=a.includeDocumentNotes,null!==a.pageRangeType&&void 0!==a.pageRangeType&&(l.pageRangeType=a.pageRangeType),null!==a.pageRangeValue&&void 0!==a.pageRangeValue&&(l.pageRangeValue=a.pageRangeValue),"current"===l.pageRangeType&&(l.pageRangeValue=r.getPageNumber());var v=e.normalizePageRangeInput(l.pageRangeType,l.pageRangeValue,r);if(i.call("printDocumentBegin",{documentId:l.state.getDocumentId(),includeAnnnotations:a.includeAnnotations,includeRedactions:l.includeRedactions,includeRedactionTags:l.includeRedactionTags,includeWatermarks:l.includeWatermarks,includeDocumentNotes:l.includeDocumentNotes,pageRangeType:l.pageRangeType,pageRangeValue:l.pageRangeValue,clientInstanceId:virtualViewer.getClientInstanceId()}),"Explorer"===BrowserDetect.browser&&v.length>n.printIE11PageLimit){var h="Due to limitations of Internet Explorer, printing of more than %n pages at a time is unsupported.  Please split your print task up into sets of %n or fewer pages.",m=e.getLocalizedValue("errors.printTooManyPagesForIE",h);return m=m.replace(/%n/g,n.printIE11PageLimit),alert(m),void i.call("printDocumentError",{documentId:l.state.getDocumentId(),exceptionMessage:m})}if("Firefox"===BrowserDetect.browser&&v.length>n.printFirefoxPageLimit){var f="Due to limitations of Firefox, printing of more than %n pages at a time is unsupported.  Please split your print task up into sets of %n or fewer pages.",y=e.getLocalizedValue("errors.printTooManyPagesForFirefox",f);return y=y.replace(/%n/g,n.printFirefoxPageLimit),alert(y),void i.call("printDocumentError",{documentId:l.state.getDocumentId(),exceptionMessage:y})}return s(l)},s=function(e){var t=e.state;return l(t,e),A(t,e.pageRangeValue),"Printed Via Local Printing"},l=function(e,t){var n=$("<iframe></iframe>").appendTo("#virtualViewerMain").addClass("vvPrintFrame");n.off("load"),n.attr("src","about:blank"),n.addClass("onScreen");var o=new URI(a.servletPath);o.addQuery("action","newExport"),o.addQuery("format","pdf"),o.addQuery("includeTextAnnotations",t.includeTextAnnotations),o.addQuery("includeNonTextAnnotations",t.includeNonTextAnnotations),o.addQuery("includeRedactions",t.includeRedactions),o.addQuery("includeRedactionTags",t.includeRedactionTags),o.addQuery("includeWatermarks",t.includeWatermarks),o.addQuery("includeDocumentNotes",t.includeDocumentNotes),o.addQuery("pageRangeType",t.pageRangeType),o.addQuery("pageRangeValue",t.pageRangeValue),o.addQuery("annotations",JSON.stringify(t.state.getAnnotationLayers(!0,!1,!1,t.includeRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,t.includeNonTextAnnotations))),o.addQuery("modelJSON",JSON.stringify(t.model.model)),o.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),o.addQuery("asAttachment",!1),o.addQuery("pageCount",t.state.getPageCount()),virtualViewer.getOverlayPath()||o.addQuery("overlayPath",virtualViewer.getOverlayPath());var i=o.query();o.query(""),$("#vvNewPrintDialog").modal("hide"),$("#vvPrintIndicator").modal("show"),y()&&!f(e)?u(o,i,n,e.getDocumentId()):d(o,i,m(e),n,e.getDocumentId())},u=function(t,a,n,o){h(t,a,function(t){n.on("load",function(e){this.contentWindow.print(),v(-1,o,n)}),n.on("error",function(){g(o,e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."))}),n.attr("src",t)},function(e){g(o,e)})},d=function(t,a,n,o,i){o.on("load",function(e){h(t,a,function(e){o[0].contentWindow.renderPDF(e,"#vvPDFJSCanvasHolder",n,c,function(e){v(e,i,o)},function(e){g(i,e)})},function(e){g(i,e)})}),o.on("error",function(t){var a=e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."),n={client:!0,disable:virtualViewer.disableErrorModals.print,e:t};virtualViewer.displayExceptionMessage(a,n),g(i,e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."))}),o.attr("src","resources/print.html")},c=function(e,t){},g=function(t,a){i.call("printDocumentError",{documentId:t,exceptionMessage:a||e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing.")})},v=function(e,t,a){$("#vvPrintIndicator").modal("hide"),setTimeout(function(){a.removeClass("onScreen")},1e4),i.call("printDocument",{totalPagesPrinted:e,documentId:t})},p=function(){var e=$(".vvPrintFrame").not(".onScreen");setTimeout(function(){for(var t=0;t<e.length;t++)$(e[t]).remove()},3e3)},h=function(t,a,n,o){var i=new XMLHttpRequest,r=t.toString();i.open("POST",r,!0),i.responseType="blob",i.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){if(4===i.readyState){if(500===i.status)return virtualViewer.handle500Status(i.response),void o(e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."));if(200===i.status){var t=URL.createObjectURL(i.response);n(t)}}},i.send(a)},m=function(e){var t=e.getImageManager();if(!t||!t.overlayImage)return null;var a=t.overlayImage;return t.stripWhite(a),{overlayImage:a,lockedOverlayOffset:t.pageLockOverlayOffset,overlayData:t.overlayDataArray}},f=function(e){var t=e.getImageManager();return!(!t||!t.overlayImage)},y=function(){if(a.disableDirectPDFPrinting)return!1;if("Explorer"!==BrowserDetect.browser)return P("Adobe Acrobat")||P("Chrome PDF Viewer")||P("WebKit built-in PDF");if(BrowserDetect.version<11)return b("AcroPDF.PDF")||b("PDF.PdfCtrl");for(var e=0;e<navigator.plugins.length;e++){var t=navigator.plugins[e];if(t.name.toLowerCase().indexOf("pdf")!==-1)return!0}},b=function(e){try{var t=new ActiveXObject(e);return t}catch(e){}},P=function(e){for(var t=0;t<navigator.plugins.length;t++){var a=navigator.plugins[t];if(a.name===e)return a}},A=function(e,t){virtualViewer.event(e,"VALUE_EVENT_PRINT",{KEY_EVENT_PRINT_PAGE_NUMBERS:t})};return{printDocument:r}}();return r}),define("vvDialogs",["vvUtility","vvWatermarks","vvPrintManager","user-config/config","vvStateManager"],function(e,t,a,n,o){var i=function(){"use strict";var a,n=function(e){return{dialogName:e,bodyTemplate:"#"+e+"BodyTemplate",documentName:{},pages:{},format:{},annotations:{},redactions:{}}},i=function(){a=$.templates("#confirmCancelDialogTemplate");var e=null;$("body").on("show.bs.modal",function(t){e=document.activeElement,$(t.target).removeAttr("aria-hidden")}).on("hide.bs.modal",function(t){$(t.target).attr("aria-hidden","true"),$(e).focus(),e=null})},v=function(e,t,o){var i=n(e);$.extend(i,t.defaultOptions,o);var s=$(a.render(i));s.appendTo("body"),t.setup(s),s.modal("show"),"#savePreferencesFooterTemplate"===i.footerTemplate&&(s.find(".preference-button").click(function(){r.saveDialogOptions(s),s.find(".preference-button").hide(),s.find(".preference-saved-button").show()}),s.on("change",function(){var e=s.find(".preference-button"),t=s.find(".preference-saved-button");"none"===e.css("display")&&(e.show(),t.hide())}));var l=s.find("input[name=pageRangeType]");return l.length>0&&i.pages.pageRangeValue&&(l[0].checked=!1,l[2].checked=!1,l[1].checked=!0),s.find(".confirm-button").click(function(){t.confirm(s)&&s.modal("hide")}),s.find(".cancel-button").click(function(){t.cancel&&t.cancel()}),s.on("hidden.bs.modal",function(){s.remove()}),s},p=function(e,t,a){a=a||{},a.footerTemplate="#confirmRefuseCancelDialogFooterTemplate";var n=v(e,t,a);n.find(".refuse-button").click(function(){t.refuse&&(t.refuse(),n.modal("hide"))})},h=function(e){var t={setup:function(){},confirm:function(){return e(),!0}};v("permanentChangeDialog",t)},m=function(e,t){var a={setup:function(){},confirm:function(){return e(),!0},cancel:t};v("ocrDialog",a)},f=function(e,t,a){var n={setup:function(){},confirm:function(){return e(),!0},refuse:t,cancel:a};p("ocrDialogForVirtualDocumentSearch",n)},y=function(e){e.footerTemplate="#savePreferencesFooterTemplate",v("saveAsDialog",s,e)},b=function(t,a,n){var o={useCut:a,documentName:{documentName:t},pages:{allPagesDisabled:a,pageRangeValue:e.createComplexPageString(n)}};v("copyToNewDialog",l,o)},P=function(t){var a={pages:{pageRangeValue:e.createComplexPageString(t)},footerTemplate:"#savePreferencesFooterTemplate"};v("exportDialog",u,a)},A=function(e){e.footerTemplate="#savePreferencesFooterTemplate",v("emailDialog",d,e)},T=function(t){var a={pages:{pageRangeValue:e.createComplexPageString(t)},footerTemplate:"#savePreferencesFooterTemplate"};v("printDialog",c,a)},S=function(e){var a=o.getActivePaneState(),n=t.getWatermarksArray(a);e=$.extend({},e,{existingWatermarks:n}),v("watermarksDialog",g,e)},I=function(e,t,a,n){var o={setup:function(){},confirm:function(){return e(),!0},refuse:t};p("confirmChangesDialog",o,{documentName:a,overwrite:n})},w=function(e,t){var a=e.find(".vvDialogErrorBanner");return t?(a.show(),void a.text(t)):(a.empty(),void a.hide())};return{init:i,permanentChangeDialog:h,ocrDialog:m,ocrDialogForVirtualDocumentSearch:f,saveAsDialog:y,copyToNewDialog:b,exportDialog:P,emailDialog:A,printDialog:T,watermarksDialog:S,confirmChangesDialog:I,toggleErrorBanner:w}}(),r=function(){"use strict";var e=function(e){var t="Original"===e.find("input[name=format]:checked").val();t&&e.find("input[name=pageRangeType][value=all]").prop("checked",!0),e.find("input[name=pageRangeType][value=complex]").prop("disabled",t),e.find("input[name=pageRangeType][value=current]").prop("disabled",t),e.find("input[name=pageRangeValue]").prop("disabled",t),e.find("input[name=includeDocumentNotes]").prop("disabled",t)},t=function(e){var t,a=o.getActivePaneState();e.find("input[name=includeRedactions]").is(":checked");e.find("input[name=includeAnnotations][burn=true]").is(":checked")||e.find("input[name=includeRedactions]").is(":checked")||e.find("input[name=includeWatermarks][burn=true]").is(":checked")||a.isVirtualDocument()?(t=e.find("input[name=format][value=Original]"),t.prop("disabled",!0),t.closest("label").addClass("vvDialogDisabledText"),t.is(":checked")&&e.find("input[name=format]:first").prop("checked",!0)):(t=e.find("input[name=format][value=Original]"),t.prop("disabled",!1),t.closest("label").removeClass("vvDialogDisabledText"))},a=function(e){e.find("input[name=documentName]").keypress(function(e){13===e.which&&e.preventDefault()}),e.find("input[name=format]").change(function(){if("Original"!==this.value){var t=o.getActivePaneState(),a=t.getDocumentId(),n=t.getDisplayName(),i="PDF"===this.value?"pdf":"tif",r=virtualViewer.getSaveAsDocumentNameGenerator(),s=r(a,n,i);e.find("input[name=documentName]").val(s)}})},i=function(e){e.find("input[name=pageRangeValue]").keypress(function(t){e.find("input[name='pageRangeType'][value='complex']").prop("checked",!0),13===t.which&&t.preventDefault()})},r=function(t){t.find("input[name=format]").change(function(){e(t)})},s=function(a){a.find("input[name=includeAnnotations]").change(function(){t(a),e(a)})},l=function(a){a.find("input[name=includeRedactions]").change(function(){t(a),e(a);var n=$(this).is(":checked"),o=a.find("input[name=includeRedactionTags]");o.prop("disabled",!n),o.closest("label").toggleClass("vvDialogDisabledText",!n)})},u=function(e,t){var a=function(a){a||(a={allPages:!0,pageRanges:!1,currentPage:!1,fileTypePDF:!0,fileTypeTIFF:!1,fileTypeOriginal:!1,burnAnnotations:n.burnAnnotations,includeRedactions:n.includeRedactions,includeRedactionTags:n.includeRedactionTags,includeDocumentNotes:n.includeDocumentNotes,includeWatermarks:n.includeWatermarks});var o=e.find("input[name=pageRangeType]");o.length>0&&(a.allPages||a.pageRanges||a.currentPage?o[1].checked||(o[0].checked=a.allPages,o[1].checked=a.pageRanges,o[2].checked=a.currentPage):o[0].checked=!0);var i=null;if("SaveAs"===t){var r=a.burnAnnotations,s=a.includeDocumentNotes||!1,l=a.includeRedactions,u=a.includeWatermarks;r?((s||l||u)&&(i=!1),s||l||u||(i=!0)):((s||l||u)&&(i=!1),s||l||u||(i=!0))}else i=!(a.burnAnnotations||a.includeDocumentNotes||a.includeRedactions||a.includeWatermarks);var d=e.find("input[value=Original]");if(i&&(d.prop("disabled",!1),d.closest("label").removeClass("vvDialogDisabledText")),a.fileTypeOriginal&&(0===d.length||d.prop("disabled"))?e.find("input[value=PDF]").prop("checked",!0):(e.find("input[value=PDF]").prop("checked",a.fileTypePDF),e.find("input[value=TIFF]").prop("checked",a.fileTypeTIFF),e.find("input[value=Original]").prop("checked",a.fileTypeOriginal)),e.find("input[name=includeAnnotations]").prop("checked",a.burnAnnotations!==!1),e.find("input[name=includeRedactions]").prop("checked",a.includeRedactions!==!1),e.find("input[name=includeRedactionTags]").prop("checked",a.includeRedactionTags!==!1),e.find("input[name=includeDocumentNotes]").prop("checked",a.includeDocumentNotes!==!1),e.find("input[name=includeWatermarks]").prop("checked",a.includeWatermarks!==!1),a.includeRedactions===!1){var c=e.find("input[name=includeRedactionTags]");c.addClass("vvDialogDisabledText"),c.prop("disabled",!0)}},o=function(){a(null)},i=localforage.getItem("dialogTemplateOptions");i.then(a,o)},d=function(e){var t,a,n,o=e.find("input[name=pageRangeType]");o.length>0&&(t=o[0].checked,a=o[1].checked,n=o[2].checked),t||a||n||(t=!0,a=!1,n=!1);var i=e.find("input[value=PDF]").prop("checked"),r=e.find("input[value=TIFF]").prop("checked"),s=e.find("input[value=Original]").prop("checked"),l=e.find("input[name=includeAnnotations]").prop("checked"),u=e.find("input[name=includeRedactions]").prop("checked"),d=e.find("input[name=includeRedactionTags]").prop("checked"),c=e.find("input[name=includeDocumentNotes]").prop("checked"),g=e.find("input[name=includeWatermarks]").prop("checked"),v={allPages:t,pageRanges:a,currentPage:n,burnAnnotations:l,includeRedactions:u,includeRedactionTags:d,includeDocumentNotes:c,includeWatermarks:g,fileTypePDF:i,fileTypeTIFF:r,fileTypeOriginal:s};localforage.setItem("dialogTemplateOptions",v)},c=function(a){a.find("input[name=includeWatermarks]").change(function(){t(a),e(a)})},g=function(e){e.find("input").keypress(function(e){13===e.which&&e.preventDefault()})};return{setupDocumentNameTemplate:a,setupPagesTemplate:i,setupFormatTemplate:r,setupAnnotationsTemplate:s,setupRedactionsTemplate:l,setupDisableRadioEnter:g,setupWatermarksTemplate:c,loadDialogOptions:u,saveDialogOptions:d}}(),s=function(){"use strict";var t={format:{includeOriginalOption:!0}},a=function(e){r.setupDocumentNameTemplate(e),r.setupPagesTemplate(e),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.loadDialogOptions(e,"SaveAs"),r.setupWatermarksTemplate(e);var t=o.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount()),e.find("input[name=includeAnnotations]").attr("burn","false"),e.find("input[name=includeWatermarks]").attr("burn","false")},n=function(t){var a=e.getFormData(t.find("form")),n=o.getActivePaneState(),r=n.getDocumentId(),s=$.trim(a.documentName);if(!s)return i.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.noDocumentName","Please enter a new document name.")),$("#vvDocumentName").addClass("has-error"),$("#vvDocumentName").focus(),$("#vvDocumentName").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;if(s.includes("%"))return i.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.invalidDocumentName","Please enter a valid document name.")),
$("#vvDocumentName").addClass("has-error"),$("#vvDocumentName").focus(),$("#vvDocumentName").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;var l=a.pageRangeType,u="undefined";"complex"===l?u=a.pageRangeValue:"current"===l&&(u=n.getPageNumber());var d=e.validatePageRangeInput(l,u,n);return"OK"!==d?(i.toggleErrorBanner(t,d),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1):(i.toggleErrorBanner(t),virtualViewer.saveDocument(r,{newDocumentId:s,newDisplayName:s,burnRedactions:a.includeRedactions,includeRedactionTags:!!a.includeRedactionTags,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:a.includeAnnotations,includeDocumentNotes:a.includeDocumentNotes,includeWatermarks:!1,saveAsFormat:a.format,pageRangeType:l,pageRangeValue:u,copyWatermarks:a.includeWatermarks}),!0)};return{defaultOptions:t,setup:a,confirm:n}}(),l=function(){"use strict";var t={format:{includeOriginalOption:!1}},a=function(e){r.setupDocumentNameTemplate(e),r.setupPagesTemplate(e),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e);var t=o.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount())},n=function(t){var a=e.getFormData(t.find("form")),n=o.getActivePaneState(),r=n.getDocumentId(),s=$.trim(a.documentName);if(!s)return i.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.noDocumentName","Please enter a new document name.")),$("#vvDocumentName").addClass("has-error"),$("#vvDocumentName").focus(),$("#vvDocumentName").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;var l=a.pageRangeType,u="undefined",d=null;if("complex"===l){if(u=a.pageRangeValue,d=e.normalizePageRangeInput(l,u,n),a.useCut&&d.length>=n.getPageCount())return i.toggleErrorBanner(t,e.getLocalizedValue("errors.onePageLimit")),!1;i.toggleErrorBanner(t)}else"current"===l&&(u=n.getPageNumber(),d=[u]);var c=e.validatePageRangeInput(l,u,n);return"OK"!==c?(i.toggleErrorBanner(t,c),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1):(i.toggleErrorBanner(t),virtualViewer.saveDocument(r,{newDocumentId:s,newDisplayName:s,burnRedactions:a.includeRedactions,includeRedactionTags:a.includeRedactionTags,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:a.includeAnnotations,includeDocumentNotes:!1,includeWatermarks:!1,saveAsFormat:a.format,pageRangeType:l,pageRangeValue:u,copyWatermarks:a.includeWatermarks,useCut:a.useCut,pageNums:d,createNew:!0}),!0)};return{defaultOptions:t,setup:a,confirm:n}}(),u=function(){"use strict";var t={format:{includeOriginalOption:!0}},a=function(e){r.setupPagesTemplate(e),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupWatermarksTemplate(e),r.loadDialogOptions(e);var t=o.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount())},n=function(t){var a=e.getFormData(t.find("form")),n=e.validatePageRangeInput(a.pageRangeType,a.pageRangeValue,o.getActivePaneState());if("OK"!==n)return i.toggleErrorBanner(t,n),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;i.toggleErrorBanner(t);var r=s(a);return r&&l(a.format),r},s=function(e){var t=o.getActivePaneState(),a=e.format,n=t.getDocFormat();"PDF"===a?n="pdf":"TIFF"===a&&(n="tif");var i=e.pageRangeType,r="undefined";return"complex"===i?r=e.pageRangeValue:"current"===i&&(r=t.getPageNumber()),virtualViewer.exportDocument({exportFormat:a,fileExtension:n,includeTextAnnotations:e.includeAnnotations,includeNonTextAnnotations:e.includeAnnotations,burnRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeDocumentNotes:e.includeDocumentNotes,includeWatermarks:e.includeWatermarks,pageRangeType:i,pageRangeValue:r})},l=function(e){virtualViewer.event(o.getActivePaneState(),"VALUE_EVENT_EXPORT",{KEY_EVENT_EXPORT_FORMAT_NAME:e})};return{defaultOptions:t,setup:a,confirm:n}}(),d=function(){"use strict";var t={format:{includeOriginalOption:!0}},a=function(t){var a=function(t,a){var n=$(t).val();if(!n)return!a||($(t).addClass("has-error"),!1);for(var o=n.split(","),i=0;i<o.length;i++)if(!e.isValidEmailAddress(o[i].trim()))return $(t).addClass("has-error"),!1;return $(t).removeClass("has-error"),!0};return!!a(t.find("input[name=fromAddress]"),!0)&&(!!a(t.find("input[name=toAddresses]"),!0)&&(!!a(t.find("input[name=ccAddresses]"))&&!!a(t.find("input[name=ccAddresses]"))))},n=function(e){e?$("#vvEmailIndicator").modal("show"):$("#vvEmailIndicator").modal("hide")},o=function(e){r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupWatermarksTemplate(e),r.loadDialogOptions(e),e.find(".vvEmailAddressEntry").on("input",function(t){var n=a(e);e.find(".confirm-button").prop("disabled",!n)}),a(e)||e.find(".confirm-button").prop("disabled",!0)},i=function(t){if(!a(t))return!1;var o=e.getFormData(t.find("form"));return t.modal("hide"),n(!0),window.setTimeout(function(){var e=s(o);e&&(n(!1),l())},200),!0},s=function(e){var t={format:e.format,includeTextAnnotations:e.includeAnnotations,includeNonTextAnnotations:e.includeAnnotations,burnRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeDocumentNotes:e.includeDocumentNotes,includeWatermarks:e.includeWatermarks,pageRangeType:"all",fromAddress:e.fromAddress||"",toAddresses:e.toAddresses||"",ccAddresses:e.ccAddresses||"",bccAddresses:e.bccAddresses||"",subject:e.subject||"",emailBody:e.message||""};return virtualViewer.emailDocument(t)},l=function(){virtualViewer.event(null,"VALUE_EVENT_EMAIL",null)};return{defaultOptions:t,setup:o,confirm:i}}(),c=function(){"use strict";var t={},s=function(e){r.setupPagesTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.loadDialogOptions(e);var t=o.getActivePaneState(),a=e.find("input[name=pageRangeValue]");t&&!a.val()&&e.find("input[name=pageRangeValue]").val("1 - "+t.getPageCount()),e.find("input[name=includeAnnotations]").prop("checked",n.printBurnAnnotations!==!1)},l=function(t){var a=e.getFormData(t.find("form")),r=e.validatePageRangeInput(a.pageRangeType,a.pageRangeValue,o.getActivePaneState());return"OK"!==r?(i.toggleErrorBanner(t,r),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1):(i.toggleErrorBanner(t),n.printBurnAnnotations=a.includeAnnotations,u(a))},u=function(e){var t=o.getActivePaneState(),n=e.pageRangeType,i="undefined";"complex"===n?i=e.pageRangeValue:"current"===n&&(i=t.getPageNumber());var r={includeAnnotations:e.includeAnnotations,includeRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeWatermarks:e.includeWatermarks,includeDocumentNotes:e.includeDocumentNotes,pageRangeType:n,pageRangeValue:i};return a.printDocument(r)};return{defaultOptions:t,setup:s,confirm:l}}(),g=function(){"use strict";var a,s={horizontalTop:{verticalPosition:t.verticalPositionOptions.TOP,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-top",allowStretchPercent:!0},horizontalBottom:{verticalPosition:t.verticalPositionOptions.BOTTOM,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-bottom",allowStretchPercent:!0},horizontalCenter:{verticalPosition:t.verticalPositionOptions.CENTER,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-center",allowStretchPercent:!0},diagonalTop:{verticalPosition:t.verticalPositionOptions.TOP,textDirection:t.textDirectionOptions.DIAGONAL,imageClass:"diagonal-top",allowStretchPercent:!1},diagonalBottom:{verticalPosition:t.verticalPositionOptions.BOTTOM,textDirection:t.textDirectionOptions.DIAGONAL,imageClass:"diagonal-bottom",allowStretchPercent:!1}},l=s.horizontalCenter,u=null,d={pages:{includePageRangeOption:!0},position:l},c=function(e,a){e.find("input[name=verticalPosition]").val(a.verticalPosition),e.find("input[name=textDirection]").val(a.textDirection),e.find(".watermark-image").removeClass(u.imageClass).addClass(a.imageClass);var n=e.find("select[name=stretchPercent]");n.parent().toggle(a.allowStretchPercent),a.allowStretchPercent||n.find("option:first").prop("selected",!0),g(e,a.textDirection===t.textDirectionOptions.DIAGONAL),u=a},g=function(e,t){var a=e.find(".watermark-image"),n=a.parent().width(),o=!1,i=a.width();if(t){var r=53*(Math.PI/180),s=a.width()/a.height(),l=a.parent().height(),u=Math.sqrt(n*n+l*l),d=u/(2*Math.tan(r)*s+2);n=u-2*d,o=!0}var c=6;n-=2*c;var g=+e.find("select[name=stretchPercent]").val(),v=n*g/i;a.attr("style","");var p=a.css("transform");"none"===p&&(p="");var h="transform: scale("+v+") "+p;o&&(h="transform: "+p+" scale("+v+")"),a.attr("style",h)},v=function(t){var a=e.getLocalizedValue("watermarksDialog.editText."+t,t);return"[["+a+"]]"},p=function(e,t){var a=e.prop("selectionStart"),n=e.prop("selectionEnd"),o=e.val();o=o.substring(0,a)+t+o.substring(n),e.val(o),e.prop("selectionStart",a+t.length),e.prop("selectionEnd",a+t.length),e.focus().trigger("input")},h=function(e,t){var a=v(t);p(e,a)},m=function(e){for(var t=e.find(".watermarks-text-area").val(),n=0;n<a.length;n++)t=t.replace(new RegExp(RegExp.escape(v(a[n])),"g"),"@@"+a[n]+"@@");return t},f=function(e,t){var a=e.find(".watermarks-text-area");t=t.replace(/@@([A-Z]*)@@/gi,function(e,t){var a=v(t);return a}),a.val(t).trigger("input")},y=function(n){var i=n.find(".watermark-text-control-panel .btn");a=i.map(function(){return $(this).attr("data-vvwatermark")}),u=l,r.setupPagesTemplate(n),n.find(".confirm-button").prop("disabled",!0);var d=n.find(".delete-button");d.click(function(){var e=n.find("select[name=selectedWatermark]"),a=+e.val();if(a||0===a){var i=o.getActivePaneState();t.removeWatermark(i,a),virtualViewer.delayedPaintCanvases(),e.find(":selected").remove(),e.find("option").not(":first-child").each(function(e){$(this).val(e)}),e.val("createNew").change()}}),n.find("select[name=selectedWatermark]").change(function(){var a=$(this),i={},r=null;if("createNew"===a.val())i={text:"",transparency:!0,allPages:!0,stretch:!0},r=l,d.hide();else{var u=o.getActivePaneState(),g=t.getWatermarksArray(u);i=g[+a.val()],r=null,$.each(s,function(e,t){if(t.verticalPosition===i.position.vertical&&t.textDirection===i.position.direction)return r=t,!1}),d.show()}f(n,i.text),n.find("select[name=stretchPercent]").val(i.stretchPercent).trigger("input"),i.stretchPercent||n.find("select[name=stretchPercent]").find("option:first").prop("selected",!0),n.find("input[name=transparency][value="+i.transparency+"]").prop("checked",!0),i.allPages?n.find("input[name=pageRangeType][value=allPages]").prop("checked",!0):(n.find("input[name=pageRangeType][value=complex]").prop("checked",!0),n.find("input[name=pageRangeValue]").val(e.createComplexPageString(i.pages))),r&&c(n,r)});var p=n.find(".watermarks-text-area");p.highlightWithinTextarea({highlight:$.map(a,function(e){return v(e)})});var m=function(){var e=p.val().trim().length>0;n.find(".confirm-button").prop("disabled",!e)};if("Explorer"===BrowserDetect.browser)var y=setInterval(function(){jQuery.contains(document.documentElement,n[0])?m():clearInterval(y)},1e3);else p.on("input",m);n.find(".watermark-text-control-panel .btn").click(function(){var e=$(this).attr("data-vvwatermark");p.focus(),h(p,e),p.trigger("change")}),n.find(".watermark-position-button").click(function(){var e=$(this).attr("data-vvmovement"),t=s[e];return c(n,t),$(".watermark-position-button").attr("aria-pressed",null),$(this).attr("aria-pressed",!0),!1}),n.find("input[name=transparency]").change(function(){n.find(".watermark-image").toggleClass("transparent","true"===this.value)}),n.find("select[name=stretchPercent]").change(function(){g(n)}),setTimeout(function(){g(n)},300)},b=function(a){var r=o.getActivePaneState(),s=r.getDocumentModel(),l=e.getFormData(a.find("form")),u=m(a).trim(),d={vertical:+l.verticalPosition,direction:+l.textDirection},c=l.pageRangeType,g=l.pageRangeValue,v=e.validatePageRangeInput(c,g,r);if("OK"!==v)return i.toggleErrorBanner(a,v),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;i.toggleErrorBanner(a);var p=!1,h=null;"all"===c&&(p=!0),"complex"===c?h=e.parseComplexPageString(g,r.getPageCount()):"current"===c&&(h=[r.getPageNumber()]);var f={text:u,image:null,transparency:l.transparency,position:d,allPages:p,stretchPercent:+l.stretchPercent,pages:h,format:{font:"Times New Roman",color:"000000"},adminCreated:n.adminCreated},y=+l.selectedWatermark;return y||0===y?t.getWatermarksArray(r)[y]=f:t.addWatermark(r,f),s.setWatermarksModifiedSinceInit(!0,r),virtualViewer.delayedPaintCanvases(),!0};return{defaultOptions:d,setup:y,confirm:b}}();return i}),define("vvSearchManager",["vvUtility","vvDefines","vvStateManager","user-config/config","vvSearch","vvThumbs","vvDialogs"],function(e,t,a,n,o,i,r){var s=0,l=new o,u=function(){if($("#vvSearchTerm").show(),L(),p($(".vvSearchButton"),!0),$("#vvSearchTermField").prop("placeholder",e.getLocalizedValue("search.basicSearchMode.title","Basic Search")),$("#vvSearchTermFieldLabel").text(e.getLocalizedValue("search.basicSearchMode.title","Basic Search")),j(),n.searchRedactionTags)for(var t=0;t<n.annotationTags.length;t++){var o=$("<option></option>").text(n.annotationTags[t]);$("#vvAnnTagSearchSelect").append(o)}else $("#vvMainSearchButtons > div").removeClass("col-xs-12").addClass("col-xs-11 col-xs-offset-1"),$("#vvTagAllRedactions").remove();n.readOnlyAnnotationMode&&$("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch").remove(),$("#vvDocSearchStart").click(function(e){if("true"!==$(this).attr("aria-disabled")){var t=$("#vvSearchTermField").val(),n=a.getCurrentState();virtualViewer.checkRedactionsEnabled()&&n.isSearchable&&p($("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch"),!1),z(t)}}),$("#vvAnnSearchStart").click(function(e){if("true"!==$(this).attr("aria-disabled")){var t="";c()||(t=$("#vvSearchTermField").val()),p($("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch"),!0),H(t)}}),$("#vvSearchTermField").on("change",function(){if(!$(this).val()){var e=a.getCurrentState();e&&!e.cacheSearchResults&&(C(),h())}}),$("#vvSearchTermField").on("keyup",function(e){if("true"===$(this).attr("aria-disabled"))return void e.preventDefault();var t=$(this).val();10!==e.which&&13!==e.which||(e.preventDefault(),t.length&&z(t)),t||C(),h()}),$("#vvSearchControls").on("submit",function(e){e.preventDefault()}),$("#vvSearchPrevious").click(function(){"true"!==$(this).attr("aria-disabled")&&I()}),$("#vvSearchNext").click(function(){"true"!==$(this).attr("aria-disabled")&&D()}),$("#vvSearchProgressCancel").click(function(){x()}),$("#vvSearchRedactAllMatches").click(function(){"true"!==$(this).attr("aria-disabled")&&A()}),$("#vvSearchRedactCurrentMatch").click(function(){"true"!==$(this).attr("aria-disabled")&&P()}),$("#vvTagAllRedactions").click(function(){virtualViewer.showTagAllRedactionsDialog()}),d()},d=function(){var a=e.getLocalizedValue("search.basicSearchMode.title","Basic Search");$("#vvSearchPatternOptionNone").text(a).data("pattern-index",-1).on("click",g);for(var n=$("#vvSearchPatternSelect"),o=0;o<t.searchPatterns.length;o++){var i=t.searchPatterns[o],r=$("<a></a>").text(e.getLocalizedValue(i.localizeKey,i.name)).data("pattern-index",o),s=$("<li></li>");r.on("click",g),s.append(r).appendTo(n)}},c=function(){var e=$("#vvSearchTermField"),a="number"==typeof e.data("pattern-index")?e.data("pattern-index"):-1;return a===-1?null:t.searchPatterns[a].pattern},g=function(e){var a=-1;e&&(a=$(e.target).data("pattern-index")),a===-1?l.pattern=null:l.pattern=t.searchPatterns[a].pattern,l.patternIndex=a,v(a),h()},v=function(a){var n=$("#vvSearchTermField");if(n.data("pattern-index",a),a===-1)p(n,!1),n.val("");else{p(n,!0);var o=t.searchPatterns[a];n.val(e.getLocalizedValue(o.localizeKey,o.name))}},p=function(e,t){e&&(t=!!t,e.attr("aria-disabled",t).css("opacity",t?.2:1),t?e.addClass("disabled"):e.removeClass("disabled"))},h=function(){var e=a.getCurrentState();e&&($("#vvSearchTermField").val()||l.pattern)?((virtualViewer.ocrEnabled||e.getIsSearchable())&&p($("#vvDocSearchStart"),!1),p($("#vvAnnSearchStart"),!1)):p($("#vvDocSearchStart, #vvAnnSearchStart"),!0)},m=function(e){if(e=e||a.getCurrentState()){var t=e.getPageNumber()||0,n=l.firstResultPage,o=l.lastResultPage,i=l.getPageResults(o),r=!n&&0!==n,s=!o&&0!==o;$("#vvSearchTermField").val()||p($("#vvDocSearchStart, #vvAnnSearchStart"),!0);var u=r||n>t||n===t&&0===l.searchCursor.match;p($("#vvSearchPrevious"),u);var d;d=i&&i.matches&&i.matches.length?i.matches.length-1:0,u=s||o<t||o===t&&l.searchCursor.match===d,p($("#vvSearchNext"),u),!virtualViewer.checkRedactionsEnabled()||r&&s?p($(".vvSearchRedactButton, #vvTagAllRedactions"),!0):p($(".vvSearchRedactButton"),!1),l.searchAnnotationResults.length&&p($(".vvSearchRedactButton, #vvTagAllRedactions"),!0)}},f=function(){x(),$("#vvSearchTermField").val(""),C()},y=function(e,t){if(e){var a=require("vvThumbs");x(),a.removeThumbs($("#vvSearch")),$(".vvNoSearchResults").remove(),t&&(t.cachedSearch=l),e.cachedSearch?(l=e.cachedSearch,a.fillSearchThumbs(e,l.getMatchedPages()),a.loadVisibleThumbs($("#vvSearchResults")),V(),v(l.patternIndex),l.searchTerm&&$("#vvSearchTermField").val(l.searchTerm)):(l=new o,v(-1)),m(e),h()}},b=function(e){var t=virtualViewer.getCurrentAnnObject();virtualViewer.hideAnnPopUp(),$("#vvAnnotationNotesArea").collapse("hide"),"Sticky Note"===t.type&&(t.collapsed=!1),(e.tag||e.comment)&&(virtualViewer.annPopUpHandler(null,t),e.comment&&$("#vvAnnotationNotesArea").collapse("show"))},P=function(){if(a.getCurrentState()&&l){var e=l.getCurrentMatch();e||(D(),e=l.getCurrentMatch());var t=l.searchCursor.page,n=[];e.annotation||(n=virtualViewer.redactSearchMatch(e,t)),l.matchRedactions=l.matchRedactions.concat(n)}},A=function(){var e=a.getCurrentState();if(e&&e.documentFullyLoaded()){for(var t=0;t<e.getPageCount();t++)T(t);n.searchRedactionTags&&p($("#vvTagAllRedactions"),!1)}},T=function(e){var t,a=l.getPageResults(e).matches,n=[];if(!a||!a.length)return[];for(var o=0;o<a.length;o++){var i=a[o];t=virtualViewer.redactSearchMatch(i,e),n=n.concat(t)}return l.matchRedactions=l.matchRedactions.concat(n),n},S=function(){return l.matchRedactions||[]},I=function(){var e=a.getCurrentState();if(e&&!a.isVideoOpen()){var t=e.getPageNumber(),n=t!==l.searchCursor.page,o=l.getPageResults(t);if(l.searchCursor.match--,!o||n||l.searchCursor.match<0){for(n||t--;t>=l.firstResultPage;){var i=l.getPageResults(t);if(i&&i.matches.length){virtualViewer.setPage(t),l.searchCursor.match=i.matches.length-1;break}t--}t<l.firstResultPage&&(virtualViewer.setPage(l.lastResultPage),t=l.lastResultPage)}l.searchCursor.page=t;var r=l.getCurrentMatch();r&&(r.annotation&&(virtualViewer.setCurrentAnnObject(r.annotation),b(r)),virtualViewer.delayedPaintCanvases(),m())}},w=function(){var e=a.getCurrentState();e&&!a.isVideoOpen()&&(0!==l.firstResultPage?D():virtualViewer.setPage(0,e))},D=function(){var e=a.getCurrentState();if(e&&!a.isVideoOpen()){var t=e.getPageNumber(),n=t!==l.searchCursor.page,o=l.getPageResults(t);if(l.searchCursor.match++,!o||n||l.searchCursor.match>=o.matches.length){for(l.searchCursor.match=0,n||t++;t<=l.lastResultPage;){var i=l.getPageResults(t);if(i&&i.matches.length){virtualViewer.setPage(t);break}t++}t>l.lastResultPage&&(virtualViewer.setPage(l.firstResultPage),t=l.firstResultPage)}l.searchCursor.page=t;var r=l.getCurrentMatch();r&&(r.annotation&&(virtualViewer.setCurrentAnnObject(r.annotation),b(r)),virtualViewer.delayedPaintCanvases(),m())}},C=function(){l=new o,i.removeThumbs($("#vvSearch")),$(".vvNoSearchResults").remove();var e=a.getCurrentState();e&&(e.cachedSearch=null),m(),virtualViewer.delayedPaintCanvases()},M=function(){(l.searchTerm||l.pattern)&&(l.annotationSearch||(l.clearResults(),z(l.searchTerm,l.firstPageToSearch,l.lastPageToSearch,l.performOCR)))},x=function(){l.searchCancelled=!0,l.inProgress=!1,clearTimeout(s),V()},L=function(){$("#vvSearchProgressContainer").hide(),$("#vvSearchProgress").attr("aria-valuenow",0).css("width","0%")},N=function(e,t,a){var n,o=Math.ceil(a/e),i=Math.ceil(t/e);if(o===i)n=100;else{var r=(i+1)/(o+1);n=parseInt(100*r)}$("#vvSearchProgress").attr("aria-valuenow",n).css("width",n+"%")},V=function(){$("#vvSearchTerm").show(),L(),h(),m(),l.noResultsFound()&&R()},k=function(){$("#vvSearchTerm").hide(),$("#vvSearchProgressContainer").show();var e=$("#vvSearchProgress").width();$("#vvSearchProgressText").width(e-2),$("#vvSearchProgressCancel").position({my:"right",at:"right",of:"#vvSearchProgressText"}),p($("#startSearchButtons .btn, #vvSearchRedactButtonsContainer .btn"),!0)},R=function(){$(".vvNoSearchResults").length||$("<div></div>").text(e.getLocalizedValue("search.noResults","This search found no results.")).addClass("vvNoSearchResults").appendTo($("#vvSearchResults"))},B=function(){return!(!l||l.searchCancelled)&&l.inProgress},F=function(t,n,o,i){t=t||a.getCurrentState(),o.lineWidth=2;var r=l.searchDocumentResults[i];if(r&&r.matches)for(var s=r.matches,u=0;u<s.length;u++)for(var d=s[u],c=E(u,i),g=0;g<d.rectangles.length;g+=1){var v=d.rectangles[g],p=new e.ImageRect(v.left/1e3,v.top/1e3,v.right/1e3,v.bottom/1e3);virtualViewer.highlightImageRect(p,o,c)}},E=function(e,a){var o,i=n.searchColors||{};return o=e===l.searchCursor.match&&a===l.searchCursor.page?i.selectedMatchColor||t.searchSelectedColor:i.matchColor||t.searchDefaultColor},O=function(n){var o=a.getCurrentState();if(!l.searchCancelled){var i=l.addDocumentSearchResults(n,l.firstPageOfCurrentBatch);m();var r=l.firstPageOfCurrentBatch,u=r+l.batchSize,d=o.getPageNumber();N(l.batchSize,u,l.lastPageToSearch);var c=require("vvThumbs");c.fillSearchThumbs(o,i),c.loadVisibleThumbs($("#vvSearchResults.thumbPanel")),d>=r&&d<=u&&virtualViewer.delayedPaintCanvases();var g=u;if(l.isFirstSearchResult&&e.isInteger(l.firstResultPage)&&l.firstResultPage>=0&&(w(),l.isFirstSearchResult=!1),g>=l.lastPageToSearch)return V(),void(l.inProgress=!1);g+l.batchSize>l.lastPageToSearch&&(l.batchSize=l.lastPageToSearch-g),s=setTimeout(function(e){_(l.searchTerm,g,l.batchSize)},t.searchTimeout)}},U=function(e){if(virtualViewer.checkServerException(e))V();else{if(l.performOCR){var t=a.getActivePaneState();t.setIsSearchable(!0),setTimeout(function(){for(var e=0;e<t.getPageCount();e++)virtualViewer.getAllText(e,t)},0)}O(e)}},_=function(e,o,i){var r=a.getCurrentState(),u=r.getDocumentModel().model,d=new URI(n.servletPath);d.escapeQuerySpace(!1),d.addQuery("action","searchDocument"),d.addQuery("documentId",r.getDocumentId()),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("pageCount",r.getPageCount()),d.addQuery("performOcr",l.performOCR);var c=u.pageData;u.pageData=c.slice(o,o+i),d.addQuery("modelJSON",JSON.stringify(u)),u.pageData=c,l.firstPageOfCurrentBatch=o,null!==virtualViewer.getOverlayPath()&&d.addQuery("overlayPath",virtualViewer.getOverlayPath()),t.cacheBuster===!0&&d.addQuery("cacheBuster",Math.random()),l.pattern?d.addQuery("searchPattern",l.pattern):d.addQuery("searchText",e),d.addQuery("firstPage",o),d.addQuery("lastPage",o+i),l.caseSensitive&&d.addQuery("caseSensitive","true"),l.exactMatch&&d.addQuery("exactMatch","true"),s&&clearTimeout(s),l.performOCR&&virtualViewer.displayOcrWaitIndicator(!0);var g=d.query();d.query(""),$.ajax({url:d.toString(),type:"POST",dataType:"json",data:g}).done(U).fail(function(e){virtualViewer.checkServerException(e,r.getDocumentId(),r.currentPaneIndex),console.log("Search document error")}).always(function(){virtualViewer.displayOcrWaitIndicator(!1)})},z=function(e,t,n,o){var i=a.getCurrentState();if(i&&i.documentFullyLoaded()){var s=!1;if(i.isVirtualDocument()){if(!virtualViewer.ocrEnabled||!o)return void r.ocrDialogForVirtualDocumentSearch(function(){setTimeout(function(){W(e,t,n,i,!0)},0)},function(){setTimeout(function(){W(e,t,n,i,!1)},0)});s=!0}if(i.getIsSearchable())s=!1;else{if(!virtualViewer.ocrEnabled)return;if(!o)return void r.ocrDialog(function(){setTimeout(function(){W(e,t,n,i,!0)},0)});s=!0}W(e,t,n,i,s)}},W=function(e,a,o,i,r){C(i),k(),l.isFirstSearchResult=!0,l.inProgress=!0,("number"!=typeof a||a<0)&&(a=0),("number"!=typeof o||o>i.getPageCount())&&(o=i.getPageCount());var s=n.searchBatchSize||t.searchBatchSize;s>o-a&&(s=o-a),l.batchSize=s,l.documentId=i.getDocumentId(),l.searchTerm=e,l.pattern=c(),l.firstPageToSearch=a,l.lastPageToSearch=o,"boolean"==typeof r&&(l.performOCR=r),_(e,a,s)},H=function(e){if(e||c()){var t,n=e.toUpperCase(),o=a.getActivePaneState();if(!o||a.isVideoOpen())return void p($("#vvAnnSearchStart"),!0);C(),l.searchTerm=e;var i=null;!e&&c()&&(l.pattern=c(),i=new RegExp(l.pattern)),l.annotationSearch=!0;for(var r=o.getPageCount(),s=[],u=null,d=0;d<r;d++){t=o.pageStates[d];var g=!1;for(var v in t.annotationLayers)if(v){var h=t.annotationLayers[v];if(h&&h.anns)for(var f=0;f<h.anns.length;f++){var y=!1,P={annotation:null,text:null,tag:null,comment:null},A=h.anns[f];if(!A.annDelete){if(h.visibility||(h.visibility=!0),"Sticky Note"===A.type||"Rubber Stamp"===A.type){var T=A.getTextString().toUpperCase();(i&&i.test(T)||n&&T.indexOf(n)>-1)&&(P.text=T,y=!0)}for(var S=0;S<A.noteArray.length;S++){var I=A.noteArray[S],w=I.text.toUpperCase();(i&&i.test(w)||n&&w.indexOf(n)>-1)&&(P.comment=w,y=!0)}for(var D=0;D<A.annotationTags.length;D++){var M=A.annotationTags[D].toUpperCase();(i&&i.test(M)||n&&M.indexOf(n)>-1)&&(P.tag=M,y=!0)}y&&(P.annotation=A,g=!0,l.addAnnotationSearchResultToPage(P,d))}}}g&&(s.push(d),null===u&&d>=o.getPageNumber()&&(u=d))}if(V(),s.length){var x=require("vvThumbs");x.fillSearchThumbs(o,s),x.highlightActiveThumbnail(),m(),null!==u?l.searchCursor.page=u:l.searchCursor.page=l.firstResultPage,l.searchCursor.match=0,virtualViewer.setPage(l.searchCursor.page);var L=l.getPageResults(l.searchCursor.page);virtualViewer.setCurrentAnnObject(L.matches[0].annotation),b(L.matches[0]),virtualViewer.delayedPaintCanvases(),x.loadVisibleThumbs($("#vvSearchResults"))}}},Q=function(){return l?l.getResults():[]},j=function(){$("#vvSearchTermField").attr("aria-label",e.getLocalizedValue("search.searchField.title","Search Term Field")),$("#vvDocSearchStart").attr("aria-label",e.getLocalizedValue("search.docSearch.title","Search Document")),$("#vvAnnSearchStart").attr("aria-label",e.getLocalizedValue("search.annSearch.title","Search Annotations")),$("#vvSearchDropDown").attr("aria-label",e.getLocalizedValue("search.searchDropDown.title","Search Pattern Dropdown Menu")),$("#vvSearchPatternSelect").attr("aria-label",e.getLocalizedValue("search.searchDropDown.options","Search Pattern Options")),$("#vvSearchPrevious").attr("aria-label",e.getLocalizedValue("search.previousMatch.title","Previous Match")),$("#vvSearchRedactAllMatches").attr("aria-label",e.getLocalizedValue("search.redactAllMatches.title","Redact All Matches")),$("#vvSearchRedactCurrentMatch").attr("aria-label",e.getLocalizedValue("search.redactCurrentMatch.title","Redact Current Match")),$("#vvTagAllRedactions").attr("aria-label",e.getLocalizedValue("search.tagAllRedactions.title","Tag All Redactions")),$("#vvSearchNext").attr("aria-label",e.getLocalizedValue("search.nextMatch.title","Next Match")),$("#vvSearchResults").attr("aria-label",e.getLocalizedValue("search.searchResults.title","Search Results")),$("#vvSearchPatternOptionNone").attr("aria-label",e.getLocalizedValue("search.searchPatternNone.title","There are no search patterns."))};return{prepareSearch:u,updateSearchButtons:m,handleSearchOnTabSwitch:y,handleSearchOnPageManipulation:f,searchAnnotationText:H,searchDocumentText:z,clearSearchResults:C,paintDocumentSearchResults:F,rerunCurrentSearch:M,getSearchedRedactions:S,searchInProgress:B,firstSearchResult:w,nextSearchResult:D,previousSearchResult:I,cancelCurrentSearch:x,getCurrentSearchResults:Q,addAccessibleSearchLabels:j}}),define("vvHotkeys",["user-config/config","vvDefines","vvUtility"],function(e,t,a){function n(){this.assignedShortcutHashtable={}}var o;n.prototype.initializeHotkeys=function(){var t=e.hotkeys,a=e.customHotKeys;if(t||a){var n=function(e){for(var t=0;t<e.length;t++)!function(t){i(e[t].key,function(a){return a.preventDefault(),e[t].method(),!1})}(t)};n(a),n(t)}};var i=function(e,t){if(e)for(var a=e.split(","),n=0;n<a.length;n++){var i=a[n].toLowerCase();if(o.assignedShortcutHashtable[i]===i)return void console.error(i+" has been detected as a duplicate keyboard shortcut");o.assignedShortcutHashtable[i]=i;var u=g(i),c=d(i);l(i)&&!s(i)?r(u,c,t):jQuery(document).bind(u,i,t)}},r=function(e,t,a){$(document).bind(e,function(e){e.shiftKey&&e.ctrlKey&&u(t,e.keyCode)&&a(e)})},s=function(e){var a=c(e);return!!t.specialKeys[a]},l=function(e){return 0===e.indexOf("ctrl+shift")},u=function(e,t){var a={187:61,189:173};return e===t||e===a[t]},d=function(e){var t=c(e);if("="===t)return 61;if("plusKeypad"===t)return 107;if("minusKeypad"===t)return 109;if("-"===t)return 173;var a=t.charCodeAt(0)-32;return a},c=function(e){var t=e.split("+"),a=t[t.length-1];return a},g=function(e){return"keydown"};n.prototype.initKeyboardHintsContent=function(){if(!e.hotkeys)return"";$.views.helpers({prettyPrintShortcut:p});var t=$.templates("#shortcutHintsRowTemplate"),a=e.hotkeys.slice(0,e.hotkeys.length/2);$(t.render(a)).appendTo("#vvShortcutsLeftHalf");var n=e.hotkeys.slice(e.hotkeys.length/2);$(t.render(n)).appendTo("#vvShortcutsRightHalf")};var v=function(e){var a=e,n=t.specialKeys[e];return n&&(a=n),a="<span class='keyboardkey'>"+a+"</span>"},p=function(e){if(!e)return"N/A";e=e.replace("++","+plus");for(var t=e.split(","),a=t[0],n="",o=a.split("+"),i=0;i<o.length;i++){var r=o[i];n+=v(r),i!==o.length-1&&(n+=" ")}return n=n.replace("plus","+")};return function(){return o=o||new n}()}),define("vvUserPreferences",["vvUtility","user-config/config","user-config/toolbar-config","vvWidgets","vvDefines","vvStateManager"],function(e,t,a,n,o,i){function r(){this.userPrefType={ANNOTATION:0,OPTION:1,STAMP:2,GENERAL:3,NOTE:4},this.JSONBlob=null,this.annotationPreference={userPrefType:0,type:null,localType:null,sticky:null,lineColor:null,lineWidth:null,fillColor:null,fontColor:null,fontFace:null,fontSize:null,fontBold:null,fontItalic:null,displayName:null,text:null},this.toolbarOption={userPrefType:1,annotation:null,name:null,on:!0},this.customTextStamp={userPrefType:2,displayName:null,textString:null,fontColor:null,fontFace:null,fontSize:null,fontBold:null,fontItalic:null,fontUnderline:null,fontStrike:null},this.noteTemplate={userPrefType:4,templateName:null,templateString:null},this.defaultUsername=e.getLocalizedValue("userPreferencesDialog.userNameInput","Undefined User"),this.username="",this.imageControlToolbar=[],this.annotationToolbar=[],this.annotationPropertyArray={},this.fileUploadVisible=!1,this.customStampArray=[],this.noteTemplateArray=[],this.generalPreferencesArray=[],this.zoomPreferences={mode:-1,zoomLevelIndex:-1,zoomLevel:-1},this.defaultTab=-1,this.currentAnnotationProperty=null,this.currentCustomStampIndex=null,this.numOfStamps=1,this.errorDialogTimeoutId=null,this.errorTimeoutTime=5,this.versions={zoomPreferences:3,annotationPreferences:3,imageToolbarPreferences:3,annotationToolbarPreferences:3,customTextStamps:3,noteTemplates:3},this.errorState=!1,this.dynamicUPOptionPrefix="vvUPOption",this.defaultZoomPercentIndex=0,
this.videoPreferences={autoplay:null,mute:null,controls:null,stretch:null},this.audioPreferences={autoplay:null,mute:null,controls:!0,background:null},this.dialogHasBeenOpened=!1,this.saveButtonHit=!1}var s;r.prototype.init=function(){this.readInCurrentToolbarButtons(),this.loadUserPreferences()},r.prototype.cloneAnnotationPreference=function(e){var t={userPrefType:this.userPrefType.ANNOTATION,type:e.type,localType:e.localType,sticky:e.sticky,lineColor:e.lineColor,lineWidth:e.lineWidth,fillColor:e.fillColor,fontColor:e.fontColor,fontFace:e.fontFace,fontSize:e.fontSize,bold:e.fontBold,italic:e.fontItalic};return t},r.prototype.cloneTextStamp=function(e){var t={userPrefType:this.userPrefType.STAMP,displayName:e.displayName,textString:e.textString,fontColor:e.fontColor,fontFace:e.fontFace,fontSize:e.fontSize,fontBold:e.fontBold,fontItalic:e.fontItalic};return t},r.prototype.createDefaultTextStamp=function(e){var t={userPrefType:this.userPrefType.STAMP,displayName:"Custom Stamp",textString:"Custom Stamp Text",fontColor:"000000",fontFace:"Helvetica",fontSize:18,fontBold:!1,fontItalic:!1,fontUnderline:!1,fontStrike:!1};return e&&(t.displayName=e,t.textString=e+" Text"),t},r.prototype.cloneNoteTemplate=function(e){var t={userPrefType:this.userPrefType.NOTE,templateName:e.templateName,templateString:e.templateString};return t},r.prototype.createDefaultNoteTemplate=function(e){var t={userPrefType:this.userPrefType.NOTE,templateName:"Template",templateString:"Template Text"};return e&&(t.templateName=e),t},r.prototype.cloneToolbarOption=function(e){var t={userPrefType:this.userPrefType.OPTION,annotation:e.annotation,id:e.id,name:e.name,on:e.on};return t},r.prototype.readInCurrentToolbarButtons=function(){this.imageControlToolbar=[],this.annotationToolbar=[],this.toolbarOption.name="Image Controls",this.toolbarOption.on=!0,this.toolbarOption.annotation=!1,this.toolbarOption.id="",this.imageControlToolbar.push(this.cloneToolbarOption(this.toolbarOption));var t=a(virtualViewer).imageToolbarButtons;for(var n in t)"vvFileUpload"===n&&virtualViewer.disableUploadDocument||t[n]&&(t[n].localizeKey?this.toolbarOption.name=e.getLocalizedValueObject(t[n].localizeKey,{title:"Button with ID "+n}).title:this.toolbarOption.name=t[n].name,this.toolbarOption.iconImage=t[n].iconImage,this.toolbarOption.id=n,this.toolbarOption.on=!0,this.imageControlToolbar.push(this.cloneToolbarOption(this.toolbarOption)));this.toolbarOption.name="Annotation Toolbar",this.toolbarOption.on=!0,this.toolbarOption.annotation=!0,this.toolbarOption.id="",this.annotationToolbar.push(this.cloneToolbarOption(this.toolbarOption));var o=a(virtualViewer).annotationToolbarButtons;for(var i in o)o[i]&&(o[i].localizeKey?this.toolbarOption.name=e.getLocalizedValueObject(o[i].localizeKey,{title:"Button with ID "+i}).title:this.toolbarOption.name=o[i].name,this.toolbarOption.iconImage=o[i].iconImage,this.toolbarOption.id=i,o[i].annType&&(this.toolbarOption.annotation=!0),this.toolbarOption.on=!0,this.annotationToolbar.push(this.cloneToolbarOption(this.toolbarOption)))},r.prototype.initDialog=function(){return t.disableUserPreferences?void $("#vvUserPreferencesDialog").remove():(this.prepareToolbarTab(),this.prepareAnnotationTab(),this.prepareStampsTab(),this.prepareNotesTab(),this.prepareGeneralTab(),this.prepareMediaTab(),$("#vvUserPreferencesDialog form").submit(function(e){return e.preventDefault(),!1}),$("#vvUserPreferencesDialogResetButton").click(function(){s.reset()}),$("#vvUserPreferencesDialogSaveButton").click(function(){s.saveButtonHit=!0,s.save(),$("#vvUserPreferencesDialog").modal("hide")}),void $("#userPreferencesClose").attr("title",e.getLocalizedValue("commonDialog.closeButton","Close")))},r.prototype.updateDialog=function(){this.dialogHasBeenOpened||(this.initDialog(),this.dialogHasBeenOpened=!0),this.updateToolbarConfigurations(),this.updateDialogZoomPreferences(),this.updateDialogDefaultTab(),this.updateMediaTab(),this.createCustomStampsTable(),this.createNoteTemplateTable(),this.setAnnotationProperties(),this.setUsername(this.username)},r.prototype.reset=function(){localforage.clear(),this.loadDefaults(),t.disableUserPreferences||this.updateDialog()},r.prototype.turnOnErrorState=function(t){this.errorState=!0,t=t||e.getLocalizedValue("errors.failureLoadingUserPreferences","Problem loading User Preferences. Setting User Preferences back to default values."),$("#vvUserPreferencesErrorBanner").html(t),$("#vvUserPreferencesErrorBanner").show(),$("#vvUserPreferencesDialogResetButton").prop("disabled",!0),$("#vvUserPreferencesDialogSaveButton").prop("disabled",!0)},r.prototype.turnOffErrorState=function(){this.errorState=!1,$("#vvUserPreferencesErrorBanner").hide(),$("#vvUserPreferencesDialogResetButton").prop("disabled",!1)},r.prototype.save=function(){if(!t.disableUserPreferences){var e=this.saveZoomPreferences();e=e&&this.saveUsername(),e=e&&this.saveTabPreference(),e=e&&this.saveAnnotationPreferences(),e=e&&this.saveToolbarPreferences(),e=e&&this.saveCustomStamps(),e=e&&this.saveNoteTemplates(),e=e&&this.saveMediaPreferences(),e&&this.applyUserPreferences()}},r.prototype.loadUserPreferences=function(){if(t.disableUserPreferences)return void this.loadDefaults();try{if(!localforage)return this.turnOnErrorState(),void this.loadDefaults()}catch(e){return this.turnOnErrorState(),void this.loadDefaults()}this.turnOffErrorState(),this.loadToolbarPreferences(),this.loadAnnotationPreferences(),this.loadStampPreferences(),this.loadTemplatePreferences(),this.loadZoomPreferences(),this.loadTabPreferences(),this.loadUsername(),this.loadVideoPreferences(),this.loadAudioPreferences()},r.prototype.loadTemplatePreferences=function(){var e=function(){s.turnOnErrorState(),l(null)},t=localforage.getItem("noteTemplateArray");t.then(l,e)};var l=function(e){if(e&&e.version===s.versions.noteTemplates)s.noteTemplateArray=e;else{s.noteTemplateArray=[];for(var a=0;a<t.noteTemplates.length;a++){var n=t.noteTemplates[a],o=s.cloneNoteTemplate(s.noteTemplate),i=s.createDefaultNoteTemplate();for(var r in o)r&&n.hasOwnProperty(r)&&(o[r]=n[r],"templateName"===r&&(o[r]=n.templateName),o[r]&&(i[r]=o[r]));s.noteTemplateArray.push(i)}}virtualViewer.createNoteTemplateContextMenuList()};r.prototype.loadStampPreferences=function(){var e=function(){s.turnOnErrorState(),u(null)},t=localforage.getItem("customStampArray");t.then(u,e)};var u=function(e){if(e&&e.version===s.versions.customTextStamps)s.customStampArray=e;else{s.customStampArray=[];for(var a=t.textRubberStamps||[],n=0;n<a.length;n++){var o=a[n],i=s.cloneTextStamp(s.customTextStamp),r=s.createDefaultTextStamp();for(var l in i)l&&(i[l]=o[l],"displayName"===l&&(i[l]=o.textString),i[l]&&(r[l]=i[l]));s.customStampArray.push(r)}}virtualViewer.createTextAnnContextMenuList()};r.prototype.loadUsername=function(){var e=function(){s.turnOnErrorState(),d(null)},t=localforage.getItem("username");t.then(d,e)};var d=function(e){var t=virtualViewer.getCallbackManager(),a={loadedUsername:e,previousUsername:s.username};t.call("onLoadUsername",a),e&&0!==e.length||s.setUsername(s.defaultUsername),s.username.length&&s.username!==s.defaultUsername||s.setUsername(e)};r.prototype.loadZoomPreferences=function(){var e=function(){s.turnOnErrorState(),c(null)},t=localforage.getItem("zoomPreferences");t.then(c,e)};var c=function(e){e&&e.version===s.versions.zoomPreferences?s.zoomPreferences=e:(s.zoomPreferences.mode=t.defaultZoomMode||o.zoomModes.fitWindow,s.zoomPreferences.zoomLevel=t.defaultZoomLevel||100,s.zoomPreferences.zoomLevelIndex=t.zoomLevels.indexOf(s.zoomPreferences.zoomLevel),s.zoomPreferences.zoomLevelIndex===-1&&(s.zoomPreferences.zoomLevelIndex=s.getMiddleZoomLevel(),s.zoomPreferences.zoomLevel=t.zoomLevels[s.zoomPreferences.zoomLevelIndex])),s.dialogHasBeenOpened||s.applyZoomPreferences()};r.prototype.loadTabPreferences=function(){var e=function(){s.turnOnErrorState(),g(null)},t=localforage.getItem("defaultTab");t.then(g,e)};var g=function(e){"number"!=typeof e&&(e=t.defaultThumbnailTab),s.defaultTab=e;var a=virtualViewer.getActivePaneState();a&&!a.isMedia()||(e=o.thumbnailTabs.document),virtualViewer.openDefaultThumb(e)};r.prototype.loadToolbarPreferences=function(){var e=function(){s.turnOnErrorState(),p(null)},t=localforage.getItem("imageControlToolbar");t.then(p,e);var a=function(){s.turnOnErrorState(),v(null)},n=localforage.getItem("annotationToolbar");n.then(v,a)};var v=function(e){if(e&&e.length&&e.version===s.versions.annotationToolbarPreferences)s.annotationToolbar=e;else if(s.annotationToolbar)for(var t=1;t<s.annotationToolbar.length;t++)s.annotationToolbar[t].on=!0;s.updateToolbarsGeneric(s.annotationToolbar,"vvAnnToolbar")},p=function(e){if(e&&e.length&&e.version===s.versions.imageToolbarPreferences)s.imageControlToolbar=e;else if(s.imageControlToolbar)for(var t=1;t<s.imageControlToolbar.length;t++)s.imageControlToolbar[t].on=!0;s.updateToolbarsGeneric(s.imageControlToolbar,"vvToolbar")};r.prototype.loadAnnotationPreferences=function(){var e=function(){s.turnOnErrorState(),h(null)},t=localforage.getItem("annotationPropertyArray");t.then(h,e)};var h=function(e){if(null===e||e.length<1){e={};for(var a in o.annotationTypes){if(a){var n=o.annotationTypes[a];e[n]=s.cloneAnnotationPreference(t.annotationDefaults),e[n].type=n,e[n].version=s.versions.annotationPreferences}n===o.annotationTypes.SANN_POSTIT&&a&&(e[n].fillColor=t.annotationDefaults.stickyFillColor)}e[o.annotationTypes.SANN_HIGHLIGHT_RECT]&&t.annotationDefaults.highlightFillColor&&(e[o.annotationTypes.SANN_HIGHLIGHT_RECT].fillColor=t.annotationDefaults.highlightFillColor)}s.annotationPropertyArray=e};r.prototype.applyUserPreferences=function(){virtualViewer.setActivePane(0),this.updateToolbarDisplay(),virtualViewer.createTextAnnContextMenuList(),virtualViewer.createNoteTemplateContextMenuList(),virtualViewer.openDefaultThumb(),this.applyZoomPreferences()},r.prototype.loadDefaults=function(e){this.readInCurrentToolbarButtons(),e||this.updateToolbarDisplay(),c(null,this),d(null,this),u(null,this),l(null,this),h(null,this),M(null,this),x(null,this),g(null)},r.prototype.prepareToolbarTab=function(){for(var e=1;e<this.imageControlToolbar.length;e++){var t=this.imageControlToolbar[e].name,a=this.createElmtIDWithPrefix(this.imageControlToolbar[e].id,!1),n=$("<label></label>").attr("for",a+"Check").addClass("list-group-item vvUPToolbarCheckItem");n.append($("<input>").attr({type:"checkbox",id:a+"Check"})),n.append($("<span></span>").attr("id",a).html(t)),$("#vvUPImageControl").append(n)}for(var o=1;o<this.annotationToolbar.length;o++){var i=this.annotationToolbar[o].name,r=this.createElmtIDWithPrefix(this.annotationToolbar[o].id,!1),s=$("<label></label>").attr("for",r+"Check").addClass("list-group-item vvUPToolbarCheckItem");s.append($("<input>").attr({type:"checkbox",id:r+"Check"})),s.append($("<span></span>").attr("id",r).html(i)),$("#vvUPAnnotationToolbar").append(s)}$("#ImageControlsCheck").on("change",function(){$("#vvUPImageControl .vvUPToolbarCheckItem > input").attr("disabled",!$(this).prop("checked"))}),$("#AnnotationToolbarCheck").on("change",function(){$("#vvUPAnnotationToolbar .vvUPToolbarCheckItem > input").attr("disabled",!$(this).prop("checked"))})},r.prototype.updateToolbarDisplay=function(){t.enableCrop||$("#vvCropButton").hide(),this.updateToolbarsGeneric(this.imageControlToolbar,"vvToolbar"),this.updateToolbarsGeneric(this.annotationToolbar,"vvAnnToolbar")},r.prototype.updateToolbarsGeneric=function(e,t){var a,n=!1;a="vvToolbar"===t?$("#vvToolbarItems"):$("#vvAnnToolbar, #vvAnnToolbarHamburgerItems");var o;e.length&&e[0].on?a.removeClass("vvHidden"):(n=!0,a.addClass("vvHidden"));for(var i,r=1;r<e.length;r++)o=e[r],i=$("."+o.id),i.toggle(o.on),i.toggleClass("vvPreferenceDisabled",!o.on),i.toggleClass("vvPreferenceEnabled",!!o.on),"vvFileUpload"===o.id&&(this.fileUploadVisible=o.on);n&&!e[0].on||a.show(),virtualViewer.applyToolbarButtonConfigurations()},r.prototype.updateToolbarConfigurations=function(){var e,t;if(0!==this.imageControlToolbar.length&&0!==this.annotationToolbar.length){e=this.imageControlToolbar[0],t=$("#ImageControlsCheck"),t.prop("checked",e.on),$("#vvUPImageControl .vvUPToolbarCheckItem > input").attr("disabled",!e.on);for(var a=1;a<this.imageControlToolbar.length;a++)e=this.imageControlToolbar[a],t=$("#"+this.createElmtIDWithPrefix(e.id,!0)),t.prop("checked",e.on),"vvFileUpload"===e.id&&virtualViewer.disableUploadDocument&&t.parents(".vvUPToolbarCheckItem").hide();for(e=this.annotationToolbar[0],t=$("#AnnotationToolbarCheck"),t.prop("checked",e.on),$("#vvUPAnnotationToolbar .vvUPToolbarCheckItem > input").attr("disabled",!e.on),a=1;a<this.annotationToolbar.length;a++)e=this.annotationToolbar[a],t=$("#"+this.createElmtIDWithPrefix(e.id,!0)),t.prop("checked",e.on)}},r.prototype.saveToolbarPreferences=function(){for(var e=$("#vvUPImageControl input"),t=0;t<this.imageControlToolbar.length;t++)e[t]&&(this.imageControlToolbar[t].on=$(e[t]).prop("checked"));this.imageControlToolbar.version=this.versions.imageToolbarPreferences,e=$("#vvUPAnnotationToolbar input");for(var a=0;a<this.annotationToolbar.length;a++)e[a]&&(this.annotationToolbar[a].on=$(e[a]).prop("checked"));this.annotationToolbar.version=this.versions.annotationToolbarPreferences;try{localforage.setItem("imageControlToolbar",this.imageControlToolbar),localforage.setItem("annotationToolbar",this.annotationToolbar)}catch(e){return!1}var n=virtualViewer.getCallbackManager(),o={imageControlToolbar:this.imageControlToolbar,annotationToolbar:this.annotationToolbar};return n.call("saveToolbarPreferences",o),!0},r.prototype.prepareAnnotationTab=function(){for(var e=$("#vvUPAnnotationsList"),t=$("#vvUPAnnotationProperties"),i=1;i<this.annotationToolbar.length;i++){var r=this.annotationToolbar[i].id,s=a(virtualViewer).annotationToolbarButtons[r].annType;if(s&&s!==o.annotationTypes.SANN_REDACTION_RECT&&s!==o.annotationTypes.SANN_BITMAP){var l=this.createElmtIDWithPrefix(this.sanitizeName(s),!1),u=l+"Edit",d=$("#vvUPAnnotationEditTemplate").clone().attr("id",u).data("anntype",s);t.append(d),n.createColorPicker(d.find(".vvUPAnnotationLineColorChoices")),n.createColorPicker(d.find(".vvUPAnnotationFillColorChoices")),n.createColorPicker(d.find(".vvUPAnnotationFontColorChoices"));var c=$("<li></li>").attr({id:l,role:"tab"}).addClass("vvUPAnnotationItem nav").data("vvTabTarget",u);c.append($("<a></a>").html(this.annotationToolbar[i].name)),d.attr("aria-labelledby",l),y(s,d),d.hide(),e.append(c)}}$(".vvUPAnnotationItem").on("click",function(){f($(this))}),$("#vvUPAnnotationEditTemplate").hide();for(var g=0;g<o.fontNames.length;g+=1)$(".vvUPAnnTextFaceSelect").append("<option>"+o.fontNames[g]+"</option>");for(var v=0;v<o.fontSizes.length;v+=1)$(".vvUPAnnTextSizeSelect").append("<option>"+o.fontSizes[v]+"</option>");$(".vvUPAnnThicknessCell").click(function(){m($(this))});var p=$(".vvUPAnnotationItem")[0];p&&f($(p))};var m=function(e){var t=e.closest(".vvUPAnnotationLineThickness");t.find(".vvUPAnnThicknessCell").attr("aria-pressed","false"),e.attr("aria-pressed","true");var a=e.data("vvlinewidth");a=parseInt(a,10),t.find(".vvUPAnnLineSizeValue").text(a)},f=function(e){var t=e.data("vvTabTarget");$(".vvUPAnnPropPane.active").removeClass("active").hide(),$("#"+t).addClass("active").show(),$(".vvUPSelectedAnnotation.active").removeClass("vvUPSelectedAnnotation active"),e.addClass("vvUPSelectedAnnotation active"),$("#vvSelectedAnnotation").text(e.text())},y=function(e,t){return e===o.annotationTypes.SANN_POSTIT?void t.find(".vvUPAnnLineColorLabel, .vvUPAnnotationLineThickness").hide():e===o.annotationTypes.SANN_EDIT?void t.find(".vvUPAnnFillColorLabel, .vvUPAnnLineColorLabel, .vvUPAnnotationLineThickness").hide():(t.find(".vvUPTextAnnOptions").hide(),void(e===o.annotationTypes.SANN_FILLED_RECT||e===o.annotationTypes.SANN_FILLED_ELLIPSE||e===o.annotationTypes.SANN_FILLED_POLYGON||e===o.annotationTypes.SANN_HIGHLIGHT_RECT?t.find(".vvUPAnnTextColorLabel, .vvUPAnnLineColorLabel, .vvUPAnnotationLineThickness").hide():t.find(".vvUPAnnTextColorLabel, .vvUPAnnFillColorLabel").hide()))};r.prototype.setAnnotationProperties=function(){for(var e=$("#vvUPAnnotationProperties .vvUPAnnPropPane"),t=0;t<e.length;t++){var a=$(e[t]),i=this.getAnnotationPreference(a.data("anntype"));if(i){var r,s=i.type;if(s===o.annotationTypes.SANN_POSTIT){r=i.fillColor;var l=a.find(".vvUPAnnFillColorLabel");n.setColorPickerColor(l,r),r=i.fontColor;var u=a.find(".vvUPAnnTextFaceSelect");u.val(i.fontFace),u.val()||u.val("Times New Roman");var d=a.find(".vvUPAnnTextSizeSelect");d.val(i.fontSize),a.find(".vvUPAnnTextStyleBold").prop("checked",i.bold),a.find(".vvUPAnnTextStyleItalic").prop("checked",i.italic),a=a.find(".vvUPAnnTextColorLabel")}else if(s===o.annotationTypes.SANN_EDIT){r=i.fontColor;var u=a.find(".vvUPAnnTextFaceSelect");u.val(i.fontFace),u.val()||u.val("Times New Roman");var d=a.find(".vvUPAnnTextSizeSelect");d.val(i.fontSize),a.find(".vvUPAnnTextStyleBold").prop("checked",i.bold),a.find(".vvUPAnnTextStyleItalic").prop("checked",i.italic)}else if(s===o.annotationTypes.SANN_FILLED_RECT||s===o.annotationTypes.SANN_FILLED_ELLIPSE||s===o.annotationTypes.SANN_FILLED_POLYGON||s===o.annotationTypes.SANN_HIGHLIGHT_RECT)r=i.fillColor;else{var c=i.lineWidth;c||(c=1),m(a.find(".vvUPAnnThicknessCell-"+c)),r=i.lineColor}n.setColorPickerColor(a,r)}}},r.prototype.getAnnotationPreference=function(e){if(!e)return this.cloneAnnotationPreference(t.annotationDefaults);var a=this.sanitizeName(e),n=this.annotationPropertyArray[e];if(n){if(n.version!==this.versions.annotationPreferences){var o;o=n.type,n=this.cloneAnnotationPreference(t.annotationDefaults),n.type=o,this.annotationPropertyArray[e]=n}}else{if(this.annotationPropertyArray[a])return n=this.annotationPropertyArray[a],this.annotationPropertyArray[e]=n,this.annotationPropertyArray[a]=null,n;n=this.cloneAnnotationPreference(t.annotationDefaults),n.type=e,this.annotationPropertyArray[e]=n}return n},r.prototype.saveAnnotationPreferences=function(){for(var e=$("#vvUPAnnotationProperties .vvUPAnnPropPane"),t=function(e,t){var a=e.find(t);return a.find(".vvColorInputBox").val()},a=0;a<e.length;a++){var n=$(e[a]),i=this.getAnnotationPreference(n.data("anntype"));if(i){i.version=this.versions.annotationPreferences;var r=i.type;if(i.lineColor=t(n,".vvUPAnnLineColorLabel")||i.lineColor,i.fillColor=t(n,".vvUPAnnFillColorLabel")||i.fillColor,i.fontColor=t(n,".vvUPAnnTextColorLabel")||i.fontColor,r===o.annotationTypes.SANN_POSTIT||r===o.annotationTypes.SANN_EDIT){var s=n.find(".vvUPAnnTextFaceSelect"),l=s.val();l||(l="Times New Roman"),i.fontFace=l;var u=n.find(".vvUPAnnTextSizeSelect");i.fontSize=u.val(),i.bold=n.find(".vvUPAnnTextStyleBold").prop("checked"),i.italic=n.find(".vvUPAnnTextStyleItalic").prop("checked")}else{var d=parseInt(n.find(".vvUPAnnLineSizeValue").text(),10);d||(d=1),i.lineWidth=d}}}try{localforage.setItem("annotationPropertyArray",this.annotationPropertyArray)}catch(e){return!1}var c=virtualViewer.getCallbackManager(),g={annotationProperties:this.annotationPropertyArray};return c.call("saveAnnotationPreferences",g),!0},r.prototype.returnCurrentStampIndex=function(){var e=0;return e=$(".vvUPCustomStampItem").index($(".vvUPSelectedCustomStamp")[0])},r.prototype.prepareStampsTab=function(){$("#vvUPAddCustomStamp").click(function(){s.createCustomStamp()}),$("#vvUPRemoveCustomStamp").click(function(){s.removeCurrentCustomStamp()})};var b=function(){var e=$("#vvUPCustomStampEdit .active"),t=$("#vvUPCustomStampPreview"),a=e.find(".vvUPCustomStampStampTextInput").val();a||(a=""),t.text(a),"false"===e.find(".vvColorInputBox").attr("aria-invalid")&&t.css("color","#"+e.find(".vvColorInputBox").val()),t.css("font-family",e.find(".vvUPCustomTextFaceSelect").val()),t.css("font-size",e.find(".vvUPCustomTextSizeSelect").val()+"px");var n=parseInt(($("#vvUPCustomStampPreviewWrapper").height()-parseInt(t.css("line-height")))/2);t.css("margin-top",n+"px"),e.find(".vvUPCustomTextStyleBold").prop("checked")?t.css("font-weight","bold"):t.css("font-weight","normal"),e.find(".vvUPCustomTextStyleItalic").prop("checked")?t.css("font-style","italic"):t.css("font-style","normal")};r.prototype.createCustomStampsTable=function(){$("#vvUPSelectedCustomStampName").html(" "),$("#vvUPPreviewWord").html(" "),$("#vvUPCustomStampPreview").html(" "),$("#vvUPCustomStamps").html(" "),$(".vvUPStampEditPane:not(:first)").remove();for(var e=0;e<this.customStampArray.length;e++)this.createCustomStamp(this.customStampArray[e]);if(this.customStampArray.length>0){var t=$(".vvUPCustomStampItem").first();A(t)}else $("#vvUPCustomStampEdit").hide()};var P=function(e){$(e.find(".vvColorPickerContainer ")).on("click",function(){b()}),e.find(".vvUPCustomStampDisplayNameInput").change(function(){var e=$("#"+$(this).closest(".vvUPStampEditPane").attr("aria-labelledby")+" > a");e.text($(this).val()),$("#vvUPSelectedCustomStampName").text($(this).val())}),e.find(".vvUPCustomStampStampTextInput").change(function(){b()}),e.find(".vvUPCustomTextFaceSelect").change(function(){b()}),e.find(".vvUPCustomTextSizeSelect").change(function(){b()}),e.find(".vvUPCustomTextStyleBold").change(function(){$(this).prop("checked")?$("#vvUPCustomStampPreview").css("font-weight","bold"):$("#vvUPCustomStampPreview").css("font-weight","normal")}),e.find(".vvUPCustomTextStyleItalic").change(function(){$(this).prop("checked")?$("#vvUPCustomStampPreview").css("font-style","italic"):$("#vvUPCustomStampPreview").css("font-style","normal")})};r.prototype.createCustomStamp=function(e){var t,a=!0,n=$(".vvUPCustomStampItem").length+1,o="vvUPCustomStamp"+n;if(e)t=e.displayName;else{for(;$("#"+o).length;)n++,o="vvUPCustomStamp"+n;t="Custom Stamp #"+n,a=!1,e=this.createDefaultTextStamp(t)}var i=T(o,e),r=i.attr("id"),s=$("<li></li>").attr({id:o,role:"tab"}).addClass("vvUPCustomStampItem nav").data("vvTabTarget",r);s.append($("<a></a>").text(t)),$("#vvUPCustomStamps").append(s),i.attr("aria-labelledby",o),s.on("click",function(){A($(this))}),a||A(s)};var A=function(e){$("#vvUPSelectedCustomStampName").text(e.text()),$("#vvUPCustomStampEdit").show(),$("#vvUPCustomStamps .active").removeClass("active vvUPSelectedCustomStamp"),e.addClass("active vvUPSelectedCustomStamp");var t=e.attr("id")+"Edit";$("#vvUPCustomStampEdit .active").removeClass("active").hide(),$("#"+t).addClass("active").show(),b()},T=function(e,t){var a=$("#vvUPStampEditPaneTemplate").clone();$("#vvUPCustomStampEdit").append(a),a.attr("id",e+"Edit"),n.createColorPicker(a.find(".vvUPStampColorChoices")),n.setColorPickerColor(a,t.fontColor);for(var i=a.find(".vvUPCustomTextFaceSelect"),r=0;r<o.fontNames.length;r+=1)i.append("<option>"+o.fontNames[r]+"</option>");i.val(t.fontFace),null===i.val()&&(i.val("Times New Roman"),t.fontFace="Times New Roman");for(var s=a.find(".vvUPCustomTextSizeSelect"),l=0;l<o.fontSizes.length;l+=1)s.append("<option>"+o.fontSizes[l]+"</option>");return s.val(t.fontSize),null===s.val()&&s.val(18),a.find(".vvUPCustomStampDisplayNameInput").val(t.displayName),a.find(".vvUPCustomStampStampTextInput").val(t.textString),a.find(".vvUPCustomTextStyleBold").prop("checked",!!t.fontBold),a.find(".vvUPCustomTextStyleItalic").prop("checked",!!t.fontItalic),P(a),a};r.prototype.removeCurrentCustomStamp=function(){var e=this.returnCurrentStampIndex();if($(".vvUPCustomStampItem")[e]){if($(".vvUPCustomStampItem").eq(e).remove(),$("#vvUPCustomStampEdit .vvUPStampEditPane").eq(e+1).remove(),!$(".vvUPCustomStampItem").length)return void $("#vvUPCustomStampEdit").hide();0===e&&(e=1),A($(".vvUPCustomStampItem").eq(e-1))}},r.prototype.saveCustomStamps=function(){for(var e=[],t=$(".vvUPCustomStampItem"),a=0;a<t.length;a++){var n=this.createDefaultTextStamp(),o=$("#"+$(t[a]).attr("id")+"Edit");n.displayName=o.find(".vvUPCustomStampDisplayNameInput").val(),n.textString=o.find(".vvUPCustomStampStampTextInput").val(),n.fontFace=o.find(".vvUPCustomTextFaceSelect").val(),n.fontSize=o.find(".vvUPCustomTextSizeSelect").val(),n.fontBold=o.find(".vvUPCustomTextStyleBold").prop("checked"),n.fontItalic=o.find(".vvUPCustomTextStyleItalic").prop("checked"),"true"!==o.find(".vvColorInputBox").attr("aria-invalid")&&(n.fontColor=o.find(".vvColorInputBox").val()),e[a]=n}e.version=this.versions.customTextStamps;try{localforage.setItem("customStampArray",e)}catch(e){return!1}var i=virtualViewer.getCallbackManager(),r={stampsPreferences:e};return i.call("saveCustomStamps",r),this.customStampArray=e,!0},r.prototype.returnCurrentTemplateIndex=function(){var e=0;return e=$(".vvUPNoteTemplateItem").index($(".vvUPSelectedNoteTemplate")[0])},r.prototype.prepareNotesTab=function(){$("#vvUPAddNoteTemplate").click(function(){s.createNoteTemplate()}),$("#vvUPRemoveNoteTemplate").click(function(){s.removeCurrentNoteTemplate()})};var S=function(){var e=$("#vvUPNoteTemplateEdit .active"),t=e.find(".vvUPNoteTemplateTextInput").val();t||(t=""),$("#vvUPNoteTemplatePreview").text(t)};r.prototype.createNoteTemplateTable=function(){$("#vvUPSelectedNoteTemplateName").html(" "),$("#vvUPPreviewWord").html(" "),$("#vvUPNoteTemplates").html(" "),$(".vvUPTemplateEditPane:not(:first)").remove();for(var e=0;e<this.noteTemplateArray.length;e++)this.createNoteTemplate(this.noteTemplateArray[e]);if(this.noteTemplateArray.length>0){var t=$(".vvUPNoteTemplateItem").first();w(t)}else $("#vvUPNoteTemplateEdit").hide()};var I=function(e){e.find(".vvUPNoteTemplateDisplayNameInput").change(function(){var e=$("#"+$(this).closest(".vvUPTemplateEditPane").attr("aria-labelledby")+" > a");e.text($(this).val()),$("#vvUPSelectedNoteTemplateName").text($(this).val())}),e.find(".vvUPNoteTemplateTextInput").change(function(){S()})};r.prototype.createNoteTemplate=function(e){var t,a=!0,n=$(".vvUPNoteTemplateItem").length+1,o="vvUPNoteTemplate"+n;if(e)t=e.templateName;else{for(;$("#"+o).length;)n++,o="vvUPNoteTemplate"+n;t="Note Template #"+n,a=!1,e=this.createDefaultNoteTemplate(t)}templateForm=D(o,e);var i=templateForm.attr("id"),r=$("<li></li>").attr({id:o,role:"tab"}).addClass("vvUPNoteTemplateItem nav").data("vvTabTarget",i);r.append($("<a></a>").html(t)),$("#vvUPNoteTemplates").append(r),templateForm.attr("aria-labelledby",o),r.on("click",function(){w($(this))}),a||w(r)};var w=function(e){$("#vvUPSelectedNoteTemplateName").text(e.text()),$("#vvUPNoteTemplateEdit").show(),$("#vvUPNoteTemplates .active").removeClass("active vvUPSelectedNoteTemplate"),e.addClass("active vvUPSelectedNoteTemplate");var t=e.attr("id")+"Edit";$("#vvUPNoteTemplateEdit .active").removeClass("active").hide(),$("#"+t).addClass("active").show()},D=function(e,t){var a=$("#vvUPTemplateEditPaneTemplate").clone();return $("#vvUPNoteTemplateEdit").append(a),a.attr("id",e+"Edit"),a.find(".vvUPNoteTemplateDisplayNameInput").val(t.templateName),a.find(".vvUPNoteTemplateTextInput").val(t.templateString),I(a),a};r.prototype.removeCurrentNoteTemplate=function(){var e=this.returnCurrentTemplateIndex();if($(".vvUPNoteTemplateItem")[e]){if($(".vvUPNoteTemplateItem").eq(e).remove(),$("#vVUPNoteTemplateEdit .vvUPTemplateEditPane").eq(e+1).remove(),!$(".vvUPNoteTemplateItem").length)return void $("#vvUPNoteTemplateEdit").hide();0===e&&(e=1),w($(".vvUPNoteTemplateItem").eq(e-1))}},r.prototype.saveNoteTemplates=function(){for(var e=[],t=$(".vvUPNoteTemplateItem"),a=0;a<t.length;a++){var n=this.createDefaultNoteTemplate(),o=$("#"+$(t[a]).attr("id")+"Edit");n.templateName=o.find(".vvUPNoteTemplateDisplayNameInput").val(),n.templateString=o.find(".vvUPNoteTemplateTextInput").val(),e[a]=n}e.version=this.versions.noteTemplates;try{localforage.setItem("noteTemplateArray",e)}catch(e){return!1}this.noteTemplateArray=e;var i=virtualViewer.getCallbackManager(),r={notesTemplate:e};return i.call("saveNoteTemplates",r),!0},r.prototype.prepareGeneralTab=function(){$("#vvUPZoomLevelForm").hide();var e=$("#vvUPZoomLevelSelect"),a=0;virtualViewer.validateZoomLevels();for(var n=0;n<t.zoomLevels.length;n++){var o=t.zoomLevels[n];o>=t.zoomLevels[a]&&o<=100&&(a=n),o+="%",$(e).append($("<option/>",{value:n,text:o}))}this.defaultZoomPercentIndex=a,$(e).val(a),this.zoomPreferences.zoomLevelIndex<0&&(this.zoomPreferences.zoomLevelIndex=a,this.zoomPreferences.zoomLevel=t.zoomLevels[a]),$("#vvUPZoomLevelSelect").on("change",function(){$("#vvUPFitCustom").prop("checked",!0)}),$(".vvUPDefaultFitRadio").on("change",function(){if("vvUPFitCustom"!==$(this).attr("id")){var e=$("#vvUPZoomLevelSelect");$(e).val(s.defaultZoomPercentIndex)}}),C(),this.updateDialogZoomPreferences()},r.prototype.applyZoomPreferences=function(e){var t;t=e?[e]:i.getAllStates();for(var a=0;a<t.length;a++)t[a].isMedia()&&(t[a].isVideo()?t[a].getMediaManager().applyMediaPreferences(this.videoPreferences):t[a].isAudio()&&t[a].getMediaManager().applyMediaPreferences(this.audioPreferences)),this.applyZoomPreferencesCore(t[a]),t[a].clearCachedScroll()},r.prototype.applyZoomPreferencesCore=function(e){if(e)return e.documentId!==i.displayedDocuments[e.currentPaneIndex]?(e.setZoomMode(this.zoomPreferences.mode),void e.setZoom(this.zoomPreferences.zoomLevel)):void(this.zoomPreferences.mode===o.zoomModes.fitWindow?virtualViewer.fitWindowCore(e):this.zoomPreferences.mode===o.zoomModes.fitHeight?virtualViewer.fitHeightCore(e):this.zoomPreferences.mode===o.zoomModes.fitWidth?virtualViewer.fitWidthCore(e):this.zoomPreferences.mode===o.zoomModes.fitCustom&&virtualViewer.setZoomPercentCore(this.zoomPreferences.zoomLevel,e))},r.prototype.saveZoomPreferences=function(){this.setZoomValuesFromHTML(),this.zoomPreferences.version=this.versions.zoomPreferences;try{localforage.setItem("zoomPreferences",this.zoomPreferences)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={zoomPreferences:this.zoomPreferences};return e.call("saveZoomPreferences",t),!0},r.prototype.setZoomValuesFromHTML=function(){if($("#vvUPFitToWindow").prop("checked"))this.zoomPreferences.mode=o.zoomModes.fitWindow;else if($("#vvUPFitToHeight").prop("checked"))this.zoomPreferences.mode=o.zoomModes.fitHeight;else if($("#vvUPFitToWidth").prop("checked"))this.zoomPreferences.mode=o.zoomModes.fitWidth;else if($("#vvUPFitCustom").prop("checked")){this.zoomPreferences.mode=o.zoomModes.fitCustom;var e=parseInt($("#vvUPZoomLevelSelect").val());isNaN(e)||void 0===t.zoomLevels[e]?this.zoomPreferences.zoomLevelIndex=this.getMiddleZoomLevel():this.zoomPreferences.zoomLevelIndex=e,this.zoomPreferences.zoomLevel=t.zoomLevels[this.zoomPreferences.zoomLevelIndex]}},r.prototype.updateDialogZoomPreferences=function(){var e=$("#vvUPZoomLevelSelect");if($(e).val(this.defaultZoomPercentIndex),this.zoomPreferences.mode===o.zoomModes.fitWindow)$("#vvUPFitToWindow").prop("checked",!0);else if(this.zoomPreferences.mode===o.zoomModes.fitHeight)$("#vvUPFitToHeight").prop("checked",!0);else if(this.zoomPreferences.mode===o.zoomModes.fitWidth)$("#vvUPFitToWidth").prop("checked",!0);else if(this.zoomPreferences.mode===o.zoomModes.fitCustom){$("#vvUPFitCustom").prop("checked",!0);$(e).val(this.zoomPreferences.zoomLevelIndex)}},r.prototype.getMiddleZoomLevel=function(){var e=t.zoomLevels.length/2;return e-=e%1},r.prototype.getDefaultZoomMode=function(){return this.zoomPreferences.mode},r.prototype.getDefaultZoomLevel=function(){var e=this.zoomPreferences.zoomLevel;return e<0?t.zoomLevels[this.getMiddleZoomLevel()]:e},r.prototype.setUsername=function(t){t?(this.username=t,$("#vvUPUsernameInput").val(t)):this.username=$("#vvUPUsernameInput").val(),$("#vvDocumentNoteAdderAuthor").html(e.encodeForHTML(this.username)),$("#vvAnnotationNoteAdderAuthor").html(e.encodeForHTML(this.username)),this.username&&virtualViewer.addUsersToDropDown(this.username)},r.prototype.getUsername=function(){return this.username},r.prototype.saveUsername=function(e){this.setUsername(e);try{localforage.setItem("username",this.username)}catch(e){return!1}var t=virtualViewer.getCallbackManager(),a={username:this.username};return t.call("saveUsername",a),!0};var C=function(){for(var e=$("#vvUPDefaultTab .form-group"),a=0;a<e.length;a++){var n=$(e[a]).find("input").attr("id");
("vvUPPageTab"!==n||t.showPageThumbnails)&&("vvUPDocumentTab"!==n||t.showDocThumbnails)&&("vvUPSearchTab"!==n||t.showSearch)&&("vvUPNoteTab"!==n||t.enableDocumentNotes)&&("vvUPBookmarkTab"!==n||t.showBookmarkThumbnails)?"vvUPAnnotationTab"!==n||t.showAnnotationList||$(e[a]).remove():$(e[a]).remove()}};r.prototype.updateDialogDefaultTab=function(){switch(this.defaultTab){case o.thumbnailTabs.page:$("#vvUPPageTab").prop("checked",!0);break;case o.thumbnailTabs.document:$("#vvUPDocumentTab").prop("checked",!0);break;case o.thumbnailTabs.search:$("#vvUPSearchTab").prop("checked",!0);break;case o.thumbnailTabs.note:$("#vvUPNoteTab").prop("checked",!0);break;case o.thumbnailTabs.bookmark:$("#vvUPBookmarkTab").prop("checked",!0);break;case o.thumbnailTabs.annList:$("#vvUPAnnotationTab").prop("checked",!0)}},r.prototype.setDefaultTabFromHTML=function(){$("#vvUPPageTab").prop("checked")?this.defaultTab=o.thumbnailTabs.page:$("#vvUPDocumentTab").prop("checked")?this.defaultTab=o.thumbnailTabs.document:$("#vvUPSearchTab").prop("checked")?this.defaultTab=o.thumbnailTabs.search:$("#vvUPNoteTab").prop("checked")?this.defaultTab=o.thumbnailTabs.note:$("#vvUPBookmarkTab").prop("checked")?this.defaultTab=o.thumbnailTabs.bookmark:$("#vvUPAnnotationTab").prop("checked")&&(this.defaultTab=o.thumbnailTabs.annList)},r.prototype.saveTabPreference=function(){this.setDefaultTabFromHTML();try{localforage.setItem("defaultTab",this.defaultTab)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={defaultTab:this.defaultTab};return e.call("saveTabPreferences",t),!0},r.prototype.getDefaultTab=function(){return(null===this.defaultTab||this.defaultTab<0)&&(this.defaultTab=t.defaultThumbnailTab),this.defaultTab},r.prototype.prepareMediaTab=function(){this.updateMediaTab()},r.prototype.updateMediaTab=function(){this.videoPreferences.autoplay?$("#vvUPVideoAutoplay").prop("checked",!0):$("#vvUPVideoAutoplay").prop("checked",!1),this.videoPreferences.mute?$("#vvUPVideoMute").prop("checked",!0):$("#vvUPVideoMute").prop("checked",!1),this.videoPreferences.controls?$("#vvUPVideoControls").prop("checked",!0):$("#vvUPVideoControls").prop("checked",!1),this.videoPreferences.stretch?$("#vvUPVideoStretch").prop("checked",!0):$("#vvUPVideoStretch").prop("checked",!1),this.audioPreferences.loop?$("#vvUPAudioLoop").prop("checked",!0):$("#vvUPAudioLoop").prop("checked",!1),this.audioPreferences.background?$("#vvUPAudioBackground").prop("checked",!0):$("#vvUPAudioBackground").prop("checked",!1)},r.prototype.setMediaValuesFromHTML=function(){this.setVideoValuesFromHTML(),this.setAudioValuesFromHTML()},r.prototype.setVideoValuesFromHTML=function(){$("#vvUPVideoAutoplay").prop("checked")?this.videoPreferences.autoplay=!0:this.videoPreferences.autoplay=!1,$("#vvUPVideoMute").prop("checked")?this.videoPreferences.mute=!0:this.videoPreferences.mute=!1,$("#vvUPVideoControls").prop("checked")?this.videoPreferences.controls=!0:this.videoPreferences.controls=!1,$("#vvUPVideoStretch").prop("checked")?this.videoPreferences.stretch=!0:this.videoPreferences.stretch=!1},r.prototype.setAudioValuesFromHTML=function(){$("#vvUPAudioLoop").prop("checked")?this.audioPreferences.loop=!0:this.audioPreferences.loop=!1,$("#vvUPAudioBackground").prop("checked")?this.audioPreferences.background=!0:this.audioPreferences.background=!1},r.prototype.loadVideoPreferences=function(){var e=function(){s.turnOnErrorState(),M(null)},t=localforage.getItem("videoPreferences");t.then(M,e)};var M=function(e){e?s.videoPreferences=e:(s.videoPreferences.autoplay=t.videoAutoplay,s.videoPreferences.mute=t.videoMuted,s.videoPreferences.controls=t.videoControls,s.videoPreferences.stretch=t.videoStretch,s.updateMediaTab());var a=virtualViewer.getCallbackManager();if(a){var n=virtualViewer.getActivePaneState();if(n){var o=n.getMediaManager(),i={player:o.player,self:o};a.call("postLoadPreferencesVideo",i)}}};r.prototype.loadAudioPreferences=function(){var e=function(){s.turnOnErrorState(),x(null)},t=localforage.getItem("audioPreferences");t.then(x,e)};var x=function(e){e?s.audioPreferences=e:(s.audioPreferences.loop=t.audioLoop,s.audioPreferences.background=t.audioBackground,s.updateMediaTab());var a=virtualViewer.getCallbackManager();if(a){var n=virtualViewer.getActivePaneState();if(n){var o=n.getMediaManager(),i={player:o.player,self:o};a.call("postLoadPreferencesAudio",i)}}};return r.prototype.saveMediaPreferences=function(){this.setMediaValuesFromHTML();try{localforage.setItem("videoPreferences",this.videoPreferences),localforage.setItem("audioPreferences",this.audioPreferences)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={videoPreferences:this.videoPreferences};return e.call("saveVideoPreferences",t),t={audioPreferences:this.audioPreferences},e.call("saveAudioPreferences",t),!0},r.prototype.sanitizeName=function(e){if(e)return e.replace(/([ ;&,\.\+\*\~':"\!\^#$%@\[\]\(\)\\\/=>\|])/gm,"")},r.prototype.createElmtIDWithPrefix=function(e,t){var a=this.dynamicUPOptionPrefix+e;return t&&(a+="Check"),a},function(){return s=s||new r}()}),define("vvMagnifier",["vvUtility","user-config/config","vvDefines","vvPoint","vvStateManager"],function(e,t,a,n,o){function i(){this.magnifierTemporarilyDisabled=!1,this.magnifierEnabled=!1,this.currentPage=null}var r,s=20;return i.prototype.getMagnifierEnabled=function(){return this.magnifierEnabled},i.prototype.setMagnifierEnabled=function(e){this.magnifierTemporarilyDisabled=!1,e&&virtualViewer.setActivePane(0),this.magnifierEnabled=e},i.prototype.initMagnifier=function(){var e=$("#vvMagnifierCanvas");e.hide(),e.css("left",t.magnifierDefaults.x),e.css("top",t.magnifierDefaults.y),e.width(t.magnifierDefaults.width),e.height(t.magnifierDefaults.height);var n=e[0].getContext("2d");if(n.canvas.width=t.magnifierDefaults.width,n.canvas.height=t.magnifierDefaults.height,"number"==typeof a.magnifierCloseButtonSize&&a.magnifierCloseButtonSize>=0){var o=t.collapseStickiesSize||50;s=Math.min(a.magnifierCloseButtonSize,o)}},i.prototype.toggleMagnifier=function(){this.setMagnifierEnabled(!this.magnifierEnabled),this.magnifierHandler(),this.adjustForWindowResize()},i.prototype.magnifierHandler=function(){var e=$("#vvMagnifierCanvas");this.magnifierEnabled?(e.show(),"hidden"===e.css("visibility")&&e.css("visibility","visible"),this.getMagnifiedImage(),this.paintMagnifierCanvas()):e.hide()},i.prototype.adjustForWindowResize=function(){if(this.magnifierEnabled||this.magnifierTemporarilyDisabled){var e=$("#vvImageCanvas"),t=$("#vvMagnifierCanvas"),a=e.width(),n=e.height(),o=t.width(),i=t.height();if(a<50||n<50||(o>$("#vvImagePanel").width()||i>$("#vvImagePanel").height())&&$("#vvThumbs:visible").length)return this.magnifierTemporarilyDisabled=!0,this.magnifierEnabled=!1,void this.magnifierHandler();this.magnifierTemporarilyDisabled&&(this.magnifierTemporarilyDisabled=!1,this.magnifierEnabled=!0,this.magnifierHandler()),o>a&&(o=Math.max(a/2,50),t.width(o),t[0].width=o),i>n&&(i=Math.max(n/2,50),t.height(i),t[0].height=i);var r=Math.max(parseInt(t.css("left"),10),0),s=Math.max(parseInt(t.css("top"),10),0);r+o>a&&(r=a-o),s+i>n&&(s=n-i),t.css({left:r,top:s})}},i.prototype.paintMagnifierCanvas=function(e){this.clearMagnifier(),null!==e&&e||(e=o.getCurrentState());var t=$("#vvMagnifierCanvas")[0],a=$("#vvDummyScroller"),i=$("#vvOuterDiv"),r=t.getContext("2d"),s=i.scrollLeft(),l=t.offsetLeft+t.width/2,u=t.offsetTop+t.height/2,d=new n(l,u),c=virtualViewer.getEventManager().clickPageFinder(e,d,!1);c===-1&&(c=e.pageNumber),this.getMagnifiedImage(e,c),c===this.currentPage&&null!==this.currentPage||(this.currentPage=c,this.getMagnifiedImage(e,c));var g,v=virtualViewer.scrollPageFinder(e,i,a),p=virtualViewer.scrollerToPaint(e,v,i,a);if(v!==c)for(g=e.getRequestedHeightForPage(v)-p;v<c-1;)v++,g+=e.getRequestedHeightForPage(v);else g=-p;var h=t.offsetLeft+s,m=t.offsetTop,f=e.getRotationForPage(c),y=e.getRequestedWidthForPage(c);90!==f&&270!==f||(y=e.getRequestedHeightForPage(c));var b=(i.width()-$("#vvDummyScroller").width())/2;b<0&&(b=0);var P=($("#vvDummyScroller").width()-y)/2,A=b+P,T=t.offsetLeft/(i.width()-t.scrollWidth)*(t.scrollWidth/2);h=h-A+T,m-=g;var S=h,I=m;90===f?(h=I,m=e.getRequestedHeightForPage(c)-S):180===f?(h=e.getRequestedWidthForPage(c)-S,m=e.getRequestedHeightForPage(c)-I):270===f&&(h=e.getRequestedWidthForPage(c)-I,m=S),this.drawMagnifiedImage(e,r,c,-h,-m,f)},i.prototype.clearMagnifier=function(){var e=$("#vvMagnifierCanvas")[0];e.width=e.width,e.height=e.height},i.prototype.getMagnifiedImage=function(e,t){return e=e||o.getCurrentState(),e.isMedia()?null:(t||0===t||(t=e.pageNumber),e.getImageManager().getBestImageFromPage(t))},i.prototype.drawMagnifiedImage=function(a,n,o,i,r,s){var l=this.getMagnifiedImage(a,o);if(null!==l&&void 0!==l){n.save();var u=Math.sin(e.degreesToRadians(s)),d=Math.cos(e.degreesToRadians(s));n.setTransform(d,u,-u,d,0,0);try{a.getSVGEnabledForPage()&&(a.getHorizontalFlipForPage()&&(n.translate(a.getRequestedWidthForPage(o),0),n.scale(-1,1)),a.getVerticalFlipForPage()&&(n.translate(0,a.getRequestedHeightForPage(o)),n.scale(1,-1))),n.fillStyle="#eeeeee",n.fillRect(-1e3,-1e3,5e3,5e3);var c=t.magnifierDefaults.zoomPercent/100,g=a.getRequestedWidthForPage(o)*c,v=a.getRequestedHeightForPage(o)*c;if(i*=c,r*=c,n.drawImage(l,i,r,g,v),a.getSVGEnabledForPage()&&a.getInvertImageForPage()){for(var p=n.getImageData(0,0,a.getRequestedWidthForPage(o),a.getRequestedHeightForPage(o)),h=p.data,m=0;m<h.length;m+=4)h[m]=255-h[m],h[m+1]=255-h[m+1],h[m+2]=255-h[m+2];n.putImageData(p,0,0)}}catch(e){console.log("exception: "+e)}n.restore(),this.drawResizeArea(n),this.drawCloseButton(n)}},i.prototype.drawResizeArea=function(t){t.fillStyle="#000000";var a=$("#vvMagnifierCanvas")[0],n=a.width,o=a.height,i=e.getNubSize();t.beginPath(),t.moveTo(n,o),t.lineTo(n-i,o),t.lineTo(n,o-i),t.lineTo(n,o),t.fill()},i.prototype.drawCloseButton=function(e){e.save(),e.fillStyle="#000000",e.beginPath(),e.moveTo(0,0),e.lineTo(s,0),e.lineTo(s,s),e.lineTo(0,s),e.lineTo(0,0),e.fill(),e.restore(),e.save(),e.fillStyle="#FFFFFF",e.font="20px Arial",e.font=s+"px Arial";var t=s/5;e.fillText("",t,s-t),e.restore()},i.prototype.isMagnifierAtPoint=function(e){var t;if(e.getX)t=e;else{if("number"!=typeof e.clientX)return;t=new n(e.clientX,e.clientY)}var a=$("#vvMagnifierCanvas"),o=a.offset();return t.getX()>o.left&&t.getX()<o.left+a.width()&&t.getY()>o.top&&t.getY()<o.top+a.height()},i.prototype.isCloseButtonAtPoint=function(e){var t;if(e.getX)t=e;else{if("number"!=typeof e.clientX)return;t=new n(e.clientX,e.clientY)}var a=$("#vvMagnifierCanvas"),o=a.offset();return t.getX()>o.left&&t.getX()<o.left+s&&t.getY()>o.top&&t.getY()<o.top+s},i.prototype.stretchMagnifier=function(e,a){var n=0,o=0,i=0,r=0,s=$("#vvMagnifierCanvas");e>$("#vvOuterDiv").width()?e=$("#vvOuterDiv").width():e<0&&(e=0),a>$("#vvOuterDiv").height()?a=$("#vvOuterDiv").height():a<0&&(a=0),n=s[0].offsetLeft,o=s[0].offsetTop;var l=t.collapseStickiesSize||50;if(i=Math.max(e-n,l),r=Math.max(a-o,l),i>0&&r>0){s.width(i),s.height(r);var u=s[0].getContext("2d");u.canvas.width=i,u.canvas.height=r}this.paintMagnifierCanvas()},function(){return r=r||new i}()}),define("vvDocumentNotes",["vvNoteBase"],function(e){function t(){var a=new e;t.prototype.getAbleToAddNote=function(){return a.ableToAddNote},t.prototype.setAbleToAddNote=function(e){a.ableToAddNote=e},t.prototype.getUsername=function(){return a.getUsername()},t.prototype.setUsername=function(e){a.setUsername(e)},t.prototype.addNewNote=function(){a.addNote("Document")},t.prototype.editNote=function(e){a.editNote(e,"Document")};var n=function(e){a.addExistingNote(e,"Document")};t.prototype.loadDocumentNotes=function(){$("#vvDocumentNotesInternal").empty();var e=virtualViewer.getCurrentState();if(e&&e.documentFullyLoaded()){var t=e.getDocumentModel();if(t.model.documentNotes){var a=t.model.documentNotes.notes;a.sort(function(e,t){return e=e.editDate?new Date(e.editDate):new Date(e.createDate),t=t.editDate?new Date(t.editDate):new Date(t.createDate),t-e});for(var o=0;o<a.length;o++)n(a[o]);a.length>0?$("#vvNotesTabSpan").addClass("docNotesExist"):$("#vvNotesTabSpan").removeClass("docNotesExist")}}},t.prototype.clearAllDocumentNotes=function(){for(var e=$("#vvDocumentNotesInternal")[0],t=e.children.length-1;t>=0;t--)$(e.children[t]).remove()},t.prototype.abilityToModifyNotes=function(e){var t;e===!0?($(".vvNotesCloseButton").click(function(){var e=this.parentElement.parentElement;if(e){var t=$(e).children().index(this.parentElement);$($(e).children()[t]).remove();var n=virtualViewer.getCurrentState(),o=n.getDocumentModel(),i=o.model.documentNotes.notes;i.splice(t,1),o.setNotesModifiedSinceInit(!0,n),a.setAbleToAddNote(!0)}}),t=document.getElementsByClassName("vvNote"),$(t).dblclick(function(){var e=$(this);a.getAbleToAddNote()&&virtualViewer.getDocumentNotes().editNote(e)})):($(".vvNotesCloseButton").off("click"),t=document.getElementsByClassName("vvNote"),$(t).off("dblclick"))}}return t}),define("vvClickEventManager",["vvUtility","user-config/config","vvDefines","vvPoint","vvAnnotationManager","vvStateManager","vvMagnifier","vvCallbackManager"],function(e,t,a,n,o,i,r,s){function l(){this.events=!1,this.dragging=!1,this.annDragging=!1,this.endPoint=0,this.selectTextDrag=!1,this.dragMode=a.dragModes.pan,this.dragStartLeft=null,this.dragStopLeft=null,this.dragStartTop=null,this.dragStopTop=null,this.overlayDragOffset=new n(0,0),this.annDragOffsetX=0,this.annDragOffsetY=0,this.errorTimeoutID=-1,this.annLineEnd=null,this.annCorner=null,this.magnifierCorner=null,this.moveTop=0,this.moveLeft=0,this.previousPinchDistance=1}function u(){return d=d||new l}var d,c=!1,g=null,v=null;l.prototype.setDragMode=function(e){this.dragMode=e},l.prototype.getDragMode=function(){return this.dragMode},l.prototype.initEvents=function(e){e&&e.length||(e=$("#vvOuterDiv"));var t=e.find(".vvScroller");e.on("mousedown",m),e.on("mouseup",f),e.on("mousemove",y),e.on("mouseout",b),e.on("click",P),e.on("touchstart",A),e.on("touchmove",T),e.on("touchend",S),e.on("dblclick",I),t.on("contextmenu",w),t.on("mousemove",D),this.events=!0},l.prototype.destroyEvents=function(e){e&&e.length||(e=$("#vvOuterDiv"));var t=e.find(".vvScroller");e.off("mousedown",m),e.off("mouseup",f),e.off("mousemove",y),e.off("mouseout",b),e.off("click",P),e.off("touchstart",A),e.off("touchmove",T),e.off("touchend",S),e.off("dblclick",I),t.off("contextmenu",w),t.off("mousemove",D),this.events=!1},l.prototype.eventSwitch=function(e){if(!(e&&this.events||!e&&!this.events))return e&&!this.events?void this.initEvents():!e&&this.events?void this.destroyEvents():void 0},l.prototype.clean=function(){this.dragging=!1,this.selectTextDrag=!1,this.dragMode=a.dragModes.pan,this.dragStartLeft=null,this.dragStopLeft=null,this.dragStartTop=null,this.dragStopTop=null,this.endPoint=0,this.annDragOffsetX=0,this.annDragOffsetY=0},l.prototype.panMousedown=function(n){var s,l=n.currentTarget||n.target,u=$(l).closest(".split");if(u.length){var d="Split",c=u.attr("id").slice(d.length);virtualViewer.setActivePane(c)}if(s=i.getActivePaneState()){this.annDragging=!1;var g=0;virtualViewer.hideAnnPopUp(),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(g=1),n||(n=window.event),Modernizr.touchevents&&(n=this.fixTouchEvent(n));var v=$(l).find(".vvCanvas");v.length||(v=$(l).parent().find(".vvCanvas"));var p=$(v).offset().left+$(v).width(),h=$(v).offset().top+$(v).height();if(!(n.clientX>p||n.clientY>h)){var m=virtualViewer.getActiveOuterDiv(),f=m.find(".vvCanvas"),y=this.clickPointConverter(n),b=o.getAnnotationAtPoint(y,s),P=!0;b||(P=!1);var A=r.isMagnifierAtPoint(n);if(t.imageScrollBars===!1){if(n.button===g)return this.dragStartLeft=n.clientX,this.dragStartTop=n.clientY,A&&r.getMagnifierEnabled()?void this.autoSwitchToMagnifierMode(n):P?(e.cursorNormal(),virtualViewer.setCurrentAnnObject(b),void this.autoSwitchToMoveAnnotationMode(n)):virtualViewer.getIsAnnButtonSticky()?void this.autoSwitchToAnnotateMode(n):(this.currentDragMode!==a.dragModes.guides&&e.cursorGrabClosed(),this.moveTop=e.stripPx(f[0].style.top),this.moveLeft=e.stripPx(f[0].style.left),this.dragging=!0,!1)}else{if(A&&r.getMagnifierEnabled())return void this.autoSwitchToMagnifierMode(n);if(P)return virtualViewer.setCurrentAnnObject(b),void this.autoSwitchToMoveAnnotationMode(n);if(virtualViewer.getIsAnnButtonSticky())return void this.autoSwitchToAnnotateMode(n);if(virtualViewer.pageHasText())return void this.autoSwitchToSelectTextMode(n);this.moveTop=e.stripPx(f[0].style.top),this.moveLeft=e.stripPx(f[0].style.left)}}}},l.prototype.panMouseup=function(a){a.preventDefault(),a||(a=window.event),Modernizr.touchevents&&(a=this.fixTouchEvent(a));var n=i.getActivePaneState();if(n){this.dragging=!1,this.annDragging=!1,this.annCorner=null,this.annLineEnd=null;var r=this.clickPointConverter(a),s=o.getAnnotationAtPoint(r,n);s&&a.preventDefault(),virtualViewer.getCurrentAnnObject()!==s&&virtualViewer.hideAnnPopUp(),s?(e.cursorNormal(),virtualViewer.paintCanvases(),t.stickyAnnButtons[virtualViewer.getCurrentAnnType()]&&virtualViewer.getIsAnnButtonSticky()||virtualViewer.disableStickyAnnotationButton()):(e.cursorGrabOpen(),virtualViewer.hideAnnPopUp()),virtualViewer.getIsAnnButtonSticky()&&$(".selectedAnn").length&&virtualViewer.turnOnAnnotationButton(virtualViewer.getCurrentAnnType(),$(".selectedAnn"),!0)}},l.prototype.panMousemove=function(e){e||(e=window.event),virtualViewer.getCurrentAnnObject()||virtualViewer.hideAnnPopUp(),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var a=i.getActivePaneState();if(a){var n=virtualViewer.getActiveOuterDiv(),o=n.find(".vvScroller");if(t.imageScrollBars===!1){var r=o.height(),s=o.width();if(this.dragging){var l=this.moveTop+(e.clientY-this.dragStartTop),u=this.moveLeft+(e.clientX-this.dragStartLeft);this.dragStartTop=e.clientY,this.dragStartLeft=e.clientX,s<n[0].clientWidth&&(u=n[0].clientWidth/2-s/2),r<n[0].clientHeight&&(l=n[0].clientHeight/2-r/2),t.invertedPanScrollY?n.scrollTop(n.scrollTop()-l):n.scrollTop(n.scrollTop()+l),t.invertedPanScrollX?n.scrollLeft(n.scrollLeft()-u):n.scrollLeft(n.scrollLeft()+u)}}}},l.prototype.panDoubleClick=function(e){t.imageScrollBars===!1&&(virtualViewer.horizontalGuide.visible||virtualViewer.verticalGuide.visible)&&(virtualViewer.enterGuideMode(),this.guideDoubleClick(e))},l.prototype.annotateMousedown=function(r){if(3!==r.which){r.preventDefault();var l=this.dragMode===a.dragModes.zoom,u=this.dragMode===a.dragModes.crop;if(!t.readOnlyAnnotationMode||l||u){$("#vvAnnPopUp").length&&(l||u)&&(virtualViewer.hideAnnPopUp(),virtualViewer.setCurrentAnnObject(null));var d=r.currentTarget||r.target,c=$(d).closest(".split");if(c.length){var g="Split",v=c.attr("id").slice(g.length);if(virtualViewer.setActivePane(v)&&virtualViewer.currentPreviewAnnObject&&this.dragging){if(virtualViewer.destroyInProgressAnnotation(),this.setDragMode(a.dragModes.pan),l){var h=i.getActivePaneState();s.call("zoomRubberbandError",{documentId:h.getDocumentId(),currentZoom:h.getZoom(),exceptionMessage:"A document pane came into focus while a draw operation was in progress. The zoom action has been cancelled to avoid error."})}else u&&s.call("cropDocumentError",{documentId:h.getDocumentId(),page:h.pageNumber,exceptionMessage:"A document pane came into focus while a draw operation was in progress. The crop action has been cancelled to avoid error."});return}}var m=this.isCurrentAnnPolygon(),h=i.getActivePaneState(),f=virtualViewer.getActiveOuterDiv(),y=f.find(".vvCanvas")[0],b=$(y).offset();if(p(r,$(y),b)){l?s.call("zoomRubberbandBegin",{documentId:h.getDocumentId(),currentZoom:h.getZoom()}):u&&s.call("cropDocumentBegin",{documentId:h.getDocumentId(),page:h.pageNumber});var P=this.clickPointConverter(r,h,null,b),A=h.pageNumber;if(h.isPageCropped(A)&&this.dragMode!==a.dragModes.crop&&this.dragMode!==a.dragModes.zoom){var T=e.getLocalizedValue("errors.cropBlock","Cannot Annotate on Crop Preview. Save the crop then Annotate."),S={client:!0,disable:virtualViewer.disableErrorModals.cropBlock};return virtualViewer.displayExceptionMessage(T,S),this.setDragMode(a.dragModes.pan),e.cursorNormal(),!1}if(virtualViewer.currentPointArray&&virtualViewer.currentPointArray.length&&virtualViewer.currentPointArray[0]||(virtualViewer.currentPointArray=[],this.endpoint=0),r||(r=window.event),Modernizr.touchevents&&(r=this.fixTouchEvent(r)),P.x<0||P.x>h.getRequestedWidthForPage(A)||P.y>h.getRequestedHeightForPage(A)||P.y<=0){if(l?s.call("zoomRubberbandError",{documentId:h.getDocumentId(),currentZoom:h.getZoom(),exceptionMessage:"The Rubberband Zoom box was initiated out of bounds of the page."}):u&&s.call("cropDocumentError",{documentId:h.getDocumentId(),page:h.pageNumber,exceptionMessage:"The crop rectangle was initiated out of bounds of the page."}),m)return;if(virtualViewer.getIsAnnButtonSticky()&&null===virtualViewer.getCurrentAnnObject())return;return e.cursorNormal(),virtualViewer.setDragMode(a.dragModes.pan),void(this.dragging=!1)}if(!l&&!u){var I=h.getUndoObject(A);I.referenceAnn=void 0,I.unchangedAnn=void 0,I.layer=o.getCurrentLayer()}if(this.dragStartLeft=P.getX(),this.dragStartTop=P.getY(),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp){var w=virtualViewer.createPreviewAnnotation(!0,A,h);virtualViewer.pageContainsAnnotations(h.getPageNumber())||virtualViewer.pageHasIndicator(h.getPageNumber())||(virtualViewer.showAnnotationIndicator(h.getPageNumber()),virtualViewer.addToPagesWithAnnotations(h.getPageNumber())),w.fixDimensionsForPage(),w.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,t.oneLayerPerAnnotation===!0&&virtualViewer.createAutoLayer();var D=o.addAnnotation(w);D&&(I.modifiedAnn=void 0,I.type="add",h.pushUndoObject(h.getPageNumber(),I)),virtualViewer.currentPointArray=[];var C=t.stickyAnnButtons[virtualViewer.getCurrentAnnType()];return C&&virtualViewer.getIsAnnButtonSticky()?(e.cursorAnnotate(),this.setDragMode(a.dragModes.annotate)):(e.cursorNormal(),this.setDragMode(a.dragModes.pan)),this.dragging=!1,virtualViewer.paintCanvases(),virtualViewer.createNavigationOptionsLabels(),!1}if(m){if(virtualViewer.currentPointArray[this.endPoint]=new n(this.dragStartLeft,this.dragStartTop),this.endPoint++,this.canEndCurrentPolygon(P))return;this.moveTop=e.stripPx(y.style.top),this.moveLeft=e.stripPx(y.style.left),this.dragging=!0}else virtualViewer.currentPointArray[0]=new n(this.dragStartLeft,this.dragStartTop),this.endPoint=1,this.moveTop=e.stripPx(y.style.top),this.moveLeft=e.stripPx(y.style.left),this.dragging=!0;return!1}}}},l.prototype.isValidAnnotateMouseUp=function(){return(!this.isCurrentAnnPolygon()||null!==virtualViewer.currentPointArray)&&(!(!t.enableSingleClickImageRubberStamp||virtualViewer.getCurrentAnnType()!==a.SANN_BITMAP)||!(!this.dragging&&!this.annDragging)&&(null!==virtualViewer.currentPointArray||null!==this.dragStartLeft||null!==this.dragStartTop))},l.prototype.annotateMouseup=function(n){if(3!==n.which){n.preventDefault();var r=i.getActivePaneState(),s=this.isCurrentAnnPolygon();if(this.isValidAnnotateMouseUp()){n||(n=window.event),Modernizr.touchevents&&(n=this.fixTouchEvent(n)),this.annDragging=!1,this.dragging=!1;var l=r.pageNumber,u=this.clickPointConverter(n,r,!1);if(u.x<0||u.x>r.getRequestedWidthForPage(l)||u.y>r.getRequestedHeightForPage(l)||u.y<=0){if(s)return void(this.dragging=!0);if(virtualViewer.getIsAnnButtonSticky()&&null===virtualViewer.getCurrentAnnObject()&&0===virtualViewer.currentPointArray.length)return}this.dragStopLeft=u.getX(),this.dragStopTop=u.getY(),this.limitRubberband();var d=virtualViewer.createPreviewAnnotation(!0,l,r),c=d.getType()===a.annotationTypes.SANN_POSTIT||d.getType()===a.annotationTypes.SANN_EDIT;if(d.getType()===a.annotationTypes.SANN_EDIT&&t.enableTextRubberStamp&&(v=virtualViewer.currentStamp,virtualViewer.currentStamp=null,d.isStamp=!0),s){var g=virtualViewer.currentPointArray[this.endPoint-1],p=this.canEndCurrentPolygon(u),h=!1;if(u.x>g.x-1&&u.x<g.x+1&&u.y>g.y-1&&u.y<g.y+1)h=!0;else{virtualViewer.currentPointArray[this.endPoint]=u,this.endPoint++;var m=e.getNubSize();null===virtualViewer.currentPointArray&&(this.annotateMousedown(n),h=!0),(u.x<virtualViewer.currentPointArray[0].getX()-m/2||u.x>virtualViewer.currentPointArray[0].getX()+m/2||u.y<virtualViewer.currentPointArray[0].getY()-m/2||u.y>virtualViewer.currentPointArray[0].getY()+m/2)&&(h=!0)}if(h&&!p)return void(this.dragging=!0)}if(d.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,!(d.box.getHeight()<2&&d.box.getWidth()<2)){if(t.oneLayerPerAnnotation===!0&&d.getType()!==a.annotationTypes.SANN_REDACTION_RECT&&virtualViewer.createAutoLayer(),null===virtualViewer.currentPointArray&&(virtualViewer.currentPointArray=[]),(d.getType()===a.annotationTypes.SANN_ARROW||d.getType()===a.annotationTypes.SANN_LINE)&&virtualViewer.currentPointArray.length<2)return virtualViewer.currentPointArray=[],!1;var f;if(d.getType()===a.annotationTypes.SANN_REDACTION_RECT){var y=r.getPageNumber(),b=o.getRedactionLayer(y);d.type=a.annotationTypes.SANN_RECTANGLE,f=o.addAnnotation(d,y,b)}else virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp||(f=o.addAnnotation(d));if(d.fitBoxToText(),virtualViewer.paintCanvases(),null!==f&&virtualViewer.getCurrentAnnType()!==a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp||virtualViewer.getCurrentAnnType()!==a.annotationTypes.SANN_EDIT||virtualViewer.getCurrentAnnType()!==a.annotationTypes.SANN_POSTIT){var P=r.getUndoObject(r.getPageNumber());P.modifiedAnn=void 0,P.layer=o.getLayerWithAnn(d),P.type="add",r.pushUndoObject(r.getPageNumber(),P)}virtualViewer.currentPointArray=[],this.endPoint=0;var A=t.stickyAnnButtons[virtualViewer.getCurrentAnnType()],T=A&&virtualViewer.getIsAnnButtonSticky();return this.setDragMode(a.dragModes.pan),e.cursorNormal(),T||virtualViewer.disableStickyAnnotationButton(),t.immediatelyEditTextAnnotations&&c&&null!==f?(virtualViewer.setCurrentAnnObject(d),virtualViewer.annPopUpHandler(null,d),$("#vvAnnPopUpEditTextArea").focus()):T&&(v>-1&&(virtualViewer.currentStamp=v),e.cursorAnnotate(),this.setDragMode(a.dragModes.annotate)),t.showAnnNavToggle&&null!==f&&(virtualViewer.pageHasIndicator(l)||(virtualViewer.addToPagesWithAnnotations(r.pageNumber),virtualViewer.showAnnotationIndicator(r.pageNumber)),virtualViewer.createNavigationOptionsLabels(),"redaction"===$("input[name='radio']:checked").val()?virtualViewer.navigationButtonHandler(!0):virtualViewer.navigationButtonHandler(!1)),virtualViewer.currentPointArray&&(virtualViewer.currentPointArray=[],this.endpoint=0),!1}}}},l.prototype.annotateMousemove=function(e){e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var t=i.getActivePaneState();if(this.dragging===!0){var n=this.clickPointConverter(e,null,!1);if(this.dragStopLeft=n.getX(),this.dragStopTop=n.getY(),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_POSTIT){var o=Math.abs(this.dragStartLeft-this.dragStopLeft),r=Math.abs(this.dragStartTop-this.dragStopTop),s=1.25*virtualViewer.collapsedStickySize(t.getZoomDecimal());o<s&&(this.dragStopLeft<this.dragStartLeft?this.dragStopLeft=this.dragStartLeft-s:this.dragStopLeft=this.dragStartLeft+s),r<s&&(this.dragStopTop<this.dragStartTop?this.dragStopTop=this.dragStartTop-s:this.dragStopTop=this.dragStartTop+s)}e.shiftKey&&this.setDragStopForShiftLockDrawing(),this.limitRubberband(),n.setX(this.dragStopLeft),n.setY(this.dragStopTop),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_FREEHAND?virtualViewer.currentPointArray[virtualViewer.currentPointArray.length]=n:virtualViewer.currentPointArray[this.endPoint]=n,virtualViewer.currentPointArray.length>1?virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1):virtualViewer.currentPreviewAnnObject=null,virtualViewer.paintCanvases()}return!1},l.prototype.setDragStopForShiftLockDrawing=function(){var e=Math.abs(this.dragStartLeft-this.dragStopLeft),t=Math.abs(this.dragStartTop-this.dragStopTop),n=Math.min(t,e);if(!(virtualViewer.currentPointArray.length>2)){if(virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_LINE||virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_ARROW)return void(n===e?this.dragStopLeft=this.dragStartLeft:this.dragStopTop=this.dragStartTop);this.dragStopTop<this.dragStartTop?this.dragStopTop=this.dragStartTop-n:this.dragStopTop=this.dragStartTop+n,this.dragStopLeft<this.dragStartLeft?this.dragStopLeft=this.dragStartLeft-n:this.dragStopLeft=this.dragStartLeft+n}},l.prototype.zoomMousemove=function(e){if(e||(e=window.event),this.dragging===!0){var t=this.clickPointConverter(e);this.dragStopLeft=t.getX(),this.dragStopTop=t.getY(),this.limitRubberband(),virtualViewer.currentPointArray[this.endPoint]=t;var a={isCrop:!1,isRubberbandZoom:!0};virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1,null,null,a),virtualViewer.paintCanvases()}return!1},l.prototype.zoomMouseup=function(e){var n=i.getActivePaneState(),o=n.getPageNumber(),r=virtualViewer.getActiveOuterDiv();e||(e=window.event);var l=this.dragMode===a.dragModes.zoom,u={isCrop:!1,isRubberbandZoom:l},d=virtualViewer.createPreviewAnnotation(!0,o,n,u);d.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,virtualViewer.textSelectionAllowed()?this.setDragMode(a.dragModes.selectText):this.setDragMode(a.dragModes.pan),virtualViewer.currentPointArray=[],this.dragging=!1;var c=this.clickPointConverter(e,n,!1);if(this.isCurrentAnnPolygon()&&(c.x<0||c.x>n.getRequestedWidthForPage(o)||c.y>n.getRequestedHeightForPage(o)||c.y<=0))return void(this.dragging=!0);this.dragStopLeft=c.getX(),this.dragStopTop=c.getY(),this.limitRubberband();var g=Math.abs(this.dragStopTop-this.dragStartTop),v=Math.abs(this.dragStopLeft-this.dragStartLeft);if(n.getRequestedWidthForPage(o)<1||n.getRequestedHeightForPage(o)<1)return void s.call("zoomRubberbandError",{documentId:n.getDocumentId(),currentZoom:n.getZoom(),exceptionMessage:"An error has occurred and page dimensions appear to be less than one pixel."});if(0===v||0===g)return void s.call("zoomRubberbandError",{documentId:n.getDocumentId(),currentZoom:n.getZoom(),exceptionMessage:"The Rubberband Zoom box is too small."});var p,h=Math.min(this.dragStopTop,this.dragStartTop),m=Math.min(this.dragStopLeft,this.dragStartLeft),f=h/n.getRequestedHeightForPage(o),y=m/n.getRequestedWidthForPage(o),b=g,P=g/n.getRequestedHeightForPage(o),A=v;90!==n.getRotationForPage(o)&&270!==n.getRotationForPage(o)||(b=A,A=g,P=b/n.getRequestedWidthForPage(o)),p=b>=A?r.height()/b:r.width()/A;var T=n.getZoom(),S=Math.round(T*p);n.setZoomMode(a.zoomModes.fitCustom),S>(t.maxZoomPercent||500)&&(S=t.maxZoomPercent||500),n.setZoom(S),virtualViewer.zoomLoop(n),S=n.getZoom(),p=S/T;var I=n.getImageManager();I.scaleDocumentByPercentage(n.getZoomDecimal()),virtualViewer.sizeScroller({state:n});var w=y*n.getRequestedWidthForPage(o),D=virtualViewer.getScrollSpeed(n);180===n.getRotationForPage(o)?(f=1-f-P,w=n.getRequestedWidthForPage(o)-y*n.getRequestedWidthForPage(o),w-=A*p):90===n.getRotationForPage(o)?(w=n.getRequestedHeightForPage(o)-f*n.getRequestedHeightForPage(o),w-=A*p,f=y):270===n.getRotationForPage(o)&&(w=f*n.getRequestedHeightForPage(o),f=1-y-P);var C=virtualViewer.findPagePosition(o,n)+f*D;r.scrollLeft(0);var M=virtualViewer.getVisualPageLeft({page:o,state:n})+w;return virtualViewer.skipScrollEvent=!0,r.scrollLeft(M),r.scrollTop(C),virtualViewer.getIsAnnButtonSticky()&&virtualViewer.setCurrentAnnType(virtualViewer.getCurrentStickyAnnType()),s.call("zoomRubberband",{documentId:n.getDocumentId(),currentZoom:n.getZoom()}),this.endPoint=0,virtualViewer.currentPointArray=[],!1},l.prototype.selectTextMousedown=function(t){var a=t.currentTarget||t.target,s=$(a).closest(".split");if("button"!==t.target.localName&&s.length){var l="Split",u=s.attr("id").slice(l.length);virtualViewer.setActivePane(u)}var d=i.getActivePaneState();if(d){t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));
var c=$(a).find(".vvCanvas"),g=$(c).offset().left+$(c).width(),v=$(c).offset().top+$(c).height();if(!(t.clientX>g||t.clientY>v)){var p=this.clickPointConverter(t),h=o.getAnnotationAtPoint(p,d);if(this.annDragging=!1,this.dragging=!1,r.getMagnifierEnabled()&&r.isMagnifierAtPoint(t))return void this.autoSwitchToMagnifierMode(t);if(h)return e.cursorNormal(),virtualViewer.setCurrentAnnObject(h),void this.autoSwitchToMoveAnnotationMode(t);var m=!1,f=!1;switch(t.which){case 1:m=!0;break;case 2:break;case 3:f=!0}m&&(this.selectTextDrag=!0,p.x=p.x/d.getZoomDecimal(),p.y=p.y/d.getZoomDecimal(),virtualViewer.selectTextStartPoint=new n(p.x,p.y),virtualViewer.selectTextEndPoint=new n(p.x,p.y),virtualViewer.paintCanvases(d))}}},l.prototype.selectTextMousemove=function(e){this.selectTextDrag&&this.selectTextDragUpdate(e)},l.prototype.selectTextDragUpdate=function(e){e||(e=window.event);var t=this.clickPointConverter(e),a=i.getActivePaneState();t.x=t.x/a.getZoomDecimal(),t.y=t.y/a.getZoomDecimal(),virtualViewer.selectTextEndPoint=new n(t.x,t.y),virtualViewer.paintCanvases()},l.prototype.selectTextMouseup=function(){if(this.annDragging||this.selectTextDrag||this.dragging){this.annDragging=this.dragging=!1,virtualViewer.paintCanvases(),this.selectTextDrag=!1;var e={text:virtualViewer.getUserFriendlySelectedText()};s.call("textSelect",e)}if(virtualViewer.getIsAnnButtonSticky())return void($(".selectedAnn").length&&virtualViewer.turnOnAnnotationButton(virtualViewer.getCurrentAnnType(),$(".selectedAnn"),!0))},l.prototype.annotationMoveMousedown=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=i.getActivePaneState();if(3!==e.which){e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var a=this.clickPointConverter(e,t);if(r.getMagnifierEnabled()&&r.isMagnifierAtPoint(e))return void this.autoSwitchToMagnifierMode(e);var n=o.getAnnotationAtPoint(a,t);if(virtualViewer.getCurrentAnnObject()!==n&&virtualViewer.hideAnnPopUp(),!n)return virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null),this.autoSwitchToPanMode(e),virtualViewer.delayedPaintCanvases(),!1;n!==virtualViewer.getCurrentAnnObject()&&virtualViewer.setCurrentAnnObject(n);var s=n.getBoundingBox(n.collapsed);n.slope=s.getSlope();var l=n.getPointRotatedForAnn(a),u=l.getX(),d=l.getY(),c=n.getWidthRatio(),g=n.getHeightRatio(),v=o.getLayerWithAnn(n),p=t.getUndoObject(t.getPageNumber());p.referenceAnn=n,p.unchangedAnn=n.clone(),p.layer=v,this.checkAnnotationMinimize(n,l)||(this.annDragOffsetX=u-n.box.one.getX()*c,this.annDragOffsetY=d-n.box.one.getY()*g,this.annDragging=!0,n.useLineResize()?this.annLineEnd=n.findLineEndpoint(l,c,g):n.collapsed||(this.annCorner=s.findCorner(l,c,g),this.annCorner&&o.markLayerWithAnnDirty(n)))}},l.prototype.annotationMoveMousemove=function(e){if(e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.annDragging){var t=virtualViewer.getCurrentAnnObject();if(!t)return;var a=this.clickPointConverter(e,null,!1),r=t.getPointRotatedForAnn(a),s=r.getX(),l=r.getY(),u=new n(s-this.annDragOffsetX,l-this.annDragOffsetY),d=new n(s,l),c=i.getActivePaneState(),g=t.pageWidth*t.getWidthRatio(c),v=t.pageHeight*t.getHeightRatio(c);u.getX()<0?u=new n(0,u.getY()):u.getX()+t.box.getWidth()*t.getWidthRatio()>g&&(u=new n(g-t.box.getWidth()*t.getWidthRatio(),u.getY())),u.getY()<0?u=new n(u.getX(),0):u.getY()+t.box.getHeight()*t.getHeightRatio()>v&&(u=new n(u.getX(),v-t.box.getHeight()*t.getHeightRatio())),d.getX()<0?d=new n(0,d.getY()):d.getX()>g&&(d=new n(g,d.getY())),d.getY()<0?d=new n(d.getX(),0):d.getY()>v&&(d=new n(d.getX(),v));var p=!1;p=null!==this.annCorner||null!==this.annLineEnd?t.useLineResize()?t.stretchLine(this.annLineEnd,d.getX(),d.getY()):t.stretch(this.annCorner,d.getX(),d.getY(),e.shiftKey):t.move(u),c.getNewAnnList().indexOf(t)!==-1||c.getTrueAnnChange()||c.setTrueAnnChange(!0),virtualViewer.hideAnnPopUp(),p&&(t.markRevised(),o.markLayerWithAnnDirty(t),virtualViewer.paintCanvases())}},l.prototype.annotationMoveMouseup=function(t){if(t.preventDefault(),(0!==$("#vvAnnPopUp").filter(":hidden").length||this.annDragging)&&virtualViewer.getCurrentAnnObject()){var n=i.getActivePaneState();t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t)),this.annDragging=!1,this.annCorner=null,this.annLineEnd=null,virtualViewer.getCurrentAnnObject()&&virtualViewer.getCurrentAnnObject().fixBoundingBox();var r=virtualViewer.getCurrentAnnObject(),s=o.getLayerWithAnn(r),l=n.getDocumentModel().getAnnotationsModifiedSinceInit(),u=n.getUndoObject(n.getPageNumber());u.modifiedAnn=r.clone(),u.layer=s,u.type="modify",r&&l&&r.markRevised(),u.modifiedAnn.isSameAs(u.unchangedAnn)||u.unchangedAnn&&n.pushUndoObject(n.getPageNumber(),u),n.resetUndoObject(),o.checkLayerPermission(o.getCurrentLayer(),a.permissionLevels.PERM_EDIT)===!1&&(alert(e.getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer.")),virtualViewer.undoAnnotation()),this.setDragMode(a.dragModes.pan),virtualViewer.paintCanvases()}},l.prototype.magnifierMousedown=function(t){t.preventDefault();var a=i.getActivePaneState();if(a){t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var o=$("#vvMagnifierCanvas"),s=o.offset();virtualViewer.hideAnnPopUp(),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var l=r.isMagnifierAtPoint(t);if(!l)return virtualViewer.paintCanvases(),this.autoSwitchToPanMode(t),!1;this.dragStartLeft=t.clientX,this.dragStartTop=t.clientY;var u=new n(s.left+o[0].width,s.top+o[0].height),d=e.getNubSize();this.annDragOffsetX=this.dragStartLeft-s.left,this.annDragOffsetY=this.dragStartTop-s.top,this.dragging=!0,this.dragStartLeft>u.x-2*d&&this.dragStartLeft<u.x+2*d&&this.dragStartTop>u.y-2*d&&this.dragStartTop<u.y+2*d&&(this.magnifierCorner=3)}},l.prototype.magnifierMouseup=function(e){return e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.dragging=!1,this.magnifierCorner=null,this.setDragMode(a.dragModes.pan),r.isCloseButtonAtPoint(e)?void r.toggleMagnifier():void virtualViewer.paintCanvases()},l.prototype.magnifierMousemove=function(e){e.preventDefault();var t=$("#vvMagnifierCanvas"),a=$("#vvImageCanvas");if(e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.dragging){var o=e.clientX,i=e.clientY,s=a.offset(),l=new n(o-this.annDragOffsetX,i-this.annDragOffsetY),u=new n(o,i),d=a.width(),c=a.height();l.x=Math.max(l.x,s.left),l.x+t.width()>d+s.left&&(l.x=d-t.width()+s.left),l.y=Math.max(l.y,s.top),l.y+t.height()>c+s.top&&(l.y=c-t.height()+s.top),u.x=Math.max(u.x,s.left),u.x=Math.min(u.x,d+s.left),u.y=Math.max(u.y,s.top),u.y=Math.min(u.y,c+s.top),null!==this.magnifierCorner||null!==this.annLineEnd?r.stretchMagnifier(u.x-s.left,u.y-s.top):(t.css("left",l.x-s.left),t.css("top",l.y-s.top)),virtualViewer.hideAnnPopUp(),r.paintMagnifierCanvas()}},l.prototype.cropMousemove=function(e){var t=i.getActivePaneState();if(e||(e=window.event),this.dragging===!0){var a=this.clickPointConverter(e);this.dragStopLeft=a.getX(),this.dragStopTop=a.getY(),this.limitRubberband(),virtualViewer.currentPointArray[this.endPoint]=a;var n={isCrop:!0,isRubberbandZoom:!1};virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1,t.getPageNumber(),t,n),virtualViewer.paintCanvases(t)}},l.prototype.cropMouseup=function(t){var n=i.getActivePaneState();t.preventDefault(),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var o=this.clickPointConverter(t,n,!1);this.dragging=!1,this.dragStopLeft=o.getX(),this.dragStopTop=o.getY(),this.limitRubberband();var r=Math.abs(this.dragStartLeft-this.dragStopLeft),s=Math.abs(this.dragStartTop-this.dragStopTop);(r>=2||s>=2)&&this.dragStartLeft>0&&this.dragStartTop>0&&(virtualViewer.showCropDialog(n),this.setDragMode(a.dragModes.pan),e.cursorNormal(),virtualViewer.currentPreviewAnnObject=null,virtualViewer.currentPointArray=[])},l.prototype.dummyMousemove=function(t){var n=i.getActivePaneState(),o=virtualViewer.getActiveOuterDiv().find(".vvScroller"),r=this.clickPointConverter(t);if(r){var s=r.getX(),l=r.getY(),u=n.getLayerNames(),d=n.getLayersForPage(n.pageNumber);if(u&&d)for(var v=0;v<u.length;v+=1){var p=d[u[v]];if(p)for(var h=p.anns,m=0;m<h.length;m+=1){var f=h[m];if(f.getType()===a.annotationTypes.SANN_POSTIT){var y=e.getTextAnnDOMId(f),b=f.getBoundingBox(),P=b.getX1()*f.getWidthRatio(),A=b.getY1()*f.getWidthRatio(),T=b.getX2()*f.getWidthRatio(),S=b.getY2()*f.getWidthRatio();if(P<s&&T>s&&A<l&&S>l){if(!c){var I=$("#"+y).attr("title");return o.attr("title",I),g=y,void(c=!0)}}else c&&y===g&&(o.removeAttr("title"),c=!1)}}}}},l.prototype.guideMousedown=function(n){n||(n=window.event);var i=1;if($(n.target).closest("#vvOuterDiv").length&&(i=0),virtualViewer.setActivePane(i),this.dragging=!1,e.cursorGuides(),(virtualViewer.horizontalGuide.locked||!virtualViewer.horizontalGuide.visible)&&(virtualViewer.verticalGuide.locked||!virtualViewer.verticalGuide.visible)){Modernizr.touchevents&&(n=this.fixTouchEvent(n));var r=this.clickPointConverter(n),s=o.isAnnotationAtPoint(r);if(s)return e.cursorNormal(),void this.setDragMode(a.dragModes.pan);if(t.imageScrollBars===!1)return void this.panMousedown(n)}virtualViewer.updateGuidePositions(n),virtualViewer.horizontalGuide.locked=virtualViewer.horizontalGuide.visible,virtualViewer.verticalGuide.locked=virtualViewer.verticalGuide.visible,virtualViewer.paintCanvases()},l.prototype.guideMouseup=function(e){this.dragging=!1},l.prototype.guideDoubleClick=function(t){e.cursorGuides(),this.getDragMode()===a.dragModes.guides&&(virtualViewer.horizontalGuide.locked=!1,virtualViewer.verticalGuide.locked=!1,virtualViewer.updateGuidePositions(t),virtualViewer.paintCanvases())},l.prototype.guideMousemove=function(t){return!virtualViewer.horizontalGuide.locked&&virtualViewer.horizontalGuide.visible||!virtualViewer.verticalGuide.locked&&virtualViewer.verticalGuide.visible||!this.dragging?(e.cursorGuides(),void virtualViewer.updateGuidePositions(t)):(this.setDragMode(a.dragModes.pan),e.cursorGrabClosed(),void this.panMousedown(t))},l.prototype.overlayMousedown=function(e){e||(e=window.event);var t=1;$(e.target).closest("#vvOuterDiv").length&&(t=0),virtualViewer.setActivePane(t);var a=i.getActivePaneState(),o=a.getImageManager();if(!o.overlayImage)return void this.autoSwitchToPanMode(e);r.isMagnifierAtPoint(e)&&this.autoSwitchToMagnifierMode(e);var s=!1,l=!1;switch(e.which){case 1:s=!0;break;case 2:break;case 3:l=!0}if(l)return void this.autoSwitchToPanMode(e);if(s){this.dragging=!0;var u=this.clickPointConverter(e);this.dragStartLeft=u.getX(),this.dragStartTop=u.getY();var d=this.clickPageFinder(a,new n(e.clientX,e.clientY)),c=o.getOverlayOffsetForPage(d);if(c){var g,v=a.getRequestedWidthForPage(d)/o.overlayImage.width,p=a.getRequestedHeightForPage(d)/o.overlayImage.height;g=v<p?v:p,this.overlayDragOffset.x=this.dragStartLeft/g-c.offsetX,this.overlayDragOffset.y=this.dragStartTop/g-c.offsetY}}},l.prototype.overlayMouseup=function(e){this.dragging=!1},l.prototype.overlayMousemove=function(e){if(this.dragging){var t=i.getActivePaneState(),a=t.getImageManager(),o=this.clickPointConverter(e);this.dragStopLeft=o.getX(),this.dragStopTop=o.getY();var r=this.clickPageFinder(t,new n(e.clientX,e.clientY)),s=a.getOverlayOffsetForPage(r);if(s){var l,u=a.overlayImage,d=t.getRequestedWidthForPage(r)/u.width,c=t.getRequestedHeightForPage(r)/u.height;l=d<c?d:c,s.offsetX=this.dragStopLeft/l-this.overlayDragOffset.x,s.offsetY=this.dragStopTop/l-this.overlayDragOffset.y,virtualViewer.paintCanvases()}}},l.prototype.checkAnnotationMinimize=function(e,n){if(e.getType()!==a.annotationTypes.SANN_POSTIT)return!1;var o=i.getActivePaneState(),r=n.getX(),s=n.getY(),l=e.getBoundingBox(e.collapsed),u=l.getX2()*e.getWidthRatio(),d=l.getY1()*e.getHeightRatio(),c=e.getMinimizeButtonSize(o);if(!c)return!1;var g=c+Math.ceil(t.annotationDefaults.stickyMargin*o.getZoomDecimal());return r>=u-g&&r<=u&&s>=d&&s<=d+g&&(e.collapsed=!e.collapsed,virtualViewer.paintCanvases(),!0)},l.prototype.fixTouchEvent=function(e){if(Modernizr.touchevents){e&&e.originalEvent&&(e=e.originalEvent);var t=e.changedTouches,a=!1;t&&t.length>0?(e=t[0],a=!0):e.gesture&&e.gesture.touches&&e.gesture.touches.length>0&&(t=e.gesture.touches,t&&t.length>0&&(e=t[0],a=!0)),a&&(e.button=0,e.preventDefault=function(){},e.stopPropagation=function(){})}return e};var p=function(e,t,a){return!(e.clientX<a.left||e.clientX>a.left+t.width())&&!(e.clientY<a.top||e.clientY>a.top+t.height())};l.prototype.limitRubberband=function(){var e=i.getActivePaneState();this.dragStopLeft>e.getRequestedWidthForPage(e.pageNumber)?this.dragStopLeft=e.getRequestedWidthForPage(e.pageNumber):this.dragStopLeft<0&&(this.dragStopLeft=0),this.dragStopTop>e.getRequestedHeightForPage(e.pageNumber)?this.dragStopTop=e.getRequestedHeightForPage(e.pageNumber):this.dragStopTop<0&&(this.dragStopTop=0)},l.prototype.clickPointConverter=function(e,t,a,o){if(t=t||i.getActivePaneState(),!t||!t.pageStates)return null;a!==!1&&(a=!0),o=o||i.getOuterDivFromState(t).find(".vvCanvas").offset();var r=new n(e.clientX-o.left,e.clientY-o.top),s=this.clickPageFinder(t,r);s===-1&&(s=t.pageNumber||0),s<t.pageCount&&s>=0&&s!==t.pageNumber&&this.dragging===!1&&"mousemove"!==e.type&&"mouseout"!==e.type&&a&&virtualViewer.updatePage(s,t);var l=this.globalPosToLocalPos(r,t.pageNumber,t),u=t.getRotationForPage(t.pageNumber),d=this.rotateLocalizedPoint(l,u);return d},l.prototype.findPos=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);var n=virtualViewer.getActiveOuterDiv();return a-=n.scrollTop(),t-=n.scrollLeft(),[t,a]},l.prototype.clickPageFinder=function(e,n,o,r){if(e=e||i.getActivePaneState(),o=o||virtualViewer.getActiveOuterDiv(),r=r||o.find(".vvScroller"),e.isMedia())return-1;var s=virtualViewer.scrollPageFinder(e,o,r),l=virtualViewer.getVisualPageTop({page:s,state:e,currentZeroPage:s}),u=s+t.continuousScrollBufferAfterSize;u||0===u||(u=s+3);var d;u>=e.pageCount&&(u=e.pageCount-1);for(var c,g=s;g<=u;g++){if(d=e.getRotationForPage(g),c=0===d||180===d?l+e.getRequestedHeightForPage(g):l+e.getRequestedWidthForPage(g),c+=a.spaceBetweenPages,n.y<=c&&n.y>=l)return g;l=c}return-1},l.prototype.rotateLocalizedPoint=function(e,t,a){var o,r=i.getActivePaneState();if(r&&r.documentFullyLoaded()){a||(a=r.pageNumber),t||(t=r.getRotationForPage(a));var s=r.getRequestedWidthForPage(a),l=r.getRequestedHeightForPage(a);return o=0===t?e:90===t?new n(e.y,l-e.x):180===t?new n(s-e.x,l-e.y):new n(s-e.y,e.x)}},l.prototype.autoSwitchToSelectTextMode=function(e){this.setDragMode(a.dragModes.selectText),this.selectTextMousedown(e)},l.prototype.autoSwitchToMoveAnnotationMode=function(e){t.readOnlyAnnotationMode||(this.setDragMode(a.dragModes.moveAnnotation),this.annotationMoveMousedown(e))},l.prototype.autoSwitchToAnnotateMode=function(e){t.readOnlyAnnotationMode||(this.setDragMode(a.dragModes.annotate),this.annotateMousedown(e))},l.prototype.autoSwitchToPanMode=function(e){this.setDragMode(a.dragModes.pan),this.panMousedown(e)},l.prototype.autoSwitchToMagnifierMode=function(e){this.setDragMode(a.dragModes.magnifier),this.magnifierMousedown(e)},l.prototype.canEndCurrentPolygon=function(t){var a=e.getNubSize();return t.x>virtualViewer.currentPointArray[0].getX()-a/2&&t.x<virtualViewer.currentPointArray[0].getX()+a/2&&t.y>virtualViewer.currentPointArray[0].getY()-a/2&&t.y<virtualViewer.currentPointArray[0].getY()+a/2&&this.endPoint>1},l.prototype.isCurrentAnnPolygon=function(){var e=virtualViewer.getCurrentAnnType();return e===a.annotationTypes.SANN_POLYGON||e===a.annotationTypes.SANN_FILLED_POLYGON},l.prototype.localPosToGlobalPos=function(e,t,a){a=a||i.getActivePaneState();var o=e[1];o||(o=e.getY());var r=e[0];r||(r=e.getX());var s=i.getOuterDivFromState(a).find(".vvCanvas"),l=s.offset(),u=virtualViewer.getVisualPageTop({page:t,state:a}),d=virtualViewer.getVisualPageLeft({page:t,state:a});return r=r+d+l.left,o=o+u+l.top,new n(r,o)},l.prototype.globalPosToLocalPos=function(e,t,a){if(a=a||i.getActivePaneState(),a&&a.documentFullyLoaded()){var o=e[1];o||(o=e.getY());var r=e[0];r||(r=e.getX()),t=t||a.pageNumber;var s=virtualViewer.getVisualPageTop({page:t,state:a}),l=virtualViewer.getVisualPageLeft({page:t,state:a});return r-=l,o-=s,new n(r,o)}};var h=function(e,t){e!==a.dragModes.annotate&&e!==a.dragModes.moveAnnotation||self.autoSwitchToPanMode(t)},m=function(e){var n=u(),o=n.getDragMode();t.readOnlyAnnotationMode&&h(o,e),o===a.dragModes.pan?n.panMousedown(e):o===a.dragModes.annotate?n.annotateMousedown(e):o===a.dragModes.moveAnnotation?n.annotationMoveMousedown(e):o===a.dragModes.zoom?n.annotateMousedown(e):o===a.dragModes.selectText?n.selectTextMousedown(e):o===a.dragModes.guides?n.guideMousedown(e):o===a.dragModes.magnifier?n.magnifierMousedown(e):o===a.dragModes.crop?n.annotateMousedown(e):o===a.dragModes.overlay&&n.overlayMousedown(e),"Explorer"===BrowserDetect.browser&&2===e.button&&w(e)},f=function(e){var n=u(),o=n.getDragMode();t.readOnlyAnnotationMode&&h(o,e),o===a.dragModes.pan?n.panMouseup(e):o===a.dragModes.annotate?n.annotateMouseup(e):o===a.dragModes.moveAnnotation?n.annotationMoveMouseup(e):o===a.dragModes.zoom?n.zoomMouseup(e):o===a.dragModes.selectText?n.selectTextMouseup(e):o===a.dragModes.guides?n.guideMouseup(e):o===a.dragModes.magnifier?n.magnifierMouseup(e):o===a.dragModes.crop?n.cropMouseup(e):o===a.dragModes.overlay&&n.overlayMouseup(e)},y=function(e){var n=u(),o=n.getDragMode();t.readOnlyAnnotationMode&&h(o,e),o===a.dragModes.pan?n.panMousemove(e):o===a.dragModes.annotate?n.annotateMousemove(e):o===a.dragModes.moveAnnotation?n.annotationMoveMousemove(e):o===a.dragModes.zoom?n.zoomMousemove(e):o===a.dragModes.selectText?n.selectTextMousemove(e):o===a.dragModes.guides?n.guideMousemove(e):o===a.dragModes.magnifier?n.magnifierMousemove(e):o===a.dragModes.crop?n.cropMousemove(e):o===a.dragModes.overlay&&n.overlayMousemove(e)},b=function(e){var t=u(),n=t.getDragMode();n===a.dragModes.pan},P=function(e){var t=u();t.getDragMode()},A=function(e){var t=u(),n=t.getDragMode();return n===a.dragModes.pan?(e=t.fixTouchEvent(e),void t.panMousedown(e)):(e.preventDefault(),e=t.fixTouchEvent(e),void(n===a.dragModes.annotate?t.annotateMousedown(e):n===a.dragModes.zoom?t.annotateMousedown(e):n===a.dragModes.moveAnnotation?t.annotationMoveMousedown(e):n===a.dragModes.magnifier?t.magnifierMousedown(e):n===a.dragModes.crop&&t.annotateMousedown(e)))},T=function(e){var t=u(),n=t.getDragMode();n===a.dragModes.pan?(e=t.fixTouchEvent(e),t.panMousemove(e)):n===a.dragModes.annotate?(e=t.fixTouchEvent(e),t.annotateMousemove(e)):n===a.dragModes.zoom?(e=t.fixTouchEvent(e),t.zoomMousemove(e)):n===a.dragModes.moveAnnotation?(e=t.fixTouchEvent(e),t.annotationMoveMousemove(e)):n===a.dragModes.magnifier?(e.preventDefault(),e=t.fixTouchEvent(e),t.magnifierMousemove(e)):n===a.dragModes.crop&&(e=t.fixTouchEvent(e),t.cropMousemove(e))},S=function(e){var t=u(),n=t.getDragMode();e=t.fixTouchEvent(e),n===a.dragModes.pan?t.panMouseup(e):n===a.dragModes.annotate?t.annotateMouseup(e):n===a.dragModes.moveAnnotation?t.annotationMoveMouseup(e):n===a.dragModes.magnifier?t.magnifierMouseup(e):n===a.dragModes.crop?t.cropMouseup(e):n===a.dragModes.zoom&&t.zoomMouseup(e)},I=function(e){var t=u(),n=t.getDragMode();n===a.dragModes.pan?t.panDoubleClick(e):n===a.dragModes.guides&&t.guideDoubleClick(e)},w=function(e){var t=u();Modernizr.touchevents&&(e=t.fixTouchEvent(e));var a=i.getActivePaneState(),n=virtualViewer.getAnnClipboard();a&&n&&(n.pasteLocation=t.clickPointConverter(e,a,!0))},D=function(e){var t=u(),n=t.getDragMode();n===a.dragModes.pan&&t.dummyMousemove(e)};return u()}),define("vvStampManager",["vvUtility","user-config/config","vvDefines","user-config/toolbar-config"],function(e,t,a,n){function o(e){this.stampArray=[],this.currentImageRubberStamp=-1}return o.prototype.checkStampIntegrity=function(e){return!!e&&(!(!e.stampTitle||"string"!=typeof e.stampTitle)&&!!e.stampData)},o.prototype.getCurrentStamp=function(){return this.stampArray[this.currentImageRubberStamp]},o.prototype.pushStamp=function(e){return!!this.checkStampIntegrity(e)&&(this.stampArray.push(e),!0)},o.prototype.createStampObject=function(t,a,n){if(!t||!a){var o={client:!1,disable:virtualViewer.disableErrorModals.stamp||!1},i=e.getLocalizedValue("errors.stampCreationFailure","Unable to create ImageStamp, invalid URL or title.");return virtualViewer.displayExceptionMessage(i,o),null}var r={},s=document.createElement("canvas"),l=s.getContext("2d"),u=new Image;return u.src=t,u.crossOrigin="Anonymous",u.onload=function(){if(!u.complete)return null;if(!e.validImageObject(u))return null;r.stampWidth?s.width=r.stampWidth:r.stampWidth=s.width=u.width,r.stampHeight?s.height=r.stampHeight:r.stampHeight=s.height=u.height;try{l.drawImage(u,0,0,r.stampWidth,r.stampHeight);var t=s.toDataURL();r.stampData=t.substr(t.indexOf(",")+1)}catch(e){return null}},r.stampData=u,r.stampTitle=a,n&&(r.stampWidth=n.width,r.stampHeight=n.height,r.annotationId=n.annotationId),r},o.prototype.processStampArray=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],o=this.createStampObject(n.url,n.stampTitle,{width:n.width,height:n.height,annotationId:n.annotationId});null!==o&&t.push(o)}return t},o.prototype.pushStampArray=function(e){if(!e)return!1;if(!e.length)return this.pushStamp(e),!0;for(var t=0;t<e.length;t++)this.pushStamp(e[t]);return!0},o.prototype.setStampArray=function(e){for(var t=0;t<e.length;t++)if(!this.checkStampIntegrity(e[t]))return!1;this.stampArray=e},o.prototype.clearStampArray=function(){this.stampArray=[]},o.prototype.clearStampDropdown=function(){$(".vvAnnImageRubberStamp ul.dropdown-menu").empty().hide(),$(".vvAnnImageRubberStamp.vvHasSubDropdown").removeClass("vvHasSubDropdown"),this.clearStampArray()},o.prototype.createStampDropdown=function(e){if(n(virtualViewer).annotationToolbarButtons.vvAnnImageRubberStamp){if("Explorer"===BrowserDetect.browser&&BrowserDetect.version<9||!e||!e.length)return void $(".vvAnnImageRubberStamp").attr("aria-disabled","true");$(".vvAnnImageRubberStamp ul.dropdown-menu").empty(),$(".vvAnnImageRubberStamp.vvHasSubDropdown").removeClass("vvHasSubDropdown"),this.addStampsToDropdown(e)}},o.prototype.addStampsToDropdown=function(e){var t=this;if(e){e.length||0===e.length||(e=[e]),(this.stampArray.length||e.length)&&$(".vvAnnImageRubberStamp").addClass("vvHasSubDropdown");var n;this.stampArray.length&&(n={startIndex:this.stampArray.length},Array.isArray(e)||(e=[e]));var o=$.templates("#vvStampDropdownItemTemplate"),i=$(o.render(e,n));i.appendTo(".vvAnnImageRubberStamp ul.dropdown-menu"),$(".vvAnnImageRubberStamp ul.dropdown-menu li").unbind("click"),$(".vvAnnImageRubberStamp ul.dropdown-menu li").on("click",function(){var e=$(this).data("stamp-row-index");t.currentImageRubberStamp=e,virtualViewer.turnOnAnnotationButton(a.annotationTypes.SANN_BITMAP,$(".vvAnnImageRubberStamp")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()}),this.pushStampArray(e),$(".vvAnnImageRubberStamp ul.dropdown-menu").css("display")&&$(".vvAnnImageRubberStamp ul.dropdown-menu").css("display","")}},o}),define("vvPreviewAnnotation",["user-config/config","vvDefines","vvUtility","annotations","vvBoundingBox","vvNoteBase","vvStateManager"],function(e,t,a,n,o,i,r){function s(){}return s.prototype=n.prototype,s.prototype.initPreview=function(n,s,l,u,d,c,g,v,p,h,m,f){var y=r.getActivePaneState(),b=virtualViewer.getUserPreferences();m||(m=y.getPageNumber()),f&&(this.pageHeight=f.pageHeight,this.pageWidth=f.pageWidth),this.pageHeight&&this.pageWidth||(this.pageHeight=y.getRequestedHeightForPage(m),this.pageWidth=y.getRequestedWidthForPage(m)),this.type=n,this.box=s,this.lineColor=l,this.preview=!0,this.annDelete=!1,this.index=-1,this.isIDM=h,this.docDPI=p||72,this.page=m,this.annPreference=null,this.rotationAngle=0,this.xmlRotate=0,this.wrappedText=[],this.revisionHistory=[],this.currentRevision={},this.annPreference=b.getAnnotationPreference(this.type),this.createDate=a.toSnowDateString(new Date),this.modifyDate=a.toSnowDateString(new Date),this.createUser=b.username,void 0!==v&&null!==v?this.doubleByte=v:this.doubleByte=e.base64EncodeAnnotations;var P=n.indexOf("Filled");P!==-1&&(this.fillColor=u,this.type=n.slice(6,n.length)),this.type===t.annotationTypes.SANN_HIGHLIGHT_RECT?(this.fillColor=u,this.opacity=c,this.type=n.slice(9,n.length)):this.opacity=1,n===t.annotationTypes.SANN_CIRCLE&&(this.fillColor=u,this.box=new o(s.getX1(),s.getY1(),s.getWidth(),s.getWidth())),n===t.annotationTypes.SANN_FREEHAND&&(this.type=t.annotationTypes.SANN_LINE),n===t.annotationTypes.SANN_FILLED_POLYGON&&(this.type=t.annotationTypes.SANN_POLYGON),this.fontName=null,this.fontSize=0,this.fontBold=!1,this.fontItalic=!1,this.fontStrike=!1,this.fontUnderline=!1,this.fontColor=null,n!==t.annotationTypes.SANN_EDIT&&n!==t.annotationTypes.SANN_BUBBLE&&n!==t.annotationTypes.SANN_CLOUD_EDIT&&n!==t.annotationTypes.SANN_POSTIT||(this.setTextString(e.annotationDefaults.textString),this.setFontName(this.annPreference.fontFace),this.setFontSize(this.annPreference.fontSize),this.setFontBold(this.annPreference.bold),this.setFontItalic(this.annPreference.italic),this.setFontStrike(e.annotationDefaults.fontStrike),this.setFontUnderline(e.annotationDefaults.fontUnderline),this.setFontColor(this.annPreference.fontColor.toString())),n===t.annotationTypes.SANN_POSTIT&&(this.fillColor=this.annPreference.fillColor.toString()),d?this.setLineWidth(parseInt(d,10)):this.setLineWidth(1),g&&(this.pointArray=g,this.fixBoundingBox()),this.annotationTags=[],this.notes=new i,this.noteArray=[]},s}),define("vvScreenReaderManager",["vvUtility","user-config/config","user-config/toolbar-config","vvDefines","vvStateManager"],function(e,t,a,n,o){function i(){r=this,this.startedPlaying=!1,this.buttonClicked="",this.speechNextPage=!1,this.speechPreviousPage=!1,this.documentIdToBeRead=""}var r;i.prototype.setStartedPlaying=function(e){this.startedPlaying=e},i.prototype.getStartedPlaying=function(){return this.startedPlaying},i.prototype.setButtonClicked=function(e){this.buttonClicked=e},i.prototype.getButtonClicked=function(){return this.buttonClicked},i.prototype.setSpeechNextPage=function(e){this.speechNextPage=e},i.prototype.getSpeechNextPage=function(){return this.speechNextPage},i.prototype.setSpeechPreviousPage=function(e){this.speechPreviousPage=e},i.prototype.getSpeechPreviousPage=function(){return this.speechPreviousPage},i.prototype.setDocumentIdToBeRead=function(e){this.documentIdToBeRead=e},i.prototype.getDocumentIdToBeRead=function(){return this.documentIdToBeRead};var s=function(e){var t=virtualViewer.getActivePaneState();if(t&&virtualViewer.pageHasText())return u()},l=function(e){var t=e.join("");return t};i.prototype.setUpScreenReaderDiv=function(e){e=e||virtualViewer.getActivePaneState();var a=[],n=e.getPageNumber(),o=t.continuousScrollBufferBeforeSize||1,i=t.continuousScrollBufferAfterSize||3,r=n-o;r<0&&(r=0);var s=n+i;if(s>e.pageCount&&(s=e.pageCount),e&&e.getPageCount()){$("#vvScreenReaderDiv").children().length||c(e);for(var l=r;l<=s;l++)virtualViewer.pageHasText(l)&&(a[l]=u(e,l),d(a[l],l))}};var u=function(t,a){t=t||virtualViewer.getActivePaneState(),r.setDocumentIdToBeRead(t.getDocumentId());var n=null;return t.getPageText(a)&&(n=t.getPageText(a).wordRects),n?e.wordRectsToPageString(n):""},d=function(e,t){var a=$("#p"+t);a.length&&a.text(e)},c=function(e){for(var t=e.getPageCount(),a=0,n=document.createDocumentFragment();a<t;){var o="p"+a;$(o).length||$("<p>",{text:"",id:o,tabindex:-1}).appendTo($(n)),a++}$("#vvScreenReaderDiv").append(n)};return i.prototype.playSpeechSynthesisForPage=function(t){var a=virtualViewer.getActivePaneState(),n=t||a.getPageNumber(),o=window.speechSynthesis,i=[],u=e.getLocalizedValue("thumbPageLabel","Page ");i.push(u+(n+1)+", "),i.push(s(n));var d=l(i),c=new window.SpeechSynthesisUtterance(d);window.utterances=[],window.utterances.push(c),c.onend=function(){r.startedPlaying&&(n>=a.getPageCount()-1?r.stopSpeech():("next"===r.buttonClicked?r.speechNextPage||virtualViewer.nextPage():"previous"===r.buttonClicked?r.speechPreviousPage||virtualViewer.previousPage():virtualViewer.nextPage(),r.playSpeechSynthesisForPage(a.getPageNumber())))},o.cancel(),o.speak(c)},i.prototype.stopSpeech=function(){r.startedPlaying=!1,r.buttonClicked="",window.speechSynthesis.cancel()},i}),define("webviewer",["require","vvUtility","vvWidgets","vvPoint","vvDocViewStateElement","vvDefines","vvBoundingBox","user-config/config","user-config/toolbar-config","vvAnnotationManager","vvStateManager","vvSearchManager","vvHotkeys","vvWatermarks","vvUserPreferences","vvThumbs","vvMagnifier","vvLayerManager","vvDocViewState","vvDocumentNotes","vvDialogs","vvClickEventManager","vvBookmarks","vvStampManager","vvPreviewAnnotation","annotations","vvCallbackManager","vvPrintManager","vvScreenReaderManager"],function(e,t,a,n,o,i,r,s,l,u,d,c,g){function v(){URI.escapeQuerySpace=!1,C=this,this.currentStamp=null,this.documentList=[],this.recentlyViewedList=[],this.newRecentlyViewedList=[],this.activeTab=0,this.tabs=[],this.shortTabNames=!1,this.viewerSessionID="",this.scrollingLocked=!1,this.zoomLocked=null,this.imageBufferTop=[],this.redactionWarningShown=!1,this.pageManipulationsEnabled=!0,this.annotationsEnabled=!0,this.redactionsEnabled=!0,this.ocrEnabled=!1,this.disableUploadDocument=null,this.overrideLoggingLevel=!1,this.verticalGuide={locked:!1,visible:!1,value:0},this.horizontalGuide={locked:!1,visible:!1,value:0},this.currentPointArray=[],this.clientInstanceId=null,this.disableErrorModals=s.disableErrorModals||{}}function p(){var e=null;return e=s.zoomLevels?s.zoomLevels:i.defaultZoomLevels}function h(e){for(var t=p(),a=0;a<t.length;a++){var n=t[a];if(n>e)return n}return t[t.length-1]}function m(e){for(var t=p(),a=t.length-1;a>-1;a--){var n=t[a];if(n<e)return n}return t[0]}function f(e){var t=["documentId","documentDisplayName","documentByteSize","pageCount","documentFormat"],a=$.inArray(e,t)>-1;return a}function y(e,t){var a,n;if("pageCount"===e)return t.getPageCount();if("documentDisplayName"===e)return t.getDisplayName();if("documentByteSize"===e){var o=t.getDocumentByteSize();return o&&(o=o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),o}if("documentId"===e)return t.getDocumentId();if("dpi"===e)return t.getDPIForPage(t.pageNumber);if("compressionType"===e){var i=t.getCompressionTypeForPage(t.pageNumber);return i||(i="N/A"),i}if("bitDepth"===e)return t.getBitDepthForPage(t.pageNumber);if("pageNumber"===e)return t.pageNumber+1;if("documentFormat"===e)return t.getFormatForPage(t.pageNumber);if(0===e.indexOf("tiffTag")){var r=t.getTiffTag(t.pageNumber,e);return r?b(e,r):"N/A"}if("imageSizePixels"===e)return a=t.getOriginalWidthForPage(t.pageNumber),n=t.getOriginalHeightForPage(t.pageNumber),""+a+" x "+n;if("imageSizeInches"===e){var s=t.getDPIForPage(t.pageNumber);a=t.getOriginalWidthForPage(t.pageNumber),n=t.getOriginalHeightForPage(t.pageNumber);var l=a/s,u=n/s;return""+l.toFixed(2)+" x "+u.toFixed(2)+" inches"}}function b(e,t){var a=i.tiffTagValueHash[e];if(a){var n=a[t];if(n)return n}return t}function P(e){var t=s.maxInfoFieldLength||128,a=""+e;return a.length<t?a:jQuery.trim(a).substring(0,t)+"..."}function A(e,a,n,o){if(!o){if(e.y<n.top&&a.y>n.bottom)return!0;if(e.y<n.bottom&&a.y>n.bottom&&e.x<n.right)return!0;if(a.y>n.top&&a.y<n.bottom&&e.y<n.top&&n.left<a.x)return!0}var i=new t.ImageRect(Math.min(e.x,a.x),Math.min(e.y,a.y),Math.max(e.x,a.x),Math.max(e.y,a.y));return i.intersects(n)}function T(e){""!==$.trim(e)&&($("#vvClipboardTextarea").html(e),$("#vvClipboard").modal("show"),$("#vvClipboard").focus(function(e){$("#vvClipboardTextarea").select()}))}function S(e,t,a,n){var o=.7,i=o,r=2,s=a.top-t.top,l=t.bottom-t.top,u=Math.floor(s/(l*i)),d=0;if(a.left<t.left&&(d=1),u=Math.max(u,d),u=Math.min(u,r),u!==1/0)for(var c=0;c<u;c++)e+="\n";
return u>0&&(e=I(e,a,n)),e}function I(e,t,a){var n=.355,o=t.bottom-t.top,i=o*n,r=t.left,s=r-a,l=Math.round(s/i);if(i>0)for(var u=0;u<l;u++)e+=" ";return e}function w(e,t,a){var n=.1272,o=.355,i=a.top-t.top,r=a.bottom-t.bottom,s=t.bottom-t.top,l=a.bottom-a.top,u=Math.min(s,l),d=u*n,c=u*o,g=Math.floor(i/u),v=Math.floor(r/u);if(g>0&&v>0)return e;var p=t.right,h=a.left,m=h-p,f=0;if(c>0&&m>d){f=1;var y=Math.round((m-2.6*d)/c);f+=y}else f=0;for(var b=0;b<f;b++)e+=" ";return e}function D(e){if(!(virtualViewer.verticalGuide.locked&&virtualViewer.horizontalGuide.locked||(e||(e=window.event),Y.getDragMode()!==i.dragModes.guides))){var t=d.getCurrentState(0),a=$(e.target).closest(".vvOuter");"vvSplit1Panel"===a.attr("id")&&(t=d.getCurrentState(1));var o=a.find(".vvCanvas").offset(),r=o.top,s=o.left,l=new n(e.clientX,e.clientY-r),u=Math.max(Y.clickPageFinder(t,l,a),0);if(virtualViewer.verticalGuide.locked||(virtualViewer.verticalGuide.value=Math.max(e.clientX-s,1)),!virtualViewer.horizontalGuide.locked){var c=virtualViewer.getVisualPageTop({page:u,state:t}),g=l.getY()-c;virtualViewer.horizontalGuide.value=Math.max(g,1)}C.paintCanvases()}}var C,M=!1,x=null,L=null,N=0,V=0,k=0,R=0,B=0,F=null,E=null,O=null,U=null,_=null,z=null,W=null,H=!1,Q=null,j=null,q=null,G=null,Y=null,X=null,Z=null,K=null,J=null,ee=[],te=!1,ae=!1,ne=0,oe=0,ie=0,re=0,se=0,le=null,ue=null,de=!1,ce=null,ge="",ve=s.guideLineWidth||2,pe=s.activeGuideColor||"#000099",he=s.lockedGuideColor||"#990000",me={width:0,height:0},fe=s.panIncrement||30;v.prototype.isInitialized=function(){return!!(j&&G&&this.initializationComplete)},v.prototype.init=function(a){if(this.isInitialized())return void console.error("VirtualViewer has already been initialized.");window.addEventListener("message",Ae,!1),be(),g.initializeHotkeys(),$("[data-localize]").localize("vv",i.localizeOptions);var n=i.localizeOptions.language||navigator.language;t.isValidISOCode(n)&&$("html").prop("lang",n),$.views.converters("decodeUri",function(e){return decodeURIComponent(e)}),$.views.helpers({localize:t.getLocalizedValue,escapeSingleQuotes:function(e){return"string"==typeof e?e.replace(/'/g,"&apos;"):e},placeholderizeWatermarkText:function(e){var a=e.replace(/@@[A-Z]+@@/gi,function(e){var a=e.replace(/@/g,"");return"["+t.getLocalizedValue("watermarksDialog.editText."+a,a)+"]"});return a.length>45&&(a=a.substr(0,45)+"..."),a}}),C.pageManipulationsEnabled=s.pageManipulations,this.initToolbar(),ye(),x=this.getScrollbarWidth(),this.getServerConfig(),this.validateZoomLevels();var o=document.getElementById("vvOuterDiv");if(Modernizr.touchevents){var r=navigator.userAgent.toLowerCase();(r.match(/(iphone|ipod|ipad)/)||r.match(/(android)/)||r.match(/(iemobile)/))&&(s.imageScrollBars=!1),$(document).on("orientationchange",function(){e("vvThumbs").loadVisibleThumbs()}),Pe()}$("[title]").each(function(e){var t=$(this).attr("title");t=$("<div />").html(t).text(),$(this).attr("title",t)}),$("#vvBookmarks").contextmenu(function(){return!1}),De(),G=e("vvMagnifier"),G.initMagnifier(),C.checkPageManipulationsEnabled()&&(i.cacheBuster=!0),s.imageScrollBars===!1&&$(o).addClass("panMode"),document.body.onmousedown=function(e){if(1===e.button)return!1},"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(i.cacheBuster=!0),$("#vvNotesTab").click(function(){var e=C.getCurrentState();e&&!e.isVirtualDocument()&&$("#vvDocumentNotes").css("visibility","visible")}),q=new(e("vvDocumentNotes")),Q=new(e("vvBookmarks")),Y=e("vvClickEventManager"),X=e("vvCallbackManager"),Z=new(e("vvStampManager")),K=new(e("vvScreenReaderManager")),Y.initEvents(),X.init(),j=e("vvUserPreferences"),j.init(),Ve(),Fe(),Ue(),He(),c.prepareSearch(),je(),qe(),Ye(),Xe(),Ke(),$e(),Ee(),$t(),Wa(),t.enableTooltips(),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvImageCanvas").contextMenu("vvSelectTextContextMenu",Je):$("#vvDummyScroller").contextMenu("vvSelectTextContextMenu",Je),Ze(),this.setDragMode(i.dragModes.pan),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&$(o).on("dragstart",function(){return!1}),$("body").on("contextmenu",function(e){e.target&&"VIDEO"===e.target.tagName||e.preventDefault()}),$("body").click(function(e){var t=d.getCurrentState(0);if(t){var a=t.getDocumentModel();if(a){var n=$(e.target);if(!(n.hasClass("vvToolbarItem")||n.hasClass("toolbar-icon")||n.hasClass("vvToolbarItemName"))){var o=$("#okCancelDialog").data("bs.modal");if(!o||!o.isShown){var i=$("#vvLayerManagerDiv:visible, #vvUserPreferencesDialog:visible");if(!i.length&&"modal"!==n.attr("data-dismiss")){var r=n.parent();"modal"===r.attr("data-dismiss")||r.hasClass("modal-footer")||0===n.closest(".thumbPanel").length&&a.clearPageSelection()}}}}}}),$("#vvAnnButtonContainer button").on("click",function(){var e=d.getCurrentState(0);if(e){var t=e.getDocumentModel();t&&t.clearPageSelection()}}),$("#vvPageThumbs").scroll(ta),$("#vvDocThumbs").scroll(ta),$("#vvSearch").scroll(ta),$("#vvDocumentNotes").scroll(ta),this.viewerSessionID=t.vvGUID(),document.addEventListener("dragend",function(){virtualViewer.dragging=!1,ea()}),$(document).bind("drag",ea),document.addEventListener("drop",function(e){e.preventDefault(),ea()}),$(window).resize(C.processWindowResize),$("#vvOuterDiv").on("scroll",function(e){var t=C.getCurrentState();t&&(C.paintCanvases(t),0===C.getActivePane()||virtualViewer.scrollingLocked||C.setActivePane(0))}),$("#vvOuterDiv").on("scroll",function(){var e=C.getCurrentState();if(e&&!virtualViewer.skipScrollEvent){var t=Qt(e);e.getPageNumber()!==t&&t<e.pageCount&&t>=0&&C.updatePage(t,e)}else virtualViewer.skipScrollEvent=!1}),$("#vvOuterDiv").on("scroll",function(){if(virtualViewer.scrollingLocked){var e=$("#Split1 .vvOuter");if(e.length){var t=$(this);le&&clearTimeout(le),le=setTimeout(function(){wa(t,e)},5),Math.abs($(this).scrollTop()-re)>=100&&wa(t,e)}}});var l=Z.processStampArray(s.initialStamps||[]);Z.addStampsToDropdown(l),s.showDocThumbnails!==!0&&s.showPageThumbnails!==!0||this.requestDocumentList(),a&&this.openInTab(C.getDocumentId(0)),s.unsavedChangesNotification&&$(window).bind("beforeunload",function(){for(var e=d.getAllStates(),a=0;a<e.length;a++){var n=e[a].getDocumentModel();if(n.getModifiedSinceInit())return t.getLocalizedValue("browserClose.message","You have unsaved changes in this session.")}}),$("#vvNavOptions").on("change",function(){if("redaction"===$("input[name='radio']:checked").val()){$("#vvAnnotationThumbsButton").prop("disabled",!0).addClass("disabled");var e=yt(!0);0===e.length?St():(It(),C.navigationButtonHandler(!0))}else{var t=C.pagesWithAnnotations();$("#vvAnnotationThumbsButton").prop("disabled",!1).removeClass("disabled");var a=yt(!1);0===a.length?St():t.length<=1?($("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled")):(It(),C.navigationButtonHandler(!1))}}),$("#vvPrevAnnotationButton").on("click",function(e){C.navigationChangeHandler(e)}),$("#vvNextAnnotationButton").on("click",function(e){C.navigationChangeHandler(e)}),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$(window).bind("beforeunload",function(){K.getStartedPlaying()&&(K.stopSpeech(),C.toggleSpeechControls())}),$("#vvScreenReaderDiv").on("focus",function(){var e=C.getCurrentState();if(e){var t=$("#vvScreenReaderDiv").find("#p"+e.getPageNumber());t.focus(),$("#vvOuterDiv").addClass("vvScreenReaderActive")}}),$("#vvScreenReaderDiv").on("focusout",function(){$("#vvOuterDiv").removeClass("vvScreenReaderActive")}),$("a.skip").on("click",function(e){e.preventDefault(),$("#vvScreenReaderDiv").focus(),$("#vvOuterDiv").addClass("vvScreenReaderActive")}),Te(),this.initializationComplete=!0},v.prototype.initViaURL=function(){if(this.isInitialized())return void console.error("VirtualViewer has already been initialized.");ut();var e=lt("documentId");e&&C.setDocumentId(e),"string"!=typeof this.getClientInstanceId()&&this.setClientInstanceId(this.parseClientInstanceId());var t=lt("openerHistoryBack");"true"===t&&window.opener.history.back(1),this.init(!0);var a=lt("pageNumber");a&&window.setTimeout(function(){virtualViewer.setPage(+a)},400)},v.prototype.initSpecifiedDocuments=function(e){if(this.isInitialized())return void console.error("VirtualViewer has already been initialized.");for(var t=0;t<e.length;t++)this.documentList[t]={},e[t].documentId?(this.documentList[t].documentId=e[t].documentId,this.documentList[t].displayName=e[t].displayName):(this.documentList[t].documentId=e[t],this.documentList[t].displayName=null);var a=lt("openerHistoryBack");"true"===a&&window.opener.history.back(1),this.init(!1),this.documentList[0]&&this.openInTab(this.documentList[0].documentId)},v.prototype.openSpecifiedDocuments=function(e){for(var t=e||this.documentList,a=Math.min(t.length,i.maxNumberOfTabs),n=0;n<a;n++)if(t[n].documentId){if(e&&t[n].displayName){var o=this.indexInDocumentList(t[n].documentId);this.documentList[o].displayName=t[n].displayName}this.openInTab(t[n].documentId)}else this.openInTab(t[n])};var ye=function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,n=this.length;a<n;a++)if(this[a]===e)return a;return-1})},be=function(){var e,t;s.disableToolbarHamburger?(e="#bootstrapHamburger",t="#toolbarHamburger",$("#vvAnnToolbarHamburgerItems").addClass("hidden-xs"),$("#vvMidSizeToolbarItems").removeClass("hidden-xs")):(e="#bootstrapHamburgerless",t="#toolbarHamburgerless"),$(e).attr("disabled","disabled"),$(t).attr("disabled","disabled")},Pe=function(e){var t;t=e?e.find(".vvScroller")[0]:$("#vvDummyScroller")[0];var a=new Hammer(t);a.get("pinch").set({enable:!0}),a.on("doubletap",function(e){var t=virtualViewer.getCurrentAnnObject();t&&C.annPopUpHandler(null,t)}),a.get("press").set({enable:!0,threshold:4}),a.on("press",function(e){var t=virtualViewer.getCurrentAnnObject();t||$(e.target).trigger($.Event("contextmenu",{pageX:e.center.x,pageY:e.center.y,clientX:e.center.x,clientY:e.center.y}))}),a.on("pinchin",function(e){var t=e.pointers[0].clientX-e.pointers[1].clientX,a=e.pointers[0].clientY-e.pointers[1].clientY;Y.previousPinchDistance=Math.sqrt(Math.pow(t,2)+Math.pow(a,2))}),a.on("pinchout",function(e){var t=e.pointers[0].clientX-e.pointers[1].clientX,a=e.pointers[0].clientY-e.pointers[1].clientY;Y.previousPinchDistance=Math.sqrt(Math.pow(t,2)+Math.pow(a,2))}),a.on("pinchmove",function(e){var t=d.getActivePaneState(),a=t.getZoomDecimal(),n=e.pointers[0].clientX-e.pointers[1].clientX,o=e.pointers[0].clientY-e.pointers[1].clientY,i=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),r=i/Y.previousPinchDistance;if(!(r>.98&&r<1.02)){Y.previousPinchDistance=i;var s=r*a,l={clientX:e.center.x,clientY:e.center.y},u=Y.clickPointConverter(l,t,!1);u.x=u.x*r,u.y=u.y*r,virtualViewer.zoomToLocation(100*s,u.x,u.y)}})},Ae=function(e){var a,n=t.getLocalizedValue("errors.malformedJsonInMessage","VirtualViewer received an invalid command.");try{a=JSON.parse(e.data)}catch(e){return console.error(n),Promise.resolve(e)}switch(a.method){case"openInTab":virtualViewer.openInTab(a.id||a.documentId);case"compareDocuments":virtualViewer.compareDocuments(a.firstDocumentId,a.secondDocumentId,a.options);default:return Promise.resolve(e)}},Te=function(){s.disableImageTabs&&($("#vvImageTabs").remove(),$("#vvSplitPaneDiv").css({top:"0px"})),s.disableToolbar&&($("#vvToolbar").remove(),$("#vvImageAndThumbs").css({top:"10px"}),$(".vvRightPaneControlPanel").css({top:"68px"}),$("#vvAnnotationIndicatorToggle").css({top:"62px"}),$("#vvAnnButtonContainer").css({top:"66px"}),$("#vvSearchControls").css({top:"62px"})),s.disableAnnToolbar&&($("#vvAnnToolbar").remove(),$("#vvImageAndThumbs").css({left:"0px"}))};v.prototype.getOriginalPageDimensions=function(){if(!tn({state:!0}))return{};var e=C.getActivePaneState(),t=virtualViewer.scrollPageFinder(e),a=e.getOriginalHeightForPage(t),n=e.getOriginalWidthForPage(t);return{height:a,width:n}},v.prototype.splitScreen=function(a,n){if(!s.splitScreen){var o=t.getLocalizedValue("errors.splitScreenDisabled","Document Comparison has been disabled by the administrator."),r={client:!0,disable:this.disableErrorModals.splitScreen};return void vt(o,r)}n=n||"horizontal";var l=1,u=d.getOpenDocumentId(l),c=d.getCurrentState(0);if(!c){var o=t.getLocalizedValue("error.splitNotAllowed","Please open a document before entering compare document mode."),r={client:!0,disable:C.disableErrorModals.splitScreen};return void vt(o,r)}var g=C.getFromDocumentList(a);if(!g){var o=t.getLocalizedValue("errors.documentNotFound","Document not found: ")+a,r={client:!0,disable:C.disableErrorModals.documentNotFound};return void C.displayExceptionMessage(o,r)}if(t.dumbVideoExtensionCheck(g.documentId)||t.dumbVideoExtensionCheck(c.documentId)||t.dumbVideoExtensionCheck(g.displayName)||t.dumbVideoExtensionCheck(c.getDisplayName())){var o=t.getLocalizedValue("errors.splitVideoError","Document comparison is unsupported for video files."),r={client:!0,disable:C.disableErrorModals.splitScreen};return void C.displayExceptionMessage(o,r)}C.destroyInProgressAnnotation(),u&&(d.getStateForDocumentId(u,l).setClosedTab(!0),d.removeStateForDocumentId(u,l)),ae||(Se(n),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvSplitCanvas").contextMenu("vvSelectTextContextMenu",Je):$("#vvSplitScroller").contextMenu("vvSelectTextContextMenu",Je),$("#vvSplit1Panel").on("scroll",function(){var e=d.getCurrentState(1);e&&(C.paintCanvases(e),0!==C.getActivePane()||C.scrollingLocked||C.setActivePane(1))}),$("#vvSplit1Panel").on("scroll",function(){var e=d.getCurrentState(1);if(e&&!virtualViewer.skipScrollEvent){var t=Qt(e,!1,"#vvSplit1Panel");e.getPageNumber()!==t&&t<e.pageCount&&t>=0&&C.updatePage(t,e)}else virtualViewer.skipScrollEvent=!1}),$("#vvSplit1Panel").on("scroll",function(){if(virtualViewer.scrollingLocked){var e=$("#Split0 .vvOuter");if(e.length&&(e.scrollTop()!==$(this).scrollTop()||e.scrollLeft()!==$(this).scrollLeft())){var t=$(this);le&&clearTimeout(le),le=setTimeout(function(){wa(t,e,!0)},5),Math.abs($(this).scrollTop()-oe)>=100&&wa(t,e,!0)}}}),Y.initEvents($("#vvSplit1Panel")),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvSplitCanvas").bind("contextmenu",C.annPopUpHandler):$("#vvSplitScroller").bind("contextmenu",C.annPopUpHandler),Modernizr.touchevents&&Pe($("#vvSplit1Panel")));var v=d.openNewState({documentId:a,pageNumber:0,tabNumber:this.tabs.length,zoomMode:j.getDefaultZoomMode(),paneIndex:l,displayName:g.displayName});null===this.zoomLocked&&(this.zoomLocked=s.zoomLock!==!1),d.setDisplayedState(v,l),ae=!0,C.setActivePane(l),v.setClosedTab(!1),this.zoomLocked?c.getZoomMode()===i.zoomModes.fitCustom?(v.setZoom(c.getZoom()),v.setZoomMode(i.zoomModes.fitCustom)):v.setZoomMode(c.getZoomMode()):(v.setZoomMode(j.getDefaultZoomMode()),v.setZoom(j.getDefaultZoomLevel())),Y.setDragMode(i.dragModes.pan),Ht(v),v.requestDocumentModel(!1),s.multipleDocMode===i.multipleDocModes.viewedDocuments&&e("vvThumbs").loadVisibleThumbs($("#vvDocThumbs")),virtualViewer.paintCanvases(v),G.getMagnifierEnabled()&&(G.toggleMagnifier(),G.initMagnifier(),G.toggleMagnifier()),virtualViewer.sizeScroller({state:d.getCurrentState(0)}),d.getCurrentState(0).isMedia()&&d.getCurrentState(0).getMediaManager().resizeVideo(),C.lockScrolling(s.splitScrollLock),X.call("onSplitScreenComplete",{documentId:v.getDocumentId(),paneIndex:v.currentPaneIndex})};var Se=function(e){for(var a,n,o,i=s.screenSizes||[50,50],r=i.length,l=[],u=$("#vvSplitPaneDiv"),c=0;c<r;c++)a="#Split"+c,l.push(a);for(c=0;c<l.length;c++)n=$("<div></div>").attr("id",l[c].replace("#","")).addClass("split split-"+e+" vvActivePane"),u.append(n);if(0!==l.length){var g=Split(l,{sizes:s.screenSizes||[50,50],direction:e,onDrag:virtualViewer.paintCanvases});d.setSplit(g),$("#Split0").append($("#vvOuterDiv")),o=$("<div></div>").addClass("vvOuter"),o.attr("id","vv"+l[1].replace("#","")+"Panel"),$(o).width($("#Split1").width()),$(o).height($("#Split1").height()),$("#Split1").append(o);var v=$("<div></div>");$(v).attr("id","vvSplitScroller"),$(v).addClass("vvScroller"),$(o).append(v),s.imageScrollBars===!0?$(o).removeClass("panMode"):$(o).addClass("panMode");var p=$("<div></div>");$(p).attr("id","vvInnerSplitDiv"),$(p).addClass("vvInner"),$(o).append(p);var h=$("<canvas></canvas>");$(h).attr("id","vvSplitCanvas"),$(h).addClass("vvCanvas"),$(p).append(h);var m=$("<button id='vvSplitCloseButton'><span id='vvSplitCloseX' aria-hidden='true' class='close'>&times;</span>&nbsp;</button>").append($("<span id='vvSplitCloseText'></span>").text(t.getLocalizedValue("closeSplitButton.buttonText","Close"))).on("click",function(){var e=d.getCurrentState(1);if(e){var t=e.documentModel;t.getModifiedSinceInit()?C.confirmCloseDialog(e):C.undoSplitScreen()}});m.appendTo(v)}};v.prototype.removeUndoSplit=function(){$("#vvSplitCloseButton").remove(),$("#vvUndoSplitPane").remove()},v.prototype.indexInDocumentList=function(e){for(var t=this.documentList,a=0;a<t.length;a++)if(t[a].documentId===e)return a;return-1},v.prototype.isInDocumentList=function(e){return!!virtualViewer.getFromDocumentList(e)},v.prototype.getFromDocumentList=function(e){for(var t=this.documentList,a=0;a<t.length;a++)if(t[a].documentId===e)return t[a];return null},v.prototype.isOnImage=function(e){var t=d.getActivePaneState(),a=t.getPageNumber(),n=t.getRequestedWidthForPage(a);return!(e.x<0||e.x>n)},v.prototype.getSplitDocumentId=function(){return d.getOpenDocumentId(1)},v.prototype.getActivePane=function(){return ne},v.prototype.setActivePane=function(e){e=e||0,e=parseInt(e,10);var t=!1;return ne!==e&&(t=!0),ne=e,d.setActivePane(e),C.indicateActivePane(e),t&&we(e),t},v.prototype.getSplitObjects=function(){return d.splitInstance},v.prototype.getSplit=function(){return ae},v.prototype.getActivePaneState=function(){return d.getActivePaneState()},v.prototype.getActiveOuterDiv=function(){var e=C.getActivePane();return 1===e?$("#vvSplit1Panel"):$("#vvOuterDiv")},v.prototype.getOuterDivFromState=function(e){return d.getOuterDivFromState(e)};var Ie=function(t){if(t.getDocumentModel()&&t.getDocumentModel().model&&0!==!t.currentPaneIndex){var a=e("vvThumbs");a.fillPageThumbs(t),a.ensurePageThumbIsVisible(t),a.loadVisibleThumbs($("#vvPageThumbs")),a.loadVisibleThumbs($("#vvDocThumbs")),C.getBookmarks().loadBookmarks(t),C.getDocumentNotes().loadDocumentNotes(),ee=C.pagesWithAnnotations(),te&&C.showThumbsWithAnnotations()}},we=function(e){1===e?($(".thumbTabs").addClass("disabled disabledTab"),$("#vvDocThumbsTab, #vvDocCompareTab").removeClass("disabled disabledTab"),$("#vvMagnifierButton").attr("aria-disabled",!0),$(".thumbTabs.active.disabled").length&&virtualViewer.openDefaultThumb()):$(".thumbTabs").hasClass("disabled disabledTab")&&($(".thumbTabs").removeClass("disabled disabledTab"),$("#vvMagnifierButton").attr("aria-disabled",!1))};v.prototype.indicateActivePane=function(e){if(!ae)return void $(".vvActivePane").removeClass("vvActivePane");var t=e;$(".vvActivePane").removeClass("vvActivePane"),$("#Split"+t).addClass("vvActivePane");var a=d.getActivePaneState();Da(a)},v.prototype.undoSplitScreen=function(){if($("#vvDocCompare.active").length&&C.openDefaultThumb(),$("#vvDocCompare, #vvDocCompareTab").removeClass("active"),$("#vvDocCompareTab").hide().removeClass("vvAllowedTab"),Wa(),ae){var e=d.getCurrentState(1);if(tn({state:!0},e)){C.destroyInProgressAnnotation(),e.setClosedTab(!0),d.removeStateForDocumentId(e.getDocumentId(),1),$("#vvSplitPaneDiv").append($("#vvOuterDiv")),d.splitInstance.destroy(),$(".split").remove(),$("#vvOuterDiv").eq(0).css({height:"100%",width:"100%"}),we(0),ae=!1,C.setActivePane(0);var t=d.getCurrentState(0);C.lockScrolling(!1),Da(),C.clearCanvases(t),C.delayedPaintCanvases()}}};var De=function(){"Explorer"===BrowserDetect.browser&&BrowserDetect.version<=11?$("#vvImageCanvas").bind("contextmenu",C.annPopUpHandler):$("#vvDummyScroller").bind("contextmenu",C.annPopUpHandler)},Ce=function(){if("true"!==$(this).attr("aria-disabled")){if($(this).hasClass("selectedAnn"))return void virtualViewer.disableStickyAnnotationButton();if($(this).hasClass("vvHasSubDropdown")){var e=$(this).parent("li").data("group"),t="#"+e+"Mid";return void(e&&$(t+":visible").length&&$(t+" ul.dropdown-menu").hide())}var a=$(this).data("button-id");if(!a)return void $("#vvToolbar ul.dropdown-menu, #vvAnnToolbar ul.dropdown-menu").hide();var n,o=l(virtualViewer);if(n=$(this).parent("li").hasClass("vvAdvancedSaveOptions")?Ne()[a]:o.imageToolbarButtons[a],n||(n=o.annotationToolbarButtons[a]),n&&(n.clickHandler||n.annType)){var i,r=n.clickHandler;if(!r&&n.annType&&(i=n.annType,r=function(){virtualViewer.turnOnAnnotationButton(i,$("."+a))}),!$("#vvImageAndThumbs:visible").length)return virtualViewer.toggleHamburgerMenu(),void r.call(virtualViewer);var s=$(this).parents(".dropdown-menu");return s.length?void s.parent().on("hidden.bs.dropdown",function(){$(this).off("hidden.bs.dropdown"),r.call(virtualViewer)}):void r.call(virtualViewer)}}},Me=function(e,a){for(var n in e)if(e[n]){if(e[n].localizeKey){var o=e[n].localizeKey+".title";e[n].name=t.getLocalizedValue(o)}e[n].annotationToolbar=a}e.vvSaveDocument&&s.enableAdvancedSaveMenu&&(e.vvSaveDocument.hasSubMenu=!0),e.vvAnnText&&s.enableTextRubberStamp&&(e.vvAnnText.hasSubMenu=!0),e.vvAnnImageRubberStamp&&(e.vvAnnImageRubberStamp.hasSubMenu=!0);for(var i=$($("#vvGenericToolbarItem").render(e)),r=0;r<i.length;r++){var u=$(i[r]).data("group");u&&l(v).toolbarButtonLogicalGroups[u]?$(i[r]).appendTo("."+u).hide().show():a?$(i[r]).appendTo($("#vvUncategorizedAnnToolbarItems")):$(i[r]).appendTo($("#vvUncategorizedToolbarItems")),a&&$(i[r]).clone().appendTo("#vvAnnToolbarHamburgerItems").addClass("hidden-sm hidden-md hidden-lg")}},xe=function(){$("#vvThumbToggleButton").on("click",virtualViewer.toggleThumbnailPanel),$("#vvToolbarHamburger").on("click",virtualViewer.toggleHamburgerMenu),$("a.vvToolbarItem").on("click",Ce),$("a.vvToolbarItem").on("click",function(e){e.preventDefault()}),$("a.vvToolbarItem").on("dragstart",function(e){e.preventDefault()}),$("a.vvToolbarItem").on("click",function(e){if(virtualViewer.getEventManager().dragging||"true"===$(this).attr("aria-disabled"))return void e.stopImmediatePropagation()}),$("form.vvJumpToPage").on("submit",function(e){return e.preventDefault(),$(this).blur(),!1}),$(".vvJumpToPageInput").bind("click",function(e){"true"!==$(".vvJumpToPage").attr("aria-disabled")&&$(this).select()}),"Explorer"===BrowserDetect.browser&&$(".vvJumpToPageInput").on("keypress",function(e){13===e.keyCode&&$(this).blur()}),$(".vvJumpToPageInput").on("change",function(e){if("true"!==$(".vvJumpToPage").attr("aria-disabled")){var t=parseInt($(this).val(),10);Ca(t-1)&&($("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),C.setPage(t-1))}}),$("#vvMidSizeToolbarItems .vvHasSubDropdown, #vvMidSizeAnnToolbarItems .vvHasSubDropdown").on("click",function(e){$(this).find('a[data-toggle="dropdown"]').length&&($(this).find(".dropdown-menu").children().length>0&&$(this).find(".dropdown-menu").toggle(),e.stopPropagation(),e.preventDefault())}),$("#vvMidSizeAnnToolbarItems > .dropdown").on("click",function(){$(this).hasClass("selectedAnn")&&virtualViewer.disableStickyAnnotationButton()}),$("#vvAnnToolbar li.vvToolbarItem > a > .icon").data("placement","right"),$("a.vvToolbarItem, #vvToolbarHamburger, #vvThumbToggleButton, .vvToolbarButton, .vvDiffButton").mousedown(function(e){"true"!==$(this).attr("aria-disabled")&&1===e.which&&$(this).addClass("mouseDown")}),$("a.vvToolbarItem, #vvToolbarHamburger, #vvThumbToggleButton, .vvToolbarButton, .vvDiffButton").mouseup(function(e){1===e.which&&($(this).removeClass("mouseDown"),$(this).blur())}),$("a.vvToolbarItem, #vvToolbarHamburger, #vvThumbToggleButton, .vvToolbarButton, .vvDiffButton").mouseleave(function(){$(this).removeClass("mouseDown")})};v.prototype.initToolbar=function(){var e=$("#vvAnnToolbar"),a=$("#vvToolbarItems"),n=$("#vvAnnToolbarItems"),o=$("#vvMidSizeAnnToolbarItems"),i=$("#vvMidSizeToolbarItems");$("#vvToolbar").prop("aria-label",t.getLocalizedValue("utilityToolbar.title"),"Main Toolbar"),e.prop("aria-label",t.getLocalizedValue("annToolbar.title"),"Annotation Toolbar");var r=l(virtualViewer),u=r.toolbarButtonLogicalGroups;for(var d in u)u[d]&&u[d].localizeKey&&(u[d].groupTitle=t.getLocalizedValue(u[d].localizeKey+".title"));for(var c=$($("#vvGenericGroupItem").render(u)),g=0;g<c.length;g++){var v=$(c[g]);v.hasClass("vvMidAnnotationToolbarGroup")?(o.append(v),s.disableToolbarHamburger&&v.removeClass("hidden-xs")):v.hasClass("vvMidImageToolbarGroup")?i.append(v):v.hasClass("vvImageToolbarGroup")?i.before(v):v.hasClass("vvAnnotationToolbarGroup")&&o.before(v)}Me(r.imageToolbarButtons),Me(r.annotationToolbarButtons,!0),Le(),$(".vvToolbarItem.vvEndSubGroup").after($("<span></span>").addClass("hidden-xs vvSubGroupSeparator")),xe(),s.disableToolbarHamburger&&(i.children().removeClass("hidden-xs"),e.removeClass("hidden-xs"),n.find("span.toolbar-icon").removeClass("hidden-xs")),a.addClass("overflowScroll"),$("li.vvHasSubDropdown").on("show.bs.dropdown",function(e){$(e.relatedTarget).tooltip("hide")})},v.prototype.toggleHamburgerMenu=function(e){e&&e.stopImmediatePropagation(),"true"===$("#vvToolbarItems").attr("aria-expanded")?($("#vvImageAndThumbs").show(),$("#vvToolbarItems").attr("aria-expanded","false"),$("#vvToolbarItems").hide()):($("#vvImageAndThumbs").hide(),$("#vvToolbarItems").attr("aria-expanded","true"),$("#vvToolbarItems").show(),virtualViewer.disableStickyAnnotationButton())};var Le=function(){if(s.enableAdvancedSaveMenu){var e=Ne();for(var a in e)if(e[a]&&e[a].localizeKey){var n=e[a].localizeKey+".title";e[a].name=t.getLocalizedValue(n)}var o=$($("#vvGenericToolbarItem").render(e)).addClass("vvAdvancedSaveOptions");o.appendTo("li.vvSaveDocument ul.dropdown-menu"),$("li.vvSaveDocument ul.dropdown-menu a[data-tooltip='tooltip']").attr("data-tooltip","")}else $(".vvSaveDocument.vvHasSubDropdown, .vvSaveDocument.dropdown").removeClass("vvHasSubDropdown dropdown"),$("a.vvSaveDocument.dropdown-toggle").attr("data-toggle","")},Ne=function(){return{vvAdvancedSave:{clickHandler:virtualViewer.saveDocument,localizeKey:"utilityToolbar.saveDocument.saveMenuOption"},vvAdvancedSaveRedactions:{clickHandler:function(){var t=function(){virtualViewer.getDocumentModel().setPagesModifiedSinceInit(!0),virtualViewer.saveDocument(null,{burnRedactions:!0,includeRedactionTags:!0})};s.enableAdvancedSaveWarning?e("vvDialogs").permanentChangeDialog(t):t()},localizeKey:"utilityToolbar.saveDocument.saveWithRedactionsMenuOption"},vvAdvancedSaveRedactionsAnnotations:{clickHandler:function(){var t=function(){virtualViewer.getDocumentModel().setPagesModifiedSinceInit(!0),virtualViewer.saveDocument(null,{burnRedactions:!0,includeRedactionTags:!0,includeTextAnnotations:!0,includeNonTextAnnotations:!0,copyAnnotations:!1})};s.enableAdvancedSaveWarning?e("vvDialogs").permanentChangeDialog(t):t()},localizeKey:"utilityToolbar.saveDocument.saveWithRedactionsAnnotationsMenuOptions"}}};v.prototype.validateZoomLevels=function(){var e=!0;if(s.zoomLevels)for(var t=0;t<s.zoomLevels.length;t++){var a=s.zoomLevels[t];t>0&&a<=s.zoomLevels[t-1]&&(e=!1),a<=0&&(e=!1)}else e=!1;e||(s.zoomLevels=i.defaultZoomLevels)};var $e=function(){$("#vvToggleDiffHighlightingBtn").on("click",function(){$(this).prop("disabled")||($(this).toggleClass("vvDiffHighlightVisible"),$(this).toggleClass("vvDiffHighlightNotVisible"),d.getCurrentDiff().showHighlights=!d.getCurrentDiff().showHighlights,virtualViewer.paintCanvases())}),$("#vvLockScrollingBtn").on("click",function(){$(this).prop("disabled")||virtualViewer.lockScrolling(!virtualViewer.scrollingLocked)}),$("#vvRefreshDiffBtn").on("click",function(){if(!$(this).prop("disabled")){var e=d.getCurrentDiff();if(!e||e.diffDisabled)return void virtualViewer.performDiff(!1,!0);e.startDiff(),qa()}}),$("#vvDocCompareInternal").on("scroll",function(){var e=$("#fixedPageLabel").data("currentPage"),a=e||0,n=$(".diffPageContainer[pageNumber='"+a+"']"),o=n.position();if(n.hasClass("in")&&o.top<=0&&o.top+n.height()>0){if(t.getLocalizedValue("thumbPageLabel","Page ")+(a+1)===$("#fixedPageLabel").text())return;return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(a+1)),void $("#fixedPageLabel").data("currentPage",a)}var i=$(".diffPageContainer.collapse");if(n.position().top>0){for(var r=a-1;r>=0;r--)if(i.eq(r).hasClass("in")){if(o=i.eq(r).position(),o.top<=0&&o.top+i.eq(r).height()>0)return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(r+1)),void $("#fixedPageLabel").data("currentPage",r);if(o.top+i.eq(r).height()<0)return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",r)}return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",0)}for(var s=a+1;s<i.length;s++)if(i.eq(s).hasClass("in")){if(o=i.eq(s).position(),o.top<=0&&o.top+i.eq(s).height()>0)return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(s+1)),void $("#fixedPageLabel").data("currentPage",s);if(o.top>0)return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",a)}$("#fixedPageLabel").text(""),$("#fixedPageLabel").data("currentPage",0)})},Ve=function(){e("vvDialogs").init(),$("#vvRedactionWarningDialogOKButton").text(t.getLocalizedValue("redactionWarningDialog.okButton","OK")),$("#vvRedactionWarningDialogOKButton").click(function(e){$("#vvRedactionWarningDialog").modal("hide")}),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.redactedVersionTitle","Creating a Redacted Version")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.redactedVersionText","error")+"</p>"),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.searchAndRedactTitle","Search and Redact")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.searchAndRedactText","error")+"</p>"),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.visualVerificationTitle","Visual Verification")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.visualVerificationText","error")+"</p>"),$("#vvOverwriteDialogOverwriteButton").click(function(){var e=d.getActivePaneState(),t=e.getDocumentId();C.saveDocument(t,{skipOverwriteDialog:!0}),$("#vvOverwriteDialog").modal("hide")}),$("#vvOverwriteDialogSaveAsButton").click(function(){$("#vvOverwriteDialog").modal("hide"),C.saveDocumentAsDialog()}),$("#vvConfirmCropDialogOK").click(function(){if(virtualViewer.cropPageClient()){var e=d.getActivePaneState();C.updateTabName(e)}else virtualViewer.delayedPaintCanvases();$("#vvConfirmCropDialog").modal("toggle")}),$("#vvConfirmCropDialog").on("hidden.bs.modal",function(){Y.clean(),virtualViewer.delayedPaintCanvases()}),$("#vvConfirmCropDialogCancel").click(function(){d.getActivePaneState().removeCropOnPage(),virtualViewer.delayedPaintCanvases()}),$("#pictureControlsClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvPictureControlsDialogCancelButton,#pictureControlsClose").click(function(e){var t=d.getActivePaneState(),a=t.getDocumentModel().getModifiedSinceInit();t&&a&&(t.setContrastForPage(t.pageNumber,i.defaultContrastValue),t.setBrightnessForPage(t.pageNumber,i.defaultBrightnessValue),t.setGammaForPage(t.pageNumber,i.defaultGammaValue),$("#vvContrastSlider").slider("setValue",i.defaultContrastValue),$("#vvBrightnessSlider").slider("setValue",i.defaultBrightnessValue),$("#vvGammaSlider").slider("setValue",i.defaultGammaValue),$("#vvContrastSliderVal").html(i.defaultContrastValue),$("#vvBrightnessSliderVal").html(i.defaultBrightnessValue),$("#vvGammaSliderVal").html(i.defaultGammaValue),t.imageManager.throttledRequestImageBatch(t))}),
$("#imageInfoClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvImageInfoTitle").html(t.getLocalizedValue("imageInfo.dialogTitle","Document & Page Properties")),$("#vvImageInfoDialogOKButton").text(t.getLocalizedValue("aboutDialog.okButton","OK")),$("#aboutClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvAboutDialogText").html(t.getLocalizedValue("aboutDialog.text",i.aboutDialogTextContents)),$("#vvAboutDialogTitle").html(t.getLocalizedValue("aboutDialog.productName",i.productName)+" "+t.getLocalizedValue("aboutDialog.versionPrefix","v")+i.productVersion),$("#vvAboutDialogOKButton").text(t.getLocalizedValue("aboutDialog.okButton","OK")),$("#vvAboutDialogCancelButton").text(t.getLocalizedValue("aboutDialog.helpButton","Help")),$("#vvAboutDialogOKButton").click(function(e){$("#vvAboutDialog").modal("hide")}),$("#vvAboutDialogCancelButton").click(function(e){window.open(s.helpURL,s.helpWindowName,s.helpWindowParams),$("#vvAboutDialog").modal("hide")});var a=t.getLocalizedValue("clipboardDialog.clipboardTitleStart","Copy to clipboard"),n="Ctrl-C",o=navigator.platform.toUpperCase().indexOf("MAC")>=0;o&&(n="Command-C");var r=a+": "+n;$("#vvClipboardTitle").html(r),g.initKeyboardHintsContent();var l=$("#vvExportUnsupportedFileDialog");l.find(".download-button").click(function(){C.downloadDocument(l.data().documentId),l.modal("hide")}),l.on("hidden.bs.modal",function(){var e=d.getStateForDocumentId(l.data().documentId);e&&(e.closedTab||C.closeTab(e.getTabNumber(),!0),d.removeStateForDocumentId(e.getDocumentId(),e.currentPaneIndex)),H=!1});var u=$("#vvPasswordProtectedFileDialog");u.find(".download-button").click(function(){C.downloadDocument(u.data().documentId),u.modal("hide")}),u.on("hidden.bs.modal",function(){var e=d.getStateForDocumentId(u.data().documentId);e&&(e.closedTab||C.closeTab(e.getTabNumber(),!0),d.removeStateForDocumentId(e.getDocumentId(),e.currentPaneIndex)),H=!1}),$("#bookmarksClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvBookmarkDialogOKButton").click(function(e){var t=virtualViewer.getCurrentState().documentModel,a=t.getSelectedPageNumbers()[0],n=$("#vvBookmarkDialogNoteInput").val();null===C.getBookmarks().editingBookmark?C.addBookmark(n,a):C.getBookmarks().saveEditedBookmark(n),$("#vvBookmarkDialogNoteInput").val(""),$("#vvBookmarkDialog").modal("hide")}),$("#vvBookmarkDialogCancelButton").click(function(e){$("#vvBookmarkDialogNoteInput").val(""),C.getBookmarks().editingBookmark=null}),$("#vvBookmarkDialog").on("hidden.bs.modal",function(e){$("#vvBookmarkDialogNoteInput").val(""),C.getBookmarks().editingBookmark=null}),$("#vvUploadLocalFileForm .file-clicker").click(function(e){$(this).attr("disabled")||(e.preventDefault(),$("#vvUploadLocalFileForm input[type=file]").click())}),$("#vvUploadLocalFileForm input[type=file]").change(function(){var e=$(this).val(),t=e.substring(e.lastIndexOf("/")+1);t=t.substring(e.lastIndexOf("\\")+1),$("#vvUploadLocalFileForm .upload-file-info").text(t)}),$("#vvUploadLocalFilesDialog").on("show.bs.modal",function(){$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1),$("#vvUploadLocalFileForm")[0].reset(),$("#vvUploadLocalFilesDialog .upload-file-info").text("")}),$("#vvUploadLocalFileDialogOK").click(virtualViewer.uploadDocument),Oa()},ke=function(e){var t=e.getPageNumber(),a=e.getPageCount();$(".vvGoToFirstPage").attr("aria-disabled",t<=0||a<=1),$(".vvGoToPreviousPage").attr("aria-disabled",t<=0||a<=1),$(".vvGoToNextPage").attr("aria-disabled",a<=1||t+1===a),$(".vvGoToLastPage").attr("aria-disabled",a<=1||t+1===a)};v.prototype.applyToolbarButtonConfigurations=function(e){Re(e)};var Re=function(e){e=e||d.getActivePaneState(),C.disableUploadDocument?$(".vvFileUpload").remove():null!==C.disableUploadDocument&&j.fileUploadVisible&&j.imageControlToolbar[0].on?$(".vvFileUpload").show():$(".vvFileUpload").hide(),s.disableUserPreferences&&$(".vvUserPreferences").remove(),e&&!e.isMedia()&&e.documentFullyLoaded()?($(".vvJumpToPageInput").prop("disabled",!1),$(".vvToolbarItem").attr("aria-disabled","false").removeClass("disabled"),s.oneLayerPerAnnotation&&!e.imageLayers&&$(".vvLayerManager").attr("aria-disabled",!0).addClass("disabled"),virtualViewer.checkRedactionsEnabled()||$(".vvRedactionRect").attr("aria-disabled",!0).addClass("disabled"),ke(e),e.xlsxPageLimited&&$(".vvSaveDocument, .vvSaveDocumentAs, .vvExportDocument, .vvEmailDocument, .vvPrint").attr("aria-disabled",!0).addClass("disabled")):($(".vvJumpToPageInput").prop("disabled",!0),$(".vvToolbarItem").attr("aria-disabled","true").addClass("disabled"),$(".vvAbout, .vvUserPreferences, #vvThumbToggleButton, .vvFileUpload").attr("aria-disabled","false").removeClass("disabled"),$("#vvMidSizeToolbarItems > li > a.dropdown-toggle, #vvMidSizeAnnToolbarItems > li > a.dropdown-toggle").attr("aria-disabled","false").removeClass("disabled")),s.readOnlyAnnotationMode&&e&&Be();for(var t=$(".vvMidAnnotationToolbarGroup, .vvMidImageToolbarGroup"),a=0;a<t.length;a++){var n=$(t[a]).find("li.vvToolbarItem"),o=$(t[a]);n.length?n.not(".disabled").length?(o.children("button").removeClass("disabled"),o.attr("aria-disabled",!1).removeClass("disabled"),o.children(".dropdown-toggle").attr("aria-disabled",!1)):(o.children("button").addClass("disabled"),o.attr("aria-disabled",!0).addClass("disabled"),o.children(".dropdown-toggle").attr("aria-disabled",!0)):o.remove(),n.hasClass("vvPreferenceDisabled")&&!n.hasClass("vvPreferenceEnabled")?o.hide():o.show()}Modernizr.speechsynthesis||$(".vvSpeechSynthesis").remove()},Be=function(){$("li.vvToolbarItem[data-anntype], li.vvToolbarItem[data-anntype] > a").attr("aria-disabled",!0).addClass("disabled").tooltip("hide")};v.prototype.mediaThumbPrep=function(e){return e&&e.isMedia()?($(".thumbTabs").addClass("disabledTab"),$("#vvDocThumbsTab").removeClass("disabledTab"),C.openDefaultThumb(i.thumbnailTabs.document),!0):($(".thumbTabs").removeClass("disabledTab"),!1)};var Fe=function(){Re()},Ee=function(){$("#vvPlayButton").on("click",function(e){var t=C.getActivePaneState();K.getStartedPlaying()===!1?(K.setStartedPlaying(!0),K.playSpeechSynthesisForPage(t.getPageNumber())):window.speechSynthesis.resume()}),$("#vvPauseButton").on("click",function(e){window.speechSynthesis.pause()}),$("#vvNextButton").on("click",function(e){K.setButtonClicked("next"),K.getStartedPlaying()&&window.speechSynthesis.cancel(),K.setSpeechNextPage(!0),C.nextPage(),Oe()}),$("#vvPreviousButton").on("click",function(e){K.setButtonClicked("previous"),K.getStartedPlaying()&&window.speechSynthesis.cancel(),K.setSpeechPreviousPage(!0),C.previousPage(),Oe()}),$("#vvStopButton").on("click",function(e){K.stopSpeech()})},Oe=function(){var e=d.getActivePaneState(),t=e.getPageNumber(),a=e.getPageCount(),n=t<=0||a<=1,o=a<=1||t+1===a;n?$(".vvPreviousButton").attr("aria-disabled",n).addClass("nonselectable disabled"):$(".vvPreviousButton").attr("aria-disabled",n).removeClass("nonselectable disabled"),o?$(".vvNextButton").attr("aria-disabled",o).addClass("nonselectable disabled"):$(".vvNextButton").attr("aria-disabled",n).removeClass("nonselectable disabled")},Ue=function(){$("#vvThumbsTabs").css("visibility","visible"),$("#vvSearch").css("visibility","visible"),$("#vvNotesTab").css("visibility","visible"),$("#vvBookmarksTab").css("visibility","visible"),$("#vvUPToolbarConfigTab").css("visibility","visible"),$("#vvUPAnnotationPropTab").css("visibility","visible"),$("#vvUPCustomTextStampsTab").css("visibility","visible"),$("#vvUPNotesTemplateTab").css("visibility","visible"),$("#vvUPMediaTab").css("visibility","visible"),$("#vvUPGeneralTab").css("visibility","visible"),$(".thumbTabs > a").on("dragstart",function(e){e.preventDefault()});var a=e("vvThumbs");if(s.showThumbnailPanel===!1||s.showPageThumbnails===!1&&s.showDocThumbnails===!1&&s.showSearch===!1?virtualViewer.toggleThumbnailPanel(!1):$("#vvThumbs").width()>$("#vvImageAndThumbs").width()/3?virtualViewer.toggleThumbnailPanel(!1):virtualViewer.toggleThumbnailPanel(!0),s.enableDocumentNotes===!1&&$("#vvNotesTab").hide().removeClass("vvAllowedTab"),s.showPageThumbnails===!1&&($("#vvPageThumbsTab").hide().removeClass("vvAllowedTab"),$("#vvThumbs li:eq(1) a").tab("show")),s.showDocThumbnails===!1&&$("#vvDocThumbsTab").hide().removeClass("vvAllowedTab"),s.showSearch===!1&&$("#vvSearchTab").hide().removeClass("vvAllowedTab"),s.showBookmarkThumbnails===!1&&$("#vvBookmarksTab").hide().removeClass("vvAllowedTab"),s.showAnnotationList===!1&&$("#vvAnnotationsListTab").hide().removeClass("vvAllowedTab"),s.showDocumentFilter){$("#vvDocThumbs").addClass("show-control-panel");var n=null,o=$("#vvDocThumbsSearch .displayNameSearch");o.attr("placeholder",t.getLocalizedValue("documentFilterPlaceholderText","Filter")),o.addClear({symbolClass:"text_clear_symbol icon",onClear:function(){virtualViewer.filterDocumentThumbsByDisplayName()}}),o.keydown(function(){n&&clearTimeout(n),n=setTimeout(function(){virtualViewer.filterDocumentThumbsByDisplayName(o.val())},200)})}ze(),$(".docTabs").on("shown.bs.tab",function(e){var t=$(".thumbTabs.active").index();C.tabs[t]&&C.activeTab!==t&&C.switchToTab(C.getStateForDocumentId(C.tabs[t]))}),$("#vvDocThumbsTab").on("click",function(e){setTimeout(function(e){a.loadVisibleThumbs($("#vvDocThumbs"))},200),s.showDocumentFilter&&setTimeout(function(e){$("#vvDocThumbsSearch").find(".form-control").first().focus()})}),$("#vvPageThumbsTab").on("shown.bs.tab",function(e){setTimeout(function(e){a.loadVisibleThumbs($("#vvPageThumbs")),a.ensurePageThumbIsVisible(C.getActivePaneState())},200),C.getActivePaneState()&&_e()}),$("#vvSearchTab").on("shown.bs.tab",function(){setTimeout(function(e){a.loadVisibleThumbs($("#vvSearchResults")),c.updateSearchButtons()},200),$("#vvSearchTermField").focus()}),$("#vvAnnotationsListTab").on("shown.bs.tab",function(){$("#vvAnnotationsList").find(".form-control").first().focus()}),$("#vvNotesTab").on("shown.bs.tab",function(){$("#vvDocumentNotes").find(".form-control").first().focus()})},_e=function(){s.showAnnNavToggle?($("#vvAnnotationIndicatorToggle").show(),virtualViewer.showAnnotationNaviPanel($("#vvPageThumbs").hasClass("vvAnnotationNavigation"))):($("#vvAnnotationIndicatorToggle").hide(),$("#vvPageThumbs").removeClass("vvAnnotationNavigation vvAnnotationNavigationHidden"))},ze=function(e){var t=$("#vvImageTabs"),a=t.innerHeight(),n=40;if(a>=n&&!C.shortTabNames)return C.shortTabNames=!0,void C.updateAllTabNames(!0);if(a<n&&C.shortTabNames&&!e){var o=200*C.tabs.length;if($("#vvImageTabs").width()>o)return C.shortTabNames=!1,void C.updateAllTabNames(!0)}if(a>=n)for(;a>n;){var i=t.children("li:not(:last-child)"),r=i.length;$(i[r-1]).prependTo("#collapsed"),a=t.innerHeight()}else for(var s=$("#collapsed").children("li"),l=0;l<s.length&&a<n;l+=1)$(s[l]).insertBefore(t.children("li:last-child")),a=t.innerHeight();$("#collapsed").children("li").length>0?$("#collapseTab").show():$("#collapseTab").hide().tooltip("hide"),a=t.innerHeight(),a>n&&ze()},We=function(e){if($("#vvNotesTab").removeClass("disabled"),e.isVirtualDocument()){$("#vvNotesTab").addClass("disabledTab"),$("#vvNotesTab").removeAttr("data-toggle");var a=t.getLocalizedValue("errors.virtualDocumentNotes","Notes are not yet supported for Virtual Documents.");$("#vvNotesTabSpan").attr("title",a),$("#vvBookmarksTab").addClass("disabledTab"),$("#vvBookmarksTab").removeAttr("data-toggle"),a=t.getLocalizedValue("errors.virtualDocumentBookmarks","Bookmarks are not yet supported for Virtual Documents."),$("#vvBookmarksTabSpan").attr("title",a)}},He=function(){if($(".vvAnnPopUpButton").each(function(){var e=$(this).val();$(this).val($("<div />").html(e).text())}),a.createColorPicker($("#vvAnnLineColorChoices"),Ia),a.createColorPicker($("#vvAnnFillColorChoices"),Ia),a.createColorPicker($("#vvAnnTextColorChoices"),Ia),s.annotationTags.length>0){$("#vvAddTagButton").html(t.getLocalizedValue("annotationTag.addButton","Add Tag")+"<div class='vvAnnTagInnerButton'>+</div>");for(var e=0;e<s.annotationTags.length;e++)$("#vvAnnTagList").append(Gt(s.annotationTags[e]))}$(".vvTagOption").on("click",function(){var e=virtualViewer.getCurrentAnnObject(),t=d.getActivePaneState(),a=!0,n=$(this).text();if(""===n)a=!1;else{0===e.annotationTags.length&&$("#vvAnnTagChosen").show();for(var o=0;o<e.annotationTags.length;o++)if(e.annotationTags[o]===n){a=!1;break}}if("vvRedaction"===e.layerName&&1===e.annotationTags.length&&a&&(e.annotationTags=[],$("#vvAnnTagChosen").children().remove()),a){e.annotationTags.push(n);var i=qt(n);$("#vvAnnTagChosen").append(i),i.find(".vvAnnTagCloseButton").on("click",Yt),e.markRevised(),u.markLayerWithAnnDirty(e),t.getNewAnnList().indexOf(e)===-1&&t.setTrueAnnChange(!0),jt(n)}});for(var n=0;n<i.fontNames.length;n+=1)$("#vvAnnTextFaceSelect").append("<option>"+i.fontNames[n]+"</option>");for(var o=0;o<i.fontSizes.length;o+=1)$("#vvAnnTextSizeSelect").append("<option>"+i.fontSizes[o]+"</option>");$("#vvAnnotationRevisionHistory").on("hide.bs.collapse",function(e){$("#vvAnnPopUpForm").removeClass("vvDisplayingRevisionHistory")}),$("#vvAnnotationRevisionHistory").on("show.bs.collapse",function(e){$("#vvAnnPopUpForm").addClass("vvDisplayingRevisionHistory")}),$("#vvAnnPopUp .vvAnnThicknessCell").click(function(){var e=$(this).children(".vvAnnThicknessElement").css("width");e=parseInt(e.replace(/px/i,""),10),$("#vvAnnPopUp .vvAnnThicknessCell").attr("aria-pressed","false"),$(this).attr("aria-pressed","true"),$("#vvAnnLineSizeValue").html(e);var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a),o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,a.setLineWidth(e,!0),o.modifiedAnn=a.clone(),o.type="modify",a&&a.markRevised(),o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),u.markLayerWithAnnDirty(a),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnTextFaceSelect").change(function(e){var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a),o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,a&&a.markRevised(),a.setFontName($(e.target).val()),a.wrappedTextIsStale=!0,a.fitBoxToText(),o.modifiedAnn=a.clone(),o.type="modify",o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),$("#vvAnnPopUpEditTextArea").css("font-family",a.getFontName()),u.markLayerWithAnnDirty(a),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnTextSizeSelect").change(function(e){var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a),o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,a&&a.markRevised();var r=1;a.docDPI>i.minimumAnnotationDPI&&t.getDPIForPage(a.page)&&t.getDPIForPage(a.page)<10&&(r=a.pageWidth/t.getOriginalWidthForPage(a.page)||1,90!==a.rotateAngle&&270!==a.rotateAngle||(r=a.pageHeight/t.getOriginalWidthForPage(a.page)||1)),a.setFontSize($(e.target).val()*r),a.wrappedTextIsStale=!0,a.fitBoxToText(),o.modifiedAnn=a.clone(),o.type="modify",o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),$("#vvAnnPopUpEditTextArea").css("font-size",$(e.target).val()+"px"),u.markLayerWithAnnDirty(a),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnTextStyle").change(function(e){var t=d.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=u.getLayerWithAnn(a);a.wrappedTextIsStale=!0;var o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,$("#vvAnnTextStyleBold").is(":checked")?(a.fontBold=!0,$("#vvAnnPopUpEditTextArea").css("font-weight","bold")):(a.fontBold=!1,$("#vvAnnPopUpEditTextArea").css("font-weight","normal")),$("#vvAnnTextStyleItalic").is(":checked")?(a.fontItalic=!0,$("#vvAnnPopUpEditTextArea").css("font-style","italic")):(a.fontItalic=!1,$("#vvAnnPopUpEditTextArea").css("font-style","normal")),$("#vvAnnTextStyleUnderline").is(":checked")?(a.fontUnderline=!0,$("#vvAnnPopUpEditTextArea").css("text-decoration","underline")):(a.fontUnderline=!1,$("#vvAnnPopUpEditTextArea").css("text-decoration","none")),a.fitBoxToText(),o.modifiedAnn=a.clone(),o.type="modify",o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),a&&(a.markRevised(),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0)),u.markLayerWithAnnDirty(a),virtualViewer.delayedPaintCanvases()}),$("#vvAnnPopUpEditTextArea").on("focus",function(){s.autoConfirmTextAnnotations||($("#vvAnnPopUpEditTextSaveBtn").show(),$("#vvAnnPopUpEditTextCancelBtn").show())}),$("#vvAnnPopUpEditTextArea").on("input",function(){if(s.autoConfirmTextAnnotations){var e=(d.getActivePaneState(),virtualViewer.getCurrentAnnObject());e.setTextString($("#vvAnnPopUpEditTextArea").val()),e.wrappedTextIsStale=!0,e.fitBoxToText(),virtualViewer.delayedPaintCanvases(),e.markRevised(),u.markLayerWithAnnDirty(e)}}),$("#vvAnnPopUpEditTextSaveBtn").on("click",function(){var e=d.getActivePaneState(),t=virtualViewer.getCurrentAnnObject();t.wrappedTextIsStale=!0,t.setTextString($("#vvAnnPopUpEditTextArea").val()),t.fitBoxToText(),t.markRevised(),u.markLayerWithAnnDirty(t),$("#vvAnnPopUpEditTextArea").blur(),$(this).hide(),$("#vvAnnPopUpEditTextCancelBtn").hide(),e.getNewAnnList().indexOf(t)===-1&&e.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnPopUpEditTextCancelBtn").on("click",function(){var e=(d.getActivePaneState(),virtualViewer.getCurrentAnnObject());$("#vvAnnPopUpEditTextArea").val(e.getTextString()),e.fitBoxToText(),$("#vvAnnPopUpEditTextArea").blur(),$(this).hide(),$("#vvAnnPopUpEditTextSaveBtn").hide(),virtualViewer.delayedPaintCanvases()}),$("#vvAnnCopyButton").click(function(e){u.copyAnn(),virtualViewer.hideAnnPopUp()}),$("#vvAnnCutButton").click(function(e){u.cutAnn(),virtualViewer.hideAnnPopUp()}),$("#vvAnnDeleteButton").click(function(e){$("#vvDeleteAnnotationDialog").modal("show"),$("#deleteAnnotationButtonConfirm").click(function(e){virtualViewer.hideAnnPopUp(),u.deleteAnn(),$("#vvDeleteAnnotationDialog").modal("hide")})})},Qe=function(e){var t=d.getActivePaneState();"number"!=typeof e&&(e=t.pageNumber),t.getSVGEnabledForPage(e)&&(t.setSVGEnabledForPage(e,!1),t.imageManager.cleanPageFromBuffers(e),t.imageManager.getBestImageFromPage(e,!0))},je=function(){$("#vvBrightness .icon").attr("title",t.getLocalizedValue("pictureControls.brightnessIcon.title","Brightness (Icon)")),$("#vvContrast .icon").attr("title",t.getLocalizedValue("pictureControls.contrastIcon.title","Contrast (Icon)")),$("#vvGamma .icon").attr("title",t.getLocalizedValue("pictureControls.gammaIcon.title","Gamma (Icon)")),$("#vvBrightnessSliderVal").attr("title",t.getLocalizedValue("pictureControls.brightnessValue.title","Brightness (Value)")),$("#vvContrastSliderVal").attr("title",t.getLocalizedValue("pictureControls.contrastValue.title","Contrast (Value)")),$("#vvGammaSliderVal").attr("title",t.getLocalizedValue("pictureControls.gammaValue.title","Gamma (Value)"))},qe=function(){$("#vvDocumentNoteAdderAuthor").html(t.encodeForHTML(q.getUsername())),$("#vvDocumentNoteAddButton").click(function(){$("#vvDocumentNoteContentInput").val()&&(q.addNewNote(),C.docHasNotes()&&$("#vvNotesTabSpan").addClass("docNotesExist"))}),$("#vvAnnotationNoteAddButton").click(function(){$("#vvAnnotationNoteContentInput").val()&&(virtualViewer.getCurrentAnnObject().addNewNote(),virtualViewer.getCurrentAnnObject().markRevised())})};v.prototype.docHasNotes=function(){var e=C.getDocNotes();return!!e&&e.length>0},v.prototype.getDocNotes=function(){var e=C.getCurrentState();if(e){var t=e.getDocumentModel();if(t){var a=t.model.documentNotes.notes;return a}}};var Ge=function(){q.clearAllDocumentNotes(),$("#vvNotesTabSpan").removeClass("docNotesExist")},Ye=function(){C.createNoteTemplateContextMenuList()};v.prototype.createNoteTemplateContextMenuList=function(){$("#vvNoteTemplateCMenuList").empty();for(var e=0;e<j.noteTemplateArray.length;e+=1){var t=$("<li>"+C.encodeForHTML(j.noteTemplateArray[e].templateName)+"</li>");$("#vvNoteTemplateCMenuList").append(t),t.click(function(){var e=this.parentElement,t=$(e).children().index(this);$("#vvDocumentNoteContentInput").val(j.noteTemplateArray[t].templateString),$("#jqContextMenu").hide(),$("#jqContextMenuShadow").hide()})}$("#vvDocumentNoteTemplateButton").contextMenu("vvNoteTemplateContextMenu",{bindTarget:"click",onContextMenu:function(e){if(j.noteTemplateArray.length>0)return!0},onShowMenu:function(e,t){if(j.noteTemplateArray.length>0)return t}})};var Xe=function(){e("vvThumbs").prepareThumbPanels()};v.prototype.openDefaultThumb=function(t){t=t||j.getDefaultTab(),(null===t||t<0)&&(t=s.defaultThumbnailTab);var a=d.getActivePaneState(),n=!!a&&ne<1&&!d.isVideoOpen()&&s.showPageThumbnails,o=!!a&&ne<1&&!a.isVirtualDocument()&&s.enableDocumentNotes,r=!!s.showDocThumbnails,l=!!s.showBookmarkThumbnails&&ne<1,u=!!s.showSearch&&ne<1,c=!!s.showAnnotationList&&ne<1&&!d.isVideoOpen(),g=!d.isVideoOpen()&&d.getCurrentDiff();switch(a&&d.isVideoOpen()&&(t=i.thumbnailTabs.document),(t===i.thumbnailTabs.page&&!n||t===i.thumbnailTabs.search&&!u||t===i.thumbnailTabs.note&&!o||t===i.thumbnailTabs.bookmark&&!l||t===i.thumbnailTabs.document&&!r||t===i.thumbnailTabs.annList&&!c||t===i.thumbnailTabs.docCompare&&!g)&&(t=r?i.thumbnailTabs.document:n?i.thumbnailTabs.page:u?i.thumbnailTabs.search:o?i.thumbnailTabs.note:l?i.thumbnailTabs.bookmark:c?i.thumbnailTabs.annList:g?i.thumbnailTabs.docCompare:null),$("#vvThumbs .active").removeClass("active"),t){case i.thumbnailTabs.page:$("#vvPageThumbsTab").addClass("active"),$("#vvPageThumbs").addClass("active"),e("vvThumbs").loadVisibleThumbs($("#vvPageThumbs"));break;case i.thumbnailTabs.document:$("#vvDocThumbsTab").addClass("active"),$("#vvDocThumbs").addClass("active"),e("vvThumbs").loadVisibleThumbs($("#vvDocThumbs"));break;case i.thumbnailTabs.search:$("#vvSearchTab").addClass("active"),$("#vvSearch").addClass("active");break;case i.thumbnailTabs.note:$("#vvNotesTab").addClass("active"),$("#vvDocumentNotes").addClass("active"),$("#vvDocumentNotes").css("visibility","visible");break;case i.thumbnailTabs.bookmark:$("#vvBookmarksTab").addClass("active"),$("#vvBookmarks").addClass("active");break;case i.thumbnailTabs.annList:$("#vvAnnotationsListTab").addClass("active"),$("#vvAnnotationsList").addClass("active");break;case i.thumbnailTabs.docCompare:$("#vvDocCompareTab").addClass("active"),$("#vvDocCompare").addClass("active")}};var Ze=function(){$("#vvCopyTextContainer").length||$("<div></div>").attr("id","vvCopyTextContainer").appendTo("#virtualViewerMain").hide(),$("#vvSelectTextMenuCopy").on("click",virtualViewer.copyTextUserEventHandler)},Ke=function(){e("vvLayerManager").prepareLayerDialog()};v.prototype.docThumbContextMenu={bindings:{vvSplitImage:function(e){var t=$(e).data("thumbInfo").documentId,a=C.getCurrentState(1);if(a){var n=a.documentModel;n.getModifiedSinceInit()?C.confirmCloseDialog(a,t):C.splitScreen(t,"horizontal")}else C.splitScreen(t,"horizontal");C.performDiff()}},offsetHeight:10,onContextMenu:function(e){var a=$(e.currentTarget).data().thumbInfo.documentId,n=$(e.currentTarget).data().thumbInfo.displayName;return!(t.dumbVideoExtensionCheck(a)||t.dumbVideoExtensionCheck(n)||d.isVideoOpen())&&(!!s.splitScreen&&!($("#vvImagePanel").width()<2*$("#vvThumbs").width()&&Modernizr.touchevents))}};var Je={bindings:{vvOcrContextMenuOcr:function(){C.performOCR({force:!0})},vvSelectTextMenuPaste:function(){var e=C.getActivePaneState();if(e.isPageCropped(e.getPageNumber())){var a=t.getLocalizedValue("errors.cropBlock","Cannot Annotate on Crop Preview. Save the crop then Annotate."),n={client:!0,disable:C.disableErrorModals.cropBlock};C.displayExceptionMessage(a,n)}else u.pasteAnn()},vvUndoSplitPane:function(e){var t=d.getCurrentState(1);t.documentModel.getModifiedSinceInit()?C.confirmCloseDialog(t):C.undoSplitScreen()},vvSelectTextMenuCopy:function(e){},vvSelectTextMenuHighlight:function(e){C.createHighlightFromSelection()},vvSelectTextMenuRedact:function(e){C.createRedactionFromSelection()}},offsetHeight:100,onContextMenu:function(e){e||(e=window.event),Modernizr.touchevents&&(e=Y.fixTouchEvent(e));var t=d.getActivePaneState();if(d.isVideoOpen()||!t)return!1;var a=Y.clickPointConverter(e),n=u.isAnnotationAtPoint(a),o=Y.annDragging,r=virtualViewer.isOnImage(a),s=virtualViewer.getSelectedTextRects(),l=virtualViewer.getEventManager().getDragMode();if(!r)return!1;if(n||o)return!1;var c={documentId:t.getDocumentId()};return!X.callWithReturn("disableTextContextMenu",c)&&(!(!C.ocrEnabled&&!ae)||!!(l===i.dragModes.selectText&&s&&s.length>0||null!==ue&&void 0!==ue))},onShowMenu:function(e,t){var a=virtualViewer.getEventManager().getDragMode(),n=virtualViewer.getSelectedTextRects();s.readOnlyAnnotationMode&&($("#vvSelectTextMenuHighlight",t).remove(),$("#vvSelectTextMenuRedact",t).remove()),a===i.dragModes.selectText&&n&&n.length>0?virtualViewer.checkRedactionsEnabled()||$("#vvSelectTextMenuRedact",t).remove():($("#vvSelectTextMenuCopy",t).remove(),$("#vvSelectTextMenuHighlight",t).remove(),$("#vvSelectTextMenuRedact",t).remove()),null!==ue&&void 0!==ue||$("#vvSelectTextMenuPaste",t).remove(),ae||$("#vvUndoSplitPane",t).remove(),C.ocrEnabled||$("#vvOcrContextMenuOcr",t).remove();var o={documentId:virtualViewer.getActivePaneState().getDocumentId()};return X.call("onShowSelectTextContextMenu",o),t}};v.prototype.pageThumbContextMenuOptions={offsetHeight:400,bindings:{vvSelectPagesAll:function(e){C.selectAll()},vvSelectPagesNone:function(e){C.selectNone()},vvDeletePages:function(e){$("#vvPageThumbs").trigger("vvDeletePages")},vvCutPages:function(e){$("#vvPageThumbs").trigger("vvCutPages")},vvCopyPages:function(e){$("#vvPageThumbs").trigger("vvCopyPages")},vvInsertPagesBefore:function(e){$("#vvPageThumbs").trigger("vvPastePages",$(e).closest(".vvThumbBox").data("thumbInfo").pageNumber)},vvInsertPagesAfter:function(e){$("#vvPageThumbs").trigger("vvPastePages",$(e).closest(".vvThumbBox").data("thumbInfo").pageNumber+1)},vvCopyPagesToNewDocument:function(e){C.copyToNewDocument(!1)},vvCutPagesToNewDocument:function(e){C.copyToNewDocument(!0)},vvAddBookmark:function(e){$("#vvBookmarkDialog").modal("show");var a=t.getLocalizedValue("bookmarkDialog.title","Create New Bookmark");$("#vvBookmarkTitle").text(a);var n=virtualViewer.getCurrentState().documentModel,o=n.getSelectedPageNumbers()[0];Q.pageToAdd=o},vvPrintPages:function(e){var t=virtualViewer.getSelectedPageNumbers();C.printDocumentDialog(t)},vvExportPages:function(e){var t=virtualViewer.getSelectedPageNumbers();C.exportDocumentDialog(t)}},onContextMenu:function(e){return!("vvPageThumbs"===e.target.id&&C.getPageCount()>0)},onShowMenu:function(e,t){var a=virtualViewer.getDocumentModel(),n=$(e.target).closest(".vvThumbBox"),o=n.data("thumbInfo").pageNumber,i=d.getActivePaneState();a.isPageSelected(o)||e.ctrlKey||e.metaKey||e.shiftKey||(a.clearPageSelection(),a.addPageToSelection(o));var r=function(e){var a=e?e.sessionGUID:null;e&&e.model&&0!==e.model.length&&(s.enableCopyPasteBetweenSessions!==!1||a===virtualViewer.viewerSessionID)||($("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove())},l={documentId:i.getDocumentId()};return C.checkPageManipulationsEnabled()&&!X.callWithReturn("disablePageManipulationContextMenuOptions",l)||($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvDeletePages",t).remove(),$("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove(),$("#vvCutPagesToNewDocument",t).remove(),$("#vvSelectPagesAll",t).remove(),$("#vvSelectPagesNone",t).remove()),0===a.getSelectedPageNumbers().length&&($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvCopyPagesToNewDocument",t).remove(),$("#vvCutPagesToNewDocument",t).remove()),a.getSelectedPageNumbers().length>1&&$("#vvAddBookmark",t).remove(),i.isVirtualDocument()&&$("#vvAddBookmark",t).remove(),s.pageManipulationsNewDocumentMenu||($("#vvCopyPagesToNewDocument",t).remove(),$("#vvCutPagesToNewDocument",t).remove()),0===i.getPageCount()&&($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvDeletePages",t).remove(),$("#vvSelectPagesAll",t).remove(),$("#vvSelectPagesNone",t).remove(),$("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove()),this.offsetHeight=t.height(),La(r),t}},v.prototype.getServerConfig=function(){var e=new URI(s.servletPath);e.addQuery("action","getServerConfig");var t=e.query();e.query(""),$.ajax({url:e.toString(),type:"POST",data:t,dataType:"json",success:function(e){dt(e)},error:function(e){virtualViewer.handle500Status(e),console.log("getServerConfig: error")}})};var et=function(e){e=e||virtualViewer.getActiveOuterDiv();var t,a=C.getScrollbarWidth();t=!s.imageScrollBars||!a||a<10?s.canvasBufferSpace||10:2*a;var n=e.width()-t;return n<0&&(n=0),n};v.prototype.getOuterDivClientWidth=function(e){return et(e)};var tt=function(e){e=e||virtualViewer.getActiveOuterDiv();var t=e.height(),a=e.find(".vvInner"),n=Math.floor(a.offset().top)-Math.floor(e.offset().top);t-=n;var o,i=C.getScrollbarHeight();return o=!s.imageScrollBars||!i||i<10?s.canvasBufferSpace||10:i,t-=o};v.prototype.getOuterDivClientHeight=function(e){return tt(e)},v.prototype.getScrollbarWidth=function(){var e,t=virtualViewer.getActiveOuterDiv(),a=t.width(),n=t[0].clientWidth,o=s.canvasBufferSpace||10;return 0===a||0===n?null:(a&&n&&(e=a-n),o+e)},v.prototype.getScrollbarHeight=function(){var e,t=virtualViewer.getActiveOuterDiv(),a=t.height(),n=t[0].clientHeight,o=s.canvasBufferSpace||10;return 0===a||0===n?null:(a&&n&&(e=a-n),o+e)},v.prototype.copyToNewDocument=function(a){var n=C.getSelectedPageNumbers(),o=Q.copyBookmarksForPageRange(n);if(Q.bookmarkArray=o,a&&n.length>=virtualViewer.getPageCount()){var i=t.getLocalizedValue("errors.onePageLimit","Document must contain at least 1 page"),r={client:!0,disable:C.disableErrorModals.pageLimit};return vt(i,r),!1}if(U){var s=U(),l="TIFF",u=n[0];"PDF"===C.getCurrentState(0).getFormatForPage(u)&&(l="PDF");for(var c=[],g=0;g<n.length;g++)c[g]=n[g]+1;c=c.toString(),C.saveDocument(C.getDocumentId(0),{newDocumentId:s,newDisplayName:s,burnRedactions:!1,includeRedactionTags:!1,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:!0,includeDocumentNotes:!1,includeWatermarks:!1,saveAsFormat:l,pageRangeType:"complex",pageRangeValue:c,copyWatermarks:!0,useCut:a,pageNums:n})}else{var v=d.getActivePaneState(),p="pdf",h=C.getSaveAsDocumentNameGenerator(),m=h(v.getDocumentId(),v.getDisplayName(),p);C.copySelection(!1,function(){e("vvDialogs").copyToNewDialog(m,a,n)})}},v.prototype.createTextAnnContextMenuList=function(){if(l(virtualViewer).annotationToolbarButtons.vvAnnText){if($(".vvAnnText .dropdown-menu").empty(),!s.enableTextRubberStamp||!j.customStampArray.length)return $(".vvAnnText.vvHasSubDropdown, .vvAnnText.dropdown").removeClass("vvHasSubDropdown dropdown"),void $("a.vvAnnText.dropdown-toggle").attr("data-toggle","");$(".vvAnnText").addClass("vvHasSubDropdown dropdown"),$("a.vvAnnText.dropdown-toggle").attr("data-toggle","dropdown");var e=t.getLocalizedValue("textAnnContextMenu.newTextAnn","New Text Ann"),a=$.templates("#vvStampDropdownItemTemplate");$(a.render({displayName:e})).appendTo(".vvAnnText .dropdown-menu").on("click",function(){virtualViewer.currentStamp=null,virtualViewer.turnOnAnnotationButton(i.annotationTypes.SANN_EDIT,$(".vvAnnText")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()}),$(a.render(j.customStampArray)).appendTo(".vvAnnText .dropdown-menu").on("click",function(){var e=$(this).data("stamp-row-index");virtualViewer.currentStamp=e,virtualViewer.turnOnAnnotationButton(i.annotationTypes.SANN_EDIT,$(".vvAnnText")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu();
})}},v.prototype.openInTab=function(e){if(e){e=e.trim();var a=C.getStateForDocumentId(e,0),n=virtualViewer.getFromDocumentList(e)||{documentId:e,displayName:null};ot();for(var o=0;o<C.newRecentlyViewedList.length;o++)if(e===C.newRecentlyViewedList[o].documentId){n.displayName||(n.displayName=C.newRecentlyViewedList[o].displayName);break}this.addToRecentlyViewed(n),s.multipleDocMode===i.multipleDocModes.viewedDocuments&&this.requestDocumentList(),$("#vvImagePanel").width()<$("#vvThumbs").width()&&virtualViewer.toggleThumbnailPanel(!1);for(var r=null,l=!1,u=!1,c=!1,g=0;g<this.tabs.length;g+=1)if(C.tabs[g]===e){l=!0;break}if(C.tabs.length>=i.maxNumberOfTabs&&!l){var v=t.getLocalizedValue("errors.tabTooManyOpen","Too many open tabs."),p={client:!0,disable:C.disableErrorModals.tabs};return void vt(v,p)}a?(r=a.getTabNumber(),u=a.getClosedTab()):(c=!0,a=d.openNewState({documentId:e,pageNumber:0,tabNumber:this.tabs.length,zoomMode:j.getDefaultZoomMode(),paneIndex:0,displayName:n.displayName}),a.setZoom(j.getDefaultZoomLevel())),u&&(a.setZoomMode(j.getDefaultZoomMode()),a.setZoom(j.getDefaultZoomLevel()));var h=c||l===!1||u===!0;if(h&&!s.disableImageTabs){r=C.tabs.length,C.tabs[r]=e;var m=this.getStateForDocumentId(this.tabs[r],0),f=m.getDisplayName()||e,y="<li class='docTabs nav' data-toggle='tab' ><a data-toggle='tooltip' data-tooltip='tooltip' data-placement='bottom' data-title='";y+=f,y+="' href='#vvOuterDiv' class='singleDocTab'><span class='vvTabTextSpan'></span><button class='close rightFloat vvTabCloseButton' title='"+t.getLocalizedValue("closeSplitButton.buttonText","Close")+"' data-tooltip='tooltip' type='button' ><span aria-hidden='true'>&times;</span></button></a></li>";var b,P=$("#vvImageTabs .docTabs:last");b=P.length?$(y).insertAfter(P):$(y).prependTo("#vvImageTabs");var A=b.find(".vvTabTextSpan"),T=b.find(".singleDocTab");this.shortTabNames?(A.text(f.substring(0,16)),f.length>16&&A.addClass("shortenTab shortenTabSixteen")):(A.text(f.substring(0,24)),f.length>24&&A.addClass("shortenTab")),b.data("vvDocState",m),b.on("drop",Kt),b.on("dragover",Jt),b.on("dragstart",function(e){e.preventDefault()}),T.click(function(){var e=$(this.parentElement).data("vvDocState");if(e){var t=e.getTabNumber();if(!C.tabs[t])return;C.activeTab!==t&&C.switchToTab(e)}}),ze(),at(),a&&(a.setTabNumber(r),a.setClosedTab(!1))}else r=a.getTabNumber();var S=Boolean(a.documentFullyLoaded()&&a.getImageManager()&&a.getImageManager().getOriginalFromPage(a.pageNumber));a&&(S||a.isMediaLoaded())||this.displayWaitIndicator(!0,a),s.disableImageTabs&&a.setClosedTab(!1),this.switchToTab(a,!0)}},v.prototype.selectTab=function(e){var a=e.getTabNumber();if(a<0||a>this.tabs.length){var n=t.getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."),o={client:!0,disable:this.disableErrorModals.tabs};return void vt(n,o)}var i=$("#vvImageTabs .docTabs");i.removeClass("active"),i.eq(a).tab("show"),this.activeTab=a},v.prototype.switchToTab=function(a,n){if(a){ae&&C.setActivePane(0);var o,r=C.getDocumentId(0);r!==a.getDocumentId()&&(o=C.getStateForDocumentId(r,0)),Re(a),this.setPreviousAnnObject(this.getCurrentAnnObject()),this.destroyInProgressAnnotation(),this.hideAnnPopUp(),C.clearCanvases(a,$("#vvImageCanvas")[0]);var l=e("vvThumbs"),u=null;if(l.removeThumbs($("#vvPageThumbs")),$(".thumbTabs").removeClass("disabledTab"),c.handleSearchOnTabSwitch(a,o),$("#vvThumbs li:eq(0) a").tab("show"),We(a),_e(),o&&(u=o.getZoom(),o.documentModel&&o.isMedia()&&o.getMediaManager().hideMediaDiv(),it(o)),d.setDisplayedState(a,0),Q.switchTabs(o,a),a.requestDocumentModel(!1,function(){Et(a)}),s.fitLastBetweenDocuments&&u&&(a.setZoomMode(i.zoomModes.fitCustom),a.setZoom(u)),Pa(a),this.sizeScroller({state:a}),l.highlightActiveThumbnail(),Da(),Dt(a),this.resetGuides(),t.cursorNormal(),this.setDragMode(i.dragModes.pan),$("#vvDocumentNoteContentInput").val(""),a.isMedia()){this.mediaThumbPrep(a);var g=a.getMediaManager();g.showMediaDiv(),g.resizeVideo()}else this.setPageCore(a.pageNumber,a);this.selectTab(a),s.positionLastBetweenDocuments&&o?n?rt(a,o):(st(a,o),a.clearCachedScroll()):st(a),C.openDefaultThumb(),G.getMagnifierEnabled()&&G.getMagnifiedImage(a),s.collapseStickiesByDefault&&C.collapseAllStickyNotes(!0),s.enableDocumentNotes&&a.documentModel&&a.documentModel.model.documentNotes&&q.loadDocumentNotes(),virtualViewer.fillAnnotationList(),Ie(a),Et(a),"#vvScreenReaderDiv".length&&($("#vvScreenReaderDiv").empty(),K.setUpScreenReaderDiv(a)),Fa(),a.getDocumentId()===K.getDocumentIdToBeRead()&&K.getStartedPlaying()&&"none"===$("#vvScreenReaderControlsPopUp")[0].style.display&&C.toggleSpeechControls();var v={documentId:a.documentId};X.call("switchToTab",v),o&&(v={currentTabDocumentId:a.documentId,previousTabDocumentId:o.documentId},X.call("switchBetweenTabs",v))}},v.prototype.onDocumentModelError=function(e){virtualViewer.closeDocument(e.documentId,e.paneIndex,null,!0)},v.prototype.onDocumentModelLoad=function(e){var t=d.getStateForDocumentId(e.documentId,e.paneIndex);if(t&&!t.closedTab&&(C.requestAnnotations(t),d.displayedDocuments[t.currentPaneIndex]===t.getDocumentId())){if(Pa(t),C.sizeScroller({state:t}),Da(),Re(),t.isMedia())return C.mediaThumbPrep(t),t.getMediaManager().fixMediaDivs(t),void t.getMediaManager().getVideo();var a=d.getCurrentDiff();ae&&(!a||a.diffDisabled||a.diffDisabledUntilSave?a?qa():C.performDiff():C.performDiff(!1,!0)),0===t.currentPaneIndex&&Ie(t)}},v.prototype.closeLastTab=function(t){t=t||C.getActivePaneState(),(s.splitScreen||ae)&&C.undoSplitScreen(),s.showAnnNavToggle&&($("#vvPageThumbs").hasClass("vvAnnotationNavigation")&&virtualViewer.showAnnotationNaviPanel(!1),$("#vvAnnotationIndicatorToggle").hide()),C.clearCanvases(t,$("#vvImageCanvas")[0]),$("#vvDummyScroller").height(0),e("vvThumbs").removeThumbs($("#vvPageThumbs")),t.isMedia()&&t.getMediaManager().hideMediaDiv(),C.openDefaultThumb()},v.prototype.closeDocument=function(e,t,a,n){var o=d.getStateForDocumentId(e,t);o&&o.currentPaneIndex===t&&(e===K.getDocumentIdToBeRead()&&K.getStartedPlaying()&&(K.stopSpeech(),C.toggleSpeechControls()),"none"!==$("#vvScreenReaderControlsPopUp")[0].style.display&&C.toggleSpeechControls(),t>0?a?this.splitScreen(a):this.undoSplitScreen():this.closeTab(e,n),Re(),o.clearNewAnnList(),o.clearNewWMList(),d.removeStateForDocumentId(e,t))},v.prototype.closeTab=function(e){var a,n=typeof e;if("number"===n&&(a=e),"string"===n&&(a=C.tabs.indexOf(e)),(a<0||a>=this.tabs.length)&&!H){var o=t.getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."),i={client:!0,disable:this.disableErrorModals.tabs};return void vt(o,i)}1===this.tabs.length&&0===a&&(C.closeLastTab(C.getActivePaneState()),Q.bookmarkArray.length>0&&Q.clearAllBookmarks(),C.docHasNotes()&&Ge(),G.getMagnifierEnabled()&&G.toggleMagnifier());var r=$("#vvImageTabs .docTabs").eq(a);r.data("vvDocState",null),r.remove();var s=this.tabs[a],l=r.attr("aria-controls");$("#"+l).remove();var u=C.getStateForDocumentId(s);if(tn({state:!0},u)){u.isMedia()&&u.getMediaManager().player.pause(),$("#vvAnnPopUp").length&&C.hideAnnPopUp(),u.setTabNumber(null),u.setClosedTab(!0),this.tabs.splice(a,1);for(var c=a;c<this.tabs.length;c+=1)u=C.getStateForDocumentId(this.tabs[c]),u.setTabNumber(c);this.activeTab>=a&&(this.activeTab-=1,this.activeTab<0&&(this.activeTab=0),u=C.getStateForDocumentId(C.tabs[C.activeTab]),u&&this.switchToTab(u),d.removeStateForDocumentId(s)),ze();var g={closedDocumentId:s};X.call("afterTabClosed",g)}},v.prototype.confirmCloseDialog=function(t,a){if(!t||!t.documentModel.getModifiedSinceInit())return void Re();var n=function(){t.closedTab=!0,C.saveDocument(t.getDocumentId(),{documentPaneIndex:t.currentPaneIndex,skipOverwriteDialog:!0}),C.closeDocument(t.getDocumentId(),t.currentPaneIndex,a)},o=function(){C.closeDocument(t.getDocumentId(),t.currentPaneIndex,a)},i=t.getDisplayName()||t.getDocumentId();e("vvDialogs").confirmChangesDialog(n,o,i,this.willSavingOverwriteCurrentFormat(t))},v.prototype.updateTabName=function(e,t){if(e||(e=virtualViewer.getCurrentState()),e&&e.getDocumentModel()){var a=e.getTabNumber(),n=e.getDisplayName()||e.getDocumentId(),o=e.getDocumentModel(),i=$("#vvImageTabs a").eq(a),r=n,s=i.find(".vvTabTextSpan");o.getModifiedSinceInit()&&(n="*"+n),this.shortTabNames&&n.length>16?(n=n.substring(0,16),s.addClass("shortenTab shortenTabSixteen")):n.length>24?(n=n.substring(0,24),s.addClass("shortenTab"),s.removeClass("shortenTabSixteen")):s.removeClass("shortenTab shortenTabSixteen"),s.text()!==n&&(s.text(n),i.attr("title",r),t||ze())}},v.prototype.updateAllTabNames=function(e){for(var t=0;t<this.tabs.length;t++){var a=d.getStateForDocumentId(this.tabs[t],0);a&&this.updateTabName(a,!0)}ze(e)};var at=function(){$(".vvTabCloseButton").unbind().click(function(e){e.preventDefault();var t=this.parentElement.parentElement,a=$(t).data("vvDocState");if(a){var n=a.getDocumentId();if(s.unsavedChangesNotification){var o=a.getDocumentModel();o&&o.getModifiedSinceInit()?C.confirmCloseDialog(a):C.closeDocument(n,0)}else C.closeDocument(n,0)}})};v.prototype.getActiveTab=function(){return this.activeTab},v.prototype.addToRecentlyViewed=function(e){this.removeFromRecentlyViewed(e),C.newRecentlyViewedList.length===i.mostRecentlyViewedListLength&&C.newRecentlyViewedList.pop(),C.newRecentlyViewedList.unshift(e),nt()},v.prototype.removeFromRecentlyViewed=function(e){for(var t=0;t<C.newRecentlyViewedList.length;t+=1){var a=C.newRecentlyViewedList[t].documentId;if(a===e.documentId){C.newRecentlyViewedList.splice(t,1);break}}nt()};var nt=function(){var e=new Date;e.setDate(e.getDate()+365);var t=JSON.stringify(C.newRecentlyViewedList);t&&(document.cookie="newRecentlyViewedList="+encodeURIComponent(t)+";expires="+e.toGMTString())},ot=function(){if(document.cookie.length>0){var e="newRecentlyViewedList",t=document.cookie.indexOf(e+"="),a=-1;if(t!==-1){t+=e.length+1,a=document.cookie.indexOf(";",t),a===-1&&(a=document.cookie.length);var n=decodeURIComponent(document.cookie.substring(t,a));if(!n.startsWith("[{"))return!1;for(var o=JSON.parse(n),i=0;i<o.length;i+=1)C.newRecentlyViewedList[i]={},C.newRecentlyViewedList[i].documentId=o[i].documentId,C.newRecentlyViewedList[i].displayName=o[i].displayName,C.newRecentlyViewedList[i]||C.newRecentlyViewedList.splice(i,1);return!0}if(e="recentlyViewedList",t=document.cookie.indexOf(e+"="),t!==-1){t+=e.length+1,a=document.cookie.indexOf(";",t),a===-1&&(a=document.cookie.length),this.recentlyViewedList=decodeURIComponent(document.cookie.substring(t,a)).split(",");for(var r=0;r<this.recentlyViewedList.length;r+=1)C.newRecentlyViewedList[r]={},C.newRecentlyViewedList[r].documentId=decodeURIComponent(this.recentlyViewedList[r]),C.newRecentlyViewedList[r]||C.newRecentlyViewedList.splice(r,1);return!0}return!1}return!1};v.prototype.clearSpecifiedState=function(e){var t=C.tabs[e];d.removeStateForDocumentId(t,0)},v.prototype.resetGuides=function(){this.horizontalGuide.visible=!1,this.horizontalGuide.locked=!1,this.verticalGuide.visible=!1,this.verticalGuide.locked=!1};var it=function(e){if(e=e||C.getActivePaneState(),e&&!e.isMedia()){var t=d.getOuterDivFromState(e);e.setCachedScrollLeft(t.scrollLeft()),e.setCachedScrollTop(t.scrollTop())}},rt=function(e,t){e=e||d.getActivePaneState(),t&&(e.setCachedScrollLeft(t.getCachedScrollLeft()),e.setCachedScrollTop(t.getCachedScrollTop()))},st=function(e,t){e=e||d.getActivePaneState(),t=t||e;var a=d.getOuterDivFromState(e),n=t.getCachedScrollLeft(),o=t.getCachedScrollTop();if("number"!=typeof n||"number"!=typeof o)return!1;var i=et(a);return i<=n&&C.sizeScroller({state:e}),a.scrollLeft(n),a.scrollTop(o),!0};v.prototype.parseClientInstanceId=function(){var e="clientInstanceId",t=document.cookie.indexOf(e+"="),a=null;if(t!==-1){t=t+e.length+1;var n=document.cookie.indexOf(";",t);n===-1&&(n=document.cookie.length),a=decodeURIComponent(document.cookie.substring(t,n))}return a||(a=lt("clientInstanceId")),a},v.prototype.getClientInstanceId=function(){return"string"!=typeof this.clientInstanceId&&this.setClientInstanceId(this.parseClientInstanceId()),this.clientInstanceId},v.prototype.setClientInstanceId=function(e){this.clientInstanceId=e},v.prototype.requestDocumentModel=function(e,t,a){e||(e=d.getActivePaneState()),e.requestDocumentModel(t,a)},v.prototype.requestDocumentList=function(){var t=e("vvThumbs"),a=new URI(s.servletPath);a.addQuery("action","getDocumentList"),a.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),i.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query(""),s.multipleDocMode===i.multipleDocModes.availableDocuments?$.ajax({url:a.toString(),type:"POST",data:n,dataType:"json",success:function(e){if(gt(e)!==!0){if(e.documentList){C.documentList=[];for(var a=0;a<e.documentList.length;a+=1)C.documentList[a]=decodeURIComponent(e.documentList[a]),C.documentList[a]={},C.documentList[a].documentId=decodeURIComponent(e.documentList[a].documentId),e.documentList[a].displayName&&(C.documentList[a].displayName=decodeURIComponent(e.documentList[a].displayName))}else C.documentList=[];t.fillDocThumbs(C.documentList),t.ensureDocThumbIsVisible(),t.loadVisibleThumbs($("#vvDocThumbs"))}},error:function(e){virtualViewer.handle500Status(e)||console.log("requestDocumentList: "+e.statusText)}}):s.multipleDocMode===i.multipleDocModes.specifiedDocuments?(t.fillDocThumbs(C.documentList),t.loadVisibleThumbs($("#vvDocThumbs"))):s.multipleDocMode===i.multipleDocModes.viewedDocuments&&(ot()&&(this.documentList=C.newRecentlyViewedList.slice()),t.fillDocThumbs(this.documentList),t.loadVisibleThumbs($("#vvDocThumbs")))};var lt=function(e){var t=new URI(window.location.href);return t.query(!0)[e]},ut=function(){var e=new URI(window.location.href);if(e.fragment()){var t=window.location.href.split("#");t.pop(),window.location=t.join()}};v.prototype.reloadDocumentModel=function(t,a,n){var o=this.getStateForDocumentId(t,a);o=o||this.getActivePaneState(),tn({state:!0},o)&&(0===o.currentPaneIndex&&d.displayedDocuments[o.currentPaneIndex]===o.getDocumentId()&&e("vvThumbs").removeThumbs($("#vvPageThumbs")),o.requestDocumentModel(!0,n))};var dt=function(e){Ba(e.disableUploadDocument),C.ocrEnabled=e.ocrEnabled,s.enableCacheObfuscation=e.cacheObfuscationEnabled};v.prototype.defaultSaveAsDocumentCallback=function(e){var t=virtualViewer.getStateForDocumentId(e.newDocumentId);if(t){if(!t.getClosedTab()){var a=t.getTabNumber();C.closeTab(a,!0)}d.removeStateForDocumentId(t.documentId,t.currentPaneIndex),C.removeFromRecentlyViewed({documentId:t.documentId})}C.openInTab(e.newDocumentId),C.requestDocumentList()},v.prototype.defaultUploadDocumentCallback=function(e){C.openInTab(e.uploadedDocumentId),C.requestDocumentList()},v.prototype.onPageLoaded=function(e){var t=d.getStateForDocumentId(e.documentId,e.paneIndex);if(t){var a=e.loadedPageNumber,n=e.searchableStatusBeforeLoad;C.determineEffectiveZoom(a,t),C.delayedPaintCanvases(),Re(t);for(var o=0;o<C.newRecentlyViewedList.length;o++)if(t.getDocumentId()===C.newRecentlyViewedList[o].documentId){C.newRecentlyViewedList[o].displayName=t.getDisplayName(),nt();break}ct(n);var r=!!s.preferServerDisplayName,l=e.newDisplayName;if(t.isVirtualDocument()){if(!t.getDisplayName()){var u=t.getVirtualDocumentComponents();e.documentId===u[0]&&(l?C.setDisplayName(l,e.documentId):C.setDisplayName(e.documentId))}}else if((s.multipleDocMode===i.multipleDocModes.specifiedDocuments||s.multipleDocMode===i.multipleDocModes.viewedDocuments)&&C.documentList.length>0){for(var c=0;c<C.documentList.length;c++)if(C.documentList[c].documentId===e.documentId){t.getDisplayName()&&!r||(C.documentList[c].displayName&&!r?C.setDisplayName(C.documentList[c].displayName):l&&(C.documentList[c].displayName=l,C.setDisplayName(l,e.documentId)));break}}else!l||t.getDisplayName()&&!r||C.setDisplayName(l,e.documentId);0===e.paneIndex&&(We(t),C.updateTabName(t)),Fa()}};var ct=function(e){if(d.getCurrentDiff()&&null===e){var t=d.getCurrentDiff();t.diffDisabled||t.diffDisabledUntilSave||null!==t.oldDocument.state.getIsSearchable()&&null!==t.newDocument.state.getIsSearchable()&&virtualViewer.performDiff(!1,!0)}};v.prototype.handleTimeoutException=function(e,a){var n,o="";if(e&&(n=d.getStateForDocumentId(e,a)),!n)return o=t.getLocalizedValue("errors.requestTimeoutError","A request to the server took longer than expected, and was not completed."),e&&(o=e+": "+o),void console.error(o);++n.demerits>=(s.maximumTimeoutsOnDocument||3)?(n.markBadDocument(!0),o=e+t.getLocalizedValue("errors.requestTimeoutDocumentFinalError"," has experienced several server timeouts, and will not be available in the current session."),C.closeTab(n.getTabNumber(),!0)):o=e+": "+t.getLocalizedValue("errors.requestTimeoutError","A request to the server took longer than expected, and was not completed.");var i={client:!1,disable:C.disableErrorModals.timeout};vt(o,i),C.displayWaitIndicator(!1),C.displaySaveIndicator(!1)},v.prototype.handle500Status=function(e,t,a){if(!e.responseJSON)return!1;switch(e.responseJSON.snowboundErrorCode){case-69:return virtualViewer.handleTimeoutException(t,a),!0;case 0:default:return!1}},v.prototype.checkServerException=function(e,t,a){return gt(e,t,a)};var gt=function(e,a,n){if(500===e.status&&virtualViewer.handle500Status(e,a,n))return!0;var o=e.exceptionMessage,i=e.snowboundErrorCode;if(i===-69)return virtualViewer.handleTimeoutException(a,n),!0;if(o&&!W){ge=o,o=decodeURIComponent(o),a=a||virtualViewer.getDocumentId(n);var r={documentId:a,displayName:null};if(virtualViewer.removeFromRecentlyViewed(r),o.includes("Format not supported"))C.exportUnsupportedFile(a);else if(o.includes("Encrypted or Password Protected File")||o.includes("Password Protected Document"))C.passwordProtectedFile(a);else{o.includes("A document by this name already exists.")&&(o=t.getLocalizedValue("uploadExistingDocument","A document by this name already exists. Please rename the file and try again"));var s={client:!1,disable:!1};o.includes("Document not found")&&(s.disable=C.disableErrorModals.documentNotFound),vt(o,s),C.displayWaitIndicator(!1),C.displaySaveIndicator(!1)}return!0}return o===ge};v.prototype.displayExceptionMessage=function(e,t){vt(e,t)};var vt=function(e,t){t=t||{e:null},console.error(e,t.e);var a=virtualViewer.disableErrorModals||{},n=t.client&&a.client||!t.client&&a.server||t.disable;n||(W=$("#vvCurrentExceptionDialog"),W.modal("show"),$("#vvCurrentExceptionText").text(e),$("#vvCurrentExceptionOKButton").click(function(e){W=null}))};v.prototype.exportUnsupportedFile=function(t){H=!0,e("vvThumbs").removeThumbs($("#vvPageThumbs")),C.displayWaitIndicator(!1),C.displaySaveIndicator(!1);var a=$("#vvExportUnsupportedFileDialog");a.data().documentId=t,a.modal("show")},v.prototype.passwordProtectedFile=function(t){H=!0,e("vvThumbs").removeThumbs($("#vvPageThumbs")),C.displayWaitIndicator(!1),C.displaySaveIndicator(!1);var a=$("#vvPasswordProtectedFileDialog");a.data().documentId=t,a.modal("show")},v.prototype.requestAnnotations=function(e,t){var a=e.getDocumentModel(),n=e.getPageNumber();if(a&&!e.isMedia()){var o=null;if(t&&e.clearAllLayers(),o=e.getLayersForPage(n),!o){var r=new URI(s.servletPath);r.addQuery("action","getAnnotationModel"),r.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),r.addQuery("modelJSON",JSON.stringify(a.model)),i.cacheBuster===!0&&r.addQuery("cacheBuster",Math.random()),r.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var l=r.query();r.query("");var d=a.model.layerManager.layers.length;$.ajax({url:r.toString(),type:"POST",data:l,dataType:"json",success:function(t){if(gt(t,e.getDocumentId(),e.currentPaneIndex))return void X.call("annotationLoadError",{documentId:e.getDocumentId(),paneIndex:e.currentPaneIndex,statusText:t.status,exceptionMessage:t.exceptionMessage});for(var n=t,o=0;o<d;o+=1){var i=a.model.layerManager.layers[o],r=decodeURIComponent(i.annotationId),s=n[r];if(!s)return;for(var l=0;l<s.length;l+=1){var c=s[l];if(c)u.parseLayer($.parseXML(c),e,l);else{var g=u.createAnnotationLayer(r,l,e.pageStates[l]);g.isRedaction=i.isRedaction,g.permissionLevel=i.permissionLevel,g.doubleByte=i.defaultDoubleByte,e.addLayerToPage(l,g)}}}0===C.pagesWithAnnotationsCore(e).length&&virtualViewer.showAnnotationNaviPanel(!1),virtualViewer.showAllAnnotationIndicators(),$("#vvImageCanvas")&&virtualViewer.delayedPaintCanvases(),virtualViewer.fillAnnotationList(),X.call("annotationLoadCompleted",{documentId:e.getDocumentId(),paneIndex:e.currentPaneIndex})},error:function(t){virtualViewer.handle500Status(t,e.getDocumentId(),e.currentPaneIndex)||console.log("requestAnnotations: "+t.statusText),X.call("annotationLoadError",{documentId:e.getDocumentId(),paneIndex:e.currentPaneIndex,statusText:t.statusText})}})}}},v.prototype.getPagePropertyByFieldId=function(e){if(tn({state:!0}))return y(e,C.getActivePaneState())},v.prototype.getPagePropertyByCaption=function(e){if(tn({state:!0}))for(var t=0;t<s.imageInfoFields.length;t++){var a=s.imageInfoFields[t].fieldCaption;if(a===e){var n=s.imageInfoFields[t].fieldId;return y(n,C.getCurrentState())}}},v.prototype.getPageProperties=function(){if(tn({state:!0,notVideo:!0})){retVal=[];for(var e,a,n,o,i=0;i<s.imageInfoFields.length;i++){e=s.imageInfoFields[i].fieldId;var r=s.imageInfoFields[i].fieldCaption;a=t.getLocalizedValue("imageInfo."+e,r),n=y(e,d.getActivePaneState()),n||(n="N/A"),o=P(n),retVal[i]={},retVal[i].fieldId=e,retVal[i].fieldValue=o,retVal[i].fieldCaption=a}return retVal}},v.prototype.setPageDisplayNames=function(e){var t=d.getActivePaneState();tn({state:!0,documentModel:!0},t)&&t.setPageDisplayNames(e)},v.prototype.pageHasText=function(){if(tn({state:!0,documentModel:!0,notVideo:!0})){var e=d.getActivePaneState(),t=e.getPageText(e.getPageNumber());return!!t&&t.wordRects.length>0}},v.prototype.getIsAnnButtonSticky=function(){return de},v.prototype.undoAnnotation=function(){if(tn({state:!0,documentModel:!0,notVideo:!0})){virtualViewer.hideAnnPopUp();var e=d.getActivePaneState(),t=e.getUndoObjectArray(e.getPageNumber()),a=e.getUndoIndex(e.getPageNumber());if(!(a<0)&&t[a]){var n=t[a],o=n.referenceAnn,i=n.layer;if("modify"===n.type)n.unchangedAnn&&o&&(o.copyFrom(n.unchangedAnn),u.markLayerDirty(i),virtualViewer.delayedPaintCanvases(),C.pageContainsAnnotations(C.getPageNumber())&&!C.pageHasIndicator(e.getPageNumber())&&(virtualViewer.showAnnotationIndicator(e.getPageNumber()),C.addToPagesWithAnnotations(e.getPageNumber())));else if(i.anns.length>0){u.markLayerDirty(i);var r=i.anns.pop();e.pushPoppedObject(e.getPageNumber(),r),virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null),virtualViewer.delayedPaintCanvases(),!C.pageContainsAnnotations(e.getPageNumber())&&C.pageHasIndicator(e.getPageNumber())&&(virtualViewer.removeAnnotationIndicators(e.getPageNumber()),C.removeFromPagesWithAnnotations(e.getPageNumber()))}a>=0&&(a--,e.setUndoIndex(e.getPageNumber(),a))}}},v.prototype.redoAnnotation=function(){if(tn({state:!0,documentModel:!0,notVideo:!0})){var e=d.getActivePaneState(),t=e.getUndoObjectArray(e.getPageNumber()),a=e.getUndoIndex(e.getPageNumber())+1;if(t[a]){var n=t[a],o=n.referenceAnn,i=n.layer;if("modify"===n.type)n.modifiedAnn&&o&&(o.copyFrom(n.modifiedAnn),u.markLayerDirty(i),virtualViewer.delayedPaintCanvases(),!C.pageContainsAnnotations(e.getPageNumber())&&C.pageHasIndicator(e.getPageNumber())&&(virtualViewer.removeAnnotationIndicators(e.getPageNumber()),C.removeFromPagesWithAnnotations(e.getPageNumber())));else if(e.getPoppedObjectArray(e.getPageNumber()).length>0){var r=e.popPoppedObject(e.getPageNumber());i.anns.push(r),u.markLayerDirty(i),virtualViewer.clearCanvases(e),virtualViewer.delayedPaintCanvases(),C.pageContainsAnnotations(e.getPageNumber())&&!C.pageHasIndicator(e.getPageNumber())&&(virtualViewer.showAnnotationIndicator(e.getPageNumber()),C.addToPagesWithAnnotations(e.getPageNumber()))}(0===a||a<=t.length-1)&&e.setUndoIndex(e.getPageNumber(),a)}}},v.prototype.getAnnClipboard=function(){return ue},v.prototype.setAnnClipboard=function(e){ue=e};var pt=function(){return s.autoLayerPrefix},ht=function(){return s.autoLayerSuffix},mt=function(e,a){var n,o=pt(),r=ht(),s=i.autoLayerName;if(a=a||C.getActivePaneState(),!a.autoLayerCounter){a.autoLayerCounter=0;for(var l=a.getLayerNames(),u=0;u<l.length;u++)for(var d=l[u],c=d.split("-"),g=0;g<c.length;g++)if(c[g]===i.autoLayerName&&c[g+1]){var v=parseInt(c[g+1],10);a.autoLayerCounter=Math.max(v,a.autoLayerCounter);break}a.autoLayerCounter++}var p=a.autoLayerCounter;return n=e?i.redactionLayerPrefix+"-"+t.vvGUID():o&&r?o+"-"+s+"-"+p+"."+r:o&&!r?o+"-"+s+"-"+p:!o&&r?s+"-"+p+"."+r:s+"-"+p,a.autoLayerCounter++,n};v.prototype.createAutoLayer=function(e){return ft(e)};var ft=function(e){var t=virtualViewer.getActivePaneState(),a=mt(e,t);return u.createLayer(a)};v.prototype.consolidateAnnotationLayers=function(){if(tn({state:!0,documentModel:!0,notVideo:!0})&&s.enableConsolidateAnnotationLayer&&!s.oneLayerPerAnnotation){var e=d.getActivePaneState(),a=e.getLayerNames(),n=s.consolidateLayerName||"Master Layer",o={client:!0,disable:C.disableErrorModals.annotations};if(!a.length){var i=t.getLocalizedValue("errors.noLayersExist","No Layers Exist.");return void vt(i,o)}if(a.indexOf(n)>-1){var i=t.getLocalizedValue("errors.masterLayerExists","Please delete your current Master Layer to create another.");return void vt(i,o)}u.createLayer(n),C.updateTabName(e);for(var r=0;r<e.getPageCount();r++)for(var l=e.getLayersForPage(r),c=l[n],g=Object.keys(l),v=0;v<g.length;v++){var p=l[g[v]];if(p&&p.layerName!==n)for(var h=0;h<p.anns.length;h++){var m=p.anns[h].clone();m.setLayerName(n),e.getOriginalWidthForPage(r)||c.pageWidth||(c.pageWidth=m.pageWidth,c.pageHeight=m.pageHeight,c.docDPI=m.docDPI),c.anns.push(m),e.setViewedForPage(r,!0)}}}};var yt=function(e){var a=d.getActivePaneState(),n=a.getLayerNames(),o=[],i=[];if(!n)return[];for(var r=0;r<a.getPageCount();r++){var s=a.getLayersForPage(r);if(s)for(var l=Object.keys(s),u=0;u<l.length;u++){var c=s[l[u]];if(c)for(var g=c.anns,v=0;v<g.length;v++){var p=g[v];o.indexOf(p)!==-1||p.annDelete||(t.isRedactionLayer(c)?e&&i.push(p):o.push(p))}}}return e?i:o};v.prototype.getRedactionsFromLayers=function(){return yt(!0)},v.prototype.getAnnotationCount=function(){return yt(!1).length},v.prototype.getRedactionCount=function(){return yt(!0).length},v.prototype.getRedactionPages=function(){for(var e=yt(!0),t=[],a=0;a<e.length;a++)t.indexOf(e[a].page)===-1&&t.push(e[a].page);return t};var bt=function(t){C.setPage(t.page),C.setCurrentAnnObject(t),C.getActiveOuterDiv().scrollTop(C.getScrollSpeed()*t.page+t.getAdjustedTop()),e("vvThumbs").highlightActiveThumbnail()},Pt=function(e,t){for(var a,n=0;n<t.length;n++)if(t[n].page===e){a=t[n];break}return a},At=function(e,a){e||(e=C.getRedactionPages()),a||(a=yt(!0));var n;if(C.getCurrentAnnObject()&&t.isRedactionLayer(u.getLayerWithAnn(C.getCurrentAnnObject()))){var o=a.indexOf(C.getCurrentAnnObject())-1;a[o]&&(n=a[o])}if(!C.getCurrentAnnObject()||!t.isRedactionLayer(u.getLayerWithAnn(C.getCurrentAnnObject()))){var i=C.getCurrentState().getPageNumber();if(e.indexOf(i)>-1)n=Pt(i,a);else{var r=C.closestLowest(i,e);n=Pt(r,a)}}return n};v.prototype.goToPreviousRedaction=function(){var e,t=yt(!0),a=C.getRedactionPages(),n=a[0];!a||C.getCurrentState().getPageNumber()<n||(e=At(a,t),e&&"true"!==$("#vvPrevAnnotationButton").prop("disabled")&&(bt(e),wt(e,t)))};var Tt=function(e,a){e||(e=C.getRedactionPages()),a||(a=yt(!0));var n;if(C.getCurrentAnnObject()&&t.isRedactionLayer(u.getLayerWithAnn(C.getCurrentAnnObject()))){var o=a.indexOf(C.getCurrentAnnObject())+1;a[o]&&(n=a[o])}if(!C.getCurrentAnnObject()||!t.isRedactionLayer(u.getLayerWithAnn(C.getCurrentAnnObject()))){var i=C.getCurrentState().getPageNumber();if(e.indexOf(i)>-1)n=Pt(i,a);else{var r=C.closestHighest(i,e);n=Pt(r,a)}}return n};v.prototype.goToNextRedaction=function(){var e,t=yt(!0),a=C.getRedactionPages(),n=a[a.length-1];!a||C.getCurrentState().page>n||(e=Tt(a,t),e&&(bt(e),wt(e,t)))};var St=function(){$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"),$("#vvAnnotationThumbsButton").prop("disabled",!0).addClass("disabled").tooltip("hide")},It=function(){$("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled")},wt=function(e,t){$("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"),e===t[t.length-1]?$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"):e===t[0]&&$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide")};v.prototype.toggleAnnotationVisibility=function(e){if(tn({state:!0,documentModel:!0,notVideo:!0})){var t=d.getActivePaneState();t.getLayerManager().toggleAllAnnotationLayersVisibility(e,t)}},v.prototype.event=function(e,t,a){if(s.enableEventNotification!==!1){e||(e=d.getActivePaneState());var n=new URI(s.servletPath),o={action:"eventNotification",KEY_EVENT:t,KEY_DOCUMENT_ID:e.getDocumentId(),clientInstanceId:virtualViewer.getClientInstanceId(),overrideLoggingLevel:virtualViewer.loggingOverride()};o=$.extend(o,a),i.cacheBuster&&(o.cacheBuster=Math.random()),$.ajax({url:n.toString(),type:"POST",data:o,dataType:"json",success:function(e){gt(e)===!0},error:function(t){gt(t,e.getDocumentId(),e.currentPaneIndex)===!0}})}};var Dt=function(e){C.event(e,"VALUE_EVENT_PAGE_REQUESTED",{KEY_EVENT_PAGE_REQUESTED_NUMBER:e.pageNumber})},Ct=function(){for(var e=d.getActivePaneState(),t={KEY_EVENT_PAGE_REQUESTED_NUMBER:e.pageNumber},a=e.getLayerNames(),n=0;n<a.length;n+=1)t["KEY_EVENT_SAVE_ANNOTATION_LAYER_NAME"+n]=a[n];C.event(e,"VALUE_EVENT_SAVE_ANNOTATION",t)},Mt=function(e,t){for(var a=d.getActivePaneState(),n={KEY_EVENT_ROTATE_PAGE:e,VALUE_EVENT_ROTATE_DEGREES:t},o=0;o<e.length;o+=1)n["KEY_EVENT_ROTATE_PAGE"+o]=e[o];C.event(a,"VALUE_EVENT_ROTATE_PAGE",n)};v.prototype.createPreviewAnnotation=function(e,t,a,n){if(!s.readOnlyAnnotationMode||n.isCrop||n.isRubberbandZoom)return xt(e,t,a)};var xt=function(t,a,n){n=n||d.getActivePaneState();var o,l,c,g,v,p;if(a||0===a||(a=n.getPageNumber()),Y.dragMode===i.dragModes.crop&&(E=i.annotationTypes.SANN_RECTANGLE),E===i.annotationTypes.SANN_BITMAP&&s.enableSingleClickImageRubberStamp){var h=Z.stampArray[Z.currentImageRubberStamp],m=n.getZoom();o=h.stampWidth*(m/100),l=h.stampHeight*(m/100),Y.dragStartLeft+o>n.getRequestedWidthForPage(a)&&(Y.dragStartLeft=n.getRequestedWidthForPage(a)-o),Y.dragStartTop+l>n.getRequestedHeightForPage(a)&&(Y.dragStartTop=n.getRequestedHeightForPage(a)-l)}else o=Y.dragStopLeft-Y.dragStartLeft,l=Y.dragStopTop-Y.dragStartTop;var f=new r(Y.dragStartLeft,Y.dragStartTop,o,l),y=E;null===y&&null!==virtualViewer.currentAnnType&&(y=virtualViewer.currentAnnType),t===!0||E!==i.annotationTypes.SANN_BUBBLE&&E!==i.annotationTypes.SANN_CLOUD_EDIT&&E!==i.annotationTypes.SANN_EDIT&&(E!==i.annotationTypes.SANN_BITMAP||s.enableSingleClickImageRubberStamp)||(y=i.annotationTypes.SANN_RECTANGLE);var b=j.getAnnotationPreference(E);c=b.lineWidth,g=b.lineColor,v=b.fillColor,p=s.annotationDefaults.highlightOpacity,E!==i.annotationTypes.SANN_FILLED_RECT&&E!==i.annotationTypes.SANN_HIGHLIGHT_RECT&&E!==i.annotationTypes.SANN_FILLED_ELLIPSE&&E!==i.annotationTypes.SANN_FILLED_POLYGON&&E!==i.annotationTypes.SANN_CIRCLE||(g=null,v=b.fillColor),t||E!==i.annotationTypes.SANN_POSTIT&&E!==i.annotationTypes.SANN_EDIT||(c=1);var P,A=n.getCurrentLayerOnPage(a);P=A?A.docDPI:n.getDPIForPage(a),null!==A&&void 0!==A||(A=u.createAnnotationLayer("temp",a,n.pageStates[a])),A.isIDM&&(P=200),E===i.annotationTypes.SANN_REDACTION_RECT&&(g=null,v=s.annotationDefaults.redactionFillColor,p=s.annotationDefaults.redactionOpacity);var T=A.doubleByte;s.oneLayerPerAnnotation&&(T=s.base64EncodeAnnotations);
var S=new(e("vvPreviewAnnotation"));if(S.initPreview(y,f,g,v,c,p,C.currentPointArray,T,P,A.isIDM,a,A),S.getType()===i.annotationTypes.SANN_REDACTION_RECT&&(S.setFillColorRGB(s.annotationDefaults.redactionFillColor),S.setOpacity(s.annotationDefaults.redactionOpacity)),t===!1){S.setPageWidth(n.getOriginalWidthForPage(a)),S.setPageHeight(n.getOriginalHeightForPage(a));var I=S.getFontSize()||b.fontSize,w=S.getLineWidth();S.setPageWidth(n.getRequestedWidthForPage(a)),S.setPageHeight(n.getRequestedHeightForPage(a)),S.setFontSize(I),S.setLineWidth(w)}if(A.isFilenet&&(S.isFilenet=!0),A.isDaeja&&(S.isDaeja=!0),A.isIDM&&(S.isIDM=!0,S.getType()===i.annotationTypes.SANN_POSTIT?S.setFontSize(200,!0):S.getType()===i.annotationTypes.SANN_EDIT),S.getType()===i.annotationTypes.SANN_BITMAP){var D=Z.getCurrentStamp();S.bitmapData=D.stampData,D.annotationId&&(S.annId=D.annotationId)}if(void 0!==C.currentStamp&&null!==C.currentStamp&&C.currentStamp>-1){var M=j.customStampArray[C.currentStamp];M.textString&&S.setTextString(M.textString),M.fontFace&&S.setFontName(M.fontFace),M.fontSize&&S.setFontSize(M.fontSize),M.fontBold&&(S.fontBold=M.fontBold),M.fontItalic&&(S.fontItalic=M.fontItalic),M.fontStrike&&(S.fontStrike=M.fontStrike),M.fontUnderline&&(S.fontUnderline=M.fontUnderline),M.fontColor&&(S.fontColor=M.fontColor)}return S},Lt=function(e){return"string"!=typeof e&&(e=$("#vvAnnotationsListFilter input").val()),e?void $(".vvAnnotationItem").each(function(){var t=$(this),a=t.find(".vvAnnotationListInfoCreated .vvAnnotationListInfoUser div").text().toLowerCase(),n=t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoUser div").text().toLowerCase();return e=e.toLowerCase(),a.indexOf(e)!==-1||n.indexOf(e)!==-1?void t.show():void t.hide()}):void $(".vvAnnotationItem").show()},Nt=function(e){e.preventDefault();var t=$(this).text().trim();Lt(t),$("#vvAnnotationsListFilter input").val(t)};v.prototype.updateAnnotationListItem=function(e){if(s.showAnnotationList){var t=virtualViewer.getListItemFromAnnotation(e);if(t&&t.length){if(e.getDelete())return void t.remove();e.getTextString()&&t.find(".vvAnnotationListInfoText").text(e.getTextString()),t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoUser .vvAnnInfoEntry").text(e.getMostRecentModifyUser()),t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoDate .vvAnnInfoEntry").text(e.getMostRecentModifyDateFormatted()),Lt()}}};var $t=function(){var e=$("#vvAnnotationsListFilter input");e.on("keypress",Lt);var a=null;e.addClear({symbolClass:"text_clear_symbol icon",onClear:function(){Lt("")}}),e.keydown(function(){a&&clearTimeout(a),a=setTimeout(function(){Lt(e.val())},200)}),e.prop("placeholder",t.getLocalizedValue("annotationInfoList.filterByUser","Filter by User")),$("#vvFilterOptionsDropdownOptions li a").on("click",function(t){t.preventDefault(),Lt(""),e.val("")})};v.prototype.getListItemFromAnnotation=function(e){if(!e)return $();var t=$(".vvAnnPage"+e.page);if(!t||!t.length)return $();var a=t.find(".vvAnnotationItem").filter(function(){var t=$(this);return t.data("layername")===e.layerName&&t.data("ordinal")===e.ordinal});return a};var Vt=function(e){var t=$(this),a=t.data("layername");if(a){for(var n,o=t.data("ordinal"),i=t.data("type"),r=d.getCurrentState(),s=r.getLayerFromPage(t.data("pagenumber"),a)||{anns:[]},l=s.anns,u=0;u<l.length;u++)if(l[u].ordinal===o&&l[u].type===i){n=l[u];break}n&&bt(n)}};v.prototype.addUsersToDropDown=function(e,t){var a=$("#vvFilterOptionsDropdownOptions .vvAnnotationListUserOption a").filter(function(){var a=$(this).text().trim();if(a===e||a===t)return!0}),n={};e&&a.eq(0).text().trim()!==e&&a.eq(1).text().trim()!==e&&(n[e]=!0),t&&a.eq(0).text().trim()!==t&&a.eq(1).text().trim()!==t&&(n[t]=!0);var o=$($("#vvAnnotationListUserOptionTemplate").render(n));o.appendTo($("#vvFilterOptionsDropdownOptions")),o.on("click",Nt)},v.prototype.addSingleAnnotationListItem=function(e){if(s.showAnnotationList&&!this.getListItemFromAnnotation(e).length){var t=$($("#annotationListItemTemplate").render(e));t.on("click",Vt),this.addUsersToDropDown(e.getMostRecentModifyUser(),e.createUser);var a=this.pagesWithAnnotationsCore(d.getCurrentState()),n=a.indexOf(e.page);if(n!==-1){var o=$(".vvAnnotationListPageDiv.vvAnnPage"+e.page);if(o.length&&o.data("pagenumber")===e.page)return void o.append(t);var i=$("<div></div>").addClass("vvAnnotationListPageDiv vvAnnPage"+e.page).data("pagenumber",e.page).append(t);if(o.length)return void o.before(i);$("#vvAnnotationsListInternal").append(i),Lt()}}},v.prototype.fillAnnotationList=function(){var e=d.getCurrentState();if(s.showAnnotationList&&e){var t=$("#vvAnnotationsListInternal");t.empty();for(var a=$("#annotationListItemTemplate"),n={},o=0;o<e.getPageCount();o++){for(var i=$("<div></div>").addClass("vvAnnotationListPageDiv vvAnnPage"+o).data("pagenumber",o),r=e.getAnnotationsForPage(o,!0)||[],l=0;l<r.length;l++){var u=$(a.render(r[l]));u.on("click",Vt),i.append(u);var c=r[l].getMostRecentModifyUser(),g=r[l].createUser;n[c]=!0,n[g]=!0}r.length&&t.append(i)}n[j.getUsername()]=!0,$("#vvFilterOptionsDropdownOptions .vvAnnotationListUserOption").remove();var v=$($("#vvAnnotationListUserOptionTemplate").render(n));v.appendTo($("#vvFilterOptionsDropdownOptions")),v.on("click",Nt)}},v.prototype.thumbsWithAnnotations=function(){var e=C.getCurrentState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)){for(var t=[],a=$("#vvPageThumbs .vvThumbBox"),n=0;n<e.getPageCount();n+=1)C.pageContainsAnnotations(n)&&t.push(a.eq(n));return t}},v.prototype.showThumbsWithAnnotations=function(){var a=C.getCurrentState();if(te||$("#vvRedactionNavigationOption")[0].checked)$("#vvRedactionNavigationOption")[0].checked||($("#vvAnnotationThumbsButton").removeClass("ann-filter-on"),$("#vvPageThumbs .vvThumbBox").show(),C.showAllAnnotationIndicators(),te=!1,$("#vvAnnotationThumbsButton").attr("title",t.getLocalizedValue("annotationNavigation.showThumbsWithAnnotationsOn","Turn Filter On")));else{$("#vvAnnotationThumbsButton").addClass("ann-filter-on");for(var n=0;n<a.getPageCount();n++)C.pageHasAnnotation(n)?C.removeAnnotationIndicators(n):$("#vvPageThumbs .vvThumbBox:eq("+n+")").hide();te=!0,$("#vvAnnotationThumbsButton").attr("title",t.getLocalizedValue("annotationNavigation.showThumbsWithAnnotationsOff","Turn Filter Off")),e("vvThumbs").loadVisibleThumbs()}},v.prototype.showAnnotationIndicator=function(e){if(tn({state:!0,documentModel:!0,notVideo:!0})&&s.showAnnIndicators&&!this.pageHasIndicator(e)){var t=$("#vvPageThumbs .vvThumbBox").eq(e);$("<div></div>",{class:"vvAnnotationIndicatorCheckmark icon"}).prependTo(t)}},v.prototype.removeAnnotationIndicators=function(e){tn({})&&s.showAnnIndicators&&"number"==typeof e&&$("#vvPageThumbs .vvThumbBox:eq("+e+") .vvAnnotationIndicatorCheckmark").remove()},v.prototype.removeAllAnnotationIndicators=function(){tn({})&&$("#vvPageThumbs").find(".vvAnnotationIndicatorCheckmark").remove()},v.prototype.showAllAnnotationIndicators=function(){if(s.showAnnIndicators&&tn({state:!0,documentModel:!0,notVideo:!0})){var e=this.getCurrentState();if(e.isVirtualDocument())for(var t=0;t<e.getPageCount();t++)this.pageHasAnnotation(t,e)&&this.showAnnotationIndicator(t);else{var a=this.pagesWithAnnotations();ee=a;for(var n=0;n<a.length;n+=1)this.showAnnotationIndicator(a[n])}}},v.prototype.pageHasAnnotation=function(e,t){if(t=t||d.getCurrentState(),!t.pageStates||e>=t.getPageCount())return!1;for(var a=t.pageStates[e].annotationLayers||{},n=Object.keys(a),o=0;o<n.length;o++){var i=n[o];if(a[i]){var r=a[i];if(0!==r.anns.length)return!0}}return!1},v.prototype.closestHighest=function(e,t){for(var a=t.length-1,n=t[a],o=0;o<t.length;o++)t[o]>e&&t[o]<n&&(n=t[o]);return n};var kt=function(e,t){var a,n=t.indexOf(e);return a=n===-1?C.closestHighest(e,t):t[n+1]};v.prototype.goToNextPageWithAnn=function(){var t=C.pagesWithAnnotations(),a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0})){var n,o=a.pageNumber,i=t[t.length-1];if($("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"),!t.length||o>=i)return void $("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide");n=kt(o,t),virtualViewer.setPage(n),e("vvThumbs").highlightActiveThumbnail()}},v.prototype.closestLowest=function(e,t){for(var a=t[0],n=0;n<t.length;n++)t[n]<e&&t[n]>a&&(a=t[n]);return a};var Rt=function(e,t){var a,n=t.indexOf(e);return a=n===-1?C.closestLowest(e,t):t[n-1]};v.prototype.goToPrevPageWithAnn=function(){var t=C.pagesWithAnnotations(),a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0})){var n,o=a.pageNumber;if($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),!o||!t.length||o<=t[0])return void $("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide");n=Rt(o,t),virtualViewer.setPage(n),e("vvThumbs").highlightActiveThumbnail()}};var Bt=function(e,t){var a=t.length-1;t.length<=1?($("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled")):e===t[0]?($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled")):e>=t[a]?($("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled")):($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"))};v.prototype.navigationButtonHandler=function(e){if(e){var t=yt(!0),a=Tt(),n=At();a&&wt(a,t),n&&wt(a,t)}else{var o=C.pagesWithAnnotations(),i=C.getActivePaneState().getPageNumber(),r=Rt(i,o);r&&Bt(r,o);var s=kt(i,o);s&&Bt(s,o)}},v.prototype.showAnnotationNaviPanel=function(e){var t=$("#vvPageThumbs");if(t.hasClass("vvAnnotationNavigation")&&!e||e===!1)return t.removeClass("vvAnnotationNavigation"),void t.addClass("vvAnnotationNavigationHidden");if(!tn({state:!0,notVideo:!0}))return t.removeClass("vvAnnotationNavigation"),void t.addClass("vvAnnotationNavigationHidden");var a=C.pagesWithAnnotations();t.addClass("vvAnnotationNavigation"),t.removeClass("vvAnnotationNavigationHidden"),C.createNavigationOptionsLabels(),a.length<=1&&($("#vvPrevAnnotationButton").attr("aria-disabled",!0),$("#vvNextAnnotationButton").attr("aria-disabled",!0))},v.prototype.navigationChangeHandler=function(e){"redaction"===$("input[name='radio']:checked").val()&&"vvNextAnnotationButton"===e.target.id?C.goToNextRedaction():"vvNextAnnotationButton"===e.target.id&&C.goToNextPageWithAnn(),"redaction"===$("input[name='radio']:checked").val()&&"vvPrevAnnotationButton"===e.target.id?C.goToPreviousRedaction():"vvPrevAnnotationButton"===e.target.id&&C.goToPrevPageWithAnn()},v.prototype.createNavigationOptionsLabels=function(){var e=C.getAnnotationCount(),t=C.getRedactionCount();$("#vvAnnotationNavigationOptionLabel").html("Annotations: "+e),$("#vvRedactionNavigationOptionLabel").html("Redactions: "+t)},v.prototype.pageHasIndicator=function(e){var t=$("#vvPageThumbs .vvThumbBox:eq("+e+") .vvAnnotationIndicatorCheckmark");return!!t.length},v.prototype.pagesWithAnnotations=function(){return this.pagesWithAnnotationsCore()},v.prototype.pagesWithAnnotationsCore=function(e){var t=[];if(e=e||d.getCurrentState(),e.isMedia())return[];if(!tn({state:!0,notVideo:!0},e))return[];for(var a=0;a<e.getPageCount();a++)C.pageHasAnnotation(a,e)&&t.push(a);return t},v.prototype.removeFromPagesWithAnnotations=function(e){var t=ee.indexOf(e);t>-1&&ee.splice(t,1)},v.prototype.addToPagesWithAnnotations=function(e){return ee.indexOf(e)===-1&&(ee.push(e),ee.sort()),ee},v.prototype.getVisibleAnnotationPages=function(){return ee},v.prototype.getDragMode=function(){return Y.getDragMode()},v.prototype.setDragMode=function(e){Y.setDragMode(e)},v.prototype.findPos=function(e){return Ft(e)};var Ft=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);var n=virtualViewer.getActiveOuterDiv();return a-=n.scrollTop(),t-=n.scrollLeft(),[t,a]},Et=function(e,t){if(!e||!e.getDocumentId())return null;var a=e.getPageNumber(),n=a-s.continuousScrollBufferBeforeSize,o=a+s.continuousScrollBufferAfterSize;n||0===n||(n=a-1),o||0===o||(o=a+3);var i=[];t?e.getImageManager().nukeBuffers():e.getImageManager().cleanBuffers();for(var r=n;r<=o;r++)if(!(r<0)){if(r>=e.getPageCount())break;i.push(r)}for(var l=0;l<i.length;l++)e.requestPage(i[l],t,t)};v.prototype.resetSVGSupport=function(e){var t=d.getActivePaneState();t.resetSVGSupport(e)};var Ot=function(e,t,a,n){if(e=e||d.getActivePaneState()){a=a||C.getOuterDivFromState(e),n=n||a.find(".vvScroller"),t=t||a.find(".vvCanvas");var o=!1,i=tt(a),r=et(a);return Math.abs(t[0].width-r)>1&&(t[0].width=r,o=!0),Math.abs(t[0].height-i)>1&&(t[0].height=i,o=!0),o}};v.prototype.positionCanvases=function(e,t,a,n){return Ot(e,t,a,n)},v.prototype.getTransformedPageLeft=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=t.page;n||0===n||(n=a.pageNumber);var o=t.pageHeight||a.getRequestedHeightForPage(n),i=t.pageWidth||a.getRequestedWidthForPage(n),r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.outerDiv||virtualViewer.getOuterDivFromState(a),l=t.dummyScroller||s.find(".vvScroller"),u=t.canvas||s.find(".vvCanvas"),c=$(l).width()-$(s).width();c<0&&(c=0);var g,v=($(u).width()+c)/2-$(s).scrollLeft();return g=90===r?v+o/2:270===r?v-o/2:180===r?v+i/2:v-i/2},v.prototype.getVisualPageLeft=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=a.validatePageNumber(t.page);if(n<0)return 0;var o=t.pageHeight||a.getRequestedHeightForPage(n),i=t.pageWidth||a.getRequestedWidthForPage(n),r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.outerDiv||virtualViewer.getOuterDivFromState(a),l=t.dummyScroller||s.find(".vvScroller"),u=t.canvas||s.find(".vvCanvas"),c=l.width()-s.width();c<0&&(c=0);var g,v=($(u).width()+c)/2-s.scrollLeft();return 90===r||270===r?g=v-o/2:180!==r&&0!==r||(g=v-i/2),g},v.prototype.getVisualPageTop=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=a.validatePageNumber(t.page);if(n<0)return 0;var o=t.pageHeight||a.getRequestedHeightForPage(n),i=t.pageWidth||a.getRequestedWidthForPage(n),r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.currentTransformedTop;return s||0===s||(s=virtualViewer.getTransformedPageTop(t)),0===r||90===r?s:180===r?s-o:270===r?s-i:s},v.prototype.getTransformedPageTop=function(e){var t=$.extend({},e),a=t.state||d.getActivePaneState(),n=t.outerDiv||virtualViewer.getOuterDivFromState(a),o=t.dummyScroller||n.find(".vvScroller"),r=(t.canvas||n.find(".vvCanvas"),t.page);r||0===r||(r=a.pageNumber),a=a||d.getActivePaneState();var s=t.pageHeight||a.getRequestedHeightForPage(r),l=t.pageWidth||a.getRequestedWidthForPage(r),u=t.rotateAngle;u||0===u||(u=a.getRotationForPage(r));var c,g=t.currentZeroPage||Qt(a,n,o),v=-virtualViewer.scrollerToPaint(a,g,n,o);if(r<g)for(var p=g-1;p>=r;p--)c=a.getRotationForPage(p),v-=90===c||270===c?a.getOriginalWidthForPage(p)*a.getZoomDecimal():a.getOriginalHeightForPage(p)*a.getZoomDecimal(),v-=i.spaceBetweenPages;else if(r>g)for(var h=g+1;h<=r;h++)c=a.getRotationForPage(h-1),v+=90===c||270===c?a.getOriginalWidthForPage(h-1)*a.getZoomDecimal():a.getOriginalHeightForPage(h-1)*a.getZoomDecimal(),v+=i.spaceBetweenPages;return 180===u?v+s:270===u?v+l:v},v.prototype.clearCanvases=function(e,t){e||(e=d.getActivePaneState()),t||(t=e.currentPaneIndex>0&&C.getActivePane()>0?$("#vvSplitCanvas")[0]:$("#vvImageCanvas")[0]);var a=t.getContext("2d");a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,t.width,t.height),a.restore(),$(".vvAnnSelected").removeClass("vvAnnSelected")},v.prototype.delayedPaintCanvases=function(e){k&&window.clearTimeout(k);var t=e||50;k=window.setTimeout(C.paintCanvases,t)},v.prototype.paintCanvases=function(){if(d.getActivePaneState()){if(!s.splitScreen||!ae)return void Ut(d.getCurrentState(0));for(var e=0;e<d.displayedDocuments.length;e++)Ut(d.getCurrentState(e))}};var Ut=function(a){if(a=a||d.getActivePaneState()){var n=virtualViewer.getOuterDivFromState(a),o=n.find(".vvCanvas"),i=n.find(".vvScroller"),r=n.find(".vvInner"),l=virtualViewer.positionCanvases(a,o,n,i);l||virtualViewer.clearCanvases(a,o[0]),$("#vvAnnPopUp:visible").length&&l&&Xt(),l&&ae&&G.adjustForWindowResize();var g=n.parents(".split");n.width(g.width()),n.height(g.height()),r.css("position","fixed");var v=n.offset();r.css("left",v.left+10),r.css("top",v.top+20),o=o[0];var p=o.getContext("2d"),h=n.width(),m=a.getImageManager(),f=i.width()-h,y=Qt(a,n,i),b=y+s.continuousScrollBufferAfterSize;b||0===b||(b=y+3);var P,A,T,S,I;if(b>=a.getPageCount()&&(b=a.getPageCount()-1),f<0&&(f=0),a.isMedia())return void a.getMediaManager().resizeVideo();if(a.pageStates){for(var w=y;w<=b;w++)if(!(w<0||w>=a.getPageCount())&&m&&a.pageStates[w]){T=a.getRotationForPage(w);var D=a.getRequestedWidthForPage(w),M=a.getRequestedHeightForPage(w),x={page:w,state:a,pageWidth:D,pageHeight:M,rotateAngle:T,dummyScroller:i,outerDiv:n,canvas:o,currentZeroPage:y};P=virtualViewer.getTransformedPageLeft(x),A=virtualViewer.getTransformedPageTop(x),x.currentTransformedTop=A;var L=virtualViewer.getVisualPageTop(x);if(L>n[0].offsetHeight)break;p.save(),S=Math.sin(t.degreesToRadians(T)),I=Math.cos(t.degreesToRadians(T)),p.setTransform(I,S,-S,I,P,A),_t(a,o,p,w),a&&a.watermarks&&a.watermarks.length>0&&e("vvWatermarks").paintPageWatermarks(w,a,p),a.documentId===d.getActivePaneState().documentId&&0===C.getActivePane()&&c.getCurrentSearchResults().length>0&&c.paintDocumentSearchResults(a,o,p,w),a.isPageCropped(w)||(w===a.pageNumber&&C.getActivePane()===a.currentPaneIndex&&Xa(o,p,a),Ga(a.currentPaneIndex,w,o,p)),p.restore(),u.paintAnnotations(a,o,p,w);var N=virtualViewer.currentPreviewAnnObject;N&&a.documentId===d.getActivePaneState().documentId&&N.page===w&&u.paintAnnotation(a,o,p,N),p.save(),p.setTransform(I,S,-S,I,P,A),zt(a,w,p),p.restore(),virtualViewer.horizontalGuide&&virtualViewer.horizontalGuide.visible&&(p.save(),p.translate(virtualViewer.getVisualPageLeft(x),L),Ka(o,p,a,w),p.restore())}Ja(o,p),G.getMagnifierEnabled()&&G.paintMagnifierCanvas(),virtualViewer.createNavigationOptionsLabels()}}};v.prototype.getScrollSpeed=function(e){e=e||d.getActivePaneState();var t=s.scrollSpeed||30,a=e.getZoomDecimal();a<0&&(a=0);var n=100,o=t*n*Math.sqrt(a),r="Explorer"===BrowserDetect.browser||"Edge"===BrowserDetect.browser,l="Firefox"===BrowserDetect.browser;if(r||l){var u=o*e.getPageCount(),c=r?i.maxHtmlHeightMicrosoft||15e5:i.maxHtmlHeightFirefox||17e6;u>c&&(o=c/e.getPageCount())}return o},v.prototype.sizeScroller=function(e){e||(e={});var t=e.state||d.getActivePaneState(),a=e.outerDiv||C.getOuterDivFromState(t),n=e.scroller||a.find(".vvScroller"),o=e.canvas||a.find(".vvCanvas");if(t){var i=tt(a),r=et(a),s=virtualViewer.getScrollSpeed(t),l=t.pageCount*s+a[0].offsetHeight;1===t.getPageCount()&&t.getRequestedWidthForPage(0)&&!t.isMedia()?t.widthIsOnXAxis(0)&&t.getRequestedHeightForPage(0)<i?l=i:!t.widthIsOnXAxis(0)&&t.getRequestedWidthForPage(0)<i&&(l=i):t.isMedia()&&(l=20),$(n).height(l);for(var u=r,c=0;c<t.getPageCount();c++)t.widthIsOnXAxis(c)?u<t.getRequestedWidthForPage(c)&&(u=t.getRequestedWidthForPage(c)):u<t.getRequestedHeightForPage(c)&&(u=t.getRequestedHeightForPage(c));$(n).width(u-(x||0)/2),e.applyAndResetCachedScroll&&(st(t),t.clearCachedScroll()),Ot(t,o,a,n)}};var _t=function(e,t,a,n){var o=e.getImageManager(),i=o.getBestImageFromPage(n);if(o.checkIsImageComplete(i)){var r=e.getRequestedWidthForPage(n),s=e.getRequestedHeightForPage(n);if(0===r||0===s){if(!e.pageStates[n].imageInfoLoaded)return;virtualViewer.determineEffectiveZoom(n,e)}if(a.save(),e.getHorizontalFlipForPage()&&(a.translate(r,0),a.scale(-1,1)),e.getVerticalFlipForPage()&&(a.translate(0,s),a.scale(1,-1)),e.isPageCropped(n)){var l=e.getOriginalWidthForPage(n)/r,u=e.getPageCropBox(n),d=Math.ceil(u.cropTop/l),c=Math.ceil(u.cropLeft/l),g=Math.ceil(u.cropWidth/l),v=Math.ceil(u.cropHeight/l);try{a.drawImage(i,u.cropLeft,u.cropTop,u.cropWidth,u.cropHeight,c,d,g,v),e.pageStates[n].pageAlreadyRendered||(X.call("onPageLoadAndRendered",{documentId:e.documentId,pageNumber:n}),e.pageStates[n].pageAlreadyRendered=!0)}catch(e){console.log("Error drawing cropped image: "+e)}finally{a.restore()}}else try{a.drawImage(i,0,0,r,s),e.pageStates[n].pageAlreadyRendered||(X.call("onPageLoadAndRendered",{documentId:e.documentId,pageNumber:n}),e.pageStates[n].pageAlreadyRendered=!0)}catch(e){console.log("Error drawing full image: "+e)}finally{a.restore()}}},zt=function(e,t,a){if(e&&e.getImageManager()){var n=e.getImageManager(),o=n.getOverlayOffsetForPage(t);if(o&&n.checkIsImageComplete(n.overlayImage)){var i,r,s,l=e.getRequestedWidthForPage(t),u=e.getRequestedHeightForPage(t),d=n.overlayImage,c=l/d.width,g=u/d.height;c<g?(i=l,r=d.height*c,s=c):(i=d.width*g,r=u,s=g);try{n.stripWhite(d),a.drawImage(d,o.offsetX*s,o.offsetY*s,i,r)}catch(e){console.log("exception: "+e)}}}};v.prototype.centerScrollbar=function(){Wt()};var Wt=function(e){var t,a,n;if(e||(e=d.getActivePaneState()),e.pageCount){a=d.getOuterDivFromState(e),n=a.find(".vvScroller"),t=a.find(".vvCanvas");var o=e.pageNumber,i=a.width();if(n.width()>e.getRequestedWidthForPage(o)){var r=n.width()-i;r<0&&(r=0);var s=r/2;a.scrollLeft(s)}}},Ht=function(e,t){return R&&clearTimeout(R),e?void(R=setTimeout(function(){Et(e,t)},150)):void(R=setTimeout(function(){d.getCurrentState(0)&&Et(d.getCurrentState(0),!1),d.getCurrentState(1)&&Et(d.getCurrentState(1),!1)},150))};v.prototype.scrollPageFinder=function(e,t,a){return Qt(e,t,a)};var Qt=function(e,t,a){e=e||d.getActivePaneState(),t=t||C.getOuterDivFromState(e),a=a||t.find(".vvScroller");var n=$(t).scrollTop(),o=virtualViewer.getScrollSpeed(e),i=Math.floor(n/o);return i>=e.pageCount&&(i=e.pageCount-1),i};v.prototype.scrollerToPaint=function(e,t,a,n){e=e||d.getActivePaneState(),a=a||C.getOuterDivFromState(e),n=n||a.find(".vvScroller"),null!==t&&void 0!==t||(t=e.pageNumber);var o=$(a).scrollTop(),i=virtualViewer.getScrollSpeed(e),r=o%i/i,s=e.getRequestedHeightForPage(t),l=e.getRotationForPage(t);return 90!==l&&270!==l||(s=e.getRequestedWidthForPage(t)),t===e.getPageCount()-1&&o/i-1>=t&&(r+=1),r*s},v.prototype.emailDocument=function(t){if(tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0})){var a=d.getActivePaneState(),n=a.getDocumentId();e("vvWatermarks").saveWatermarks(a);var o=a.getDocumentModel(),i=new URI(s.servletPath);t=t||{};var r={action:"emailDocument",format:t.format,pageRangeType:t.pageRangeType||"all",pageRangeValue:t.pageRangeValue,pageCount:o.getDocumentLength(),includeTextAnnotations:t.includeTextAnnotations,includeNonTextAnnotations:t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:"string"==typeof t.fromAddress?t.fromAddress:s.emailDefaults.prepopulateFrom,toAddresses:"string"==typeof t.toAddresses?t.toAddresses:s.emailDefaults.prepopulateTo,ccAddresses:"string"==typeof t.ccAddresses?t.ccAddresses:s.emailDefaults.prepopulateCC,bccAddresses:"string"==typeof t.bccAddresses?t.bccAddresses:s.emailDefaults.prepopulateBCC,subject:t.subject,emailBody:t.emailBody,documentId:n,clientInstanceId:C.getClientInstanceId(),cacheBuster:Math.random(),overrideLoggingLevel:virtualViewer.loggingOverride(),modelJSON:JSON.stringify(o.model),annotations:JSON.stringify(a.getAnnotationLayers(!0,!1,!1,t.burnRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,"PDF"===t.format))};return X.call("emailDocumentBegin",{format:t.format,pageRangeType:r.pageRangeType,pageRangeValue:t.pageRangeValue,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:r.fromAddress,toAddresses:r.toAddresses,ccAddresses:r.ccAddresses,bccAddresses:r.bccAddresses,subject:r.subject,emailBody:r.emailBody,documentId:n,clientInstanceId:C.getClientInstanceId()}),L?r.smtpServer=L:s.emailDefaults.smtpServerOverride&&(r.smtpServer=s.emailDefaults.smtpServerOverride),null!==C.getOverlayPath()&&(r.overlayPath=C.getOverlayPath()),$.ajax({url:i.toString(),type:"POST",dataType:"json",data:r,success:function(e){gt(e)?X.call("emailDocumentError",{format:t.format,pageRangeType:r.pageRangeType,pageRangeValue:t.pageRangeValue,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:r.fromAddress,toAddresses:r.toAddresses,ccAddresses:r.ccAddresses,bccAddresses:r.bccAddresses,subject:r.subject,emailBody:r.emailBody,documentId:n,clientInstanceId:C.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText}):X.call("emailDocument",{format:t.format,pageRangeType:r.pageRangeType,pageRangeValue:t.pageRangeValue,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:r.fromAddress,toAddresses:r.toAddresses,ccAddresses:r.ccAddresses,bccAddresses:r.bccAddresses,subject:r.subject,emailBody:r.emailBody,documentId:n,clientInstanceId:C.getClientInstanceId()}),Sa(!1)},error:function(e){gt(e,a.getDocumentId(),a.currentPaneIndex),Sa(!1),X.call("emailDocumentError",{format:t.format,fromAddress:r.fromAddress,toAddresses:r.toAddresses,ccAddresses:r.ccAddresses,bccAddresses:r.bccAddresses,subject:r.subject,emailBody:r.emailBody,documentId:n,clientInstanceId:C.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText})}}),!0}},v.prototype.setSmtpServerOverride=function(e){L=e},v.prototype.getSmtpServerOverride=function(){return L},v.prototype.exportDocument=function(e){return C.exportDocumentCore(e)},v.prototype.exportDocumentCore=function(a,n){if(n=n||d.getActivePaneState(),a=a||{},tn({state:!0,notVideo:!0,notPageLimited:!0},n)){var o={action:"newExport",format:a.exportFormat,includeTextAnnotations:a.includeTextAnnotations,includeNonTextAnnotations:a.includeNonTextAnnotations,includeRedactions:a.burnRedactions,includeRedactionTags:a.includeRedactionTags,includeDocumentNotes:a.includeDocumentNotes,includeWatermarks:a.includeWatermarks,pageRangeType:a.pageRangeType,pageRangeValue:a.pageRangeValue,annotations:JSON.stringify(n.getAnnotationLayers(!0,!1,!1,a.burnRedactions,a.includeTextAnnotations,a.includeNonTextAnnotations,"PDF"===a.exportFormat)),clientInstanceId:C.getClientInstanceId()};_&&(o.exportFileName=encodeURIComponent(_(a.fileExtension))),X.call("exportDocumentBegin",{documentId:n.getDocumentId(),format:a.exportFormat,includeAnnotations:a.includeTextAnnotations&&a.includeNonTextAnnotations,includeRedactions:a.burnRedactions,includeRedactionTags:a.includeRedactionTags,includeDocumentNotes:a.includeDocumentNotes,includeWatermarks:a.includeWatermarks,pageRangeType:a.pageRangeType,pageRangeValue:a.pageRangeValue,filename:o.exportFileName,clientInstanceId:C.getClientInstanceId()});var i;n.getDocumentModel()?(e("vvWatermarks").saveWatermarks(n),i=n.getDocumentModel().model):i={documentId:n.documentId},o.modelJSON=JSON.stringify(i);var r=n.getPageCount();r||(r=1),o.pageCount=r;var l=$("#autoFormTemplate").render({action:s.servletPath,data:o}),u=$(l);u.appendTo($("body")),BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&u.attr("target","_blank");var c=$("#vvDownloadFrame"),g=n.getDocumentId();return c.on("load",function(){var e=c.contents().find("body").text().substr(0,1e3);try{var a=JSON.parse(e);gt(a)&&X.call("exportDocumentError",{documentId:g,format:i.exportFormat,includeAnnotations:i.includeTextAnnotations&&i.includeNonTextAnnotations,includeRedactions:i.burnRedactions,includeRedactionTags:i.includeRedactionTags,includeDocumentNotes:i.includeDocumentNotes,includeWatermarks:i.includeWatermarks,pageRangeType:i.pageRangeType,pageRangeValue:i.pageRangeValue,filename:o.exportFileName,clientInstanceId:C.getClientInstanceId(),exceptionMessage:a.exceptionMessage})}catch(e){var n=t.getLocalizedValue("errors.exportError","Error while exporting document. Unable to display detailed error."),i={client:!1,disable:C.disableErrorModals.export};vt(n,i),X.call("exportDocumentError",{documentId:g,format:i.exportFormat,includeAnnotations:i.includeTextAnnotations&&i.includeNonTextAnnotations,includeRedactions:i.burnRedactions,includeRedactionTags:i.includeRedactionTags,includeDocumentNotes:i.includeDocumentNotes,includeWatermarks:i.includeWatermarks,pageRangeType:i.pageRangeType,pageRangeValue:i.pageRangeValue,filename:o.exportFileName,clientInstanceId:C.getClientInstanceId(),exceptionMessage:"JSON parsing exception"})}c.off("load")}),u.submit(),u.remove(),!0}},v.prototype.downloadDocument=function(t){var a=t.indexOf("."),n=t.substring(a+1),o=virtualViewer.getStateForDocumentId(t);o||(o=new(e("vvDocViewState"))(t)),C.exportDocumentCore({exportFormat:"Original",fileExtension:n,includeTextAnnotations:!1,includeNonTextAnnotations:!1,burnRedactions:!1,includeRedactionTags:!1,includeDocumentNotes:!1,includeWatermarks:!1,pageRangeType:"all",pageRangeValue:"undefined"},o)},v.prototype.determineEffectiveZoom=function(e,t,a,n){if(t=t||d.getActivePaneState(),t&&t.pageStates&&t.pageStates.length){e||0===e||(e=t.getPageNumber()),a=a||virtualViewer.getActiveOuterDiv(),n=n||a.find(".vvScroller");var o=t.getZoomMode();o||0===o||(o=s.defaultZoomMode||i.zoomModes.fitWindow);var r=t.getZoom();r||(r=100);var l=t.getOriginalHeightForPage(e),u=t.getOriginalWidthForPage(e);if(u&&l){var c=!1;if(0!==e||M||(M=1),n.width()>a.width()&&0===a.scrollLeft()&&1===M&&(c=!0,M=!0),M){var g=et(),v=tt(),p=t.getRotationForPage(e),h=g/u,m=v/l,f=r/100,y=v/u,b=g/l,P=o===i.zoomModes.fitWidth,A=o===i.zoomModes.fitHeight;o!==i.zoomModes.fitHeight&&o!==i.zoomModes.fitWidth&&o!==i.zoomModes.fitWindow||(u&&l&&o===i.zoomModes.fitWindow&&(h>=m?A=!0:P=!0),P&&(f=90===p||270===p?b:h),A&&(f=90===p||270===p?y:m),e===t.pageNumber&&t.setZoomMode(i.zoomModes.fitCustom),t.setZoomDecimal(f),C.sizeScroller({state:t,outerDiv:a,scroller:n})),t.zoomPage(f,e),c&&Wt(t)}}}},v.prototype.collapsedStickySize=function(e){e=e||this.getActivePaneState().getZoomDecimal();var t=s.collapseStickiesSize||50,a=t*e;return a<5&&(a=5),Modernizr.touch&&(a*=2),a},v.prototype.findPagePosition=function(e,t){t||(t=virtualViewer.getCurrentState()),null!==e&&void 0!==e||(e=t.pageNumber);var a=virtualViewer.getScrollSpeed(t);return Math.ceil(a*e)};var jt=function(e){var t=s.annotationTags.indexOf(e);if(t!==-1){var a=$("#vvAnnTagList .vvTagOption").eq(t),n=C.isRedaction(C.getCurrentAnnObject()),o=$("<div></div>").text(e).text();a.length&&a.text()===o&&(n&&$("#vvAnnTagList .vvTagOption").removeClass("disabled"),a.toggleClass("disabled",!a.hasClass("disabled")))}},qt=function(e){var t=$("<div></div>").addClass("vvAnnTagChosenBox"),a=$("<span></span>").addClass("vvAnnTagCloseButton vvAnnTagInnerButton").data("tagname",e).text("x").on("click",Yt),n=$("<span></span>").addClass("vvAnnTagContent").text(e);return t.append(a).append(n),t},Gt=function(e){var t=$("<li></li>").addClass("vvTagOption dropdown-item"),a=$("<a></a>").text(e);return t.append(a),t},Yt=function(){var e=virtualViewer.getCurrentAnnObject(),t=$(this).data("tagname");jt(t);for(var a=0;a<e.annotationTags.length;a++)if(e.annotationTags[a]===t){e.annotationTags.splice(a,1);break}$(this).parent().remove(),e.markRevised(),u.markLayerWithAnnDirty(e)};v.prototype.hideAnnTagsPopUp=function(e){if(s.annotationTags.length>0){if(e)return void $("#vvAnnTag").hide();$("#vvAnnTag").show()}};var Xt=function(e,t,a){var o,r,s=$("#vvImagePanel").height(),l=$("#vvImagePanel").width(),u=$("#vvAnnPopUp").height(),c=$("#vvAnnPopUp").width(),g=15;
e&&e.x&&e.y?(o=e.x,r=e.y):(o=0,r=0),t=t||virtualViewer.getCurrentAnnObject(),a=a||d.getActivePaneState();var v=!1,p=Y.localPosToGlobalPos(new n(t.getAdjustedLeft(),t.getAdjustedTop()),t.page,a),h=p.x+t.getAdjustedWidth();o?o<p.x+t.getAdjustedWidth()/2&&(v=!0):t.getType()!==i.annotationTypes.SANN_EDIT&&t.getType()!==i.annotationTypes.SANN_POSTIT||(v=!0),o=!v&&l-h>c?h+g:p.x-c-g,r||(r=p.y),o+$("#vvAnnPopUp").width()>l&&(o=l-$("#vvAnnPopUp").width()),o<0&&(o=0),r+u>s&&(r=s-u),r<0&&(r=0);var m=s-r-$("#vvAnnPopUp .btn-group-wrap").height()-15;$("#vvAnnPopUpForm").css("max-height",m+"px"),$("#vvAnnPopUp").css("top",r),$("#vvAnnPopUp").css("left",o)};v.prototype.annPopUpHandler=function(e,o,r){if(r=r||d.getActivePaneState(),d.isVideoOpen())return!1;if(s.readOnlyAnnotationMode)return!1;var l,c=0,g=0;if(e){Modernizr.touchevents&&(e=Y.fixTouchEvent(e)),e.preventDefault(),e.stopPropagation(),c=e.clientX,g=e.clientY;var v=Y.clickPointConverter(e);l=u.getAnnotationAtPoint(v,r)}if(o&&(l=o),u.checkLayerPermission(u.getCurrentLayer(),i.permissionLevels.PERM_EDIT)===!1)return void alert(t.getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer."));var p=Y.dragging;return!l||p?(virtualViewer.hideAnnPopUp(),void virtualViewer.delayedPaintCanvases(r)):(C.setCurrentAnnObject(l),void(l.collapsed||($("#vvAnnPopUpForm").removeClass(),$("#vvAnnotationNotesArea").collapse("hide"),$("#vvAnnotationRevisionHistory").collapse("hide"),a.shrinkColorPicker($("#vvAnnLineColorChoices")),a.shrinkColorPicker($("#vvAnnFillColorChoices")),a.shrinkColorPicker($("#vvAnnTextColorChoices")),$("#vvAnnPopUp").show(),Zt(l),Xt(new n(c,g),l,r),$("#jqContextMenu").hide(),$("#jqContextMenuShadow").hide(),virtualViewer.delayedPaintCanvases())))};var Zt=function(e){var n,o=u.getLayerWithAnn(e)||u.getCurrentLayer();t.isRedactionLayer(o)||e.getType()===i.annotationTypes.SANN_BITMAP||$("#vvAnnPopUpForm").addClass("vvAnnHasColor"),$("#vvAnnPopUpEditTextSaveBtn").hide(),$("#vvAnnPopUpEditTextCancelBtn").hide();var r=e.getLineWidth(!0);$("#vvAnnPopUp .vvAnnThicknessCell").attr("aria-pressed","false"),$("#vvAnnThicknessCell-"+r).attr("aria-pressed","true"),$("#vvAnnLineSizeValue").html(r);var l=$("#vvAnnPopUpEditTextArea");if(l.blur(),e.getFontColor()?($("#vvAnnPopUpForm").addClass("vvAnnHasText"),$("#vvAnnTextSizeLabel").height()>$("#vvAnnTextFaceLabel").height()?$("#vvAnnTextFaceLabel").height($("#vvAnnTextSizeLabel").height()):$("#vvAnnTextSizeLabel").height($("#vvAnnTextFaceLabel").height()),e.getType()===i.annotationTypes.SANN_POSTIT&&($("#vvAnnPopUpForm").addClass("vvAnnHasFill"),n=e.getFillColorRGB(),a.setColorPickerColor($("#vvAnnFillColorChoices"),n),l.css("color","#"+n)),n=e.getFontColor()):e.getFillColor()?($("#vvAnnPopUpForm").addClass("vvAnnHasFill"),n=e.getFillColorRGB(),a.setColorPickerColor($("#vvAnnFillColorChoices"),n)):e.getLineColor()&&($("#vvAnnPopUpForm").addClass("vvAnnHasLine"),n=e.getLineColorRGB(),a.setColorPickerColor($("#vvAnnLineColorChoices"),n)),e.getTextString()&&(l.val(e.getTextString()),a.setColorPickerColor($("#vvAnnTextColorChoices"),n)),n&&l.css("color","#"+n),s.enableAnnotationCommenting&&($("#vvAnnPopUpForm").addClass("vvAnnHasNotes"),$("#vvAnnotationNotesInternal").children().remove(),e.noteArray&&e.loadAnnotationNotes()),$("#vvAnnTagChosen").empty(),s.annotationTags.length>0&&$("#vvAnnPopUpForm").addClass("vvAnnTags"),$("#vvAnnTagList .vvTagOption").removeClass("disabled"),e.annotationTags.length>0){$("#vvAnnPopUpForm").addClass("vvAnnTags");for(var d=0;d<e.annotationTags.length;d++){var c=qt(e.annotationTags[d]);$("#vvAnnTagChosen").append(c),jt(e.annotationTags[d])}}if(e.getFontName()&&($("#vvAnnTextFaceSelect").val(t.toTitleCase(e.getFontName())),l.css("font-family",e.getFontName())),e.getFontSize()){var g=1,v=virtualViewer.getActivePaneState();e.docDPI>i.minimumAnnotationDPI&&v.getDPIForPage(e.page)&&v.getDPIForPage(e.page)<10&&(g=e.pageWidth/v.getOriginalWidthForPage(e.page)||1,90!==e.rotateAngle&&270!==e.rotateAngle||(g=e.pageHeight/v.getOriginalWidthForPage(e.page)||1));var p=t.findClosestFontSize(e.getFontSize()/g);$("#vvAnnTextSizeSelect").val(p),l.css("font-size",p+"px")}e.getFontBold()===!0?($("#vvAnnTextStyleBold").prop("checked",!0),l.css("font-weight","bold")):($("#vvAnnTextStyleBold").prop("checked",!1),l.css("font-weight","normal")),e.getFontItalic()===!0?($("#vvAnnTextStyleItalic").prop("checked",!0),l.css("font-style","italic")):($("#vvAnnTextStyleItalic").prop("checked",!1),l.css("font-style","normal")),e.getFontUnderline()===!0?($("#vvAnnTextStyleUnderline").prop("checked",!0),l.css("text-decoration","underline")):($("#vvAnnTextStyleUnderline").prop("checked",!1),l.css("text-decoration","none")),e.getType()===i.annotationTypes.SANN_BITMAP&&$("#vvAnnPopUpForm").removeClass("vvAnnHasLine vvAnnHasFill vvAnnHasText vvAnnHasColor"),e&&e.loadAnnotationInformation()};v.prototype.hideAnnPopUp=function(){var e=this.getCurrentAnnObject();e&&(e.editing=!1),$("#vvAnnPopUp").hide()};var Kt=function(e){var t=$(e.target);"LI"===e.target.tagName&&(t=t.find(".singleDocTab"));var a=t.text();"*"===a[0]&&(a=a.substring(1,a.length)),""===a[a.length-1]&&(a=a.substring(0,a.length-1));for(var n=0;n<virtualViewer.newRecentlyViewedList.length;n++)if(virtualViewer.newRecentlyViewedList[n].displayName.startsWith(a)){a=virtualViewer.newRecentlyViewedList[n].documentId;break}var o=virtualViewer.getStateForDocumentId(a);if(o&&(!C.checkPageManipulationsEnabled(!1,o)||!C.checkPageManipulationsEnabled(!1)||o.isMedia()))return void ea();var i=JSON.parse(e.originalEvent.dataTransfer.getData("text"));$a(i),o&&i&&(virtualViewer.switchToTab(o),virtualViewer.pasteClip(i,o,0)),e.preventDefault()},Jt=function(e){e.preventDefault();for(var t=$("#vvImageTabs").children(),a=0;a<t.length;a++)$(t[a].children[0]).removeClass("dragOverTab");$(e.target).addClass("dragOverTab")},ea=function(e){$(".vvThumbDivider").remove(),$("#vvImageTabs .dragOverTab").removeClass("dragOverTab")};v.prototype.cleanupDrag=ea,$.event.special.vvDeletePages={_default:function(e){C.cutSelection(!0)}},$.event.special.vvCutPages={_default:function(e){C.cutSelection(!1)}},$.event.special.vvCopyPages={_default:function(e){C.copySelection()}},$.event.special.vvPastePages={_default:function(e,t){C.pasteSelection(t)}};var ta=function(t){t||(t=window.event),N&&clearTimeout(N),N=setTimeout(e("vvThumbs").loadVisibleThumbs,200)};v.prototype.processWindowResize=function(e){e||(e=window.event),aa(!0);var t=d.getActivePaneState(),a=null;t&&(a=t.getZoomMode()),X.call("onWindowResize",{defaultZoomMode:s.defaultZoomMode,currentZoomMode:a})};var aa=function(t){for(var a=d.getActivePaneState(),n=$(".vvOuter"),o=0;o<n.length;o++){var i=$(n[o]).find(".vvCanvas");i[0].width=et($(n[o])),i[0].height=tt($(n[o])),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(i.children().width(outerDiv.width()),i.children().height(outerDiv.width()))}e("vvThumbs").loadVisibleThumbs(),ze(),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),a&&(virtualViewer.sizeScroller({state:a}),t&&virtualViewer.determineEffectiveZoom(),virtualViewer.delayedPaintCanvases()),a&&a.isVideo()&&a.getMediaManager().resizeVideo(),a&&a.isAudio()&&a.getMediaManager().resizeAudio(),G.adjustForWindowResize(),na(),null===x&&(x=C.getScrollbarWidth())},na=function(){var e=$("#virtualViewerMain"),t=e.width(),a=e.height();if(!(Math.abs(me.width-t)<3&&Math.abs(me.height-a)<3)){me.width=t,me.height=a;var n=l(virtualViewer),o=30*(Object.keys(n.imageToolbarButtons).length+2);o+=30*Object.keys(n.toolbarButtonLogicalGroups).length,n.imageToolbarButtons.vvJumpToPage&&(o+=120);var i=30*Object.keys(n.annotationToolbarButtons).length;i+=30*Object.keys(n.toolbarButtonLogicalGroups).length,i+=30;var r=481,u=$("#vvToolbar"),d=$("#vvAnnToolbar");if(t<r&&!s.disableToolbarHamburger){if(u.hasClass("vvHamburgerSize"))return;return u.removeClass("vvLargeSize vvMediumSize"),u.addClass("vvHamburgerSize"),d.removeClass("vvLargeSize vvMediumSize"),void $("#vvImageAndThumbs").css("left","15px")}u.removeClass("vvHamburgerSize"),a<i&&!d.hasClass("vvMediumSize")?(d.removeClass("vvLargeSize").addClass("vvMediumSize").width(32),u.addClass("vvPushOverForAnnToolbar"),$("#vvImageAndThumbs").css("left","44px")):a>=i&&!d.hasClass("vvLargeSize")&&(d.addClass("vvLargeSize").removeClass("vvMediumSize").width(28),u.removeClass("vvPushOverForAnnToolbar"),$("#vvImageAndThumbs").css("left","28px")),t<o&&!u.hasClass("vvMediumSize")?u.removeClass("vvLargeSize").addClass("vvMediumSize"):t>=o&&!u.hasClass("vvLargeSize")&&u.addClass("vvLargeSize").removeClass("vvMediumSize"),Te()}};v.prototype.getUserPreferences=function(){return j},v.prototype.getDocumentNotes=function(){return q},v.prototype.getDocumentId=function(e){return d.getOpenDocumentId(e)},v.prototype.getCurrentState=function(e){return d.getCurrentState(e)},v.prototype.setDocumentId=function(e){d.displayedDocuments[0]=e},v.prototype.setUsername=function(e){var t=virtualViewer.getUserPreferences();t.saveUsername(e)},v.prototype.getUsername=function(){return virtualViewer.getUserPreferences().getUsername()},v.prototype.setDisplayName=function(t,a){if(t=t||"",a=a||d.getOpenDocumentId(),!a)return null;var n=d.getStateForDocumentId(a);if(this.removeFromRecentlyViewed({documentId:a}),this.addToRecentlyViewed({documentId:a,displayName:t}),e("vvThumbs").updateDocumentDisplayName(a,t),n)return n.setDisplayName(t),virtualViewer.updateTabName(n),n.getDisplayName();var o=this.indexInDocumentList(a);return o===-1?null:(this.documentList[o].displayName=t,t)},v.prototype.getDisplayName=function(){return tn({state:!0})?d.getActivePaneState().getDisplayName():null},v.prototype.getStateForDocumentId=function(e,t){return d.getStateForDocumentId(e,t)},v.prototype.getDocumentIdForPage=function(e,t){return oa(e,t)};var oa=function(e,t){var a=t.getDocumentId(),n=t.getDocumentModel();return t.getDocumentId()?(n&&(a=decodeURIComponent(n.model.pageData[e].documentId)),a):null};v.prototype.getPageIndexForPage=function(e,t){return ia(e,t)};var ia=function(e,t){var a=e;t=t||virtualViewer.getActivePaneState();var n=virtualViewer.getDocumentModel(t);return t?(n&&(a=n.model.pageData[e].pageIndex),a):null};v.prototype.exportDocumentDialog=function(t){tn({state:!0,notVideo:!0,notPageLimited:!0})&&e("vvDialogs").exportDialog(t)},v.prototype.showCropDialog=function(e){if($("#vvConfirmCropDialog").modal("toggle"),null!==e&&void 0!==e||(e=d.getActivePaneState()),e.isVirtualDocument()){var a=$("#vvConfirmCropDialogText").text();$("#vvConfirmCropDialogText").text(a+" "+t.getLocalizedValue("errors.virtualDocumentSaving","You can't save to original on Virtual Documents. Use Export or Save As."))}},v.prototype.cropPageClient=function(e,t,a,n,o){var i=d.getActivePaneState();if(!tn({state:!0,documentModel:!0,notVideo:!0}))return!1;if("number"==typeof e&&X.call("cropDocumentBegin",{documentId:i.getDocumentId(),page:i.pageNumber}),!s.enableCrop&&void 0!==s.enableCrop)return X.call("cropDocumentError",{documentId:i.getDocumentId(),page:i.pageNumber,exceptionMessage:"Crop was disabled."}),!1;if(i.isPageCropped(o)&&i.removeCropOnPage(o),"number"!=typeof e||"number"!=typeof a||"number"!=typeof n||"number"!=typeof t){if(null===Y.dragStartTop||null===Y.dragStopTop||null===Y.dragStartLeft||null===Y.dragStopLeft)return X.call("cropDocumentError",{documentId:i.getDocumentId(),page:i.pageNumber,exceptionMessage:"Insufficient position data was available and the page could not be cropped."}),!1;e=Y.dragStartTop,t=Y.dragStartLeft,a=Y.dragStopTop,n=Y.dragStopLeft,o=i.pageNumber}var r=Math.abs(e-a),l=Math.abs(t-n);e>a&&(e=a),t>n&&(t=n);var u=1/i.getZoomDecimal();i.deleteAllAnnsOnPage(o),s.showAnnIndicators&&C.pageHasIndicator(o)&&C.removeAnnotationIndicators(o),i.resetSVGSupport(!1),null!==o&&void 0!==o||(o=i.pageNumber);var c=i.getPageCropBox(o);return i.isPageCropped(o)?(c.cropTop+=Math.floor(e*u),c.cropLeft+=Math.floor(t*u),c.cropWidth=Math.floor(l*u),c.cropHeight=Math.floor(r*u)):(c={},c.cropTop=Math.floor(e*u),c.cropLeft=Math.floor(t*u),c.cropWidth=Math.floor(l*u),c.cropHeight=Math.floor(r*u)),i.setPageCropBox(o,c),Y.clean(),i.setIsSearchable(!1),virtualViewer.delayedPaintCanvases(),i.documentModel.setPagesModifiedSinceInit(!0,o),d.getCurrentDiff()&&(d.getCurrentDiff().diffDisabledUntilSave=!0,qa()),X.call("cropDocument",{documentId:i.getDocumentId(),page:i.pageNumber}),!0},v.prototype.cropPageHandler=function(e){return e},v.prototype.cropPageButton=function(){if(tn({state:!0,documentModel:!0,notVideo:!0}))if(s.enableCrop)t.cursorAnnotate(),E=i.annotationTypes.SANN_RECTANGLE,C.currentPointArray=[],virtualViewer.setDragMode(i.dragModes.crop);else{var e={client:!0,disable:virtualViewer.disableErrorModals.adminDisabled};vt(t.getLocalizedValue("errors.cropDisabled","Crop has been disabled by the administrator."),e)}},v.prototype.removeCropOnPage=function(e){if(tn({state:!0,documentModel:!0,notVideo:!0})){var t=d.getActivePaneState();t.removeCropOnPage(e),virtualViewer.delayedPaintCanvases()}},v.prototype.removeAllCrop=function(){if(tn({state:!0,documentModel:!0,notVideo:!0}))for(var e=d.getActivePaneState(),t=0;t<e.pageCount;t++)virtualViewer.removeCropOnPage(t)},v.prototype.uploadDocument=function(e){var a=$("#vvUploadLocalFileForm");if(!C.isUploadDocumentEnabled()){a[0].reset(),$("#vvUploadLocalFilesDialog").modal("hide");var n={client:!0,disable:virtualViewer.disableErrorModals.adminDisabled};return void vt(t.getLocalizedValue("errors.uploadDisabled","Upload document has been disabled by the administrator."),n)}if(a.find("input[type=file]").val()){var o=$("#vvUploadLocalFileForm .upload-file-info").text();X.call("uploadDocumentBegin",{filename:o,clientInstanceId:C.getClientInstanceId()});var i=new FormData(a[0]);i.append("action","uploadDocument"),i.append("clientInstanceId",C.getClientInstanceId()),i.append("filename",encodeURI(o)),$("#vvUploadLocalFilesDialog .btn").attr("disabled",!0),$.ajax({url:s.servletPath,type:"POST",cache:!1,contentType:!1,processData:!1,data:i,dataType:"json",success:function(e){return $("#vvUploadLocalFilesDialog .btn").attr("disabled",!1),gt(e)===!0?void X.call("uploadDocumentError",{filename:o,clientInstanceId:C.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText}):(X.call("uploadDocument",{uploadedDocumentId:decodeURIComponent(e.documentIdToReload),clientInstanceId:C.getClientInstanceId()}),a[0].reset(),void $("#vvUploadLocalFilesDialog").modal("hide"))},error:function(e){if(X.call("uploadDocumentError",{filename:o,clientInstanceId:C.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText}),a[0].reset(),!virtualViewer.handle500Status(e)){var n=t.getLocalizedValue("errors.uploadFailure","Could not upload document."),i={client:!0,disable:virtualViewer.disableErrorModals.adminDisabled};vt(n,i)}$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1)}})}};var ra=function(e,t){return e.includeRedactionTags!==!1&&(e.includeRedactionTags=!0),"current"===e.pageRangeType&&"number"!=typeof e.pageRangeValue&&(e.pageRangeValue=t.getPageNumber()),e.newDocumentId||("undefined"==typeof e.copyAnnotations&&(e.copyAnnotations=!0),"undefined"==typeof e.copyWatermarks&&(e.copyWatermarks=!0)),e};v.prototype.saveDocument=function(a,n){var o,i;if(n=n||{},i=n.documentPaneIndex,a){if(!d.getStateForDocumentId(a,i))return;o=d.getStateForDocumentId(a,i)}else o=d.getActivePaneState(),a=o.getDocumentId();if(tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0},o)){if(n=ra(n,o),s.enableSaveOverwriteWarning!==!1&&!n.skipOverwriteDialog&&!n.newDocumentId&&this.willSavingOverwriteCurrentFormat(o))return void $("#vvOverwriteDialog").modal("show");n.newDocumentId?X.call("saveAsDocumentBegin",{documentId:o.getDocumentId(),newDocumentId:n.newDocumentId,clientInstanceId:C.getClientInstanceId()}):X.call("saveDocumentBegin",{documentId:o.getDocumentId(),clientInstanceId:C.getClientInstanceId()}),C.displaySaveIndicator(!0),i=o.currentPaneIndex,n.newDocumentId||n.saveAsFormat||o.resetDocFormat();var r=o.getDocumentModel();e("vvWatermarks").saveWatermarks(o),Q.saveBookmarks(),o.getImageManager().cleanBuffers(),this.updateAnnotationForNewDimensions(),o.clearNewAnnList(),o.clearNewWMList();var l=[];if(n.newDocumentId||r.getModifiedSinceInit()){if(o.isDocumentCropped())for(var u=0;u<o.pageCount;u++)o.isPageCropped(u)&&l.push(u);var c=new URI(s.servletPath);c.addQuery("action","saveDocumentModel"),c.addQuery("clientInstanceId",C.getClientInstanceId()),c.addQuery("cacheBuster",Math.random()),c.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),c.addQuery("includeRedactions",n.burnRedactions),c.addQuery("includeTextAnnotations",n.includeTextAnnotations),c.addQuery("includeNonTextAnnotations",n.includeNonTextAnnotations);var g=r.model;if(n.newDocumentId){g=t.deepObjCopy(r.model),g.documentId=encodeURIComponent(n.newDocumentId),n.newDisplayName?g.displayName=encodeURIComponent(n.newDisplayName):g.displayName=encodeURIComponent(n.newDocumentId);var v=n.createNew;v&&delete g.documentNotes,c.addQuery("pageRangeType",n.pageRangeType),c.addQuery("pageRangeValue",n.pageRangeValue),c.addQuery("copyAnnotations",n.copyAnnotations),c.addQuery("copyWatermarks",n.copyWatermarks),c.addQuery("format",n.saveAsFormat),c.addQuery("documentId",encodeURIComponent(n.newDocumentId)),c.addQuery("oldDocumentId",encodeURIComponent(a))}else g.bookmarks&&0===Q.bookmarkArray.length&&delete g.bookmarks,c.addQuery("copyAnnotations",n.copyAnnotations),c.addQuery("copyWatermarks",n.copyWatermarks),c.addQuery("documentId",a);c.addQuery("includeRedactionTags",n.includeRedactionTags),c.addQuery("includeWatermarks",n.includeWatermarks),c.addQuery("modelJSON",JSON.stringify(g));var p=o.getAnnotationLayers(!0,!0,n.newDocumentId,n.burnRedactions,n.includeTextAnnotations,n.includeNonTextAnnotations,"PDF"===n.saveAsFormat);c.addQuery("annotations",JSON.stringify(p)),null!==C.getOverlayPath()&&c.addQuery("overlayPath",C.getOverlayPath());var h=c.query();c.query(""),$.ajax({url:c.toString(),type:"POST",dataType:"json",data:h,async:!1,success:function(e){var t=null,o=null;if(Ct(),gt(e)===!0){C.displaySaveIndicator(!1);var u={documentId:a,saveAsDocumentId:n.newDocumentId,exceptionMessage:e.exceptionMessage,statusText:e.statusText};return void(n.newDocumentId?X.call("saveAsDocumentError",u):X.call("saveDocumentError",u))}if(e.documentIdToReload&&(o=decodeURIComponent(e.documentIdToReload)),n.newDocumentId){if(n.useCut){var c=C.getStateForDocumentId(a);C.deleteSelection({pageNums:n.pageNums},c)}return X.call("saveAsDocument",{oldDocumentId:a,newDocumentId:o,clientInstanceId:C.getClientInstanceId()}),void C.displaySaveIndicator(!1)}if(X.call("saveDocument",{documentId:a,clientInstanceId:C.getClientInstanceId(),documentIdToReload:o}),X.call("saveAnnotations",{documentId:a,clientInstanceId:C.getClientInstanceId(),documentIdToReload:o}),s.reloadDocumentOnSave===!0){var g=o,v=a;g&&"undefined"!==g||(g=v),t=d.getStateForDocumentId(v,i),t.documentId=g;var p=t.getDisplayName();p||(p=v),t.setDisplayName(p),d.removeStateForDocumentId(v,i),d.setStateForDocumentId(g,t,i),d.displayedDocuments[i]!==v&&d.displayedDocuments[i]||d.setDisplayedState(t,i);var h={documentId:v,displayName:t.getDisplayName()},m=C.getStateForDocumentId(g),f={documentId:g,displayName:m.getDisplayName()};C.removeFromRecentlyViewed(h),C.addToRecentlyViewed(f);for(var y=0;y<C.tabs.length;y+=1)if(C.tabs[y]===v){C.tabs[y]=g;break}t.getDocumentModel().cleanAfterSave(g),C.requestDocumentList(),t.clearAllLayers();var b=function(e){sa(e,l)};t.closedTab||C.reloadDocumentModel(g,i,b),C.displaySaveIndicator(!1)}else t=d.getStateForDocumentId(a,i),r.cleanAfterSave(a,t),sa(t,l)},error:function(e){console.log("saveDocument: "+e.statusText),C.displaySaveIndicator(!1);var o={client:!1,disable:C.disableErrorModals.server},r=t.getLocalizedValue("errors.saveDocumentRequestFailed","Unable to contact server to save document.");vt(r,o),gt(e,a,i);var s={documentId:a,saveAsDocumentId:n.newDocumentId,exceptionMessage:e.exceptionMessage,statusText:e.statusText};n.newDocumentId?X.call("saveAsDocumentError",s):X.call("saveDocumentError",s)}})}else o=d.getActivePaneState(),o.saveAnnotationLayers(),C.updateTabName(o)}};var sa=function(e,t){if(C.displaySaveIndicator(!1),!e.closedTab){if(e.resetAfterSave(),Ht(e),G.getMagnifiedImage(e,e.pageNumber),t.length>0)for(var a=0;a<t.length;a++)e.removePageText(t[a]);if(c.rerunCurrentSearch(),C.updateTabName(e),d.getCurrentDiff()){var n=1-e.currentPaneIndex;d.getCurrentState(n).getDocumentModel().getPagesModifiedSinceInit()||(d.getCurrentDiff().diffDisabledUntilSave=!1,C.performDiff())}}};v.prototype.saveAllDocuments=function(){for(var e=0;e<C.tabs.length;e++)this.saveDocument(C.tabs[e])},v.prototype.updateAnnotationForNewDimensions=function(){for(var e=this.getActivePaneState(),t=0;t<e.pageCount;t++)for(var a=e.pageStates[t],n=a.annotationLayers||{},o=e.layerNames,i=0;i<o.length;i++){var r=n[o[i]];if(r)for(var s=r.pageHeight,l=r.pageWidth,u=0;u<r.anns.length;u++){var d=r.anns[u],c=d.pageHeight,g=d.pageWidth,v=d.getRotationAngle();if(90!=v&&270!=v||(c=d.pageWidth,g=d.pageHeight),s!=c||l!=g){var p=(s/c).toFixed(2),h=(l/g).toFixed(2);if(p!=h)continue;var m=s/c;d.scaleAnn(m),d.setPageHeight(s),d.setPageWidth(l)}}}},v.prototype.rotateClock=function(){C.rotateImageBy(90)},v.prototype.rotateCounter=function(){C.rotateImageBy(-90)},v.prototype.rotateImageBy=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getPageNumber();C.rotatePageBy(a,e)}},v.prototype.rotateAllPagesBy=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){for(var a=0;a<t.getPageCount();a+=1)C.rotatePageBy(a,e);virtualViewer.setPage(0),C.updateTabName(t)}},v.prototype.rotateSelectedPagesBy=function(e,t){var a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},a)){if(!la(t))throw"Invalid degree entry";for(var n=0;n<e.length;n+=1){if(!ua(e[n],a))throw"Invalid page entry";C.rotatePageBy(e[n],t)}C.updateTabName(a)}},v.prototype.rotateImageTo=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getPageNumber(),n=t.getRotationForPage(a);if(X.call("rotationBegin",{documentId:t.getDocumentId(),rotationAngle:n,page:a}),!la(e))return void X.call("rotationError",{documentId:t.getDocumentId(),rotationAngle:currentAngle,page:a,exceptionMessage:"The requested angle was invalid."});e===-90?e=270:e===-180?e=180:e===-270&&(e=90),t.setRotationForPage(a,0),t.setRotationForPage(a,e),virtualViewer.determineEffectiveZoom(a,t),Ta(),Mt(a,e);var o=(n-e)%360;X.call("rotation",{documentId:t.documentId,page:a,degrees:e,rotatedTo:e,rotatedBy:o})}},v.prototype.rotatePageTo=function(e,t){var a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},a)){var n=a.getRotationForPage(e);if(X.call("rotationBegin",{documentId:a.getDocumentId(),rotationAngle:n,page:e}),!la(t))throw X.call("rotationError",{documentId:a.getDocumentId(),rotationAngle:n,page:e,exceptionMessage:"The requested angle was invalid."}),"Invalid degree entry";if(!ua(e,a))throw X.call("rotationError",{documentId:a.getDocumentId(),rotationAngle:n,page:e,exceptionMessage:"The requested page was invalid."}),"Invalid page entry";t===-90?t=270:t===-180?t=180:t===-270&&(t=90),a.setRotationForPage(e,0),a.setRotationForPage(e,t),C.updateTabName(a),Ta(),virtualViewer.determineEffectiveZoom(e,a),virtualViewer.sizeScroller({state:a}),Mt(e,t);var o=(n-t)%360;return X.call("rotation",{page:e,degrees:t,rotatedTo:t,rotatedBy:o}),C.delayedPaintCanvases(a),!0}},v.prototype.rotatePageBy=function(e,t){var a=d.getActivePaneState();if(!tn({state:!0,documentModel:!0,notVideo:!0},a))return!1;var n=a.getRotationForPage(e);if(X.call("rotationBegin",{documentId:a.getDocumentId(),rotationAngle:n,page:e}),!la(t))throw X.call("rotationError",{documentId:a.getDocumentId(),rotationAngle:n,page:e,exceptionMessage:"The requested rotation amount was invalid."}),"Invalid degree entry";if(!ua(e,a))throw X.call("rotationError",{documentId:a.getDocumentId(),rotationAngle:n,page:e,exceptionMessage:"The requested page was invalid."}),"Invalid page entry";var o=n;return o+=t,o<0&&(o+=360),o>=360&&(o-=360),a.setRotationForPage(e,o),C.updateTabName(a),Ta(),virtualViewer.determineEffectiveZoom(e,a),Mt(e,t),virtualViewer.sizeScroller({state:a}),X.call("rotation",{documentId:a.documentId,page:e,degrees:t,rotatedTo:o,rotatedBy:t}),s.rotateTextAnnotations||u.staleAnnTextWrapping(a,e),C.delayedPaintCanvases(a),!0};var la=function(e){return 0===Math.abs(e)||90===Math.abs(e)||180===Math.abs(e)||270===Math.abs(e)},ua=function(e,t){var a=t.getPageCount();return"number"==typeof e&&(e===parseInt(e,10)&&(!(e<0)&&!(e>=a)))},da=function(e){e=e||d.getActivePaneState();var t=e.getPageNumber(),a=C.getOuterDivFromState(e),n=a.scrollTop()-virtualViewer.findPagePosition(t,e);n/=virtualViewer.getScrollSpeed(e);var o=a.find(".vvScroller").width()-a.width();o<0&&(o=0);var i=(a.find(".vvCanvas").width()+o)/2,r=i-e.getRequestedWidthForPage(t)/2,s=a.scrollLeft(),l=s+r;return{zoom:e.getZoom(),page:t,yPositionOnPage:n,pageLeftPosition:l,centered:r>=0||Math.floor(o/2)===s}},ca=function(e,t){t=t||d.getActivePaneState();var a=d.getOuterDivFromState(t),n=virtualViewer.findPagePosition(e.page,t);if(n+=e.yPositionOnPage*virtualViewer.getScrollSpeed(t),a.scrollTop(n),e.pageLeftPosition<=0||e.centered)Wt(t);else{var o=e.pageLeftPosition*t.getZoom()/e.zoom,i=Math.max(a.find(".vvScroller").width()-a.width(),0),r=(a.find(".vvCanvas").width()+i)/2,s=r-t.getRequestedWidthForPage(e.page)/2;a.scrollLeft(s+o)}};v.prototype.getNextZoomLevelDown=function(e){return m(e)},v.prototype.zoomIn=function(e){var t=d.getActivePaneState(),a=d.getInactivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){var n=t.getZoom();return e||(e=n,e=h(e)),X.call("zoomDocumentBegin",{documentId:t.getDocumentId(),currentZoom:n,newZoom:e}),e>(s.maxZoomPercent||500)?(e=s.maxZoomPercent||500,void X.call("zoomDocumentError",{documentId:t.getDocumentId(),currentZoom:t.getZoom(),newZoom:e,exceptionMessage:"The new zoom is higher than the maximum allowed zoom level. See the setting maxZoomPercent in config.js."})):(ga(t,e),this.zoomLocked&&ae&&ga(a,e),t.getZoom())}},v.prototype.zoomOut=function(e){var t=d.getActivePaneState(),a=d.getInactivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){var n=t.getZoom();return e||(e=n,e=m(e)),X.call("zoomDocumentBegin",{documentId:t.getDocumentId(),currentZoom:n,newZoom:e}),e===n?void X.call("zoomDocumentError",{documentId:t.getDocumentId(),currentZoom:t.getZoom(),newZoom:e,exceptionMessage:"The document is already zoomed out as far as possible. See the setting zoomLevels in config.js."}):(ga(t,e),this.zoomLocked&&ae&&ga(a,e),t.getZoom())}};var ga=function(e,t,a){a=a||da(e),e=e||d.getActivePaneState(),t=t||e.getZoom();var n=C.getActiveOuterDiv();e.setZoomMode(i.zoomModes.fitCustom),e.setZoom(t);for(var o=0;o<e.pageCount;o++)virtualViewer.determineEffectiveZoom(o,e,n);Ta();var r=e.getImageManager();r.scaleDocumentByPercentage(e.getZoomDecimal()),virtualViewer.sizeScroller({state:e}),ca(a,e),virtualViewer.delayedPaintCanvases(),X.call("zoomDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()})};v.prototype.setZoomPercent=function(e){tn({state:!0,documentModel:!0,notVideo:!0})&&(this.setZoomPercentCore(e),virtualViewer.delayedPaintCanvases())},v.prototype.setZoomPercentCore=function(e,t){t=t||d.getActivePaneState();var a=e||s.zoomLevels[0];if(a&&tn({state:!0,notVideo:!0},t)){X.call("zoomDocumentBegin",{documentId:t.getDocumentId(),currentZoom:t.getZoom(),currentZoomMode:t.getZoomMode()}),a>(s.maxZoomPercent||500)?a=s.maxZoomPercent||500:a<s.zoomLevels[0]&&(a=s.zoomLevels[0]);var n=t.pageNumber;t.setZoomMode(i.zoomModes.fitCustom),t.setZoom(a),tn({documentModel:!0},t)&&(Pa(t),virtualViewer.setPageCore(n,t),virtualViewer.sizeScroller({state:t}),Wt(t),this.zoomLocked&&ae&&(t=d.getInactivePaneState(),t.setZoomMode(i.zoomModes.fitCustom),t.setZoom(a),Pa(t),virtualViewer.setPageCore(n,t),virtualViewer.sizeScroller({state:t}),Wt(t)))}},v.prototype.zoomToLocation=function(e,t,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)&&e&&(t||0===t)&&(a||0===a)){C.setZoomPercentCore(e,n);var o=virtualViewer.findPagePosition(n.pageNumber,n),i=C.getActiveOuterDiv();i.scrollLeft(t),i.scrollTop(o+a),C.delayedPaintCanvases()}},v.prototype.flipX=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)){var t=!e.getHorizontalFlipForPage();e.setHorizontalFlipForPage(null,t),C.delayedPaintCanvases()}},v.prototype.flipY=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)){var t=!e.getVerticalFlipForPage();e.setVerticalFlipForPage(null,t),C.delayedPaintCanvases()}},v.prototype.textSelectionAllowed=function(){var e=d.getActivePaneState(),t=e.getHorizontalFlipForPage()===!1&&e.getVerticalFlipForPage()===!1&&!e.isDocumentCropped();return t},v.prototype.getStampManager=function(){return Z},v.prototype.clearImageStamps=function(){Z.clearStampDropdown()},v.prototype.createImageStamp=function(e,a,n){if(!e||!a){var o={client:!1,disable:C.disableErrorModals.stamp||!1},i=t.getLocalizedValue("errors.stampCreationFailure","Unable to create ImageStamp, invalid URL or title.");vt(i,o)}var r=Z.createStampObject(e,a,n);null!==r&&Z.addStampsToDropdown(r)},v.prototype.createImageStampArray=function(e){var t=[];t=Z.processStampArray(e),Z.addStampsToDropdown(t)},v.prototype.createImageStampArrayFromFunction=function(e){virtualViewer.createImageStampArray(e())},v.prototype.invertImage=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)){var t=e.getPageNumber(),a=e.getInvertImageForPage(t);X.call("invertImageBegin",{documentId:e.getDocumentId(),page:t,currentImageInverted:a,invertImage:!a}),a=!a,a?Qe():e.setSVGEnabledForPage(t,!0),e.setInvertImageForPage(t,a),C.delayedPaintCanvases()}},v.prototype.despeckleImage=function(){var e=d.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0},e)&&(e.setDespeckleForPage(e.pageNumber),e.imageManager.throttledRequestImageBatch(e))},v.prototype.setAntiAliasOff=function(e){var t=virtualViewer.getStateForDocumentId(C.getDocumentId());t.setAntiAliasOffForPage(t.pageNumber,e),t.imageManager.throttledRequestImageBatch(t)},v.prototype.setBrightness=function(e){var a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},a)){if(isNaN(e))throw"Invalid input, value must be a number";t.isInteger(e)||(e=Math.round(e)),Qe(),a.setBrightnessForPage(a.getPageNumber(),e),C.delayedPaintCanvases()}},v.prototype.setBrightnessForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";if(t.isInteger(a)||(a=Math.round(a)),!ha(a))throw"Invalid brightness value, must be between -125 and 125";for(var o=0;o<e.length;o++)Qe(e[o]),n.setBrightnessForPage(e[o],a);Qe(),C.updateTabName(n),C.delayedPaintCanvases()}},v.prototype.adjustBrightnessForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a));for(var o=0;o<e.length;o++){var i=n.getBrightnessForPage(e[o]),r=a+i;r<-125&&(r=-125),r>125&&(r=125),Qe(e[o]),n.setBrightnessForPage(e[o],r)}C.updateTabName(n),C.delayedPaintCanvases()}},v.prototype.increaseBrightnessForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Qe(e[o]),va(n,e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}};var va=function(e,t,a){var n=e.getBrightnessForPage(t),o=n+a;o>125&&(o=125),e.setBrightnessForPage(t,o)};v.prototype.decreaseBrightnessForSelectedPages=function(e,a){
var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Qe(e[o]),pa(n,e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}};var pa=function(e,t,a){var n=e.getBrightnessForPage(t),o=n-a;o<-125&&(o=-125),e.setBrightnessForPage(t,o)},ha=function(e){return e>=-125&&e<=125};v.prototype.setContrast=function(e){var a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},a)){if(isNaN(e))throw"Invalid input, value must be a number";t.isInteger(e)||(e=Math.round(e)),Qe(),a.setContrastForPage(a.getPageNumber(),e),$("#vvContrastDisplay").html(e),C.delayedPaintCanvases()}},v.prototype.setContrastForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";if(t.isInteger(a)||(a=Math.round(a)),!ha(a))throw"Invalid contrast value, must be between -125 and 125";for(var o=0;o<e.length;o++)Qe(e[o]),n.setContrastForPage(e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}},v.prototype.adjustContrastForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a));for(var o=0;o<e.length;o++){var i=n.getContrastForPage(e[o]),r=a+i;r<-125&&(r=-125),r>125&&(r=125),Qe(e[o]),n.setContrastForPage(e[o],r)}C.updateTabName(n),C.delayedPaintCanvases()}},v.prototype.increaseContrastForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Qe(e[o]),ma(n,e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}};var ma=function(e,t,a){var n=e.getContrastForPage(t),o=n+a;o>125&&(o=125),e.setContrastForPage(t,o)};v.prototype.decreaseContrastForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Qe(e[o]),fa(n,e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}};var fa=function(e,t,a){var n=e.getContrastForPage(t),o=n-a;o<-125&&(o=-125),e.setContrastForPage(t,o)};v.prototype.setGamma=function(e){var a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},a)){if(isNaN(e))throw"Invalid input, value must be a number";t.isInteger(e)||(e=Math.round(e)),Qe(),a.setGammaForPage(a.getPageNumber(),e),$("#vvGammaDisplay").html(e),C.delayedPaintCanvases()}},v.prototype.setGammaForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";if(t.isInteger(a)||(a=Math.round(a)),a<0||a>400)throw"Invalid gamma value, must be between 0 and 400";for(var o=0;o<e.length;o++)Qe(e[o]),n.setGammaForPage(e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}},v.prototype.adjustGammaForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a));for(var o=0;o<e.length;o++){var i=n.getGammaForPage(e[o]),r=a+i;r<0&&(r=0),r>400&&(r=400),Qe(e[o]),n.setGammaForPage(e[o],r)}C.updateTabName(n),C.delayedPaintCanvases()}},v.prototype.increaseGammaForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Qe(e[o]),ya(n,e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}};var ya=function(e,t,a){var n=e.getGammaForPage(t),o=n+a;o>400&&(o=400),e.setGammaForPage(t,o)};v.prototype.decreaseGammaForSelectedPages=function(e,a){var n=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Qe(e[o]),ba(n,e[o],a);C.updateTabName(n),C.delayedPaintCanvases()}};var ba=function(e,t,a){var n=e.getGammaForPage(t),o=n-a;o<0&&(o=0),e.setGammaForPage(t,o)};v.prototype.getBrightness=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e))return e.getBrightnessForPage()},v.prototype.getBrightnessForPage=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t))return t.getBrightnessForPage(e)},v.prototype.getContrast=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e))return e.getContrastForPage()},v.prototype.getContrastForPage=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t))return t.getContrastForPage(e)},v.prototype.getGamma=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e))return e.getGammaForPage()},v.prototype.getGammaForPage=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t))return t.getGammaForPage(e)},v.prototype.zoomLoop=function(e){Pa(e)};var Pa=function(e){if(e=e||d.getActivePaneState(),e&&e.pageStates&&e.pageStates.length){var t=e.pageNumber;virtualViewer.determineEffectiveZoom(t,e);for(var a=0;a<e.getPageCount();a++)e.zoomPage(e.getZoomDecimal(),a);var n=e.getImageManager();n.scaleDocumentByPercentage(e.getZoomDecimal()),Ta(),Wt(e);var o=d.getOuterDivFromState(e);o.scrollTop(virtualViewer.findPagePosition(t,e)),virtualViewer.paintCanvases(e)}};v.prototype.fitWidth=function(){this.fitWidthCore()},v.prototype.fitWidthCore=function(e){if(e=e||d.getActivePaneState(),tn({state:!0,notVideo:!0},e)){if(X.call("fitDocumentBegin",{documentId:e.getDocumentId(),currentZoom:e.getZoom(),newFitMode:i.zoomModes.fitWidth}),e.setZoomMode(i.zoomModes.fitWidth),!e.pageStates)return void X.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()});Aa(e),ae&&this.zoomLocked&&Aa(d.getInactivePaneState())}},v.prototype.fitHeight=function(){this.fitHeightCore()},v.prototype.fitHeightCore=function(e){if(e=e||d.getActivePaneState(),tn({state:!0,notVideo:!0},e)){if(X.call("fitDocumentBegin",{documentId:e.getDocumentId(),currentZoom:e.getZoom(),newFitMode:i.zoomModes.fitHeight}),e.setZoomMode(i.zoomModes.fitHeight),!e.pageStates)return void X.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()});Aa(e),ae&&this.zoomLocked&&Aa(d.getInactivePaneState())}},v.prototype.fitWindow=function(){this.fitWindowCore()},v.prototype.fitWindowCore=function(e){if(e=e||d.getActivePaneState(),!e.isMedia()&&tn({state:!0,notVideo:!0},e)){if(X.call("fitDocumentBegin",{documentId:e.getDocumentId(),currentZoom:e.getZoom(),newFitMode:i.zoomModes.fitWindow}),e.setZoomMode(i.zoomModes.fitWindow),!e.pageStates)return void X.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()});Aa(e),ae&&this.zoomLocked&&Aa(d.getInactivePaneState())}};var Aa=function(e){e=e||d.getActivePaneState();var t=e.pageNumber;Pa(e),virtualViewer.setPageCore(t,e),virtualViewer.sizeScroller({state:e});var a=d.getOuterDivFromState(e);a.scrollTop(virtualViewer.findPagePosition(t,e)),Wt(e),X.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()})};v.prototype.getPageCount=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e))return e.pageCount},v.prototype.firstPage=function(){var e=d.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0},e)&&"true"!==$(".vvGoToFirstPage").attr("aria-disabled")&&0!==e.getPageNumber()&&C.setPage(0)},v.prototype.nextPage=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)&&!("true"===$(".vvGoToNextPage").attr("aria-disabled")||e.getPageNumber()+1>=e.getPageCount())){var t=e.getPageNumber();C.setPage(t+1)}},v.prototype.previousPage=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)&&"true"!==$(".vvGoToPreviousPage").attr("aria-disabled")&&0!==e.getPageNumber()){var t=e.getPageNumber();C.setPage(t-1)}},v.prototype.lastPage=function(){var e=d.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0},e)&&("true"===$(".vvGoToLastPage").attr("aria-disabled")||e.getPageNumber()+1>=e.getPageCount()||C.setPage(e.getPageCount()-1))},v.prototype.panUp=function(){var e=document.getElementById("vvOuterDiv");e.scrollTop-=fe},v.prototype.panDown=function(){var e=document.getElementById("vvOuterDiv");e.scrollTop+=fe},v.prototype.panLeft=function(){var e=document.getElementById("vvOuterDiv");e.scrollLeft-=fe},v.prototype.panRight=function(){var e=document.getElementById("vvOuterDiv");e.scrollLeft+=fe},v.prototype.thumbPageDown=function(){vvPageThumbs.scrollTop+=$("#vvPageThumbs").height()},v.prototype.thumbPageUp=function(){vvPageThumbs.scrollTop-=$("#vvPageThumbs").height()},v.prototype.updatePage=function(t,a){if(a=a||d.getActivePaneState(),!a||!a.pageStates||a.pageStates.length<1)return!1;if(t!==a.pageNumber&&X.call("pageChangeBegin",{documentId:a.getDocumentId(),currentPage:a.pageNumber,newPage:t}),!Ca(t))return t!==a.pageNumber&&X.call("pageChangeError",{documentId:a.getDocumentId(),currentPage:a.pageNumber,newPage:t,exceptionMessage:"The new page was invalid."}),!1;virtualViewer.deselectAllText(a),Ta(),s.collapseStickiesByDefault&&C.collapseAllStickyNotes(!0);var n=a.pageNumber;a.setPageNumber(t),Ht(),Da(a);var o=e("vvThumbs");return 0===C.getActivePane()&&(o.highlightActiveThumbnail(a),o.ensurePageThumbIsVisible(a),o.ensureSearchThumbIsVisible(a)),Ta(),t!==n&&X.call("pageChange",{documentId:a.getDocumentId(),page:t}),!0};var Ta=function(){virtualViewer.hideAnnPopUp(),virtualViewer.setPreviousAnnObject(C.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null)};v.prototype.setPage=function(e){return C.setPageCore(e)},v.prototype.setPageCore=function(t,a){if(a=a||d.getActivePaneState(),tn({state:!0,documentModel:!1,notVideo:!0},a)&&virtualViewer.updatePage(t,a)){if(s.showAnnIndicators){var n=C.pagesWithAnnotations();$("#vvRedactionNavigationOption")[0].checked||Bt(t,n)}Dt(a),c.updateSearchButtons(),virtualViewer.skipScrollEvent=!0;var o=C.getOuterDivFromState(a);o.scrollTop(virtualViewer.findPagePosition(t,a)),e("vvThumbs").ensurePageThumbIsVisible(a)}},v.prototype.displayWaitIndicator=function(e,t){B&&clearTimeout(B);var a=!1;if(t=t||d.getActivePaneState(),t&&(a=t.isMedia()),e){$("#waitIndicatorProgressBar").hide();var n=s.waitDialogTimeout||1e3;B=setTimeout(function(){a?$("#vvVideoWaitIndicator").modal("show"):W||$("#vvWaitIndicator").modal("show")},n)}else clearTimeout(B),$("#vvWaitIndicator").modal("hide"),$("#vvVideoWaitIndicator").modal("hide")},v.prototype.displaySaveIndicator=function(e){s.enableSaveNotification&&(e?$("#vvSaveDocumentIndicator").show():$("#vvSaveDocumentIndicator").hide())},v.prototype.displayOcrWaitIndicator=function(e){e?$("#vvOcrIndicator").modal("show"):$("#vvOcrIndicator").modal("hide")};var Sa=function(e){e?$("#vvEmailIndicator").modal("show"):$("#vvEmailIndicator").modal("hide")};v.prototype.saveDocumentAsDialog=function(){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0},t)){var a="pdf",n=C.getSaveAsDocumentNameGenerator(),o=n(t.getDocumentId(),t.getDisplayName(),a);e("vvDialogs").saveAsDialog({documentName:{documentName:o}})}},v.prototype.willSavingOverwriteCurrentFormat=function(e){if(e=e||d.getActivePaneState(),!tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0},e))return!1;var t="tif"===e.getDocFormat()||"pdf"===e.getDocFormat(),a=e.documentModel.model.isCompoundDocument,n=e.documentModel.getPagesModifiedSinceInit();return!(t&&!a||!n||e.isVirtualDocument())},v.prototype.printDocumentDialog=function(t){tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0})&&e("vvDialogs").printDialog(t)};v.prototype.printDocument=function(t){var a;t&&t.documentId&&(a=d.getStateForDocumentId(t.documentId)),tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0},a)&&e("vvPrintManager").printDocument(t)};var Ia=function(e,t){var a,n=d.getActivePaneState(),o=C.getCurrentAnnObject(),i=u.getLayerWithAnn(o),r=n.getUndoObject(n.getPageNumber());r.referenceAnn=o,r.unchangedAnn=o.clone(),r.layer=i,o&&o.markRevised(),"vvAnnTextColorChoices"===e[0].id&&(a=o.getFontColor(),o.setFontColor(t),$("#vvAnnPopUpEditTextArea").css("color","#"+t)),"vvAnnFillColorChoices"===e[0].id&&(a=o.getFillColor(),o.setFillColor(t)),"vvAnnLineColorChoices"===e[0].id&&(a=o.getLineColor(),o.setLineColor(t)),r.modifiedAnn=o.clone(),r.type="modify",r.modifiedAnn.isSameAs(r.unchangedAnn)||n.pushUndoObject(n.getPageNumber(),r),n.resetUndoObject(),u.markLayerWithAnnDirty(o),n.getNewAnnList().indexOf(o)===-1&&n.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()};v.prototype.showRedactionWarningDialog=function(){"true"!==localStorage.ne7owv6art3itt5ild7ed3oick9jiz1go5huec9eav7fups5ew&&C.annotationsEnabled&&s.disableRedactionWarningDialog!==!0&&(C.redactionWarningShown||($("#vvRedactionWarningDialog").modal("show"),C.redactionWarningShown=!0))},v.prototype.createHighlightFromSelection=function(){var e=C.mergeTextRects(virtualViewer.getSelectedTextRects()),a=C.getCurrentState(),n=a.getPageNumber();if(C.checkAnnotationsEnabled(!0)){var o=u.getCurrentLayer();if(o||s.oneLayerPerAnnotation||(o=u.createDefaultLayer(a)),o&&t.isRedactionLayer(o)&&(o=a.getLayerFromPage(n,"Default"),o||(o=u.createDefaultLayer(a))),e.length>0)for(var r=0;r<e.length;r+=1)s.oneLayerPerAnnotation===!0&&(ft(),o=u.getCurrentLayer()),C.createAnnotationFromRect(e[r],i.annotationTypes.SANN_HIGHLIGHT_RECT,o,n,!0);C.delayedPaintCanvases(),C.pageContainsAnnotations(C.getPageNumber())&&!C.pageHasIndicator(a.getPageNumber())&&(virtualViewer.showAnnotationIndicator(a.getPageNumber()),C.addToPagesWithAnnotations(a.getPageNumber())),virtualViewer.createNavigationOptionsLabels()}},v.prototype.createRedactionFromSelection=function(){var e=C.mergeTextRects(virtualViewer.getSelectedTextRects()),t=C.getCurrentState(),a=t.getPageNumber();if(e.length>0)for(var n=0;n<e.length;n+=1){var o=u.getRedactionLayer(a);C.createRedactionFromRect(e[n],o,a,!0)}C.delayedPaintCanvases(),C.pageContainsAnnotations(C.getPageNumber())&&!C.pageHasIndicator(t.getPageNumber())&&(virtualViewer.showAnnotationIndicator(t.getPageNumber()),C.addToPagesWithAnnotations(t.getPageNumber())),virtualViewer.createNavigationOptionsLabels()},v.prototype.createRedactionFromRect=function(e,t,a,n,o){C.getCurrentState();if(C.checkRedactionsEnabled(!0))return t||(t=u.getRedactionLayer(a)),C.showRedactionWarningDialog(),C.createAnnotationFromRect(e,i.annotationTypes.SANN_REDACTION_RECT,t,a,n,o)},v.prototype.createAnnotationFromRect=function(a,o,i,l,d,c){var g,v,p,h,m=this.getActivePaneState(),f=j.getAnnotationPreference(o),y=a.left,b=a.top,P=a.right,A=a.bottom,T=a.width(),S=a.height(),I=new r(y,b,T,S),w=o;f&&(v=f.lineWidth,p=f.lineColor,h=f.fillColor),i||(i=u.getCurrentLayer(l),m.getLayersForPage(l)&&i||(i=u.createDefaultLayer(m)));var D=m.getDPIForPage(l),C=m.getOriginalWidthForPage(l),M=m.getOriginalHeightForPage(l);D||(D=m.getDPIForPage(0),m.setDPIForPage(l,D)),i.dpi||(i.dpi=D),C||(C=m.getOriginalWidthForPage(0),m.setOriginalWidthForPage(l,C)),i.pageWidth||(i.pageWidth=C),M||(M=m.getOriginalHeightForPage(0),m.setOriginalHeightForPage(l,M)),i.pageHeight||(i.pageHeight=M);var x=[new n(y,b),new n(P,A)],L=new(e("vvPreviewAnnotation"));L.initPreview(w,I,p,h,v,s.annotationDefaults.highlightOpacity,x,i.doubleByte,D,i.isIDM),t.isRedactionLayer(i)&&(L.setFillColorRGB(s.annotationDefaults.redactionFillColor),L.setOpacity(s.annotationDefaults.redactionOpacity));var N=L.getFontSize(),$=L.getLineWidth();if(L.setPageWidth(i.pageWidth),L.setPageHeight(i.pageHeight),L.setFontSize(N),L.setLineWidth($),L.page=l,L.setPreview(!1),this.currentPreviewAnnObject=null,this.currentPointArray=[],g=u.addAnnotation(L,l,i,!0,c),!g)return null;var V=m.getUndoObject(l);return V.modifiedAnn=void 0,V.layer=i,V.type="add",m.pushUndoObject(l,V),d||this.delayedPaintCanvases(),this.createNavigationOptionsLabels(),g},v.prototype.destroyInProgressAnnotation=function(){this.setCurrentAnnObject(null),this.currentPreviewAnnObject=null,this.disableStickyAnnotationButton(),Y.dragging=!1,this.currentPointArray=[],E=null,this.delayedPaintCanvases()},v.prototype.turnOnAnnotationButton=function(e,a,n){if(C.checkAnnotationsEnabled(!0)&&a&&"true"!==a.attr("aria-disabled")){var o=d.getActivePaneState();if(o&&!o.isMedia()){if(C.getCurrentAnnObject()||C.currentPreviewAnnObject||C.getDragMode()===i.dragModes.annotate){if(C.setCurrentAnnObject(null),C.currentPreviewAnnObject=null,C.hideAnnPopUp(),C.delayedPaintCanvases(),e===E&&C.getDragMode()===i.dragModes.annotate)return void C.disableStickyAnnotationButton();C.disableStickyAnnotationButton()}if(e===i.annotationTypes.SANN_REDACTION_RECT){if(!C.checkRedactionsEnabled(!0))return;C.showRedactionWarningDialog()}var r=s.stickyAnnButtons[e];r&&(J=e),r&&de&&C.getCurrentAnnType()===e&&!n||(E=e,C.currentPointArray=[],E===i.annotationTypes.SANN_EDIT&&0===j.customStampArray.length&&(C.currentStamp=null),this.hideAnnPopUp(),t.cursorAnnotate(),$(".selectedAnn").removeClass("selectedAnn"),a.addClass("selectedAnn"),a.parents("li").addClass("selectedAnn"),r&&(de=!0),this.setDragMode(i.dragModes.pan),this.setDragMode(i.dragModes.annotate))}}},v.prototype.disableStickyAnnotationButton=function(){$(".selectedAnn").removeClass("selectedAnn"),de=!1,t.cursorNormal(),C.currentPointArray=[],Y.endPoint=0,this.setDragMode(i.dragModes.pan)},v.prototype.toggleLayerManager=function(){var e=this.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)){if("true"===$("#vvLayerManagerButton").attr("aria-disabled")||$("#vvLayerManagerDiv:visible").length)return void $("#vvLayerManagerDiv").modal("hide");var t=e.getLayerManager();t.showLayerDialog(e)}},v.prototype.showWatermarksManager=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&e("vvDialogs").watermarksDialog()},v.prototype.removeWatermarkFromPage=function(t){var a=d.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0},a)&&("number"!=typeof t&&(t=a.getPageNumber()),e("vvWatermarks").removeWatermarksFromPage(t,a),C.delayedPaintCanvases())},v.prototype.sendDocument=function(t){var a;if(t?a=d.getStateForDocumentId(t):(a=d.getActivePaneState(),t=a.getDocumentId()),tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0},a)){var n=new URI(s.servletPath);n.addQuery("action","sendDocument"),e("vvWatermarks").saveWatermarks(a);var o=a.getDocumentModel().model;n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),n.addQuery("modelJSON",JSON.stringify(o)),n.addQuery("annotations",JSON.stringify(a.getAnnotationLayers(!0,!0,!0,s.sendDocumentWithAnnotations))),n.addQuery("includeTextAnnotations",s.sendDocumentWithAnnotations),n.addQuery("includeNonTextAnnotations",s.sendDocumentWithAnnotations),n.addQuery("includeRedactions",s.sendDocumentWithAnnotations),n.addQuery("includeWatermarks",s.sendDocumentWithWatermarks),n.addQuery("includeDocumentNotes",s.sendDocumentWithNotes),n.addQuery("stampStatus",""),null!==C.getOverlayPath()&&n.addQuery("overlayPath",C.getOverlayPath()),i.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var r=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",data:r,dataType:"json",success:function(e){gt(e)!==!0&&X.call("sendDocument")},error:function(e){gt(e,a.getDocumentId(),a.currentPaneIndex)===!0}})}},v.prototype.lockScrolling=function(e){ae?this.scrollingLocked=!!e:this.scrollingLocked=!1;var t=$("#vvLockScrollingBtn");this.scrollingLocked?(t.removeClass("vvDiffScrollingUnlocked"),t.addClass("vvDiffScrollingLocked")):(t.removeClass("vvDiffScrollingLocked"),t.addClass("vvDiffScrollingUnlocked"))},v.prototype.toggleZoomLock=function(){this.zoomLocked=!this.zoomLocked},v.prototype.setZoomLock=function(e){this.zoomLocked=e};var wa=function(e,t,a){var n=$(e).scrollTop(),o=$(e).scrollLeft();if($(t).scrollTop()!==n||$(t).scrollLeft()!==o){var i=re,r=se;a&&(i=oe,r=ie),oe=n,ie=o,re=n,se=o,i!==n&&$(t).scrollTop(n),r!==o&&$(t).scrollLeft(o)}},Da=function(e){var a,n;return e||(e=d.getActivePaneState()),e&&(n=e.getPageNumber(),a=e.getPageCount(),ke(e)),$(".vvJumpToPageInput").val(n+1),e&&e.xlsxPageLimited?($(".vvJumpToPageTotal").html("..."),void $(".vvJumpToPageTotal").attr("title",t.getLocalizedValue("errors.xlsxPageLimited","This XLSX document has been limited by an administrator, to render a maximum number of pages. The final page displayed will be page: ")+e.getPageCount())):($(".vvJumpToPageTotal").attr("title",""),void(0!==a?(a>999&&$(".vvJumpToPageLabel").width(45),$(".vvJumpToPageTotal").html(a)):$(".vvJumpToPageTotal").html(1)))},Ca=function(e){if(!e&&0!==e)return Ma(!0),!1;var t=d.getActivePaneState(),a=t.getPageCount();return e<0||a>0&&e>=a?(Ma(!0),!1):(Ma(!1),!0)},Ma=function(e){return e?void $(".vvJumpToPageInput").attr("aria-invalid",!0):void $(".vvJumpToPageInput").attr("aria-invalid",!1)};v.prototype.getPageNumber=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e))return e?e.getPageNumber():void 0},v.prototype.getOriginalWidth=function(){return originalWidth},v.prototype.setOriginalWidth=function(e){originalWidth=e},v.prototype.getDocumentModel=function(e){return e||(e=d.getActivePaneState()),e?e.getDocumentModel():null},v.prototype.setDocumentModel=function(e){var t=d.getActivePaneState();t.setDocumentModel(e)},v.prototype.getZoomPercent=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e))return e.getZoomDecimal()},v.prototype.getCurrentAnnObject=function(){return F},v.prototype.setCurrentAnnObject=function(e){F=e},v.prototype.getPreviousAnnObject=function(){return O},v.prototype.setPreviousAnnObject=function(e){O=e},v.prototype.collapseAllStickyNotes=function(e,t){var a=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},a)){var n=a.getLayersForPage(C.getPageNumber());if(n){var o=Object.keys(n);if(o&&n)for(var r=0;r<o.length;r+=1)for(var s=n[o[r]],l=s.anns,u=0;u<l.length;u+=1){var c=l[u];c.getType()===i.annotationTypes.SANN_POSTIT&&(c.collapsed=e,c.editing=!1)}t&&virtualViewer.delayedPaintCanvases()}}},v.prototype.zoomRubberband=function(){var e=d.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0},e)&&(E=i.annotationTypes.SANN_RECTANGLE,C.currentPointArray=[],Y.endPoint=0,C.setDragMode(i.dragModes.zoom))};var xa=function(e,t){virtualViewer.localClipboard=e;var a=encodeURIComponent(JSON.stringify(e)),n=function(e){if(t)if(virtualViewer.localClipboard)t();else{var a={client:!0,disable:C.disableErrorModals.pageManipulation,e:e};vt(e.message,a)}},o=localforage.setItem("vvClipboard",a);t?o.then(t,n):o.then(function(){},n)},La=function(e){var t=function(t){var a=null;try{a=JSON.parse(decodeURIComponent(t))}catch(e){a=null}var n=a?a.sessionGUID:null,o=virtualViewer.localClipboard;o&&(!a||o.timestamp>a.timestamp)?a=o:s.enableCopyPasteBetweenSessions===!1&&n!==virtualViewer.viewerSessionID&&(a=o),a?($a(a),e(a)):e(null)},a=function(){e(virtualViewer.localClipboard?virtualViewer.localClipboard:null)},n=localforage.getItem("vvClipboard");n.then(t,a)};v.prototype.createClipObject=function(){var t={},a=virtualViewer.getDocumentModel(),n=virtualViewer.getCurrentState(),o=n.getImageManager(),i=a.getSelectedPageNumbers();return 0!==i.length&&(t.pageNums=i,t.pageState=n.copyPages(i,0),t.layerNames=n.getLayerNames(),t.model=a.copySelection(),t.bookmarks=Q.copyBookmarksForPageRange(i),t.watermarks=e("vvWatermarks").copyWatermarksForPageRange(n,i),t.imageManager=o.copyPages(i),t.timestamp=Date.now(),t.sessionGUID=virtualViewer.viewerSessionID,t)},v.prototype.copySelection=function(e,t){if(tn({state:!0,documentModel:!0,notVideo:!0})){var a={};if(C.checkPageManipulationsEnabled(e)){if(a=virtualViewer.createClipObject()){xa(a,t);var n={pages:a.pageNums,documentId:d.getActivePaneState().documentId};return X.call("pageCopied",n),!0}return!1}return!1}},v.prototype.deleteSelection=function(a,n){n=n||virtualViewer.getCurrentState();var o,i=n.getDocumentModel();o=a.pageNums?a.pageNums:i.getSelectedPageNumbers();var r=n.getImageManager();if(0===o.length)return!1;if(o.length>=n.getPageCount()){var s=t.getLocalizedValue("errors.onePageLimit","Document must contain at least 1 page"),l={client:!0,disable:C.disableErrorModals.pageLimit};return vt(s,l),!1}C.removeAllAnnotationIndicators();for(var u=0,c=0;c<o.length;c+=1)C.removeFromPagesWithAnnotations(o[c]),u++;n.getDocumentModel().setPagesModifiedSinceInit(!0,n),i.cutSelection(o),n.cutPages(o,0),r.cutPages(o),Q.deleteBookmarks(o),Q.shiftBookmarks(o[0],o,!1),e("vvWatermarks").removePages(n,o);var g=e("vvThumbs");g.fillPageThumbs(n);for(var v=C.pagesWithAnnotations(),p=0;p<v.length;p+=1)virtualViewer.showAnnotationIndicator(v[p]);return Ht(n,!0),n.getPageCount()>0&&g.loadVisibleThumbs($("#vvPageThumbs")),X.call("pageDeleted",{pages:o}),C.updateTabName(n),d.getCurrentDiff()&&virtualViewer.performDiff(!0,!0),n.pageNumber>=n.pageCount&&(n.pageNumber=n.pageCount),virtualViewer.setPage(n.pageNumber),virtualViewer.fillAnnotationList(),!0},v.prototype.cutSelection=function(e,t,a){if(!tn({state:!0,documentModel:!0,notVideo:!0}))return!1;var n={};return!!C.checkPageManipulationsEnabled(t)&&(e!==!0&&(n=virtualViewer.createClipObject(),xa(n,a)),virtualViewer.deleteSelection(n),c.handleSearchOnPageManipulation(),!0)},v.prototype.pasteClip=function(a,n,o,i){var r=a?a.sessionGUID:null;if(s.enableCopyPasteBetweenSessions===!1&&r!==virtualViewer.viewerSessionID){var l=t.getLocalizedValue("errors.copyingBetweenSessionsDisabled","Copying between sessions has been disabled by the administrator."),u={client:!0,disable:this.disableErrorModals.adminDisabled};return void vt(l,u)}n=n||d.getActivePaneState(),o=o||0;var g=n.getDocumentModel();g.setPagesModifiedSinceInit(!0,n),ka(a,n),g.paste(a.model,o),n.pastePages(a.pageState,o),n.setPageCount(g.getDocumentLength()),n.fixAnnPages();var v=n.getImageManager();v.getPastedPages(a.imageManager.length,o),Q.shiftBookmarks(o,a.pageNums,!0);for(var p=Q.shiftPastePageNumbers(a.pageNums,a.bookmarks,o),h=0;h<p.length;h++){var m=p[h];C.addBookmark(m.note,m.page)}e("vvWatermarks").pastePagesWithWatermarks(n,a,o);var f=e("vvThumbs");f.fillPageThumbs(n);for(var h=0;h<a.imageManager.length;h++)virtualViewer.pageContainsAnnotations(o+h)&&virtualViewer.addToPagesWithAnnotations(o+h);virtualViewer.removeAllAnnotationIndicators(),i||(f.loadVisibleThumbs($("#vvPageThumbs")),virtualViewer.setPage(o));for(var y=o;y<n.pageStates.length&&n.pageStates[y].imageInfoRequested;y++)n.pageStates[y].imageInfoRequested=!1;c.handleSearchOnPageManipulation(),d.getCurrentDiff()&&virtualViewer.performDiff(!0,!0),Ht(n,!0),virtualViewer.showAllAnnotationIndicators(),virtualViewer.fillAnnotationList(),C.updateTabName(n),X.call("pagePasted",{pages:a.pageNums})};var Na=function(e){var t=e&&e.model[0]&&e.pageState[0];return t};v.prototype.clipIsVVObject=Na;var $a=function(e){for(var t=[],a=0;a<e.pageState.length;a++){var n=e.pageState[a],i=e.model[a],r=new o;r.initPageStateFromObject(n);for(var s=e.layerNames,l=0;l<s.length;l++){var d=n.annotationLayers[s[l]];if(d){var c=u.createAnnotationLayer(d.layerName,i.pageIndex,r);c.isIDM=d.isIdm,c.doubleByte=d.doubleByte;for(var g=0;g<d.anns.length;g++){var v=d.anns[g];c.anns[g]=Ra(v,c)}r.annotationLayers[s[l]]=c}}t.push(r)}e.pageState=t};v.prototype.fixClipState=$a;var Va=function(e){for(var t=0;t<e.pageState.length;t++)if(e.pageState[t]&&e.pageState[t].annotationLayers)for(var a=Object.keys(e.pageState[t].annotationLayers),n=0;n<a.length;n++){var o=a[n];if(e.pageState[t].annotationLayers[o])for(var i=e.pageState[t].annotationLayers[o],r=0;r<i.anns.length;r++)i.anns[r].markRevised()}},ka=function(e,a){var n=a.layerNames,o=[];if(!s.oneLayerPerAnnotation){for(var i=0;i<e.layerNames.length;i++){var r=e.layerNames[i];n.includes(r)||o.push(r)}return a.layerNames=o.concat(n),void Va(e)}for(var l=0;l<e.pageState.length;l++){for(var d={},c=0;c<e.layerNames.length;c++)for(var g=e.layerNames[c],v=e.pageState[l].annotationLayers[g],p=0;p<v.anns.length;p++){var h=mt(t.isRedactionLayer(v)),m=u.createAnnotationLayer(h,null,e.pageState[l]);m.permissionLevel=v.permissionLevel,o.push(m.layerName);var f=v.anns[p];f.layerName=m.layerName,m.anns.push(f),d[m.layerName]=m}e.pageState[l].annotationLayers=d}Va(e),e.layerNames=o,a.layerNames=o.concat(n)},Ra=function(t,a){var n=new(e("annotations"));return n.init(null,t,t.page,t.pageWidth,t.pageHeight,t.layerName,a.doubleByte,t.index,t.docDPI,a.isIDM),n};v.prototype.pasteSelection=function(e,a,n){tn({state:!0,documentModel:!0,notVideo:!0})&&La(function(o){return e=e||0,o?void(C.checkPageManipulationsEnabled(n)&&virtualViewer.pasteClip(o,null,e,a)):void alert(t.getLocalizedValue("errors.clipboardEmpty","There are no pages on the clipboard."))})},v.prototype.selectPage=function(e,t){if(C.checkPageManipulationsEnabled(t)){var a=C.getDocumentModel();a.addPageToSelection(e)}},v.prototype.deselectPage=function(e,t){if(C.checkPageManipulationsEnabled(t)){var a=C.getDocumentModel();a.removePageFromSelection(e)}},v.prototype.selectRange=function(e,t){if(C.checkPageManipulationsEnabled(t)){var a=C.getDocumentModel();a.selectRange(e)}},v.prototype.selectAll=function(e){if(C.checkPageManipulationsEnabled(e)){var t=C.getDocumentModel();t.selectAll()}},v.prototype.selectNone=function(e){if(C.checkPageManipulationsEnabled(e)){var t=C.getDocumentModel();t.clearPageSelection()}},v.prototype.isPageSelected=function(e,t){if(C.checkPageManipulationsEnabled(t)){var a=C.getDocumentModel();return a.isPageSelected(e)}},v.prototype.getSelectedPageNumbers=function(e){if(C.checkPageManipulationsEnabled(e)){var t=C.getDocumentModel();return t.getSelectedPageNumbers()}},v.prototype.showAboutDialog=function(){$("#vvAboutDialog").modal("show")};var Ba=function(e){C.disableUploadDocument=!!e,C.disableUploadDocument?$(".vvFileUpload").remove():$(".vvFileUpload").show()};v.prototype.isUploadDocumentEnabled=function(){return!this.disableUploadDocument},v.prototype.disableUploadDocumentForSession=function(){Ba(!0)},v.prototype.showUploadLocalFileDialog=function(){if(this.isUploadDocumentEnabled())return void $("#vvUploadLocalFilesDialog").modal("show");var e=t.getLocalizedValue("errors.uploadDisabled","Upload document has been disabled by the administrator."),a={client:!0,disable:this.disableErrorModals.adminDisabled};vt(e,a)},v.prototype.showUserPreferencesDialog=function(){s.disableUserPreferences||(j.updateDialog(),$("#vvUserPreferencesDialog").modal("show"))},v.prototype.toggleSpeechControls=function(){var e=$("#vvScreenReaderControlsPopUp");"none"===e[0].style.display?(e.show(),Oe()):e.hide()};var Fa=function(){var e=d.getActivePaneState();e&&!e.isSearchable?("none"!==$("#vvScreenReaderControlsPopUp")[0].style.display&&C.toggleSpeechControls(),$(".vvSpeechSynthesis").hide()):$(".vvSpeechSynthesis").show()};v.prototype.showPictureControlsDialog=function(){var e=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},e)){if($("#vvPictureControlsDialog").modal("show"),$("#vvBrightnessSlider").slider({labelledby:"vvBrightnessSliderLabel"}),$("#vvContrastSlider").slider({labelledby:"vvContrastSliderLabel"}),$("#vvGammaSlider").slider({labelledby:"vvGammaSliderLabel"}),$("#vvBrightness .slider").attr("title",t.getLocalizedValue("pictureControls.brightnessSlider.title","Brightness (Slider)")),$("#vvContrast .slider").attr("title",t.getLocalizedValue("pictureControls.contrastSlider.title","Contrast (Slider)")),$("#vvGamma .slider").attr("title",t.getLocalizedValue("pictureControls.gammaSlider.title","Gamma (Slider)")),!e)return void $("#vvPictureControlsDialogOKButton").prop("disabled",!0);$("#vvPictureControlsDialog [title]").attr("data-tooltip","tooltip"),
$("#vvPictureControlsDialogOKButton").prop("disabled",!1);var a=e.getBrightnessForPage(e.pageNumber);$("#vvBrightnessSliderVal").text(a),$("#vvBrightnessSlider").slider("setValue",a);var n=e.getDocumentId(),o=e.currentPaneIndex;$("#vvBrightnessSlider").slider().on("slideStop slide",function(e){$("#vvBrightnessSliderVal").text(e.value),Qe();var t=e.value,a=s.pictureControlsTimeout||200;V&&clearTimeout(V),V=setTimeout(function(e){var a=d.getStateForDocumentId(n,o);a.setBrightnessForPage(a.getPageNumber(),t),C.updateTabName(a)},a)});var i=e.getContrastForPage(e.pageNumber);$("#vvContrastSliderVal").text(i),$("#vvContrastSlider").slider("setValue",i),$("#vvContrastSlider").slider().on("slideStop slide",function(e){$("#vvContrastSliderVal").text(e.value),Qe();var t=e.value,a=s.pictureControlsTimeout||200;V&&clearTimeout(V),V=setTimeout(function(e){var a=d.getStateForDocumentId(n,o);a.setContrastForPage(a.getPageNumber(),t),C.updateTabName(a)},a)});var r=e.getGammaForPage(e.pageNumber);$("#vvGammaSliderVal").text(r),$("#vvGammaSlider").slider("setValue",r),$("#vvGammaSlider").slider().on("slideStop slide",function(e,t){$("#vvGammaSliderVal").text(e.value),Qe();var a=e.value,i=s.pictureControlsTimeout||200;V&&clearTimeout(V),V=setTimeout(function(e){var t=d.getStateForDocumentId(n,o);t.setGammaForPage(t.getPageNumber(),a),C.updateTabName(t)},i)})}},v.prototype.emailDocumentDialog=function(){var t=d.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0,notPageLimited:!0},t)&&e("vvDialogs").emailDialog({displayName:t.getDisplayName(),prepopulateFrom:s.emailDefaults.prepopulateFrom,prepopulateTo:s.emailDefaults.prepopulateTo,prepopulateCC:s.emailDefaults.prepopulateCC,prepopulateBCC:s.emailDefaults.prepopulateBCC})},v.prototype.setProperty=function(e,t){var a=C.getActivePaneState();tn({state:!0,documentModel:!0,notVideo:!0})&&a.setDocumentModelProperty(e,t)},v.prototype.getProperty=function(e){var t=C.getCurrentState();if(tn({state:!0,documentModel:!0,notVideo:!0},t))return t.getDocumentModelProperty(e)},v.prototype.showImageInfo=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(this.updateImageInfoDialog(),$("#vvImageInfoDialog").modal("show"))},v.prototype.hideImageInfo=function(){$("#vvImageInfoDialog").modal("hide")},v.prototype.toggleImageInfo=function(){var e=$("#vvImageInfoDialog").data("bs.modal")&&$("#vvImageInfoDialog").data("bs.modal").isShown;return!tn({state:!0,documentModel:!0,notVideo:!0})||e?void this.hideImageInfo():void this.showImageInfo()},v.prototype.updateImageInfoDialog=function(){if(!s.imageInfoFields)return $("#vvImageInfoText").html("No Image Info Available");var e=d.getActivePaneState(),a="<div class='vvImageInfoContents'>";a+="<h4 class='vvImageInfoHeader'>"+t.getLocalizedValue("imageInfo.documentInfoHeader","Document Info")+"</h4>",a+='<table class="vvImageInfoTable" width=100%>';for(var n,o,i,r,l,u=null,c=0;c<s.imageInfoFields.length;c++)n=s.imageInfoFields[c].fieldId,i=s.imageInfoFields[c].fieldCaption,o=t.getLocalizedValue("imageInfo."+n,i),u=c%2===0?"vvImageInfoOddRow":"vvImageInfoEvenRow",f(n)&&(a+="<tr class='"+u+"'><td width=50%>",r=y(n,e),r||(r="N/A"),l=P(r),a+=o+'</td><td title="'+r+'">'+l,a+="</td></tr>");a+="<tr><td><h4 class='vvImageInfoPageHeader'>"+t.getLocalizedValue("imageInfo.pageInfoHeader","Page Info")+"</h4></td></tr>";for(var g=0;g<s.imageInfoFields.length;g++)n=s.imageInfoFields[g].fieldId,i=s.imageInfoFields[g].fieldCaption,o=t.getLocalizedValue("imageInfo."+n,i),u=g%2===0?"vvImageInfoOddRow":"vvImageInfoEvenRow",f(n)||(a+="<tr class='"+u+"'><td width=50%>",r=y(n,e),r||(r="N/A"),l=P(r),a+=o+'</td><td title="'+r+'">'+l,a+="</td></tr>");a+="</table>",a+="</div>",$("#vvImageInfoText").html(a)},v.prototype.toggleKeyboardHints=function(){var e=$("#vvKeyboardHints").data("bs.modal")&&$("#vvKeyboardHints").data("bs.modal").isShown;e?this.hideKeyboardHints():this.showKeyboardHints()},v.prototype.hideKeyboardHints=function(){$("#vvKeyboardHints").modal("hide")},v.prototype.showKeyboardHints=function(){$("#vvKeyboardHints").modal("show")},v.prototype.pageContainsAnnotations=function(e){var t=d.getActivePaneState();if(tn({state:!0,documentModel:!0,notVideo:!0},t))return t.pageContainsAnnotations(e)},v.prototype.toggleThumbnailPanel=function(t){var a=e("vvThumbs");return $("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),t===!0||t===!1?(a.setThumbPanelVisibility(t),void Wa()):void a.setThumbPanelVisibility($("#vvImagePanel").hasClass("noThumbs"))},v.prototype.setDocumentIdGenerator=function(e){U=e},v.prototype.setExportDocumentNameGenerator=function(e){_=e},v.prototype.setSaveAsDocumentNameGenerator=function(e){z=e},v.prototype.getSaveAsDocumentNameGenerator=function(){return z||virtualViewer.defaultSaveAsDocumentNameGenerator},v.prototype.defaultSaveAsDocumentNameGenerator=function(e,t,a){var n="",o="pdf"===a;return n=t?t:e,n="Copy-"+n,n+=o?".pdf":".tif"},v.prototype.removeCallback=function(e,t){return X.removeCallback(e,t)},v.prototype.setCallback=function(e,t){return X.setCallback(e,t)},v.prototype.getCallbackManager=function(){return X},v.prototype.setPageChangeCompletedHandler=function(e){X.setCallback("pageChange",e)},v.prototype.setRotationCompletedHandler=function(e){X.setCallback("rotation",e)},v.prototype.setTextSelectHandler=function(e){X.setCallback("textSelect",e)},v.prototype.setSaveDocumentCompletedHandler=function(e){X.setCallback("saveDocument",e)},v.prototype.setSaveAsDocumentCompletedHandler=function(e){X.setCallback("saveAsDocument",e)},v.prototype.setUploadDocumentCompletedHandler=function(e){X.setCallback("uploadDocument",e)},v.prototype.setSendDocumentCompletedHandler=function(e){X.setCallback("sendDocument",e)},v.prototype.setSaveAnnotationsCompletedHandler=function(e){X.setCallback("saveAnnotations",e)},v.prototype.setImageLoadCompletedHandler=function(e){X.setCallback("imageLoadCompleted",e)},v.prototype.setImageLoadRequestedHandler=function(e){X.setCallback("imageLoadRequested",e)},v.prototype.searchText=function(e,t,a,n){if(tn({state:!0,documentModel:!0,notVideo:!0}))return c.searchDocumentText(e,t,a,n)},v.prototype.searchAnnotationText=function(e){if(tn({state:!0,documentModel:!0,notVideo:!0}))return c.searchAnnotationText(e)},v.prototype.getCurrentSearchResults=function(){return c.getCurrentSearchResults()},v.prototype.clearSearchResults=function(){if(tn({state:!0,documentModel:!0,notVideo:!0}))return c.clearSearchResults()},v.prototype.getAllTextForDocument=function(e){e=e||virtualViewer.getActivePaneState(),setTimeout(function(){for(var t=0;t<e.getPageCount();t++)virtualViewer.getAllText(t,e)},0)},v.prototype.getAllText=function(e,t){s.enableTextExtraction&&(t||(t=d.getActivePaneState()),e=t.validatePageNumber(e),null===t.getPageText(e)&&Ua(e,t))},v.prototype.cancelCurrentSearch=function(){c.cancelCurrentSearch()},v.prototype.isDocumentSearchable=function(){var e=d.getActivePaneState();return tn({state:!0,notVideo:!0})?e.getIsSearchable():null},v.prototype.nextSearchResult=function(){c.nextSearchResult()},v.prototype.previousSearchResult=function(){c.previousSearchResult()},v.prototype.redactSearchMatch=function(e,a){var n=d.getCurrentState();if(n){for(var o=u.getRedactionLayer(a),i=[],r=this.mergeTextRects(e.rectangles),s=0;s<r.length;s+=1){var l=r[s],c=new t.ImageRect(l.left/1e3,l.top/1e3,l.right/1e3,l.bottom/1e3);i.push(this.createRedactionFromRect(c,o,a,!0))}return this.pageHasIndicator(a)||(this.showAnnotationIndicator(a),this.addToPagesWithAnnotations(a)),this.delayedPaintCanvases(),this.createNavigationOptionsLabels(),i}};var Ea=function(e){var t;return void 0===e||""===e?t=!1:(t=!0,$("#redactAllTagError").is(":visible")&&$("#redactAllTagError").hide()),t},Oa=function(){$("#tagAllRedactionsOKButton").click(function(){var e=$("#vvAnnTagSearchSelect").children(":selected").text(),t=Ea(e);t?(C.addRedactionTagsToSearch(c.getSearchedRedactions(),e,t),$("#vvTagAllRedactionsDialog").hide()):$("#redactAllTagError").show()}),$("#tagAllRedactionsCancelButton").click(function(e){$("select").each(function(){this.selectedIndex=0}),$("#vvTagAllRedactionsDialog").hide()})};v.prototype.showTagAllRedactionsDialog=function(){if(tn({state:!0,documentModel:!0,notVideo:!0})&&($("#vvTagAllRedactionsDialog").show(),$("#redactAllTagError").hide(),!s.annotationTags.length>0))throw"Please add tags for the redactions"},v.prototype.addRedactionTagsToSearch=function(e,t,a){var n,o=e;a||(a=!0);for(var i=0;i<o.length;i++){n=o[i];for(var r=0;r<n.annotationTags.length;r++)if(n.annotationTags[r]===t){a=!1;break}n.layerName.includes("vvRedaction")&&1===n.annotationTags.length&&n.annotationTags[0]!==t&&n.annotationTags.splice(0,1),a&&(n.annotationTags.push(t),n.markRevised(),u.markLayerWithAnnDirty(n))}var s=virtualViewer.getCurrentAnnObject();s&&$("#vvAnnPopUp:visible").length&&virtualViewer.annPopUpHandler(null,s)},v.prototype.enterGuideMode=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(t.cursorGuides(),this.setDragMode(i.dragModes.guides))},v.prototype.enterPanMode=function(){this.setDragMode(i.dragModes.pan)},v.prototype.enterSelectTextMode=function(){if(tn({state:!0,documentModel:!0,notVideo:!0})){if(!this.pageHasText())return void alert(t.getLocalizedValue("errors.noText","No selectable text on this page"));t.cursorSelectText(),this.setDragMode(i.dragModes.selectText)}},v.prototype.toggleSelectTextMode=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(Y.getDragMode()!==i.dragModes.selectText?this.pageHasText()?this.setDragMode(i.dragModes.selectText):alert(t.getLocalizedValue("errors.noText","No selectable text on this page")):this.setDragMode(i.dragModes.pan))},v.prototype.toggleHGuide=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&this.toggleGuide(this.horizontalGuide,this.verticalGuide)},v.prototype.toggleVGuide=function(e,t){tn({state:!0,documentModel:!0,notVideo:!0})&&this.toggleGuide(this.verticalGuide,this.horizontalGuide)},v.prototype.toggleGuide=function(e,a){if(tn({state:!0,documentModel:!0,notVideo:!0})){var n=Y.getDragMode();n!==i.dragModes.guides?(e.locked=!1,e.visible=!0):a.visible?(a.visible=!1,e.visible=!0):e.visible=!e.visible,a.locked=!1,e.locked=!1,a.visible||e.visible?this.setDragMode(i.dragModes.guides):(t.cursorNormal(),this.setDragMode(i.dragModes.pan)),C.delayedPaintCanvases()}},v.prototype.toggleCrosshairGuide=function(){var e=this.verticalGuide.visible||this.horizontalGuide.visible;tn({state:!0,documentModel:!0,notVideo:!0})&&(this.resetGuides(),e?(t.cursorNormal(),this.setDragMode(i.dragModes.pan)):(this.setDragMode(i.dragModes.guides),this.verticalGuide.visible=this.horizontalGuide.visible=!0),this.delayedPaintCanvases())},v.prototype.toggleBothGuidesVisibility=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(this.verticalGuide=this.verticalGuide||{},this.horizontalGuide=this.horizontalGuide||{},this.verticalGuide.visible=!this.verticalGuide.visible,this.horizontalGuide.visible=!this.horizontalGuide.visible,this.delayedPaintCanvases())},v.prototype.toggleVGuideVisibility=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(this.verticalGuide=this.verticalGuide||{},this.verticalGuide.visible=!this.verticalGuide.visible,this.delayedPaintCanvases())},v.prototype.toggleHGuideVisibility=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(this.horizontalGuide=this.horizontalGuide||{},this.horizontalGuide.visible=!this.horizontalGuide.visible,this.delayedPaintCanvases())};var Ua=function(e,t){if(t||(t=d.getActivePaneState()),t.getIsSearchable()){var a=new URI(s.servletPath);a.addQuery("action","getAllTextForPage"),a.addQuery("pageIndex",ia(e,t)),a.addQuery("documentId",oa(e,t)),a.addQuery("clientInstanceId",C.getClientInstanceId()),a.addQuery("pageCount",t.getPageCount()),i.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),null!==C.getOverlayPath()&&a.addQuery("overlayPath",C.getOverlayPath());var n=t.getDocumentId(),o=t.currentPaneIndex,r=a.query();a.query(""),$.ajax({url:a.toString(),type:"POST",dataType:"json",data:r,success:function(t){_a(t,e,n,o),virtualViewer.deselectAllText()},error:function(e){virtualViewer.handle500Status(e,n,o),console.log("getAllTextForPage"+e.statusText)}})}},_a=function(e,t,a,n){var o=e.wordRects;if(o){o.sort(function(e,t){var a=e.bottom-e.top;return e.top>=t.top&&e.bottom<=t.bottom?e.left-t.left===0?e.right-t.right:e.left-t.left:e.bottom-.2*a<=t.top?e.top-t.top:e.top<t.top&&e.bottom<t.bottom?e.top-t.top:t.bottom-.2*a<=e.top?e.top-t.top:t.top<e.top&&t.bottom<e.bottom?e.top-t.top:e.left-t.left});var i=d.getStateForDocumentId(a,n);i.addPageText(e,t);var r=d.getCurrentDiff();r&&(r.processPageTextForDiff(t),r.diffPage(t),qa(t)),K.setUpScreenReaderDiv(i)}};v.prototype.getDocumentCompareData=function(e){var t=d.getCurrentDiff();return t?t.changeObjects[e]?t.allChangeObjectsToRects(e):(this.getAllText(e,t.oldDocument.state),this.getAllText(e,t.newDocument.state),[]):[]},v.prototype.getDocumentCompareReport=function(e){if(tn({state:!0,documentModel:!0,notVideo:!0})){var t=d.getCurrentDiff();return t.diffIsComplete?e?void e(t.getChangeReport()):t.getChangeReport():(t.diffReportCallback=e,this.getAllTextForDocument(t.oldDocument.state),this.getAllTextForDocument(t.newDocument.state),e?void 0:t.getChangeReport())}},v.prototype.compareDocuments=function(e,t,a){if(a=a||{},e&&t){C.openInTab(e);var n=C.getCurrentState(1);if(n){var o=n.documentModel;o.getModifiedSinceInit()?C.confirmCloseDialog(n,t):C.splitScreen(t,a.splitScreenDirection||"horizontal")}else C.splitScreen(t,a.splitScreenDirection||"horizontal");C.performDiff(a.skipOcrPrompt,!0)}},v.prototype.performDiff=function(t,a){var n=d.getCurrentDiff();if(n&&!a)return void qa();var o=new(e("vvDiffManager"));if($("#vvDocCompareInternal").empty(),o.init(d.getCurrentState(0),d.getCurrentState(1)),d.setDiff(o),!(d.getCurrentState(0).getIsSearchable()!==!1&&d.getCurrentState(1).getIsSearchable()!==!1||C.ocrEnabled))return Ha(),o.setDiffDisabled(!0),void qa();if((d.getCurrentState(0).getIsSearchable()===!1||d.getCurrentState(1).getIsSearchable()===!1)&&null!==d.getCurrentState(0).getIsSearchable()&&null!==d.getCurrentState(1).getIsSearchable()){var i=function(){d.getCurrentState(0).getIsSearchable()===!1&&virtualViewer.performOCR(d.getCurrentState(0)),d.getCurrentState(1).getIsSearchable()===!1&&virtualViewer.performOCR(d.getCurrentState(1))};if(!t)return void e("vvDialogs").ocrDialog(function(){setTimeout(i,0)},function(){o.setDiffDisabled(!0),qa()});i()}za()};var za=function(){var e=d.getCurrentDiff();e.startDiff(),Ha(),qa()},Wa=function(){$("#vvThumbsTabs").removeClass("vvShrinkTabsToFitSevenThumbs vvShrinkTabsToFitSixThumbs vvFiveThumbs");var e=$(".thumbTabs.vvAllowedTab").length;7===e?$("#vvThumbsTabs").addClass("vvShrinkTabsToFitSevenThumbs"):6===e?$("#vvThumbsTabs").addClass("vvShrinkTabsToFitSixThumbs"):5===e&&$("#vvThumbsTabs").addClass("vvFiveThumbs")},Ha=function(){$("#vvDocCompareTab").show().addClass("vvAllowedTab"),Wa(),$("#vvThumbs .active").removeClass("active"),$("#vvDocCompareTab, #vvDocCompare").addClass("active")};v.prototype.performOCR=function(e){var t=$.extend({},e);this.displayOcrWaitIndicator(!0),t.state=t.state||d.getActivePaneState();var a=new URI(s.servletPath);a.escapeQuerySpace(!1),a.addQuery("action","performOCR"),a.addQuery("documentId",t.state.getDocumentId()),a.addQuery("clientInstanceId",C.getClientInstanceId()),a.addQuery("forceOcr",t.force),null!==C.getOverlayPath()&&a.addQuery("overlayPath",C.getOverlayPath()),i.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query("");var o=t.state.getDocumentId(),r=t.state.currentPaneIndex;$.ajax({url:a.toString(),dataType:"json",type:"POST",data:n}).done(function(e){if(!gt(e,o,r)&&"OK"===e.status&&e.ocrWasPerformed){var a=d.getStateForDocumentId(o,r);a.setIsSearchable(!0);for(var n=a.getPageNumber(),i=Math.max(n-s.continuousScrollBufferBeforeSize,0),l=Math.min(n+s.continuousScrollBufferAfterSize,a.getPageCount()-1),u=i;u<=l;u++)virtualViewer.getAllText(u,a);t.onCompleteCallback&&t.onCompleteCallback()}}).always(function(){virtualViewer.displayOcrWaitIndicator(!1)})},v.prototype.toggleColumnSelectionMode=function(){this.columnSelectionMode=!this.columnSelectionMode},v.prototype.enableColumnSelectionMode=function(){this.columnSelectionMode=!0},v.prototype.disableColumnSelectionMode=function(){this.columnSelectionMode=!1},v.prototype.getColorBlobSize=function(){return Modernizr.touchevents?i.annColorBlobSizeTouch:i.annColorBlobSize},v.prototype.selectAllText=function(){var e=d.getActivePaneState(),t=e.pageNumber;tn({state:!0,documentModel:!0,notVideo:!0},e)&&(this.selectTextStartPoint=new n(0,0),this.selectTextEndPoint=new n(e.getOriginalWidthForPage(),e.getOriginalHeightForPage(t)),this.delayedPaintCanvases())},v.prototype.deselectAllText=function(){tn({state:!0})&&(this.selectTextStartPoint=new n(0,0),this.selectTextEndPoint=new n(0,0),virtualViewer.delayedPaintCanvases())},v.prototype.copyAllText=function(){var e=d.getActivePaneState(),t=e.pageNumber;tn({state:!0,documentModel:!0,notVideo:!0},e)&&(this.selectTextStartPoint=new n(0,0),this.selectTextEndPoint=new n(e.getOriginalWidthForPage(t),e.getOriginalHeightForPage(t)),Y.getDragMode()===i.dragModes.selectText&&this.delayedPaintCanvases(),this.copySelectedText())},v.prototype.getSelectedTextRects=function(){var e=d.getActivePaneState();if(!this.selectTextStartPoint||!this.selectTextEndPoint||null===this.selectTextStartPoint||null===this.selectTextEndPoint)return[];var t=e.getPageText(e.pageNumber);if(t){var a=t.wordRects,o=[],i=new n(this.selectTextStartPoint.x,this.selectTextStartPoint.y),r=new n(this.selectTextEndPoint.x,this.selectTextEndPoint.y);if(r.y<i.y){var s=r;r=i,i=s}for(var l=0;l<a.length;l++)A(i,r,a[l],this.columnSelectionMode)&&o.push(a[l]);return o}};var Qa=function(e){return e.diffDisabled||e.diffDisabledUntilSave?virtualViewer.ocrEnabled&&!e.diffDisabledUntilSave?($(".vvDiffButton").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled"),void $("#vvToggleDiffHighlightingBtn").attr("aria-disabled","true").prop("disabled",!0).addClass("disabled")):($(".vvDiffButton").attr("aria-disabled","true").prop("disabled",!0).addClass("disabled"),void $("#vvLockScrollingBtn").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled")):void $(".vvDiffButton").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled")},ja=function(){var e,t=d.getCurrentDiff(),a=parseInt($(this).closest(".diffPageContainer").attr("pageNumber"),10);e=$(this).hasClass("vvChangeRemoved")?t.oldDocument.state:t.newDocument.state,virtualViewer.setActivePane(e.currentPaneIndex);var n=t.focusOnChange(a,parseInt($(this).data("changeIndex"),10));if(n&&n.length){var o=n[0];if(virtualViewer.setPageCore(a,e),e.getOriginalHeightForPage(a)){var i=o.top/e.getOriginalHeightForPage(a)*virtualViewer.getScrollSpeed(e),r=C.getOuterDivFromState(e),s=r.find(".vvScroller").width()-r.width();s<0&&(s=0);var l=(r.find(".vvCanvas").width()+s)/2,u=l-e.getRequestedWidthForPage(a)/2,c=u+o.left*e.getZoomDecimal();r.scrollLeft(c),r.scrollTop(i+virtualViewer.findPagePosition(a,e))}virtualViewer.paintCanvases()}},qa=function(e){var a=d.getCurrentDiff();Qa(a);var n=a.fillDiffPane(e,ja);if(!(n||$("#vvLoadMoreButton").length||a.diffDisabled||a.diffDisabledUntilSave)){var o=$("<button></button>").attr({id:"vvLoadMoreButton",type:"button"}).addClass("btn btn-secondary");o.append($("<img />").attr("src","resources/loader.gif")),o.append($("<span></span>").text(t.getLocalizedValue("documentCompare.loadMore","Load More"))),o.appendTo("#vvDocCompareInternal"),o.on("click",function(){var e,t=d.getCurrentState(0).pageNumber;e=$(".diffPageLoading[pageNumber='"+t+"']").length?t:$(".diffPageContainer").last().hasClass("diffPageLoading")?parseInt($(".diffPageContainer").last().attr("pageNumber"),10):parseInt($(".diffPageLoading").first().attr("pageNumber"),10);for(var a=s.continuousScrollBufferAfterSize||1,n=e+a,o=e;o<n;o++)o<d.getCurrentState(0).getPageCount()&&virtualViewer.getAllText(o,d.getCurrentState(0)),o<d.getCurrentState(1).getPageCount()&&virtualViewer.getAllText(o,d.getCurrentState(1))})}};v.prototype.mergeTextRects=function(e){for(var a=[],n=null,o=null,i=0;i<e.length;i++){var r=e[i],s=new t.ImageRect(r.left,r.top,r.right,r.bottom);if(null===n&&(n=s),null!==o){if(s.top===o.top){n.right=s.right,o=s;continue}a.push(n),n=s}o=s}return null!==n&&a.push(n),a},v.prototype.getSelectedText=function(){var e=this.getSelectedTextRects();if(e&&e.length){var t,a="",n=null,o=1e6;for(t=0;t<e.length;t++){var i=e[t];i.left<o&&(o=i.left)}for(t=0;t<e.length;t++){var r=e[t],s=r.word.indexOf(";");s!==-1&&(r.word=r.word.slice(0,s+1)),0===t&&(a=I(a,r,o)),null!==n&&(a=S(a,n,r,o),a=w(a,n,r)),0!==r.word.indexOf("%%%%EOT")&&(a+=r.word.indexOf(";")===-1?"&#"+r.word.charCodeAt(0)+";":r.word),n=r}return a}},v.prototype.getUserFriendlySelectedText=function(){var e=virtualViewer.getSelectedText(),t=$("#vvCopyTextContainer").html(e).text();return $("#vvCopyTextContainer").empty(),t},v.prototype.copyTextUserEventHandler=function(){var e=virtualViewer.getSelectedText();if(e&&s.copySelectedText){$("#vvCopyTextContainer").html(e).show();try{window.getSelection().selectAllChildren(document.getElementById("vvCopyTextContainer"));var t=document.execCommand("copy");t||virtualViewer.copySelectedText()}catch(e){virtualViewer.copySelectedText()}finally{$("#vvCopyTextContainer").hide()}}},v.prototype.copySelectedText=function(){if(s.copySelectedText){var e=virtualViewer.getSelectedText();T(e)}};var Ga=function(e,t,a,n){var o=d.getCurrentDiff();if(o&&o.showHighlights){var i,r,s,l;0===e?(i=o.getOldDocHighlightRects(t),r="rgba(238, 41, 77, 0.2)",o.changeInFocus.removed.page===t&&o.changeInFocus.removed.rects&&o.changeInFocus.removed.rects.length&&(s=o.changeInFocus.removed.rects,l="rgba(238, 41, 77, 0.4)")):(i=o.getNewDocHighlightRects(t),r="rgba(93, 223, 134, 0.2)",o.changeInFocus.added.page===t&&o.changeInFocus.added.rects&&o.changeInFocus.added.rects.length&&(s=o.changeInFocus.added.rects,l="rgba(93, 223, 134, 0.4)"));var u=d.getCurrentState(e);Ya(i,n,r,u),s&&Ya(s,n,l,u)}},Ya=function(e,t,a,n){for(var o=0;o<e.length;o++){e[o].length||C.highlightImageRect(e[o],t,a,n);for(var i=0;i<e[o].length;i++)C.highlightImageRect(e[o][i],t,a,n)}},Xa=function(e,t,a){if(Y.dragMode===i.dragModes.selectText&&C.textSelectionAllowed()){t.lineWidth=2;var n=C.getSelectedTextRects();if(n){var o=C.mergeTextRects(n);0!==o.length&&Za(o,e,t,i.selectedTextColor,a)}}},Za=function(e,t,a,n,o){if(e&&e.length){C.highlightImageRect(e[0],a,n,o);var i=new r(0,0,0,0);if(e.length>2)for(i.top=1e6,i.bottom=0,i.left=1e6,i.right=0,vIndex=1;vIndex<e.length-1;vIndex++){var s=e[vIndex];i.top=Math.min(s.top,i.top),i.bottom=Math.max(s.bottom,i.bottom),i.left=Math.min(s.left,i.left),i.right=Math.max(s.right,i.right),C.highlightImageRect(s,a,n,o)}if(e.length>1){var l=e[e.length-1];C.highlightImageRect(l,a,n,o)}}};v.prototype.highlightImageRect=function(e,t,a,n){n=n||C.getActivePaneState();var o=n.getZoom()/100,i=e.top*o,s=e.bottom*o,l=e.left*o,u=e.right*o,d=new r(l,i,u-l,s-i);t.strokeStyle=a,t.fillStyle=a,t.beginPath(),t.moveTo(d.getX1(),d.getY1()),t.lineTo(d.getX2(),d.getY1()),t.lineTo(d.getX2(),d.getY2()),t.lineTo(d.getX1(),d.getY2()),t.closePath(),t.fill()},v.prototype.updateGuidePositions=function(e){return D(e)};var Ka=function(e,t,a,n){if(virtualViewer.horizontalGuide&&virtualViewer.horizontalGuide.visible&&e&&t){t.save();var o=a.getRequestedWidthForPage(n),i=a.getRequestedHeightForPage(n);90!==a.getRotationForPage(n)&&270!==a.getRotationForPage(n)||(o=i,i=a.getRequestedWidthForPage(n));var r=0,s=Math.max(virtualViewer.horizontalGuide.value,1);s=Math.min(s,i);var l=o,u=s;virtualViewer.horizontalGuide.locked?t.strokeStyle=he:t.strokeStyle=pe,t.beginPath(),t.moveTo(r,s),t.lineTo(l,u),t.lineWidth=ve,t.stroke(),t.restore()}},Ja=function(e,t){if(t.save(),virtualViewer.verticalGuide&&virtualViewer.verticalGuide.visible&&e&&t){var a=Math.max(virtualViewer.verticalGuide.value,1),n=0,o=a,i=e.height;virtualViewer.verticalGuide.locked?t.strokeStyle=he:t.strokeStyle=pe,t.beginPath(),t.moveTo(a,n),t.lineTo(o,i),t.lineWidth=ve,t.stroke(),t.restore()}};v.prototype.countPagesForDocument=function(e,t){var a=-1,n=new URI(s.servletPath);n.addQuery("action","countPages"),n.addQuery("documentId",e),n.addQuery("clientInstanceId",t);var o=n.query();return n.query(""),$.ajax({url:n.toString(),async:!1,type:"POST",data:o,dataType:"json",success:function(e){a=e.pageCount},error:function(t){virtualViewer.checkServerException(t,e)}}),a},v.prototype.addPageToSelection=function(e){var t=C.getCurrentState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getDocumentModel();a.addPageToSelection(e)}},v.prototype.removePageFromSelection=function(e){var t=C.getCurrentState();if(tn({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getDocumentModel();a.removePageFromSelection(e)}},v.prototype.disabledToolbarOptionDialog=function(e,t){var a,n,o=e;switch(o){case"save":n=t?t:"Saving this Document is not allowed.",a="Cannot Save Document";break;case"export":n=t?t:"Exporting this Document is not allowed.",a="Cannot Export Document";break;case"send":n=t?t:"Sending this Document is not allowed.",a="Cannot Send Document";break;case"print":n=t?t:"Printing this Document is not allowed.",a="Cannot Print Document"}$("#vvDisableToolbarDialogText").html(n),$("#vvDisableToolbarDialogTitle").html(a),$("#vvDisableToolbarDialog").modal("show")},v.prototype.setOverlayPath=function(e){ce=e},v.prototype.getOverlayPath=function(){return ce},v.prototype.checkPageManipulationsEnabled=function(e,a){var n=null,o=!0;if(C.pageManipulationsEnabled){if(C.getDocumentModel()&&C.getDocumentModel().hasRedactions())n=t.getLocalizedValue("pageManipulations.redactions","Page Manipulations are currently not supported in documents containing redactions."),o=!1;else if(c.searchInProgress())n=t.getLocalizedValue("pageManipulations.searchInProgress","Page Manipulations are disabled while a document search is in progress."),o=!1;else if(a||(a=d.getActivePaneState()),a)for(var i,r,l=0;l<s.restrictedPageManipulationFormats.length;l++)a.getFormatForPage(a.getPageNumber())&&(i=a.getFormatForPage(a.getPageNumber()).toUpperCase()),r=s.restrictedPageManipulationFormats[l].toUpperCase(),i===r&&(n=t.getLocalizedValue("pageManipulations.restrictedFormat","Page Manipulations are disabled for this document format."),o=!1)}else n=t.getLocalizedValue("pageManipulations.disabled","Page Manipulations have been disabled by the administrator in the configuration."),o=!1;if(e&&!o){var u={client:!0,disable:C.disableErrorModals.adminDisabled};vt(n,u)}return o},v.prototype.setPageManipulationsEnabled=function(e){return C.pageManipulationsEnabled=e,C.pageManipulationsEnabled},v.prototype.setAnnotationsEnabled=function(e){return C.annotationsEnabled=e,C.annotationsEnabled},v.prototype.setRedactionsEnabled=function(e){return C.redactionsEnabled=e,Re(),C.redactionsEnabled},v.prototype.checkAnnotationsEnabled=function(e){var a=null;return C.annotationsEnabled||(a=t.getLocalizedValue("errors.annotationsDisabled","Annotations have been disabled by the administrator in the configuration.")),e&&!C.annotationsEnabled&&alert(a),C.annotationsEnabled},v.prototype.checkRedactionsEnabled=function(e){var a=null;return C.redactionsEnabled||(a=t.getLocalizedValue("errors.redactionsDisabled","Redactions have been disabled by the administrator in the configuration."),$("#vvRedactionRectButton").attr("aria-disabled",!0)),e&&!C.redactionsEnabled&&alert(a),C.redactionsEnabled},v.prototype.toggleMagnifier=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&(X.call("magnifierBegin",{documentId:d.getActivePaneState(),currentPage:d.getActivePaneState().pageNumber,magnifierActive:G.getMagnifierEnabled()}),G.setMagnifierEnabled(!G.getMagnifierEnabled()),G.magnifierHandler(),X.call("magnifier",{documentId:d.getActivePaneState(),currentPage:d.getActivePaneState().pageNumber,magnifierActive:G.getMagnifierEnabled()}))},v.prototype.showMagnifierWindow=function(){d.isVideoOpen()||(G.setMagnifierEnabled(!0),G.magnifierHandler())},v.prototype.hideMagnifierWindow=function(){d.isVideoOpen()||(G.setMagnifierEnabled(!1),G.magnifierHandler())},v.prototype.setMagnifierPosition=function(e,t){if(tn({state:!0,notVideo:!0})){var a=$("#vvMagnifierCanvas");a.css("left",e),a.css("top",t),G.paintMagnifierCanvas()}},v.prototype.addBookmark=function(e,t){return!!tn({state:!0,documentModel:!0,notVideo:!0})&&Q.addBookmark(e,t,!1,!1)},v.prototype.deleteBookmark=function(e){return!!tn({state:!0,documentModel:!0,notVideo:!0})&&(null!==e&&void 0!==e&&(Q.deleteBookmark(null,e,!1),!0))},v.prototype.editBookmark=function(e){return!!tn({state:!0,documentModel:!0,notVideo:!0})&&(null!==e&&void 0!==e&&Q.editBookmark(e))},v.prototype.getMediaPlayer=function(){var e=virtualViewer.getActivePaneState();return tn({state:!0,yesMedia:!0},e)?e.getMediaManager().player:null},v.prototype.playMedia=function(){var e=virtualViewer.getActivePaneState();return!!tn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.play(),!0)},v.prototype.playVideo=function(){virtualViewer.playMedia()},v.prototype.playAudio=function(){virtualViewer.playMedia()},v.prototype.pauseMedia=function(){var e=virtualViewer.getActivePaneState();return!!tn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.pause(),!0)},v.prototype.pauseVideo=function(){virtualViewer.pauseMedia()},v.prototype.pauseAudio=function(){virtualViewer.pauseMedia()},v.prototype.setMediaPlaybackSpeed=function(e){var t=virtualViewer.getActivePaneState();if(!tn({state:!0,yesMedia:!0},t))return!1;var a=t.getMediaManager().player;return e=e||1,a.playbackRate=e,!0},v.prototype.setVideoPlaybackSpeed=function(e){virtualViewer.setMediaPlaybackSpeed(e)},v.prototype.setAudioPlaybackSpeed=function(e){virtualViewer.setMediaPlaybackSpeed(e)},v.prototype.fastForwardMedia=function(){var e=virtualViewer.getActivePaneState();return!!tn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.playbackRate=2,!0)},v.prototype.fastForwardVideo=function(){virtualViewer.fastForwardMedia()},v.prototype.fastForwardAudio=function(){virtualViewer.fastForwardMedia()},v.prototype.setMediaTime=function(e){var t=virtualViewer.getActivePaneState();if(!tn({state:!0,yesMedia:!0},t))return null;var a=t.getMediaManager().player;return e=e||0,a.currentTime=e,e},v.prototype.setAudioTime=function(e){virtualViewer.setMediaTime(e)},v.prototype.setVideoTime=function(e){virtualViewer.setMediaTime(e)},v.prototype.resetMediaSpeed=function(){var e=virtualViewer.getActivePaneState();return!!tn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.playbackRate=1,!0)},v.prototype.getBookmarks=function(){return Q},v.prototype.getEventManager=function(){return Y},v.prototype.getCurrentAnnType=function(){return E},v.prototype.setCurrentAnnType=function(e){E=e},v.prototype.getCurrentStickyAnnType=function(){return J},v.prototype.removeDocumentFromCache=function(e,t){var a=new URI(s.servletPath);a.addQuery("action","removeDocumentFromCache"),a.addQuery("documentId",e),void 0!==t?a.addQuery("clientInstanceId",t):a.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),i.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query(""),$.ajax({url:a.toString(),type:"POST",data:n,dataType:"json",success:function(e){gt(e)===!0},error:function(t){gt(t,e)===!0}})},v.prototype.seedCache=function(e,t,a){if(!e)return!1;var n=new URI(s.servletPath);n.addQuery("action","seedCache"),n.addQuery("documentId",e),void 0!==a?n.addQuery("clientInstanceId",a):n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t||(t=[]),n.addQuery("pages",t.toString());var o=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",data:o,dataType:"json",success:function(e){
gt(e)===!0},error:function(t){gt(t,e)===!0}})},v.prototype.enterOverlayDragMode=function(){tn({state:!0,documentModel:!0,notVideo:!0})&&this.setDragMode(i.dragModes.overlay)},v.prototype.exitOverlayDragMode=function(){this.setDragMode(i.dragModes.pan)},v.prototype.moveOverlayImagesTogether=function(e){var t=d.getActivePaneState();if(tn({state:!0,notVideo:!0},t)){var a=t.getImageManager();a.pageLockOverlayOffset.locked=!!e}},v.prototype.removeOverlayFromPage=function(e){var t=d.getActivePaneState();if(tn({state:!0,notVideo:!0},t)&&t.getImageManager().overlayImage&&e===t.validatePageNumber(e)){var a=t.getImageManager();return a.overlayDataArray[e]=null,this.delayedPaintCanvases(),e}},v.prototype.addOverlayToPage=function(e,t){var a=d.getActivePaneState();if(tn({state:!0,notVideo:!0},a)&&e===a.validatePageNumber(e)){var n=a.getImageManager();return n.overlayImage&&t===n.overlayDocumentId?(null===n.overlayDataArray[e]&&(n.overlayDataArray[e]=void 0),this.delayedPaintCanvases(),e):this.getOverlayImage(t,{pages:[e]})}},v.prototype.clearOverlayImage=function(){var e=d.getActivePaneState();if(tn({state:!0,notVideo:!0},e)){var t=e.getImageManager();t.cleanOverlayOffset(),t.overlayImage=null,t.overlayDocumentId=null,t.overlayImageStripped=!1,this.delayedPaintCanvases()}},v.prototype.getOverlayImage=function(e,t){"use strict";var a=d.getActivePaneState();if(tn({state:!0,notVideo:!0},a)&&e){var n=a.getImageManager();if(t=t||{},t.lockOverlayMovement===!1?n.pageLockOverlayOffset.locked=!1:n.cleanOverlayOffset(),n.overlayDocumentId===e)return en(n,t.pages,a),void this.delayedPaintCanvases();n.requestOverlayImage(e,a),en(n,t.pages,a)}};var en=function(e,t,a){"use strict";if(!t)return void(e.overlayDataArray=[]);t.sort(function(e,t){return e||0===e?e-t:1});for(var n=0,o=0;o<a.getPageCount();o++)t[n]===o?(e.overlayDataArray[o]=void 0,n++):e.overlayDataArray[o]=null},tn=function(e,a){var n=null;if(a=a||d.getActivePaneState(),(e.state||e.documentModel)&&(!a||!a.getImageManager())){n=t.getLocalizedValue("errors.documentFullyLoaded","A document must be fully loaded in the viewer.");var o={disable:!0};return virtualViewer.displayExceptionMessage(n,o),!1}if(a=a||{},!e.documentModel||a.documentFullyLoaded()&&a.getDocumentModel()||(n=t.getLocalizedValue("errors.documentFullyLoaded","A document must be fully loaded in the viewer.")),e.notPageLimited&&a.xlsxPageLimited&&(n=t.getLocalizedValue("errors.notPageLimited","This API function may not be used on an XLSX document that is configured to show a limited number of pages.")),e.notVideo&&a.isMedia()&&(n=t.getLocalizedValue("errors.notVideo","This API function may not be called on video or audio documents.")),e.notSplit&&ae&&(n=t.getLocalizedValue("errors.notSplit","This API function may not be called when the viewer is in split pane mode.")),!e.yesMedia||a.isMedia()&&a.getMediaManager()||(n=t.getLocalizedValue("errors.yesVideo","This API function must be called on a video or audio document.")),null!==n){var o={disable:!0};return virtualViewer.displayExceptionMessage(n,o),!1}return!0};v.prototype.encodeForHTML=function(e){return String(e).replace(/[&<> \/"'`=]/g,function(e){return an[e]})};var an={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"," ":"&nbsp;"};return v.prototype.filterDocumentThumbsByDisplayName=function(t){e("vvThumbs").filterDocumentThumbsByDisplayName(t)},v.prototype.loggingOverride=function(e){return"undefined"!=typeof e&&(this.overrideLoggingLevel=!!e),this.overrideLoggingLevel},v.prototype.isRedaction=function(e){var a=u.getLayerWithAnn(e);return!!t.isRedactionLayer(a)},v.prototype.lockViewBetweenDocuments=function(){s.previousBetweenDocumentSettings={fitLast:s.fitLastBetweenDocuments,positionLast:s.positionLastBetweenDocuments},s.fitLastBetweenDocuments=!0,s.positionLastBetweenDocuments=!0},v.prototype.unlockViewBetweenDocuments=function(){var e=s.previousBetweenDocumentSettings;e?(s.fitLastBetweenDocuments=e.fitLast,s.positionLastBetweenDocuments=e.positionLast):(s.fitLastBetweenDocuments=!1,s.positionLastBetweenDocuments=!1)},v});var virtualViewer,myFlexSnap,vvConfig;requirejs.config({baseUrl:"js",paths:{"user-config":"../user-config"}}),requirejs(["3rdparty/domReady!","webviewer","user-config/config"],function(e,t){vvConfig=require("user-config/config"),virtualViewer=new t,myFlexSnap=virtualViewer;var a=!1;if("function"==typeof beforeVirtualViewerInit){var n=beforeVirtualViewerInit();a=!!n}a||(virtualViewer.isInitialized()||virtualViewer.initViaURL(),"function"==typeof afterVirtualViewerInit&&afterVirtualViewerInit())}),define("virtualviewer-main",function(){}),define("virtualviewer-built",function(){});