/**
 * @license RequireJS domReady 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/domReady for details
 */

/*! https://mths.be/startswith v0.2.0 by @mathias */

define("3rdparty/domReady",[],function(){"use strict";function e(e){var t;for(t=0;t<e.length;t+=1)e[t](u)}function t(){var t=d;l&&t.length&&(d=[],e(t))}function a(){l||(l=!0,r&&clearInterval(r),t())}function n(e){return l?e(u):d.push(e),n}var o,i,r,s="undefined"!=typeof window&&window.document,l=!s,u=s?document:null,d=[];if(s){if(document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1);else if(window.attachEvent){window.attachEvent("onload",a),i=document.createElement("div");try{o=null===window.frameElement}catch(e){}i.doScroll&&o&&window.external&&(r=setInterval(function(){try{i.doScroll(),a()}catch(e){}},30))}"complete"===document.readyState&&a()}return n.version="2.0.1",n.load=function(e,t,a,o){o.isBuild?a(null):n(a)},n}),define("vvPoint",[],function(){function e(e,t){this.x=e,this.y=t}return e.prototype.getX=function(){return this.x},e.prototype.setX=function(e){this.x=e},e.prototype.getY=function(){return this.y},e.prototype.setY=function(e){this.y=e},e.prototype.rotate=function(e,t,a){var n=this.getX(),o=this.getY(),i=e;e===-90?i=270:e===-180?i=180:e===-270&&(i=90),90===i?(this.setX(t-o),this.setY(n)):180===i?(this.setX(t-n),this.setY(a-o)):270===i&&(this.setX(o),this.setY(a-n))},e.prototype.unrotate=function(e,t,a){var n=e;90===e?n=270:180===e?n=180:270===e&&(n=90),this.rotate(n,t,a)},e}),define("vvUtility",["user-config/config","vvDefines","vvPoint"],function(e,t,a){!function(){String.prototype.startsWith||!function(){"use strict";var e=function(){try{var e={},t=Object.defineProperty,a=t(e,e,e)&&t}catch(e){}return a}(),t={}.toString,a=function(e){if(null==this)throw TypeError();var a=String(this);if(e&&"[object RegExp]"==t.call(e))throw TypeError();var n=a.length,o=String(e),i=o.length,r=arguments.length>1?arguments[1]:void 0,s=r?Number(r):0;s!=s&&(s=0);var l=Math.min(Math.max(s,0),n);if(i+l>n)return!1;for(var u=-1;++u<i;)if(a.charCodeAt(l+u)!=o.charCodeAt(u))return!1;return!0};e?e(String.prototype,"startsWith",{value:a,configurable:!0,writable:!0}):String.prototype.startsWith=a}(),Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";var t=Object(this),a=parseInt(t.length)||0;if(0===a)return!1;var n,o=parseInt(arguments[1])||0;o>=0?n=o:(n=a+o,n<0&&(n=0));for(var i;n<a;){if(i=t[n],e===i||e!==e&&i!==i)return!0;n++}return!1}),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&this.indexOf(e,t)!==-1}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:function(e,t){return new Uint8Array(Array.prototype.slice.call(this,e,t))}}),function(){"use strict";var e=/[-\/\\^$*+?.()|[\]{}]/g;RegExp.escape=function(t){return t.replace(e,"\\$&")}}(),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){"use strict";if(null===e||void 0===e)throw new TypeError("Cannot convert undefined or null to object");for(var a=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!==o&&void 0!==o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(a[i]=o[i])}return a},writable:!0,configurable:!0})}();var n=function(e){"use strict";return e*(Math.PI/180)},o=function(e){"use strict";return e*(180/Math.PI)},i=function(e){1===e.nodeType&&e.setAttribute("unselectable","on");for(var t=e.firstChild;t;)i(t),t=t.nextSibling},r=function(){let a=[];return t.fontNames&&t.fontNames.length&&(a=t.fontNames),e.fontNames&&e.fontNames.length&&(a=a.concat(e.fontNames)),a},s=function(e){"use strict";for(var a=t.fontSizes,n=0;n<a.length;n+=1){if(e===a[n])return e;if(e<a[n]&&n>0){var o=Math.abs(e-a[n-1]),i=Math.abs(e-a[n]);return o>i?a[n]:a[n-1]}if(e>a[n]&&n===a.length-1)return a[n]}},l=function(){"use strict";return Modernizr.touchevents?e.polygonNubSizeTouch||40:e.polygonNubSize||10},u=function(e){"use strict";return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},d=function(){"use strict";p();var e=$("#vvSplitPaneDiv");e.addClass("grabCursorOpen")},c=function(){"use strict";p();var e=$("#vvSplitPaneDiv");e.addClass("grabCursorClosed")},g=function(){"use strict";p();var e=$("#vvSplitPaneDiv");e.addClass("selectTextCursor")},v=function(){"use strict";p();var e=$("#vvSplitPaneDiv");e.addClass("guidesCursor")},p=function(){"use strict";var e=$("#vvSplitPaneDiv");e.removeClass("guidesCursor selectTextCursor grabCursorClosed grabCursorOpen pointerCursor")},h=function(){"use strict";var e=$("#vvSplitPaneDiv");e.addClass("pointerCursor")},m=function(e,t){"use strict";var a,n,o,i;for(a=e.split(/\./),n=$.localize.data.vv,o=0,i=a.length;o<i;o++)e=a[o],n=n?n[e]:null;if(!n&&t)n=t;else if(!n)return{};return n},f=function(e,t){var a=m(e,t);return $("<div />").html(a).text()},y=function(e,t,a){"use strict";return{r:e,g:t,b:a}},b=function(e){"use strict";var t=parseInt(e.substring(0,2),16),a=parseInt(e.substring(2,4),16),n=parseInt(e.substring(4,6),16);return y(t,a,n)},P=function(e,t){"use strict";var a=b(e),n=a.r,o=a.g,i=a.b;return"number"==typeof t?"rgba("+n+","+o+","+i+","+t+")":"rgb("+n+","+o+","+i+")"},T=function(e){"use strict";var t=document.createElement("canvas"),a=e.width,n=e.height;t.width=a,t.height=n;var o=t.getContext("2d");o.drawImage(e,0,0,a,n);for(var i=o.getImageData(0,0,a,n),r=i.data,s=0,l=1,u=2,d=3,c=0;c<r.length;c+=4)255===r[c+s]&&255===r[c+l]&&255===r[c+u]&&(r[c+d]=0);return o.putImageData(i,0,0),t.toDataURL("image/png")},A=function(e){"use strict";return!(!e||"true"!==e)},I=function(e){"use strict";var t=[];if(e){e=e.split(";");for(var n=0;n<e.length;n+=1){var o=e[n].split(",");t[n]=new a(parseInt(o[0],10),parseInt(o[1],10))}}return t},S=function(e){"use strict";for(var t="",a=0;a<e.length;a+=1)t+=e[a].getX(),t+=",",t+=e[a].getY(),a!==e.length-1&&(t+=";");return t},w=function(e){"use strict";for(var t=[],a=e.getElementsByTagName("Note").length,n=0;n<a;n++){var o=e.getElementsByTagName("Note")[n],i={userId:decodeURIComponent($(o.getElementsByTagName("userId")[0]).text()),createDate:$(o.getElementsByTagName("createDate")[0]).text(),editDate:$(o.getElementsByTagName("modifyDate")[0]).text(),text:decodeURIComponent($(o.getElementsByTagName("noteText")[0]).text()),idxFlag:$(o.getElementsByTagName("idxFlag")[0]).text()};t.push(i)}return t},C=function(e){"use strict";for(var t=[],a=e.getElementsByTagName("tag").length,n=0;n<a;n++){var o=e.getElementsByTagName("tag")[n];t.push(decodeURIComponent($(o).text()))}return t},D=function(e,t){"use strict";var a=e.getElementsByTagName(t)[0];return a?$(a).text():null},M=function(e){"use strict";return""===e||"auto"===e?0:parseFloat(e.substring(0,e.length-2))},x=function(e,t){"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9?"collapse"===t||"hidden"===t?e.style.display="none":e.style.display="":e.style.visibility=t},L=function(e){"use strict";e||(e=window.event),e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation()},N=function(e,t,a,n){if(!a&&!n)throw"An error occurred translating rectangle dimensions";n=n||{};var o=new V(0,0,0,0),i=n.pageWidth,r=n.pageHeight;return a&&(i=a.getOriginalWidthForPage(t)||n.pageWidth,r=a.getOriginalHeightForPage(t)||n.pageHeight),o.top=e.top*r,o.bottom=e.bottom*r,o.left=e.left*i,o.right=e.right*i,o},V=function(e,t,a,n){this.left=e,this.top=t,this.right=a,this.bottom=n,this.intersects=function(e){return!(e.left>this.right||e.right<this.left||e.top>this.bottom||e.bottom<this.top)},this.width=function(){return this.right-this.left},this.height=function(){return this.bottom-this.top}},k=function(e){"use strict";var t=e.replace(/\&/g,"&amp;");return t},F={SIXTY_FOUR_CHARS:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",REVERSE_MAPPING:[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,63,void 0,void 0,void 0,64,53,54,55,56,57,58,59,60,61,62,void 0,void 0,void 0,void 0,void 0,void 0,void 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,void 0,void 0,void 0,void 0,void 0,void 0,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],encode:function(e){var t="";if(!e)return null;e=this.stringToBytes(e);for(var a=e.length,n=0;n<a;n+=3)for(var o=Math.min(3,a-n),i=(255&e[n])<<16|(o<=1?0:255&e[n+1])<<8|(o<=2?0:255&e[n+2]),r=0;r<4;r++)t+=o+1>r?this.SIXTY_FOUR_CHARS.charAt(63&i>>6*(3-r)):"=";return t.toString()},decode:function(e){var t=[];if(!e)return null;for(var a=0;a<e.length;a+=4){"\n"===e.charAt(a)&&(a+=1);for(var n=[this.mapCharToInt(e.charAt(a)),this.mapCharToInt(e.charAt(a+1)),this.mapCharToInt(e.charAt(a+2)),this.mapCharToInt(e.charAt(a+3))],o=(63&n[0])<<18|(63&n[1])<<12|(63&n[2])<<6|63&n[3],i=0;i<3;i++)n[i+1]>=0&&t.push(255&o>>8*(2-i))}for(var r="",s=0;s<t.length;s+=2)r+=this.fixedFromCharCode(this.getWordAt(t,s));return r},mapCharToInt:function(e){if(!e)return-1;var t=this.REVERSE_MAPPING[e.charCodeAt(0)];return 0!==t?t-1:-1},fixedFromCharCode:function(e){return e>65535?(e-=65536,String.fromCharCode(55296+(e>>10),56320+(1023&e))):String.fromCharCode(e)},getWordAt:function(e,t){return(e[t+0]<<8)+e[t+1]},stringToBytes:function(e){for(var t,a,n=[],o=0;o<e.length;o++)if(t=e.charCodeAt(o),a=[],t>255){do a.push(255&t),t>>=8;while(t);n=n.concat(a.reverse())}else n.push(0),n.push(t);return n}},R=function(e){"use strict";var t="vvTextAnnotation-"+e.getLayerName().replace(/[\W]/g,"")+"-"+e.page+"-"+e.getOrdinal();return t},B=function(e){"use strict";return moment(e).format("YYYY-MM-DDTHH:mm:ss.SSZZ")},E=function(e){"use strict";var t={};if(null===e)return null;if(void 0!==e){if(e.vvDeadEnd===!0||"object"==typeof e&&"string"==typeof e.jquery)return null;if("object"==typeof e){"undefined"!=typeof e.length&&(t=[]);for(var a in e)"object"==typeof e[a]?t[a]=E(e[a]):"string"==typeof e[a]?t[a]=e[a]:"number"==typeof e[a]?t[a]=e[a]:"boolean"==typeof e[a]?e[a]===!0?t[a]=!0:t[a]=!1:"function"==typeof e[a]&&(t[a]=e[a])}return t}},O=function(e,t,a){"use strict";if(!a)return"State object is required";var n=a.getPageCount();if("complex"===e){if(!t)return f("errors.complexRangeEmpty","Blank complex page range");for(var o=t.split(","),i=0;i<o.length;i++)for(var r=o[i],s=r.split("-"),l=0;l<s.length;l++){var u=+s[l];if(isNaN(u))return f("errors.complexRangeInvalidCharacter","Invalid character in complex page range:")+" "+u;if(u>n||u<1)return f("errors.complexRangePageOutOfBounds","One or more of the pages in the selected range are out of bounds");if(l<s.length-1&&u>+s[l+1])return f("errors.complexRangeUnsupportedSyntax","Incorrect syntax for the pages, make sure the lower number is on the left side of the dash.")}}return"OK"},_=function(e,t,a){"use strict";if(!a)return"State object is required";var n=a.getPageCount(),o=[];if("complex"===e)for(var i=t.split(","),r=0;r<i.length;r++){var s=i[r],l=s.split("-");if(1===l.length)o.push(+s-1);else for(var u=+l[0],d=+l[1],c=u;c<=d;c+=1)o.push(+c-1)}else if("all"===e)for(var g=0;g<n;g+=1)o.push(+g);else"current"===e&&o.push(+a.getPageNumber());return o},U=function(e){"use strict";for(var t=$(e).serializeArray(),a={},n=0;n<t.length;n++){var o=t[n];"true"===o.value?a[o.name]=!0:"false"===o.value?a[o.name]=!1:a[o.name]=o.value}return a},z=function(e,t){var a=t[0].x,n=t[0].y,o=t[1].x,i=t[1].y;if(o===a)return Math.abs(e.x-a);if(i===n)return Math.abs(e.y-n);var r=(i-n)/(o-a),s=i-r*o,l=Math.abs(s+r*e.x-e.y),u=Math.sqrt(1+Math.pow(r,2));return l/u},W=function(e){"use strict";return moment(e).format("ddd MMM D YYYY h:mm:ss A")},H=function(e){if(!e.canvas)throw"A canvas is required";if(!e.image)throw"Image is required";var t=e.canvas,a=t.getContext("2d"),n=e.image,o=e.srcx||0,i=e.srcy||0,r=e.srcw||n.naturalWidth,s=e.srch||n.naturalHeight,l=e.desx||o,u=e.desy||i,d=e.desw||r,c=e.desh||s,g=e.auto,v=window.devicePixelRatio||1,p=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1,h=v/p;if("undefined"==typeof g&&(g=!0),g&&v!==p){var m=t.width,f=t.height;t.width=m*h,t.height=f*h,t.style.width=m+"px",t.style.height=f+"px",a.scale(h,h)}a.drawImage(n,o,i,r,s,l,u,d,c)},j=function(){"use strict";return!("Explorer"===BrowserDetect.browser&&BrowserDetect.version<=8)&&($("body").tooltip({trigger:"hover focus",show:!1,hide:!1,selector:'[data-tooltip="tooltip"]'}),!0)},Q=function(e){"use strict";return"string"==typeof e&&0===e.indexOf(t.redactionLayerPrefix)||(!(!e.displayName||0!==e.displayName.indexOf(t.redactionLayerPrefix))||(!(!e.layerName||0!==e.layerName.indexOf(t.redactionLayerPrefix))||!(!e.annotationId||0!==e.annotationId.indexOf(t.redactionLayerPrefix))))},q=function(e){"use strict";return 0===e.indexOf("VirtualDocument:")},G=function(e,t){var a=function(e,a,n){return t.indexOf(e)>-1};return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every(a)},Y=function(e){var t=new RegExp(/^VirtualDocument:([^,\[\]]*)(\[([0-9\-]+)\])?/),a=t.exec(e);if(a&&a.length){var n=a[3],o=0;return n&&(o=parseInt(n)-1),{documentId:a[1],pageIndex:o}}},X=function(e){"use strict";var t=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,a=new RegExp(t);return a.test(e)},Z=function(e){var t=/^"?[a-z]{2}(-[A-Z]{2})?"?$/;return t.test(e)},K=function(e){"use strict";if(!e||e.length<=0)return"";for(var t=e.sort(function(e,t){return e-t}),a="",n=null,o=0;o<t.length;o++)o+1<t.length&&t[o+1]-t[o]===1?null===n&&(n=t[o]):null!==n?(a+=n+1+" - "+(t[o]+1)+", ",n=null):a+=t[o]+1+", ";return a.length>2&&(a=a.substr(0,a.length-2)),a},J=function(e,t){"use strict";var a=[];try{e=e.replace(/\s/g,"");for(var n=e.split(","),o=0;o<n.length;o++){var i=n[o];if(i.includes("-"))for(var r=i.indexOf("-"),s=i.substring(0,r),l=i.substring(r+1),u=parseInt(s)-1,d=parseInt(l)-1,c=u;c<=d;c++)a.push(c);else{var g=parseInt(i)-1;if(!(g<t)){var v="Page "+g+" does not exist.";throw v}a.push(g)}}}catch(e){"string"==typeof e?console.log(e):console.log("Invalid Complex Range")}return a},ee=function(){"use strict";var e=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},te=function(e){if(!e||e.length<4)return!1;e=e.toUpperCase();var t=e.substring(e.length-4);switch(t){case".MOV":case".MP4":case".OGG":case"WEBM":case".MKV":case".M4V":case".OGV":case".MP3":case".M4A":case".FLAC":case".OGG":case".WAV":return!0;default:return!1}},ae=function(e){"use strict";var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"," ":"&nbsp;"};return String(e).replace(/[&<> \/"'`=]/g,function(e){return t[e]})},ne=function(e){return!(!e||!e.src||""===e.src||e.src.indexOf("data:")===-1)||!(!e||!e.src||e.src.indexOf(t.bogusImageURL)!==-1)},oe=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},ie=function(e){e=$(e)[0];var t=document.createElement("iframe");t.id="iFrameEl",t.src="about:blank",document.body.appendChild(t);var a=document.createElement("form");a.id="FormEl",a.method="post",a.autocomplete="on";var n=t.contentWindow;n.document.body.appendChild(a),a.appendChild(e.cloneNode(!0)),a.onsubmit=null,a.submit(),document.body.removeChild(t)};isHex=function(e){var t=/^([a-fA-F0-9]{6})$/;return!!t.test(e)};var re=function(e){let t=null;try{var a=new Uint8Array(e),n=(new TextDecoder).decode(a);try{t=JSON.parse(n)}catch(e){return null}}catch(e){return null}return t};return jQuery.fn.extend({preventFocusOutlineOnClick:function(){var e=!1;return this.mousedown(function(){e=!0}).mouseleave(function(t){e=!1}).mouseup(function(t){e=!1}).focus(function(t){e&&$(t.target).addClass("unfocus")}).blur(function(e){$(e.target).removeClass("unfocus")})}}),{validImageObject:ne,degreesToRadians:n,radiansToDegrees:o,findClosestFontSize:s,getNubSize:l,toTitleCase:u,Color:y,getColor:b,parseColorString:P,whiteToTransparent:T,fixBooleanString:A,parsePointArray:I,generatePointArrayString:S,parseAnnNotes:w,parseAnnTags:C,getValue:D,stripPx:M,setElementVisibility:x,cursorGrabOpen:d,cursorGrabClosed:c,cursorSelectText:g,cursorGuides:v,cursorAnnotate:v,cursorNormal:p,cursorPointer:h,cancelEventBubbling:L,xmlEncodeEntities:k,deepObjCopy:E,getLocalizedValue:f,getLocalizedValueObject:m,validatePageRangeInput:O,normalizePageRangeInput:_,getFormData:U,Base64:F,getTextAnnDOMId:R,toSnowDateString:B,createAnnTimeStamp:W,drawImage:H,enableTooltips:j,isRedactionLayer:Q,isVirtualDocument:q,arrayEquals:G,getVirtualDocumentFirstPageInfo:Y,isValidEmailAddress:X,isValidISOCode:Z,createComplexPageString:K,parseComplexPageString:J,vvGUID:ee,mediaExtensionCheck:te,encodeForHTML:ae,makeUnselectable:i,ImageRect:V,getDistanceFromPointToLine:z,isInteger:oe,getPixelImageRectFromPercents:N,addToAutoComplete:ie,isHex:isHex,tryParseJsonFromBuffer:re,fontNames:r}}),define("vvDocViewStateElement",[],function(){function e(e){this.flipHorizontal=!1,this.flipVertical=!1,this.annotationLayers=void 0,this.dpi=void 0,this.bitDepth=0,this.compressionType="N/A",this.isBad=!1,this.isModified=!1,this.imageFormat="N/A",this.tiffTagHash={},this.originalWidth=0,this.originalHeight=0,this.requestedWidth=0,this.requestedHeight=0,this.scrollLeft=null,this.scrollTop=null,this.searchResults=null,this.pageText=null,this.isSearchable=!1,this.sortedLinks=null,this.undoObject={unchangedAnn:void 0,modifiedAnn:void 0,referenceAnn:void 0,layer:void 0,type:void 0},this.undoObjectArray=[],this.undoIndex=-1,this.poppedObjectArray=[],this.poppedIndex=-1,this.newTextAnn=!1,this.pageAlreadyRendered=!1,this.preferSVG=!0,this.imageInfoRequested=!1,this.imageInfoLoaded=!1}return e.prototype.initPageStateFromObject=function(e){this.flipHorizontal=e.flipHorizontal,this.flipVertical=e.flipVertical,this.annotationLayers=e.annotationLayers,this.dpi=e.dpi,this.bitDepth=e.bitDepth,this.compressionType=e.compressionType,this.preferSVG=e.preferSVG,this.isBad=e.isBad,this.imageFormat=e.imageFormat,this.tiffTagHash=e.tiffTagHash,this.originalWidth=e.originalWidth,this.originalHeight=e.originalHeight,this.requestedWidth=e.requestedWidth,this.requestedHeight=e.requestedHeight,this.scrollLeft=e.scrollLeft,this.scrollTop=e.scrollTop,this.searchResults=e.searchResults,this.pageText=e.pageText,this.sortedLinks=e.sortedLinks,this.undoObject=e.undoObject,this.undoObjectArray=e.undoObjectArray,this.undoIndex=e.undoIndex,this.poppedObjectArray=e.poppedObjectArray,this.poppedIndex=e.poppedIndex,this.newTextAnn=e.newTextAnn,this.imageInfoRequested=e.imageInfoRequested,this.imageInfoLoaded=e.imageInfoLoaded,this.pageAlreadyRendered=e.pageAlreadyRendered},e}),define("vvBoundingBox",["vvPoint","vvUtility","vvDefines"],function(e,t,a){function n(t,a,n,o){this.one=new e(t,a),this.two=new e(t+n,a+o)}return n.prototype.getX1=function(){return this.one.getX()},n.prototype.getY1=function(){return this.one.getY()},n.prototype.getPoint1=function(){return this.one},n.prototype.getPoint2=function(){return this.two},n.prototype.getX2=function(){return this.two.getX()},n.prototype.getY2=function(){return this.two.getY()},n.prototype.getWidth=function(){return this.getX2()-this.getX1()},n.prototype.getHeight=function(){return this.getY2()-this.getY1()},n.prototype.getSlope=function(){return this.getHeight()/this.getWidth()},n.prototype.contains=function(e,a,n,o){var i=t.getNubSize()/2/a;o&&(i=0);var r=e.getX()/a,s=e.getY()/n;return r>=this.getX1()-i&&r<=this.getX2()+i&&s>=this.getY1()-i&&s<=this.getY2()+i},n.prototype.intersects=function(e){return!(e.getX1()>this.getX2()||e.getX2()<this.getX1()||e.getY1()>this.getY2()||e.getY2()<this.getY1())},n.prototype.findCorner=function(e,n,o){var i=t.getNubSize()/2/n,r=t.getNubSize()/2/o,s=e.getX()/n,l=e.getY()/o;return s>=this.getX1()-i&&s<=this.getX1()+i&&l>=this.getY1()-r&&l<=this.getY1()+r?a.corners.upperLeft:s>=this.getX2()-i&&s<=this.getX2()+i&&l>=this.getY1()-r&&l<=this.getY1()+r?a.corners.upperRight:s>=this.getX1()-i&&s<=this.getX1()+i&&l>=this.getY2()-r&&l<=this.getY2()+r?a.corners.lowerLeft:s>=this.getX2()-i&&s<=this.getX2()+i&&l>=this.getY2()-r&&l<=this.getY2()+r?a.corners.lowerRight:null},n.prototype.rotate=function(e,t,a){this.one.rotate(e,t,a),this.two.rotate(e,t,a)},n.prototype.unrotate=function(e,t,a){this.one.unrotate(e,t,a),this.two.unrotate(e,t,a)},n.prototype.copyFrom=function(t){this.one=new e(t.one.x,t.one.y),this.two=new e(t.two.x,t.two.y)},n}),define("vvTextUtility",["vvPoint","vvUtility"],function(e,t){const a=7;var n=function(e,t){let n=parseFloat(e.toFixed(a)),o=parseFloat(t.toFixed(a));return n===o||n<o},o=function(e,t){let n=parseFloat(e.toFixed(a)),o=parseFloat(t.toFixed(a));return n===o||n>o},i=function(e,t){var a=e.rect||e,i=t.rect||t,r=a.bottom-a.top;if(o(a.top,i.top)&&n(a.bottom,i.bottom))return a.left-i.left===0?a.right-i.right:a.left-i.left;let s=i.bottom-a.bottom,l=i.top-a.top;return Math.abs(s)<.1*r&&Math.abs(l)<.1*r&&(s<=0&&l<=0||s>=0&&l>=0)?a.left-i.left:n(a.bottom-.2*r,i.top)?a.top-i.top:a.top<i.top&&a.bottom<i.bottom?a.top-i.top:n(i.bottom-.2*r,a.top)?a.top-i.top:i.top<a.top&&i.bottom<a.bottom?a.top-i.top:a.left-i.left},r=function(e,t){return!(t.y<e.top||t.y>e.bottom)&&!(t.x<e.left||t.x>e.right)},s=function(e,t){return t.y<e.top||t.y<=e.bottom&&t.x<e.left},l=function(e,t,a){if(e[t-1]){let n=t-1;if(e[n].rect.bottom-e[n].rect.top<e[t].rect.bottom-e[t].rect.top&&r(e[n].rect,a))return n}if(e[t+1]){let n=t+1;if(e[n].rect.bottom-e[n].rect.top<e[t].rect.bottom-e[t].rect.top&&r(e[n].rect,a))return n}return t},u=function(e,t,a){let n=0,o=e.length,i=n+Math.floor((o-n)/2);for(;o-n>1&&e[i];){if(r(e[i].rect,t))return a?l(e,i,t):i;s(e[i].rect,t)?o=i:n=i,i=n+Math.floor((o-n)/2)}return e[n]&&r(e[n].rect,t)?n:e[o]&&r(e[o].rect,t)?o:-1},d=function(e,t){let a=t;t.wordRects&&(a=t.wordRects);let n=[];for(let o=0;o<e.words.length;o++)n.push(a[e.words[o]].word);var i=n.map(function(e){var t=e.indexOf(";");return t>-1?e.slice(0,t+1):"&#"+e.charCodeAt(0)+";"}).join(""),r=document.createElement("textarea");return r.innerHTML=i,r.value},c=function(e,t){let a=$("<a></a>");return a.text(d(e,t)),e.targetUri?a.attr("href",e.targetUri):e.targetPage>-1&&(a.attr("href","javascript:void(0);"),a.attr("onclick","virtualViewer.setPage("+e.targetPage+");")),a},g=function(e,a,n,o){if(!o){if(e.y<n.top&&a.y>n.bottom)return!0;if(e.y>n.top&&e.y<n.bottom&&a.y>n.bottom&&e.x>=n.right)return!1;if(e.y>n.top&&e.y<n.bottom&&a.y>n.bottom&&e.x<n.right)return!0;if(a.y>n.top&&a.y<n.bottom&&e.y<n.top&&n.left>=a.x)return!1;if(a.y>n.top&&a.y<n.bottom&&e.y<n.top&&n.left<a.x)return!0}var i=new t.ImageRect(Math.min(e.x,a.x),Math.min(e.y,a.y),Math.max(e.x,a.x),Math.max(e.y,a.y));return i.intersects(n)},v=function(e){return e.map(function(e){var t=e.word,a=t.indexOf(";");return a>-1?(e.word=t.slice(0,a+1),e):(e.word="&#"+t.charCodeAt(0)+";",e)})},p=function(e){if(!e)return"";let t=e.map(function(e){return e.word});var a=t.join(""),n=document.createElement("textarea");return n.innerHTML=a,n.value},h=function(t,a){if(t&&a&&t.length&&a.length){let n=-1;for(let o=0;o<t.length;o++)for(let i=0;i<a.length;i++){let s=a[i].rect,l=t[o],u=l.bottom-l.top,d=l.right-l.left,c=new e(l.left+d/2,l.top+u/2);r(s,c)&&(n<0||a[i].rect.bottom-a[i].rect.top<a[n].rect.bottom-a[n].rect.top)&&(n=i),n>-1&&(a[n].words||(a[n].words=[]),a[n].words.push(o),n=-1)}return a}},m=function(e,a){let n=$("#vvDocumentLinkPopover");n.hide(),n.find("#internalDocumentLink").detach();let o=$("<a id='internalDocumentLink'></a>");a.targetUri?(n.find("label").text(t.getLocalizedValue("documentLinks.externalURILinkLabel","Link to:")),o.text(a.targetUri).attr("href",a.targetUri),o.off("click"),o.addClass("allowBrowserContextMenu")):a.targetPage>-1&&(o.text(t.getLocalizedValue("thumbPageLabel","Page ")+(a.targetPage+1)).attr("href","javascript:void(0);"),o.on("click",function(){virtualViewer.setPage(a.targetPage)}),o.removeClass("allowBrowserContextMenu")),n.append(o),n.css("left",e.x+10+"px"),n.css("top",e.y-n.height()/2-10+"px"),n.show()},f=function(){let e=$("#vvDocumentLinkPopover");e.hide(),e.find("#internalDocumentLink").detach()};return{rectSort:i,rectIndexOfPoint:u,showDocumentLinkPopover:m,clearDocumentLinkPopover:f,assignWordsToLinks:h,rectIsInArea:g,wordRectsToPageString:p,getLinkText:d,cleanWordRects:v,getLinkHtml:c}});var diff_match_patch=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff=function(e,t){this[0]=e,this[1]=t},diff_match_patch.Diff.prototype.length=2,diff_match_patch.Diff.prototype.toString=function(){return this[0]+","+this[1]},diff_match_patch.prototype.diff_main=function(e,t,a,n){if("undefined"==typeof n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[new diff_match_patch.Diff(DIFF_EQUAL,e)]:[];"undefined"==typeof a&&(a=!0);var o=a,i=this.diff_commonPrefix(e,t);a=e.substring(0,i),e=e.substring(i),t=t.substring(i),i=this.diff_commonSuffix(e,t);var r=e.substring(e.length-i);return e=e.substring(0,e.length-i),t=t.substring(0,t.length-i),e=this.diff_compute_(e,t,o,n),a&&e.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),r&&e.push(new diff_match_patch.Diff(DIFF_EQUAL,r)),this.diff_cleanupMerge(e),e},diff_match_patch.prototype.diff_compute_=function(e,t,a,n){if(!e)return[new diff_match_patch.Diff(DIFF_INSERT,t)];if(!t)return[new diff_match_patch.Diff(DIFF_DELETE,e)];var o=e.length>t.length?e:t,i=e.length>t.length?t:e,r=o.indexOf(i);return-1!=r?(a=[new diff_match_patch.Diff(DIFF_INSERT,o.substring(0,r)),new diff_match_patch.Diff(DIFF_EQUAL,i),new diff_match_patch.Diff(DIFF_INSERT,o.substring(r+i.length))],e.length>t.length&&(a[0][0]=a[2][0]=DIFF_DELETE),a):1==i.length?[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]:(o=this.diff_halfMatch_(e,t))?(t=o[1],i=o[3],e=o[4],o=this.diff_main(o[0],o[2],a,n),a=this.diff_main(t,i,a,n),o.concat([new diff_match_patch.Diff(DIFF_EQUAL,e)],a)):a&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},diff_match_patch.prototype.diff_lineMode_=function(e,t,a){var n=this.diff_linesToChars_(e,t);e=n.chars1,t=n.chars2,n=n.lineArray,e=this.diff_main(e,t,!1,a),this.diff_charsToLines_(e,n),this.diff_cleanupSemantic(e),e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var o=n=t=0,i="",r="";t<e.length;){switch(e[t][0]){case DIFF_INSERT:o++,r+=e[t][1];break;case DIFF_DELETE:n++,i+=e[t][1];break;case DIFF_EQUAL:if(1<=n&&1<=o){for(e.splice(t-n-o,n+o),t=t-n-o,n=this.diff_main(i,r,!1,a),o=n.length-1;0<=o;o--)e.splice(t,0,n[o]);t+=n.length}n=o=0,r=i=""}t++}return e.pop(),e},diff_match_patch.prototype.diff_bisect_=function(e,t,a){for(var n=e.length,o=t.length,i=Math.ceil((n+o)/2),r=2*i,s=Array(r),l=Array(r),u=0;u<r;u++)s[u]=-1,l[u]=-1;s[i+1]=0,l[i+1]=0,u=n-o;for(var d=0!=u%2,c=0,g=0,v=0,p=0,h=0;h<i&&!((new Date).getTime()>a);h++){for(var m=-h+c;m<=h-g;m+=2){for(var f=i+m,y=m==-h||m!=h&&s[f-1]<s[f+1]?s[f+1]:s[f-1]+1,b=y-m;y<n&&b<o&&e.charAt(y)==t.charAt(b);)y++,b++;if(s[f]=y,y>n)g+=2;else if(b>o)c+=2;else if(d&&(f=i+u-m,0<=f&&f<r&&-1!=l[f])){var P=n-l[f];if(y>=P)return this.diff_bisectSplit_(e,t,y,b,a)}}for(m=-h+v;m<=h-p;m+=2){for(f=i+m,P=m==-h||m!=h&&l[f-1]<l[f+1]?l[f+1]:l[f-1]+1,y=P-m;P<n&&y<o&&e.charAt(n-P-1)==t.charAt(o-y-1);)P++,y++;if(l[f]=P,P>n)p+=2;else if(y>o)v+=2;else if(!d&&(f=i+u-m,0<=f&&f<r&&-1!=s[f]&&(y=s[f],b=i+y-f,P=n-P,y>=P)))return this.diff_bisectSplit_(e,t,y,b,a)}}return[new diff_match_patch.Diff(DIFF_DELETE,e),new diff_match_patch.Diff(DIFF_INSERT,t)]},diff_match_patch.prototype.diff_bisectSplit_=function(e,t,a,n,o){var i=e.substring(0,a),r=t.substring(0,n);return e=e.substring(a),t=t.substring(n),i=this.diff_main(i,r,!1,o),o=this.diff_main(e,t,!1,o),i.concat(o)},diff_match_patch.prototype.diff_linesToChars_=function(e,t){function a(e){for(var t="",a=0,r=-1,s=n.length;r<e.length-1;){r=e.indexOf("\n",a),-1==r&&(r=e.length-1);var l=e.substring(a,r+1);(o.hasOwnProperty?o.hasOwnProperty(l):void 0!==o[l])?t+=String.fromCharCode(o[l]):(s==i&&(l=e.substring(a),r=e.length),t+=String.fromCharCode(s),o[l]=s,n[s++]=l),a=r+1}return t}var n=[],o={};n[0]="";var i=4e4,r=a(e);i=65535;var s=a(t);return{chars1:r,chars2:s,lineArray:n}},diff_match_patch.prototype.diff_charsToLines_=function(e,t){for(var a=0;a<e.length;a++){for(var n=e[a][1],o=[],i=0;i<n.length;i++)o[i]=t[n.charCodeAt(i)];e[a][1]=o.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var a=0,n=Math.min(e.length,t.length),o=n,i=0;a<o;)e.substring(i,o)==t.substring(i,o)?i=a=o:n=o,o=Math.floor((n-a)/2+a);return o},diff_match_patch.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var a=0,n=Math.min(e.length,t.length),o=n,i=0;a<o;)e.substring(e.length-o,e.length-i)==t.substring(t.length-o,t.length-i)?i=a=o:n=o,o=Math.floor((n-a)/2+a);return o},diff_match_patch.prototype.diff_commonOverlap_=function(e,t){var a=e.length,n=t.length;if(0==a||0==n)return 0;if(a>n?e=e.substring(a-n):a<n&&(t=t.substring(0,a)),a=Math.min(a,n),e==t)return a;n=0;for(var o=1;;){var i=e.substring(a-o);if(i=t.indexOf(i),-1==i)return n;o+=i,0!=i&&e.substring(a-o)!=t.substring(0,o)||(n=o,o++)}},diff_match_patch.prototype.diff_halfMatch_=function(e,t){function a(e,t,a){for(var n,o,r,s,l=e.substring(a,a+Math.floor(e.length/4)),u=-1,d="";-1!=(u=t.indexOf(l,u+1));){var c=i.diff_commonPrefix(e.substring(a),t.substring(u)),g=i.diff_commonSuffix(e.substring(0,a),t.substring(0,u));d.length<g+c&&(d=t.substring(u-g,u)+t.substring(u,u+c),n=e.substring(0,a-g),o=e.substring(a+c),r=t.substring(0,u-g),s=t.substring(u+c))}return 2*d.length>=e.length?[n,o,r,s,d]:null}if(0>=this.Diff_Timeout)return null;var n=e.length>t.length?e:t,o=e.length>t.length?t:e;if(4>n.length||2*o.length<n.length)return null;var i=this,r=a(n,o,Math.ceil(n.length/4));if(n=a(n,o,Math.ceil(n.length/2)),!r&&!n)return null;if(r=n?r&&r[4].length>n[4].length?r:n:r,e.length>t.length){n=r[0],o=r[1];var s=r[2],l=r[3]}else s=r[0],l=r[1],n=r[2],o=r[3];return[n,o,s,l,r[4]]},diff_match_patch.prototype.diff_cleanupSemantic=function(e){for(var t=!1,a=[],n=0,o=null,i=0,r=0,s=0,l=0,u=0;i<e.length;)e[i][0]==DIFF_EQUAL?(a[n++]=i,r=l,s=u,u=l=0,o=e[i][1]):(e[i][0]==DIFF_INSERT?l+=e[i][1].length:u+=e[i][1].length,o&&o.length<=Math.max(r,s)&&o.length<=Math.max(l,u)&&(e.splice(a[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,o)),e[a[n-1]+1][0]=DIFF_INSERT,n--,n--,i=0<n?a[n-1]:-1,u=l=s=r=0,o=null,t=!0)),i++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),i=1;i<e.length;)e[i-1][0]==DIFF_DELETE&&e[i][0]==DIFF_INSERT&&(t=e[i-1][1],a=e[i][1],n=this.diff_commonOverlap_(t,a),o=this.diff_commonOverlap_(a,t),n>=o?(n>=t.length/2||n>=a.length/2)&&(e.splice(i,0,new diff_match_patch.Diff(DIFF_EQUAL,a.substring(0,n))),e[i-1][1]=t.substring(0,t.length-n),e[i+1][1]=a.substring(n),i++):(o>=t.length/2||o>=a.length/2)&&(e.splice(i,0,new diff_match_patch.Diff(DIFF_EQUAL,t.substring(0,o))),e[i-1][0]=DIFF_INSERT,e[i-1][1]=a.substring(0,a.length-o),e[i+1][0]=DIFF_DELETE,e[i+1][1]=t.substring(o),i++),i++),i++},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var a=e.charAt(e.length-1),n=t.charAt(0),o=a.match(diff_match_patch.nonAlphaNumericRegex_),i=n.match(diff_match_patch.nonAlphaNumericRegex_),r=o&&a.match(diff_match_patch.whitespaceRegex_),s=i&&n.match(diff_match_patch.whitespaceRegex_);a=r&&a.match(diff_match_patch.linebreakRegex_),n=s&&n.match(diff_match_patch.linebreakRegex_);var l=a&&e.match(diff_match_patch.blanklineEndRegex_),u=n&&t.match(diff_match_patch.blanklineStartRegex_);return l||u?5:a||n?4:o&&!r&&s?3:r||s?2:o||i?1:0;
}for(var a=1;a<e.length-1;){if(e[a-1][0]==DIFF_EQUAL&&e[a+1][0]==DIFF_EQUAL){var n=e[a-1][1],o=e[a][1],i=e[a+1][1],r=this.diff_commonSuffix(n,o);if(r){var s=o.substring(o.length-r);n=n.substring(0,n.length-r),o=s+o.substring(0,o.length-r),i=s+i}r=n,s=o;for(var l=i,u=t(n,o)+t(o,i);o.charAt(0)===i.charAt(0);){n+=o.charAt(0),o=o.substring(1)+i.charAt(0),i=i.substring(1);var d=t(n,o)+t(o,i);d>=u&&(u=d,r=n,s=o,l=i)}e[a-1][1]!=r&&(r?e[a-1][1]=r:(e.splice(a-1,1),a--),e[a][1]=s,l?e[a+1][1]=l:(e.splice(a+1,1),a--))}a++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,a=[],n=0,o=null,i=0,r=!1,s=!1,l=!1,u=!1;i<e.length;)e[i][0]==DIFF_EQUAL?(e[i][1].length<this.Diff_EditCost&&(l||u)?(a[n++]=i,r=l,s=u,o=e[i][1]):(n=0,o=null),l=u=!1):(e[i][0]==DIFF_DELETE?u=!0:l=!0,o&&(r&&s&&l&&u||o.length<this.Diff_EditCost/2&&3==r+s+l+u)&&(e.splice(a[n-1],0,new diff_match_patch.Diff(DIFF_DELETE,o)),e[a[n-1]+1][0]=DIFF_INSERT,n--,o=null,r&&s?(l=u=!0,n=0):(n--,i=0<n?a[n-1]:-1,l=u=!1),t=!0)),i++;t&&this.diff_cleanupMerge(e)},diff_match_patch.prototype.diff_cleanupMerge=function(e){e.push(new diff_match_patch.Diff(DIFF_EQUAL,""));for(var t,a=0,n=0,o=0,i="",r="";a<e.length;)switch(e[a][0]){case DIFF_INSERT:o++,r+=e[a][1],a++;break;case DIFF_DELETE:n++,i+=e[a][1],a++;break;case DIFF_EQUAL:1<n+o?(0!==n&&0!==o&&(t=this.diff_commonPrefix(r,i),0!==t&&(0<a-n-o&&e[a-n-o-1][0]==DIFF_EQUAL?e[a-n-o-1][1]+=r.substring(0,t):(e.splice(0,0,new diff_match_patch.Diff(DIFF_EQUAL,r.substring(0,t))),a++),r=r.substring(t),i=i.substring(t)),t=this.diff_commonSuffix(r,i),0!==t&&(e[a][1]=r.substring(r.length-t)+e[a][1],r=r.substring(0,r.length-t),i=i.substring(0,i.length-t))),a-=n+o,e.splice(a,n+o),i.length&&(e.splice(a,0,new diff_match_patch.Diff(DIFF_DELETE,i)),a++),r.length&&(e.splice(a,0,new diff_match_patch.Diff(DIFF_INSERT,r)),a++),a++):0!==a&&e[a-1][0]==DIFF_EQUAL?(e[a-1][1]+=e[a][1],e.splice(a,1)):a++,n=o=0,r=i=""}for(""===e[e.length-1][1]&&e.pop(),n=!1,a=1;a<e.length-1;)e[a-1][0]==DIFF_EQUAL&&e[a+1][0]==DIFF_EQUAL&&(e[a][1].substring(e[a][1].length-e[a-1][1].length)==e[a-1][1]?(e[a][1]=e[a-1][1]+e[a][1].substring(0,e[a][1].length-e[a-1][1].length),e[a+1][1]=e[a-1][1]+e[a+1][1],e.splice(a-1,1),n=!0):e[a][1].substring(0,e[a+1][1].length)==e[a+1][1]&&(e[a-1][1]+=e[a+1][1],e[a][1]=e[a][1].substring(e[a+1][1].length)+e[a+1][1],e.splice(a+1,1),n=!0)),a++;n&&this.diff_cleanupMerge(e)},diff_match_patch.prototype.diff_xIndex=function(e,t){var a,n=0,o=0,i=0,r=0;for(a=0;a<e.length&&(e[a][0]!==DIFF_INSERT&&(n+=e[a][1].length),e[a][0]!==DIFF_DELETE&&(o+=e[a][1].length),!(n>t));a++)i=n,r=o;return e.length!=a&&e[a][0]===DIFF_DELETE?r:r+(t-i)},diff_match_patch.prototype.diff_prettyHtml=function(e){for(var t=[],a=/&/g,n=/</g,o=/>/g,i=/\n/g,r=0;r<e.length;r++){var s=e[r][0],l=e[r][1].replace(a,"&amp;").replace(n,"&lt;").replace(o,"&gt;").replace(i,"&para;<br>");switch(s){case DIFF_INSERT:t[r]='<ins style="background:#e6ffe6;">'+l+"</ins>";break;case DIFF_DELETE:t[r]='<del style="background:#ffe6e6;">'+l+"</del>";break;case DIFF_EQUAL:t[r]="<span>"+l+"</span>"}}return t.join("")},diff_match_patch.prototype.diff_text1=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==DIFF_INSERT&&(t[a]=e[a][1]);return t.join("")},diff_match_patch.prototype.diff_text2=function(e){for(var t=[],a=0;a<e.length;a++)e[a][0]!==DIFF_DELETE&&(t[a]=e[a][1]);return t.join("")},diff_match_patch.prototype.diff_levenshtein=function(e){for(var t=0,a=0,n=0,o=0;o<e.length;o++){var i=e[o][1];switch(e[o][0]){case DIFF_INSERT:a+=i.length;break;case DIFF_DELETE:n+=i.length;break;case DIFF_EQUAL:t+=Math.max(a,n),n=a=0}}return t+=Math.max(a,n)},diff_match_patch.prototype.diff_toDelta=function(e){for(var t=[],a=0;a<e.length;a++)switch(e[a][0]){case DIFF_INSERT:t[a]="+"+encodeURI(e[a][1]);break;case DIFF_DELETE:t[a]="-"+e[a][1].length;break;case DIFF_EQUAL:t[a]="="+e[a][1].length}return t.join("\t").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(e,t){for(var a=[],n=0,o=0,i=t.split(/\t/g),r=0;r<i.length;r++){var s=i[r].substring(1);switch(i[r].charAt(0)){case"+":try{a[n++]=new diff_match_patch.Diff(DIFF_INSERT,decodeURI(s))}catch(e){throw Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var l=parseInt(s,10);if(isNaN(l)||0>l)throw Error("Invalid number in diff_fromDelta: "+s);s=e.substring(o,o+=l),"="==i[r].charAt(0)?a[n++]=new diff_match_patch.Diff(DIFF_EQUAL,s):a[n++]=new diff_match_patch.Diff(DIFF_DELETE,s);break;default:if(i[r])throw Error("Invalid diff operation in diff_fromDelta: "+i[r])}}if(o!=e.length)throw Error("Delta length ("+o+") does not equal source text length ("+e.length+").");return a},diff_match_patch.prototype.match_main=function(e,t,a){if(null==e||null==t||null==a)throw Error("Null input. (match_main)");return a=Math.max(0,Math.min(a,e.length)),e==t?0:e.length?e.substring(a,a+t.length)==t?a:this.match_bitap_(e,t,a):-1},diff_match_patch.prototype.match_bitap_=function(e,t,a){function n(e,n){var o=e/t.length,r=Math.abs(a-n);return i.Match_Distance?o+r/i.Match_Distance:r?1:o}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var o=this.match_alphabet_(t),i=this,r=this.Match_Threshold,s=e.indexOf(t,a);-1!=s&&(r=Math.min(n(0,s),r),s=e.lastIndexOf(t,a+t.length),-1!=s&&(r=Math.min(n(0,s),r)));var l=1<<t.length-1;s=-1;for(var u,d,c,g=t.length+e.length,v=0;v<t.length;v++){for(u=0,d=g;u<d;)n(v,a+d)<=r?u=d:g=d,d=Math.floor((g-u)/2+u);g=d,u=Math.max(1,a-d+1);var p=Math.min(a+d,e.length)+t.length;for(d=Array(p+2),d[p+1]=(1<<v)-1;p>=u;p--){var h=o[e.charAt(p-1)];if(d[p]=0===v?(d[p+1]<<1|1)&h:(d[p+1]<<1|1)&h|(c[p+1]|c[p])<<1|1|c[p+1],d[p]&l&&(h=n(v,p-1),h<=r)){if(r=h,s=p-1,!(s>a))break;u=Math.max(1,2*a-s)}}if(n(v+1,a)>r)break;c=d}return s},diff_match_patch.prototype.match_alphabet_=function(e){for(var t={},a=0;a<e.length;a++)t[e.charAt(a)]=0;for(a=0;a<e.length;a++)t[e.charAt(a)]|=1<<e.length-a-1;return t},diff_match_patch.prototype.patch_addContext_=function(e,t){if(0!=t.length){if(null===e.start2)throw Error("patch not initialized");for(var a=t.substring(e.start2,e.start2+e.length1),n=0;t.indexOf(a)!=t.lastIndexOf(a)&&a.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,a=t.substring(e.start2-n,e.start2+e.length1+n);n+=this.Patch_Margin,(a=t.substring(e.start2-n,e.start2))&&e.diffs.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),(n=t.substring(e.start2+e.length1,e.start2+e.length1+n))&&e.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,n)),e.start1-=a.length,e.start2-=a.length,e.length1+=a.length+n.length,e.length2+=a.length+n.length}},diff_match_patch.prototype.patch_make=function(e,t,a){if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof a){var n=e;t=this.diff_main(n,t,!0),2<t.length&&(this.diff_cleanupSemantic(t),this.diff_cleanupEfficiency(t))}else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof a)t=e,n=this.diff_text1(t);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof a)n=e;else{if("string"!=typeof e||"string"!=typeof t||!a||"object"!=typeof a)throw Error("Unknown call format to patch_make.");n=e,t=a}if(0===t.length)return[];a=[],e=new diff_match_patch.patch_obj;for(var o=0,i=0,r=0,s=n,l=0;l<t.length;l++){var u=t[l][0],d=t[l][1];switch(o||u===DIFF_EQUAL||(e.start1=i,e.start2=r),u){case DIFF_INSERT:e.diffs[o++]=t[l],e.length2+=d.length,n=n.substring(0,r)+d+n.substring(r);break;case DIFF_DELETE:e.length1+=d.length,e.diffs[o++]=t[l],n=n.substring(0,r)+n.substring(r+d.length);break;case DIFF_EQUAL:d.length<=2*this.Patch_Margin&&o&&t.length!=l+1?(e.diffs[o++]=t[l],e.length1+=d.length,e.length2+=d.length):d.length>=2*this.Patch_Margin&&o&&(this.patch_addContext_(e,s),a.push(e),e=new diff_match_patch.patch_obj,o=0,s=n,i=r)}u!==DIFF_INSERT&&(i+=d.length),u!==DIFF_DELETE&&(r+=d.length)}return o&&(this.patch_addContext_(e,s),a.push(e)),a},diff_match_patch.prototype.patch_deepCopy=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],o=new diff_match_patch.patch_obj;o.diffs=[];for(var i=0;i<n.diffs.length;i++)o.diffs[i]=new diff_match_patch.Diff(n.diffs[i][0],n.diffs[i][1]);o.start1=n.start1,o.start2=n.start2,o.length1=n.length1,o.length2=n.length2,t[a]=o}return t},diff_match_patch.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var a=this.patch_addPadding(e);t=a+t+a,this.patch_splitMax(e);for(var n=0,o=[],i=0;i<e.length;i++){var r=e[i].start2+n,s=this.diff_text1(e[i].diffs),l=-1;if(s.length>this.Match_MaxBits){var u=this.match_main(t,s.substring(0,this.Match_MaxBits),r);-1!=u&&(l=this.match_main(t,s.substring(s.length-this.Match_MaxBits),r+s.length-this.Match_MaxBits),-1==l||u>=l)&&(u=-1)}else u=this.match_main(t,s,r);if(-1==u)o[i]=!1,n-=e[i].length2-e[i].length1;else if(o[i]=!0,n=u-r,r=-1==l?t.substring(u,u+s.length):t.substring(u,l+this.Match_MaxBits),s==r)t=t.substring(0,u)+this.diff_text2(e[i].diffs)+t.substring(u+s.length);else if(r=this.diff_main(s,r,!1),s.length>this.Match_MaxBits&&this.diff_levenshtein(r)/s.length>this.Patch_DeleteThreshold)o[i]=!1;else{this.diff_cleanupSemanticLossless(r),s=0;var d;for(l=0;l<e[i].diffs.length;l++){var c=e[i].diffs[l];c[0]!==DIFF_EQUAL&&(d=this.diff_xIndex(r,s)),c[0]===DIFF_INSERT?t=t.substring(0,u+d)+c[1]+t.substring(u+d):c[0]===DIFF_DELETE&&(t=t.substring(0,u+d)+t.substring(u+this.diff_xIndex(r,s+c[1].length))),c[0]!==DIFF_DELETE&&(s+=c[1].length)}}}return t=t.substring(a.length,t.length-a.length),[t,o]},diff_match_patch.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,a="",n=1;n<=t;n++)a+=String.fromCharCode(n);for(n=0;n<e.length;n++)e[n].start1+=t,e[n].start2+=t;n=e[0];var o=n.diffs;if(0==o.length||o[0][0]!=DIFF_EQUAL)o.unshift(new diff_match_patch.Diff(DIFF_EQUAL,a)),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t;else if(t>o[0][1].length){var i=t-o[0][1].length;o[0][1]=a.substring(o[0][1].length)+o[0][1],n.start1-=i,n.start2-=i,n.length1+=i,n.length2+=i}return n=e[e.length-1],o=n.diffs,0==o.length||o[o.length-1][0]!=DIFF_EQUAL?(o.push(new diff_match_patch.Diff(DIFF_EQUAL,a)),n.length1+=t,n.length2+=t):t>o[o.length-1][1].length&&(i=t-o[o.length-1][1].length,o[o.length-1][1]+=a.substring(0,i),n.length1+=i,n.length2+=i),a},diff_match_patch.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,a=0;a<e.length;a++)if(!(e[a].length1<=t)){var n=e[a];e.splice(a--,1);for(var o=n.start1,i=n.start2,r="";0!==n.diffs.length;){var s=new diff_match_patch.patch_obj,l=!0;for(s.start1=o-r.length,s.start2=i-r.length,""!==r&&(s.length1=s.length2=r.length,s.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,r)));0!==n.diffs.length&&s.length1<t-this.Patch_Margin;){r=n.diffs[0][0];var u=n.diffs[0][1];r===DIFF_INSERT?(s.length2+=u.length,i+=u.length,s.diffs.push(n.diffs.shift()),l=!1):r===DIFF_DELETE&&1==s.diffs.length&&s.diffs[0][0]==DIFF_EQUAL&&u.length>2*t?(s.length1+=u.length,o+=u.length,l=!1,s.diffs.push(new diff_match_patch.Diff(r,u)),n.diffs.shift()):(u=u.substring(0,t-s.length1-this.Patch_Margin),s.length1+=u.length,o+=u.length,r===DIFF_EQUAL?(s.length2+=u.length,i+=u.length):l=!1,s.diffs.push(new diff_match_patch.Diff(r,u)),u==n.diffs[0][1]?n.diffs.shift():n.diffs[0][1]=n.diffs[0][1].substring(u.length))}r=this.diff_text2(s.diffs),r=r.substring(r.length-this.Patch_Margin),u=this.diff_text1(n.diffs).substring(0,this.Patch_Margin),""!==u&&(s.length1+=u.length,s.length2+=u.length,0!==s.diffs.length&&s.diffs[s.diffs.length-1][0]===DIFF_EQUAL?s.diffs[s.diffs.length-1][1]+=u:s.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,u))),l||e.splice(++a,0,s)}}},diff_match_patch.prototype.patch_toText=function(e){for(var t=[],a=0;a<e.length;a++)t[a]=e[a];return t.join("")},diff_match_patch.prototype.patch_fromText=function(e){var t=[];if(!e)return t;e=e.split("\n");for(var a=0,n=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<e.length;){var o=e[a].match(n);if(!o)throw Error("Invalid patch string: "+e[a]);var i=new diff_match_patch.patch_obj;for(t.push(i),i.start1=parseInt(o[1],10),""===o[2]?(i.start1--,i.length1=1):"0"==o[2]?i.length1=0:(i.start1--,i.length1=parseInt(o[2],10)),i.start2=parseInt(o[3],10),""===o[4]?(i.start2--,i.length2=1):"0"==o[4]?i.length2=0:(i.start2--,i.length2=parseInt(o[4],10)),a++;a<e.length;){o=e[a].charAt(0);try{var r=decodeURI(e[a].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+r)}if("-"==o)i.diffs.push(new diff_match_patch.Diff(DIFF_DELETE,r));else if("+"==o)i.diffs.push(new diff_match_patch.Diff(DIFF_INSERT,r));else if(" "==o)i.diffs.push(new diff_match_patch.Diff(DIFF_EQUAL,r));else{if("@"==o)break;if(""!==o)throw Error('Invalid patch mode "'+o+'" in: '+r)}a++}}return t},diff_match_patch.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},diff_match_patch.patch_obj.prototype.toString=function(){for(var e,t=["@@ -"+(0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1)+" +"+(0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case DIFF_INSERT:e="+";break;case DIFF_DELETE:e="-";break;case DIFF_EQUAL:e=" "}t[a+1]=e+encodeURI(this.diffs[a][1])+"\n"}return t.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,define("3rdparty/diff_match_patch",function(){}),define("vvDiffManager",["vvUtility","vvTextUtility","3rdparty/diff_match_patch"],function(e,t){function a(){this.newDocument={state:null,ignore:[],diffReadableText:[],highlightRects:[]},this.oldDocument={state:null,ignore:[],diffReadableText:[],highlightRects:[]},this.changeObjects=[],this.showHighlights=!0,this.readyToDiff=!1,this.diffDisabled=!1,this.diffDisabledUntilSave=!1,this.diffIsComplete=!1,this.diffReportCallback=null,this.changeInFocus={added:{page:void 0,rects:[]},removed:{page:void 0,rects:[]}}}var n=new diff_match_patch;a.prototype.init=function(e,t){this.oldDocument.state=e,this.newDocument.state=t,this.processTextForDiff()},a.prototype.setDiffDisabled=function(e){this.diffDisabled=!!e},a.prototype.setDiffComplete=function(e){var t=this.diffIsComplete!==!!e;this.diffIsComplete=!!e,t&&this.diffIsComplete&&this.diffReportCallback&&this.diffReportCallback(this.getChangeReport())},a.prototype.getOldDocHighlightRects=function(e){if(this.diffDisabled||this.diffDisabledUntilSave)return[];if(this.oldDocument.highlightRects[e])return this.oldDocument.highlightRects[e];var t=o(this.oldDocument,this.changeObjects,DIFF_DELETE,e);return this.oldDocument.highlightRects[e]=t,t},a.prototype.getNewDocHighlightRects=function(e){if(this.diffDisabled||this.diffDisabledUntilSave)return[];if(this.newDocument.highlightRects[e])return this.newDocument.highlightRects[e];var t=o(this.newDocument,this.changeObjects,DIFF_INSERT,e);return this.newDocument.highlightRects[e]=t,t},a.prototype.focusOnChange=function(e,t){var a=this.changeObjects[e][t];return a[0]===DIFF_INSERT?(this.changeInFocus.added.page=e,this.changeInFocus.added.rects=this.getAllRectsOfChangeObject(e,t),this.changeInFocus.added.rects):(this.changeInFocus.removed.page=e,this.changeInFocus.removed.rects=this.getAllRectsOfChangeObject(e,t),this.changeInFocus.removed.rects)},a.prototype.getAllRectsOfChangeObject=function(e,t){this.newDocument.highlightRects[e]&&this.oldDocument.highlightRects[e]||(this.getNewDocHighlightRects(e),this.getOldDocHighlightRects(e));for(var a=this.changeObjects[e],n=a[t],o=0,i=0;i<t;i++){var r=a[i];r[0]===n[0]&&o++}return n[0]===DIFF_INSERT?this.newDocument.highlightRects[e][o]:this.oldDocument.highlightRects[e][o]};var o=function(e,t,a,n){var o=[],r=t[n];if(!r)return o;for(var s=0,l=0;l<r.length;l++){var u=r[l],d=s+u[1].length;if(u[0]===a){var c=e.state.pageStates[n].pageText.wordRects.slice(s,d),g=i(c);o.push(g),s=d}else u[0]===DIFF_EQUAL&&(s=d)}return o};a.prototype.allChangeObjectsToRects=function(e){if(!this.changeObjects[e])return[];for(var t=[],a=0,n=0,o=0;o<this.changeObjects[e].length;o++){var r,s,l=this.changeObjects[e][o];l[0]===DIFF_EQUAL?(r=a+l[1].length,s=this.oldDocument.state.pageStates[e].pageText.wordRects.slice(a,r),a=r,n+=l[1].length):l[0]===DIFF_INSERT?(r=n+l[1].length,s=this.newDocument.state.pageStates[e].pageText.wordRects.slice(n,r),n=r):l[0]===DIFF_DELETE&&(r=a+l[1].length,s=this.oldDocument.state.pageStates[e].pageText.wordRects.slice(a,r),a=r),l[2]=s,l[3]=i(s),t.push(l)}return t};var i=function(t){var a=null,n=[];if(!t||!t.length)return n;for(var o=0,i=0;i<t.length;i++)a?a.top!==t[i].top?(n.push(a),o++,a=new e.ImageRect(t[i].left,t[i].top,t[i].right,t[i].bottom)):a.right=t[i].right:(o++,a=new e.ImageRect(t[i].left,t[i].top,t[i].right,t[i].bottom));return!n.length!==o&&n.push(a),n};a.prototype.processPageTextForDiff=function(e){this.newDocument.state&&this.oldDocument.state&&!this.diffDisabled&&!this.diffDisabledUntilSave&&(r(this.newDocument,e),r(this.oldDocument,e))},a.prototype.processTextForDiff=function(){if(this.newDocument.state&&this.oldDocument.state&&this.newDocument.state.documentFullyLoaded()&&this.oldDocument.state.documentFullyLoaded()&&!this.diffDisabled&&!this.diffDisabledUntilSave){for(var e=0;e<this.newDocument.state.getPageCount();e++)r(this.newDocument,e);for(e=0;e<this.oldDocument.state.getPageCount();e++)r(this.oldDocument,e)}};var r=function(e,a){if(e.state&&e.state.documentFullyLoaded()&&!(!e.state.getPageCount()>a)){if(null===e.state.getPageText(a))return void(e.diffReadableText[a]="");var n=e.state.getPageText(a).wordRects;e.diffReadableText[a]=t.wordRectsToPageString(n)}};a.prototype.startDiff=function(){if(!this.diffDisabled&&!this.diffDisabledUntilSave)for(var e=0;e<Math.max(this.oldDocument.state.getPageCount(),this.newDocument.state.getPageCount());e++)this.diffPage(e)},a.prototype.diffPage=function(e){if(!this.diffDisabled&&!this.diffDisabledUntilSave){var t=this.oldDocument.diffReadableText[e]||"",a=this.newDocument.diffReadableText[e]||"";this.changeObjects[e]=n.diff_main(t,a),n.diff_cleanupSemantic(this.changeObjects[e]),this.changeObjects[e]&&this.changeObjects[e].length&&(this.oldDocument.highlightRects[e]=null,this.newDocument.highlightRects[e]=null)}},a.prototype.getChangeReport=function(){var e=$.templates("#documentCompareReportTemplate"),t=e.render(this.changeObjects),a=$("<div></div>").attr("id","vvDocumentCompareReport").append(t);return a[0]},a.prototype.displayChangeObjects=function(e,t){if(this.diffDisabled||this.diffDisabledUntilSave)return null;var a;e=e||0;for(var n=0;n<this.changeObjects.length;n++)if(a=s(n),n<e)a.children().length||($("<img />").attr("src","resources/loader.gif").appendTo(a),a.addClass("diffPageLoading").attr("aria-expanded","true"),this.setDiffComplete(!1));else{if(null===this.newDocument.state.getPageText(n)||null===this.oldDocument.state.getPageText(n))return a.empty(),$("<img />").attr("src","resources/loader.gif").appendTo(a),a.addClass("diffPageLoading").attr("aria-expanded","true"),this.setDiffComplete(!1),!1;this.fillPageChangeObjects(n,a),a.find(".vvChangeObject").on("click",t)}var o=0===$(".diffPageLoading").length;return this.setDiffComplete(o),o},a.prototype.fillDiffPane=function(t,a){return this.diffDisabledUntilSave?($("#vvDocCompareInternal").empty(),$("<div></div>").addClass("vvCannotDiffMessage").text(e.getLocalizedValue("documentCompare.cannotCompareUntilSave","Document compare will resume when cropped or reordered documents have been saved.")).appendTo("#vvDocCompareInternal"),!0):this.diffDisabled?($("#vvDocCompareInternal").empty(),$("<div></div>").addClass("vvCannotDiffMessage").text(e.getLocalizedValue("documentCompare.cannotCompare","These documents cannot be compared. One or more of them contains no text.")).appendTo("#vvDocCompareInternal"),!0):t||0===t?($("#vvLoadMoreButton").remove(),this.displayChangeObjects(t,a)):($("#vvDocCompareInternal").empty(),this.displayChangeObjects(0,a))};var s=function(t){var a=$("#vvDocCompareInternal .diffPageContainer[pageNumber='"+t+"']");return a.length||($("<a></a>").text(e.getLocalizedValue("thumbPageLabel","Page ")+(t+1)).attr({href:".diffPageContainer[pageNumber='"+t+"']",role:"button","data-toggle":"collapse",pageNumber:t}).addClass("vvDiffPageCollapseButton btn").on("dragstart",function(){return!1}).append("<span class='caret'></span>").appendTo("#vvDocCompareInternal"),a=$("<div></div>").addClass("diffPageContainer collapse").attr("pageNumber",t),a.appendTo("#vvDocCompareInternal"),$("<div></div>").addClass("vvDocComparePageDivider").appendTo("#vvDocCompareInternal")),a};a.prototype.fillPageChangeObjects=function(t,a){if(!this.changeObjects[t])return a;if(a.empty().removeClass("diffPageLoading"),1===this.changeObjects[t].length&&this.changeObjects[t][0][0]===DIFF_EQUAL){var n=$("<div></div").addClass("vvNoChangesObject");return $("<div></div>").addClass("vvChangedText").append($("<span></span>").text(e.getLocalizedValue("documentCompare.noChangesOnPage","No changes to display"))).appendTo(n),n.appendTo(a),a}for(var o=0;o<this.changeObjects[t].length;o++)if(this.changeObjects[t][o][0]!==DIFF_EQUAL&&13!==this.changeObjects[t][o][1].charCodeAt(0)){var i=l(this.changeObjects[t][o],o);i&&a.append(i)}return a};var l=function(t,a){var n=$("<div></div").addClass("vvChangeObject").data("changeIndex",a);$("<label></label>").addClass("vvChangeType").appendTo(n);var o=$("<div></div>").addClass("vvChangedText").addClass("ellipsis").append($("<span></span>").text(t[1])).appendTo(n),i=t[1];if(i=i.replace(/\u200B/g,""),0!==i.length)return 0===i.trim().length&&o.find("span").css("white-space","pre"),t[0]===DIFF_INSERT?(n.find(".vvChangeType").text(e.getLocalizedValue("documentCompare.changeTypes.added","Added")),n.addClass("vvChangeAdded"),n):t[0]===DIFF_DELETE?(n.find(".vvChangeType").text(e.getLocalizedValue("documentCompare.changeTypes.removed","Removed")),n.addClass("vvChangeRemoved"),n):void 0};return a}),define("vvLayerManager",["require","vvUtility","user-config/config","vvDefines","vvAnnotationManager","vvStateManager"],function(e,t,a,n){function o(){this.invisibleLayers=[],this.imageLayerVisibilityHasChanged=!1}var i="imageLayer-",r="annLayer-";o.prepareLayerDialog=function(){$("#vvImageLayersVisibleAll").on("click",function(e){e.stopPropagation(),T($("#vvImageLayersList").hasClass("vvAllLayerVisibilityNotSet"))}),$("#vvAnnLayersVisibleAll").on("click",function(e){e.stopPropagation(),T($("#vvAnnotationLayersList").hasClass("vvAllLayerVisibilityNotSet"),!0)}),a.enableConsolidateAnnotationLayer?$("#vvConsolidateLayersButton").on("click",function(){if("true"!==$(this).prop("disabled")){$(this).prop("disabled",!0);var e={layerName:"Master Layer",visibility:!0};$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer");var t=c(e,!0);t.addClass("vvConsolidatedLayerItem vvAnnLayerAdded"),$("#vvAnnotationLayersList").append(t)}}):$("#vvConsolidateLayersButton").remove(),$("#vvAnnLayersAdd").on("click",function(){var e=$("#vvAnnotationLayersList");return e.hasClass("vvAddingNewLayer")?void $("#vvAddNewLayerListItem input").focus():(e.addClass("vvAddingNewLayer"),void $("#vvAddNewLayerListItem input").focus())}),$("#vvAddNewLayerListItem .okButton").on("click",l),$("#vvAddNewLayerListItem .cancelButton").on("click",s),$("#vvLayerManagerOK").on("click",function(){d(),u(),$("#vvLayerManagerDiv").modal("hide")}),$("#vvLayerManagerCancel").on("click",function(){$("#vvLayerManagerDiv").modal("hide")})};var s=function(e){e.stopPropagation(),M(),$("#vvAnnotationLayersList").removeClass("vvAddingNewLayer")},l=function(e){e&&e.stopPropagation();var t=$("#vvAddNewLayerListItem input"),a=t.val();if(!C(a))return void P(t,!0);P(t,!1),t.val("");var n=$("#vvAnnotationLayersList");n.removeClass("vvAddingNewLayer vvEmptyOfLayers");var o={layerName:a,visibility:!0};$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer");var i=c(o,!0);i.addClass("vvAnnLayerAdded").appendTo(n),$("#vvAnnotationLayersList .vvConsolidatedLayerItem").length||$("#vvConsolidateLayersButton").prop("disabled",!1)},u=function(){var t=e("vvStateManager").getActivePaneState(),n=!1;if(!a.oneLayerPerAnnotation){$("#vvAnnotationLayersList .vvConsolidatedLayerItem").length&&($("#vvAnnotationLayersList .vvConsolidatedLayerItem").remove(),n=!0);for(var o=$(".vvLayerMarkedForDeletion"),i=0;i<o.length;i++){var s=$(o[i]).attr("id").slice(r.length);w(s,t),$(o[i]).remove()}for(var u=$(".vvLayerListItemEditing"),d=0;d<u.length;d++)h(null,$(u[d]));var c=$("#vvAnnotationLayersList");c.hasClass("vvAddingNewLayer")&&(l(),$("#vvAddNewLayerListItem input").val(""),c.removeClass("vvAddingNewLayer"));for(var g=t.getPageNumber(),v=$("#vvAnnotationLayersList .vvLayerListItem").not("#vvAddNewLayerListItem, .vvEmptyLayerItem"),p=!1,m=null,f=v.length,y=0;y<f;y++){var b=$(v[y]),P=$(b).attr("id");if(P){var T,A=P.slice(r.length),C=b.find(".vvLayerNameText").text().trim();if(b.hasClass("vvAnnLayerAdded")?(A=C,T=e("vvAnnotationManager").createLayer(A,g,t),D(T,t)):T=t.getLayerFromPage(g,A),T){var M=$(b).hasClass("vvLayerVisible")&&!c.hasClass("vvAllLayersInvisible");M!==T.visibility&&I(A,M,t),C===A||$(b).hasClass(".vvLayerListItemEditing")||S(A,C,t),p&&D(T),b.hasClass("activeAnnLayer")&&(m=T)}}}m&&t.setCurrentLayer(m),n&&f&&virtualViewer.consolidateAnnotationLayers(),virtualViewer.fillAnnotationList(),virtualViewer.delayedPaintCanvases()}},d=function(){var t=e("vvStateManager"),a=t.getActivePaneState().getLayerManager();if(t.getActivePaneState().imageLayers&&t.getActivePaneState().imageLayers.length){for(var n=$("#vvImageLayersList .vvLayerListItem.vvLayerInvisible"),o=[],r=a.invisibleLayers.length,s=0;s<n.length;s++){var l=n.eq(s).attr("id");if(l){var u=l.slice(i.length),d=a.invisibleLayers.indexOf(u);d>-1&&a.invisibleLayers.splice(d,1),o.push(u)}}return a.invisibleLayers.length||o.length>r?(a.invisibleLayers=o,a.imageLayerVisibilityHasChanged=!0,void virtualViewer.paintCanvases()):void(a.invisibleLayers=o)}};o.prototype.showLayerDialog=function(e){this.clearLayerDialog(),this.fillLayerDialog(e),$("#vvLayerManagerDiv").modal("show")},o.prototype.clearLayerDialog=function(){$(".vvLayerListItem").remove(),$(".vvLayerMarkedForDeletion").remove(),M()},o.prototype.fillLayerDialog=function(e){A(!1,!0);var t=this.fillAnnotationLayers(e),a=this.fillImageLayers(e);a&&t?($("#vvLayerManagerTabs").show(),$("#vvImageLayersTab a").tab("show")):a&&!t?($("#vvImageLayersTab a").tab("show"),$("#vvLayerManagerTabs").hide()):($("#vvAnnotationLayersTab a").tab("show"),$("#vvLayerManagerTabs").hide())},o.prototype.fillImageLayers=function(t){t||(t=e("vvStateManager").getActivePaneState());var a=t.imageLayers;if(!a||!a.length)return!1;for(var n=0;n<a.length;n++)$("#vvImageLayersList").append(this.imageLayerItem(a[n].layer,a[n].color));return!0},o.prototype.imageLayerItem=function(e,a){if(!e)return $();var n=e;$.isNumeric(e)&&(n=t.getLocalizedValue("layerManager.numericLayerLabel","Layer ")+e);var o={color:a||"white",layerName:n,canHide:!0,layerHidden:this.invisibleLayers.indexOf(e)>-1},r=$.templates("#singleLayerItemTemplate"),s=$(r.render(o));return s.attr("id",i+e),s.find(".vvLayerVisButton").on("click",function(e){e.stopPropagation(),$(this).parents(".vvLayerListItem").toggleClass("vvLayerVisible").toggleClass("vvLayerInvisible"),A(!1)}),s},o.prototype.fillAnnotationLayers=function(o){var i=$("#vvAnnotationLayersList");if(a.oneLayerPerAnnotation)return i.addClass("vvEmptyOfLayers"),$("#vvAnnLayersHeadButtons .btn").attr("disabled",!0),!1;$("#vvAnnLayersHeadButtons .btn").attr("disabled",!1),o=o||e("vvStateManager").getActivePaneState();var r=o.getLayerNames(),s=!1,l=0,u=o.getPageNumber(),d="";e("vvAnnotationManager").getCurrentLayer()&&(d=e("vvAnnotationManager").getCurrentLayer().layerName);for(var g=0;g<r.length;g++){var v=r[g],p=o.getLayerFromPage(u,v);if(p&&(!t.isRedactionLayer(p)||!n.hideRedactionLayerFromManager)){"Master Layer"===v&&(s=!0);var h=!1;p.layerName===d&&(h=!0),p&&p.permissionLevel>=n.permissionLevels.PERM_VIEW&&(i.append(c(p,h)),l+=1)}}return l?i.removeClass("vvEmptyOfLayers"):i.addClass("vvEmptyOfLayers"),s||!l?$("#vvConsolidateLayersButton").prop("disabled",!0):$("#vvConsolidateLayersButton").prop("disabled",!1),!0};var c=function(a,o){var i=a.layerName,s=i.indexOf("Master Layer")>-1;s&&$("#vvConsolidateLayersButton").prop("disabled",!0);var l=i;$.isNumeric(i)&&(l=t.getLocalizedValue("layerManager.numericLayerLabel","Layer ")+i);var u={layerName:l,canEdit:e("vvAnnotationManager").checkLayerPermission(a,n.permissionLevels.PERM_EDIT)&&!s,canDelete:e("vvAnnotationManager").checkLayerPermission(a,n.permissionLevels.PERM_DELETE),canHide:!t.isRedactionLayer(a),layerHidden:!a.visibility||$("#vvAnnotationLayersList").hasClass("vvAllLayersInvisible")},d=$.templates("#singleLayerItemTemplate"),c=$(d.render(u));return c.attr("id",r+i),c.find(".vvLayerText").on("click",v),c.on("click",m),c.find(".vvLayerVisButton").on("click",g),c.find(".vvAnnDeleteLayerButton").on("click",f),c.find(".vvEditLayerNameDiv .okButton").on("click",h),c.find(".vvEditLayerNameDiv .cancelButton").on("click",p),c.find(".vvDeleteLayerConfirmation .okButton").on("click",y),c.find(".vvDeleteLayerConfirmation .cancelButton").on("click",b),o&&c.addClass("activeAnnLayer"),c},g=function(e){e.stopPropagation(),$(this).parents(".vvLayerListItem").toggleClass("vvLayerVisible").toggleClass("vvLayerInvisible"),A(!0)},v=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");$(t).addClass("vvLayerListItemEditing"),$(t).find(".vvEditLayerNameDiv input").focus()},p=function(e){e.stopPropagation(),M();var t=$(this).parents(".vvLayerListItem");t.removeClass("vvLayerListItemEditing");var a=t.find(".vvEditLayerNameDiv input");P(a,!1),a.val("")},h=function(e,t){var a=null;e?(e.stopPropagation(),a=$(this).parents(".vvLayerListItem")):a=t;var n=a.find(".vvEditLayerNameDiv input"),o=a.find(".vvLayerNameText"),i=n.val(),r=o.text();return i===r||C(i)?(P(n,!1),n.val(""),a.removeClass("vvLayerListItemEditing"),void o.text(i)):void P(n,!0)},m=function(e){$("#vvAnnotationLayersList .activeAnnLayer").removeClass("activeAnnLayer"),$(this).addClass("activeAnnLayer")},f=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");t.addClass("vvLayerDeletionInquiry")},y=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");if(t.addClass("vvLayerMarkedForDeletion"),t.removeClass("vvLayerDeletionInquiry"),t.removeClass("vvLayerListItem"),$(t).hasClass("activeAnnLayer")){$(t).removeClass("activeAnnLayer");var a=$("#vvAnnotationLayersList .vvLayerListItem");a.length?$($(a)[0]).addClass("activeAnnLayer"):($("#vvAnnotationLayersList").addClass("vvEmptyOfLayers"),$("#vvConsolidateLayersButton").prop("disabled",!0))}var n=$(t).get(0).id.indexOf("Master Layer")>-1;($(t).hasClass("vvConsolidatedLayerItem")||n)&&$("#vvConsolidateLayersButton").prop("disabled",!1),t.hasClass("vvAnnLayerAdded")&&t.remove()},b=function(e){e.stopPropagation();var t=$(this).parents(".vvLayerListItem");t.removeClass("vvLayerDeletionInquiry")},P=function(e,a){return a?($(e).attr("aria-invalid",!0),void M(t.getLocalizedValue("errors.invalidLayerName","Invalid layer name. Please choose a new layer name."))):($(e).attr("aria-invalid",!1),void M())},T=function(e,t){var a;a=t?$("#vvAnnotationLayersList"):$("#vvImageLayersList"),a.toggleClass("vvAllLayerVisibilityNotSet",!e).toggleClass("vvAllLayersInvisible",e),a.find(".vvLayerListItem").toggleClass("vvLayerInvisible",e).toggleClass("vvLayerVisible",!e)},A=function(e,t){var a;a=t?$("#vvImageLayersList, #vvAnnotationLayersList"):e?$("#vvAnnotationLayersList"):$("#vvImageLayersList"),a.toggleClass("vvAllLayerVisibilityNotSet",!0).toggleClass("vvAllLayersInvisible",!1)};o.prototype.toggleAllAnnotationLayersVisibility=function(e,t){
t||(t=virtualViewer.getActivePaneState());var a=t.getLayerNames();if("undefined"==typeof e&&a.length>0){var n=t.getLayerFromPage(0,a[0]);e=!n.visibility}for(var o=0;o<a.length;o++)I(a[o],e,t);virtualViewer.delayedPaintCanvases()};var I=function(t,a,n){n||(n=e("vvStateManager").getActivePaneState());for(var o=0;o<n.getPageCount();o++){var i=n.getLayerFromPage(o,t);i&&(i.visibility=a)}virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null)},S=function(t,a,n){n||(n=e("vvStateManager").getActivePaneState()),e("vvAnnotationManager").renameLayerCore(t,a),n.renameLayer(t,a),n.getDocumentModel().renameLayer(t,a)},w=function(t,a){a||(a=e("vvStateManager").getActivePaneState());var n=a.getLayerNames(),o=n.indexOf(t);n.splice(o,1),a.setLayerNames(n),a.deleteLayer(t)},C=function(e){if(!e)return!1;if(e.length>50)return!1;for(var t=$(".vvLayerNameText"),a=0;a<t.length;a++)if(t.eq(a).text()===e)return!1;return!0},D=function(t,a){a||(a=e("vvStateManager").getActivePaneState()),a.getDocumentModel().markLayerDirty(t)},M=function(e){return e?($("#vvLayerManagerErrorBanner").show(),void $("#vvLayerManagerErrorBanner > span").text(e)):($("#vvLayerManagerErrorBanner > span").empty(),void $("#vvLayerManagerErrorBanner").hide())};return o.prototype.getHiddenImageLayers=function(e){if(!this.invisibleLayers.length)return null;if(!e)return this.invisibleLayers.join(",");for(var t=[],a=0;a<this.invisibleLayers.length;a++)t.push(encodeURIComponent(this.invisibleLayers[a]));return t.join(",")},o}),!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("3rdparty/pica.min",[],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pica=e()}(function(){return function e(t,a,n){function o(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var d=a[r]={exports:{}};t[r][0].call(d.exports,function(e){return o(t[r][1][e]||e)},d,d.exports,e,t,a,n)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<n.length;r++)o(n[r]);return o}({1:[function(e,t,a){"use strict";function n(e){var t=e||[],a={js:0<=t.indexOf("js"),wasm:0<=t.indexOf("wasm")};i.call(this,a),this.features={js:a.js,wasm:a.wasm&&this.has_wasm()},this.use(r),this.use(s)}var o=e("inherits"),i=e("multimath"),r=e("multimath/lib/unsharp_mask"),s=e("./mm_resize");o(n,i),n.prototype.resizeAndUnsharp=function(e,t){var a=this.resize(e,t);return e.unsharpAmount&&this.unsharp_mask(a,e.toWidth,e.toHeight,e.unsharpAmount,e.unsharpRadius,e.unsharpThreshold),a},t.exports=n},{"./mm_resize":4,inherits:15,multimath:16,"multimath/lib/unsharp_mask":19}],2:[function(e,t,a){"use strict";function n(e){return e<0?0:255<e?255:e}t.exports={convolveHorizontally:function(e,t,a,o,i,r){var s,l,u,d,c,g,v,p,h,m,f,y=0,b=0;for(h=0;h<o;h++){for(m=c=0;m<i;m++){for(g=r[c++],v=r[c++],p=y+4*g|0,s=l=u=d=0;0<v;v--)d=d+(f=r[c++])*e[p+3]|0,u=u+f*e[p+2]|0,l=l+f*e[p+1]|0,s=s+f*e[p]|0,p=p+4|0;t[b+3]=n(d+8192>>14),t[b+2]=n(u+8192>>14),t[b+1]=n(l+8192>>14),t[b]=n(s+8192>>14),b=b+4*o|0}b=4*(h+1)|0,y=(h+1)*a*4|0}},convolveVertically:function(e,t,a,o,i,r){var s,l,u,d,c,g,v,p,h,m,f,y=0,b=0;for(h=0;h<o;h++){for(m=c=0;m<i;m++){for(g=r[c++],v=r[c++],p=y+4*g|0,s=l=u=d=0;0<v;v--)d=d+(f=r[c++])*e[p+3]|0,u=u+f*e[p+2]|0,l=l+f*e[p+1]|0,s=s+f*e[p]|0,p=p+4|0;t[b+3]=n(d+8192>>14),t[b+2]=n(u+8192>>14),t[b+1]=n(l+8192>>14),t[b]=n(s+8192>>14),b=b+4*o|0}b=4*(h+1)|0,y=(h+1)*a*4|0}}}},{}],3:[function(e,t,a){"use strict";t.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw=="},{}],4:[function(e,t,a){"use strict";t.exports={name:"resize",fn:e("./resize"),wasm_fn:e("./resize_wasm"),wasm_src:e("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(e,t,a){"use strict";var n=e("./resize_filter_gen"),o=e("./convolve").convolveHorizontally,i=e("./convolve").convolveVertically;t.exports=function(e){var t=e.src,a=e.width,r=e.height,s=e.toWidth,l=e.toHeight,u=e.scaleX||e.toWidth/e.width,d=e.scaleY||e.toHeight/e.height,c=e.offsetX||0,g=e.offsetY||0,v=e.dest||new Uint8Array(s*l*4),p=void 0===e.quality?3:e.quality,h=e.alpha||!1,m=n(p,a,s,u,c),f=n(p,r,l,d,g),y=new Uint8Array(s*r*4);return o(t,y,a,r,s,m),i(y,v,r,s,l,f),h||function(e,t,a){for(var n=3,o=t*a*4|0;n<o;)e[n]=255,n=n+4|0}(v,s,l),v}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(e,t,a){"use strict";function n(e){return Math.round(e*((1<<i)-1))}var o=e("./resize_filter_info"),i=14;t.exports=function(e,t,a,i,r){var s,l,u,d,c,g,v,p,h,m,f,y,b,P,T,A,I,S=o[e].filter,w=1/i,C=Math.min(1,i),D=o[e].win/C,M=Math.floor(2*(1+D)),x=new Int16Array((M+2)*a),L=0,N=!x.subarray||!x.set;for(s=0;s<a;s++){for(l=(s+.5)*w+r,u=Math.max(0,Math.floor(l-D)),c=(d=Math.min(t-1,Math.ceil(l+D)))-u+1,g=new Float32Array(c),v=new Int16Array(c),h=u,m=p=0;h<=d;h++,m++)p+=f=S((h+.5-l)*C),g[m]=f;for(m=y=0;m<g.length;m++)y+=b=g[m]/p,v[m]=n(b);for(v[a>>1]+=n(1-y),P=0;P<v.length&&0===v[P];)P++;if(P<v.length){for(T=v.length-1;0<T&&0===v[T];)T--;if(A=u+P,I=T-P+1,x[L++]=A,x[L++]=I,N)for(m=P;m<=T;m++)x[L++]=v[m];else x.set(v.subarray(P,T+1),L),L+=I}else x[L++]=0,x[L++]=0}return x}},{"./resize_filter_info":7}],7:[function(e,t,a){"use strict";t.exports=[{win:.5,filter:function(e){return-.5<=e&&e<.5?1:0}},{win:1,filter:function(e){if(e<=-1||1<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*(.54+.46*Math.cos(t/1))}},{win:2,filter:function(e){if(e<=-2||2<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/2)/(t/2)}},{win:3,filter:function(e){if(e<=-3||3<=e)return 0;if(-1.1920929e-7<e&&e<1.1920929e-7)return 1;var t=e*Math.PI;return Math.sin(t)/t*Math.sin(t/3)/(t/3)}}]},{}],8:[function(e,t,a){"use strict";function n(e,t,a){if(i)t.set(function(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),a);else for(var n=a,o=0;o<e.length;o++){var r=e[o];t[n++]=255&r,t[n++]=r>>8&255}}var o=e("./resize_filter_gen"),i=!0;try{i=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(e){}t.exports=function(e){var t=e.src,a=e.width,i=e.height,r=e.toWidth,s=e.toHeight,l=e.scaleX||e.toWidth/e.width,u=e.scaleY||e.toHeight/e.height,d=e.offsetX||0,c=e.offsetY||0,g=e.dest||new Uint8Array(r*s*4),v=void 0===e.quality?3:e.quality,p=e.alpha||!1,h=o(v,a,r,l,d),m=o(v,i,s,u,c),f=this.__align(0+Math.max(t.byteLength,g.byteLength)),y=this.__align(f+i*r*4),b=this.__align(y+h.byteLength),P=b+m.byteLength,T=this.__instance("resize",P),A=new Uint8Array(this.__memory.buffer),I=new Uint32Array(this.__memory.buffer),S=new Uint32Array(t.buffer);return I.set(S),n(h,A,y),n(m,A,b),(T.exports.convolveHV||T.exports._convolveHV)(y,b,f,a,i,r,s),new Uint32Array(g.buffer).set(new Uint32Array(this.__memory.buffer,0,s*r)),p||function(e,t,a){for(var n=3,o=t*a*4|0;n<o;)e[n]=255,n=n+4|0}(g,r,s),g}},{"./resize_filter_gen":6}],9:[function(e,t,a){"use strict";function n(e,t){this.create=e,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=t||2e3}n.prototype.acquire=function(){var e,t=this;return 0!==this.available.length?e=this.available.pop():((e=this.create()).id=this.lastId++,e.release=function(){return t.release(e)}),this.acquired[e.id]=e},n.prototype.release=function(e){var t=this;delete this.acquired[e.id],e.lastUsed=Date.now(),this.available.push(e),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return t.gc()},100))},n.prototype.gc=function(){var e=this,t=Date.now();this.available=this.available.filter(function(a){return!(t-a.lastUsed>e.idle&&(a.destroy(),1))}),0!==this.available.length?this.timeoutId=setTimeout(function(){return e.gc()},100):this.timeoutId=0},t.exports=n},{}],10:[function(e,t,a){"use strict";t.exports=function(e,t,a,n,o,i){var r=a/e,s=n/t,l=(2*i+2+1)/o;if(.5<l)return[[a,n]];var u=Math.ceil(Math.log(Math.min(r,s))/Math.log(l));if(u<=1)return[[a,n]];for(var d=[],c=0;c<u;c++){var g=Math.round(Math.pow(Math.pow(e,u-c-1)*Math.pow(a,c+1),1/u)),v=Math.round(Math.pow(Math.pow(t,u-c-1)*Math.pow(n,c+1),1/u));d.push([g,v])}return d}},{}],11:[function(e,t,a){"use strict";function n(e){var t=Math.round(e);return Math.abs(e-t)<i?t:Math.floor(e)}function o(e){var t=Math.round(e);return Math.abs(e-t)<i?t:Math.ceil(e)}var i=1e-5;t.exports=function(e){var t,a,i,r,s,l,u=e.toWidth/e.width,d=e.toHeight/e.height,c=n(e.srcTileSize*u)-2*e.destTileBorder,g=n(e.srcTileSize*d)-2*e.destTileBorder;if(c<1||g<1)throw new Error("Internal error in pica: target tile width/height is too small.");var v,p=[];for(r=0;r<e.toHeight;r+=g)for(i=0;i<e.toWidth;i+=c)(t=i-e.destTileBorder)<0&&(t=0),t+(s=i+c+e.destTileBorder-t)>=e.toWidth&&(s=e.toWidth-t),(a=r-e.destTileBorder)<0&&(a=0),a+(l=r+g+e.destTileBorder-a)>=e.toHeight&&(l=e.toHeight-a),v={toX:t,toY:a,toWidth:s,toHeight:l,toInnerX:i,toInnerY:r,toInnerWidth:c,toInnerHeight:g,offsetX:t/u-n(t/u),offsetY:a/d-n(a/d),scaleX:u,scaleY:d,x:n(t/u),y:n(a/d),width:o(s/u),height:o(l/d)},p.push(v);return p}},{}],12:[function(e,t,a){"use strict";function n(e){return Object.prototype.toString.call(e)}t.exports.isCanvas=function(e){var t=n(e);return"[object HTMLCanvasElement]"===t||"[object Canvas]"===t},t.exports.isImage=function(e){return"[object HTMLImageElement]"===n(e)},t.exports.limiter=function(e){function t(){a<e&&n.length&&(a++,n.shift()())}var a=0,n=[];return function(e){return new Promise(function(o,i){n.push(function(){e().then(function(e){o(e),a--,t()},function(e){i(e),a--,t()})}),t()})}},t.exports.cib_quality_name=function(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},t.exports.cib_support=function(){return Promise.resolve().then(function(){if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;var e=document.createElement("canvas");return e.width=100,e.height=100,createImageBitmap(e,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(t){var a=10===t.width;return t.close(),e=null,a})}).catch(function(){return!1})}},{}],13:[function(e,t,a){"use strict";t.exports=function(){var t,a=e("./mathlib");onmessage=function(e){var n=e.data.opts,o=(t=t||new a(e.data.features)).resizeAndUnsharp(n);postMessage({result:o},[o.buffer])}}},{"./mathlib":1}],14:[function(e,t,a){function n(e,t,a,n,o,i){var r,s,l,u,d,c,g,v,p,h,m,f,y,b;for(p=0;p<i;p++){for(v=0,u=d=(r=e[c=(g=p)*o])*n[6],m=n[0],f=n[1],y=n[4],b=n[5],h=0;h<o;h++)l=(s=e[c])*m+r*f+u*y+d*b,d=u,u=l,r=s,a[v]=u,v++,c++;for(v--,g+=i*(o-1),u=d=(r=e[--c])*n[7],s=r,m=n[2],f=n[3],h=o-1;0<=h;h--)l=s*m+r*f+u*y+d*b,d=u,u=l,r=s,s=e[c],t[g]=a[v]+u,c--,v--,g-=i}}var o,i,r,s,l,u;t.exports=function(e,t,a,d){if(d){var c=new Uint16Array(e.length),g=new Float32Array(Math.max(t,a)),v=function(e){e<.5&&(e=.5);var t=Math.exp(.527076)/e,a=Math.exp(-t),n=Math.exp(-2*t),d=(1-a)*(1-a)/(1+2*t*a-n);return i=(o=d)*(t-1)*a,r=d*(1+t)*a,s=-d*n,l=2*a,u=-n,new Float32Array([o,i,r,s,l,u,(o+i)/(1-l-u),(r+s)/(1-l-u)])}(d);n(e,c,g,v,t,a),n(c,e,g,v,a,t)}}},{}],15:[function(e,t,a){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){function a(){}t&&(e.super_=t,a.prototype=t.prototype,e.prototype=new a,e.prototype.constructor=e)}},{}],16:[function(e,t,a){"use strict";function n(e){if(!(this instanceof n))return new n(e);var t=o({},s,e||{});if(this.options=t,this.__cache={},this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}var o=e("object-assign"),i=e("./lib/base64decode"),r=e("./lib/wa_detect"),s={js:!0,wasm:!0};n.prototype.has_wasm=r,n.prototype.use=function(e){return this.__modules[e.name]=e,this.options.wasm&&this.has_wasm()&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},n.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map(function(t){var a=e.__modules[t];return e.options.wasm&&e.has_wasm()&&a.wasm_fn?e.__wasm[t]?null:WebAssembly.compile(e.__base64decode(a.wasm_src)).then(function(a){e.__wasm[t]=a}):null})).then(function(){return e}),this.__init_promise},n.prototype.__base64decode=i,n.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},n.prototype.__instance=function(e,t,a){if(t&&this.__reallocate(t),!this.__wasm[e]){var n=this.__modules[e];this.__wasm[e]=new WebAssembly.Module(this.__base64decode(n.wasm_src))}if(!this.__cache[e]){var i={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:o(i,a||{})})}return this.__cache[e]},n.prototype.__align=function(e,t){var a=e%(t=t||8);return e+(a?t-a:0)},t.exports=n},{"./lib/base64decode":17,"./lib/wa_detect":23,"object-assign":24}],17:[function(e,t,a){"use strict";t.exports=function(e){for(var t=e.replace(/[\r\n=]/g,""),a=t.length,n=new Uint8Array(3*a>>2),o=0,i=0,r=0;r<a;r++)r%4==0&&r&&(n[i++]=o>>16&255,n[i++]=o>>8&255,n[i++]=255&o),o=o<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t.charAt(r));var s=a%4*6;return 0==s?(n[i++]=o>>16&255,n[i++]=o>>8&255,n[i++]=255&o):18==s?(n[i++]=o>>10&255,n[i++]=o>>2&255):12==s&&(n[i++]=o>>4&255),n}},{}],18:[function(e,t,a){"use strict";t.exports=function(e,t,a){for(var n,o,i,r,s,l=t*a,u=new Uint16Array(l),d=0;d<l;d++)n=e[4*d],o=e[4*d+1],i=e[4*d+2],s=o<=n&&i<=n?n:i<=o&&n<=o?o:i,r=n<=o&&n<=i?n:o<=i&&o<=n?o:i,u[d]=257*(s+r)>>1;return u}},{}],19:[function(e,t,a){"use strict";t.exports={name:"unsharp_mask",fn:e("./unsharp_mask"),wasm_fn:e("./unsharp_mask_wasm"),wasm_src:e("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":20,"./unsharp_mask_wasm":21,"./unsharp_mask_wasm_base64":22}],20:[function(e,t,a){"use strict";var n=e("glur/mono16"),o=e("./hsl_l16");t.exports=function(e,t,a,i,r,s){var l,u,d,c,g,v,p,h,m,f,y,b,P;if(!(0===i||r<.5)){2<r&&(r=2);var T=o(e,t,a),A=new Uint16Array(T);n(A,t,a,r);for(var I=i/100*4096+.5|0,S=257*s|0,w=t*a,C=0;C<w;C++)b=2*(T[C]-A[C]),Math.abs(b)>=S&&(l=e[P=4*C],u=e[1+P],d=e[2+P],v=257*((h=u<=l&&d<=l?l:l<=u&&d<=u?u:d)+(p=l<=u&&l<=d?l:u<=l&&u<=d?u:d))>>1,c=p===h?g=0:(g=v<=32767?4095*(h-p)/(h+p)|0:4095*(h-p)/(510-h-p)|0,l===h?65535*(u-d)/(6*(h-p))|0:u===h?21845+(65535*(d-l)/(6*(h-p))|0):43690+(65535*(l-u)/(6*(h-p))|0)),65535<(v+=I*b+2048>>12)?v=65535:v<0&&(v=0),0===g?l=u=d=v>>8:(m=2*v-(f=v<=32767?v*(4096+g)+2048>>12:v+((65535-v)*g+2048>>12))>>8,f>>=8,l=43690<=(y=c+21845&65535)?m:32767<=y?m+(6*(f-m)*(43690-y)+32768>>16):10922<=y?f:m+(6*(f-m)*y+32768>>16),u=43690<=(y=65535&c)?m:32767<=y?m+(6*(f-m)*(43690-y)+32768>>16):10922<=y?f:m+(6*(f-m)*y+32768>>16),d=43690<=(y=c-21845&65535)?m:32767<=y?m+(6*(f-m)*(43690-y)+32768>>16):10922<=y?f:m+(6*(f-m)*y+32768>>16)),e[P]=l,e[1+P]=u,e[2+P]=d)}}},{"./hsl_l16":18,"glur/mono16":14}],21:[function(e,t,a){"use strict";t.exports=function(e,t,a,n,o,i){if(!(0===n||o<.5)){2<o&&(o=2);var r=t*a,s=4*r,l=2*r,u=2*r,d=4*Math.max(t,a),c=s,g=c+l,v=g+u,p=v+u,h=p+d,m=this.__instance("unsharp_mask",s+l+2*u+d+32,{exp:Math.exp}),f=new Uint32Array(e.buffer);new Uint32Array(this.__memory.buffer).set(f);var y=m.exports.hsl_l16||m.exports._hsl_l16;y(0,c,t,a),(y=m.exports.blurMono16||m.exports._blurMono16)(c,g,v,p,h,t,a,o),(y=m.exports.unsharp||m.exports._unsharp)(0,0,c,g,t,a,n,i),f.set(new Uint32Array(this.__memory.buffer,0,r))}}},{}],22:[function(e,t,a){"use strict";t.exports="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL"},{}],23:[function(e,t,a){"use strict";var n;t.exports=function(){if(void 0!==n)return n;if(n=!1,"undefined"==typeof WebAssembly)return n;try{var e=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(e);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(n=!0),n}catch(e){}return n}},{}],24:[function(e,t,a){"use strict";var n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},a=0;a<10;a++)t["_"+String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(e){n[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var a,r,s=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),l=1;l<arguments.length;l++){for(var u in a=Object(arguments[l]))o.call(a,u)&&(s[u]=a[u]);if(n){r=n(a);for(var d=0;d<r.length;d++)i.call(a,r[d])&&(s[r[d]]=a[r[d]])}}return s}},{}],25:[function(e,t,a){var n=arguments[3],o=arguments[4],i=arguments[5],r=JSON.stringify;t.exports=function(e,t){for(var a,s=Object.keys(i),l=0,u=s.length;l<u;l++){var d=s[l],c=i[d].exports;if(c===e||c&&c.default===e){a=d;break}}if(!a){a=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var g={};for(l=0,u=s.length;l<u;l++)g[d=s[l]]=d;o[a]=["function(require,module,exports){"+e+"(self); }",g]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),p={};p[a]=a,o[v]=["function(require,module,exports){var f = require("+r(a)+");(f.default ? f.default : f)(self);}",p];var h={};!function e(t){h[t]=!0;for(var a in o[t][1]){var n=o[t][1][a];h[n]||e(n)}}(v);var m="("+n+")({"+Object.keys(h).map(function(e){return r(e)+":["+o[e][0]+","+r(o[e][1])+"]"}).join(",")+"},{},["+r(v)+"])",f=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([m],{type:"text/javascript"});if(t&&t.bare)return y;var b=f.createObjectURL(y),P=new Worker(b);return P.objectURL=b,P}},{}],"/":[function(e,t,a){"use strict";function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var a=[],n=!0,o=!1,i=void 0;try{for(var r,s=e[Symbol.iterator]();!(n=(r=s.next()).done)&&(a.push(r.value),!t||a.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==s.return||s.return()}finally{if(o)throw i}}return a}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(){return{value:s(c),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){var e=window.URL||window.webkitURL||window.mozURL||window.msURL;e&&e.revokeObjectURL&&this.value.objectURL&&e.revokeObjectURL(this.value.objectURL)}}}}function i(e){if(!(this instanceof i))return new i(e);this.options=r({},b,e||{});var t="lk_".concat(this.options.concurrency);this.__limit=p[t]||d.limiter(this.options.concurrency),p[t]||(p[t]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}var r=e("object-assign"),s=e("webworkify"),l=e("./lib/mathlib"),u=e("./lib/pool"),d=e("./lib/utils"),c=e("./lib/worker"),g=e("./lib/stepper"),v=e("./lib/tiler"),p={},h=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(h=0<=navigator.userAgent.indexOf("Safari"))}catch(e){}var m=1;"undefined"!=typeof navigator&&(m=Math.min(navigator.hardwareConcurrency||1,4));var f,y,b={tile:1024,concurrency:m,features:["js","wasm","ww"],idle:2e3},P={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};i.prototype.init=function(){var t=this;if(this.__initPromise)return this.__initPromise;if(!1!==f&&!0!==f&&(f=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),f=!0}catch(e){}!1!==y&&!0!==y&&(y=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?y=!0:this.debug("ImageBitmap does not support .close(), disabled")));var a=this.options.features.slice();if(0<=a.indexOf("all")&&(a=["cib","wasm","js","ww"]),this.__requested_features=a,this.__mathlib=new l(a),0<=a.indexOf("ww")&&"undefined"!=typeof window&&"Worker"in window)try{e("webworkify")(function(){}).terminate(),this.features.ww=!0;var n="wp_".concat(JSON.stringify(this.options));p[n]?this.__workersPool=p[n]:(this.__workersPool=new u(o,this.options.idle),p[n]=this.__workersPool)}catch(e){}var i,s=this.__mathlib.init().then(function(e){r(t.features,e.features)});return i=y?d.cib_support().then(function(e){t.features.cib&&a.indexOf("cib")<0?t.debug("createImageBitmap() resize supported, but disabled by config"):0<=a.indexOf("cib")&&(t.features.cib=e)}):Promise.resolve(!1),this.__initPromise=Promise.all([s,i]).then(function(){return t}),this.__initPromise},i.prototype.resize=function(e,t,a){var o=this;this.debug("Start resize...");var i=r({},P);if(isNaN(a)?a&&(i=r(i,a)):i=r(i,{quality:a}),i.toWidth=t.width,i.toHeight=t.height,i.width=e.naturalWidth||e.width,i.height=e.naturalHeight||e.height,0===t.width||0===t.height)return Promise.reject(new Error("Invalid output size: ".concat(t.width,"x").concat(t.height)));2<i.unsharpRadius&&(i.unsharpRadius=2);var s=!1,l=null;i.cancelToken&&(l=i.cancelToken.then(function(e){throw s=!0,e},function(e){throw s=!0,e}));var u=Math.ceil(Math.max(3,2.5*i.unsharpRadius|0));return this.init().then(function(){function a(e,t,a){function n(t){return o.__limit(function(){if(s)return l;var n;if(d.isCanvas(e))o.debug("Get tile pixel data"),n=i.getImageData(t.x,t.y,t.width,t.height);else{o.debug("Draw tile imageBitmap/image to temporary canvas");var u=document.createElement("canvas");u.width=t.width,u.height=t.height;var g=u.getContext("2d",{alpha:Boolean(a.alpha)});g.globalCompositeOperation="copy",g.drawImage(r||e,t.x,t.y,t.width,t.height,0,0,t.width,t.height),o.debug("Get tile pixel data"),n=g.getImageData(0,0,t.width,t.height),g=u=null}var v={src:n.data,width:t.width,height:t.height,toWidth:t.toWidth,toHeight:t.toHeight,scaleX:t.scaleX,scaleY:t.scaleY,offsetX:t.offsetX,offsetY:t.offsetY,quality:a.quality,alpha:a.alpha,unsharpAmount:a.unsharpAmount,unsharpRadius:a.unsharpRadius,unsharpThreshold:a.unsharpThreshold};return o.debug("Invoke resize math"),Promise.resolve().then(function(){return function(e){return Promise.resolve().then(function(){return o.features.ww?new Promise(function(t,a){var n=o.__workersPool.acquire();l&&l.catch(function(e){return a(e)}),n.value.onmessage=function(e){n.release(),e.data.err?a(e.data.err):t(e.data.result)},n.value.postMessage({opts:e,features:o.__requested_features,preload:{wasm_nodule:o.__mathlib.__}},[e.src.buffer])}):o.__mathlib.resizeAndUnsharp(e,p)})}(v)}).then(function(e){if(s)return l;var a;if(n=null,o.debug("Convert raw rgba tile result to ImageData"),f)a=new ImageData(new Uint8ClampedArray(e),t.toWidth,t.toHeight);else if((a=c.createImageData(t.toWidth,t.toHeight)).data.set)a.data.set(e);else for(var i=a.data.length-1;0<=i;i--)a.data[i]=e[i];return o.debug("Draw tile"),h?c.putImageData(a,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth+1e-5,t.toInnerHeight+1e-5):c.putImageData(a,t.toX,t.toY,t.toInnerX-t.toX,t.toInnerY-t.toY,t.toInnerWidth,t.toInnerHeight),null})})}var i,r,c;return Promise.resolve().then(function(){if(c=t.getContext("2d",{alpha:Boolean(a.alpha)}),d.isCanvas(e))return i=e.getContext("2d",{alpha:Boolean(a.alpha)}),null;if(d.isImage(e))return y?(o.debug("Decode image via createImageBitmap"),createImageBitmap(e).then(function(e){r=e})):null;throw new Error('".from" should be image or canvas')}).then(function(){function e(){r&&(r.close(),r=null)}if(s)return l;o.debug("Calculate tiles");var i=v({width:a.width,height:a.height,srcTileSize:o.options.tile,toWidth:a.toWidth,toHeight:a.toHeight,destTileBorder:u}).map(function(e){return n(e)});return o.debug("Process tiles"),Promise.all(i).then(function(){return o.debug("Finished!"),e(),t},function(t){throw e(),t})})}if(s)return l;if(o.features.cib){var c=t.getContext("2d",{alpha:Boolean(i.alpha)});return o.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:i.toWidth,resizeHeight:i.toHeight,resizeQuality:d.cib_quality_name(i.quality)}).then(function(e){if(s)return l;if(!i.unsharpAmount)return c.drawImage(e,0,0),e.close(),c=null,o.debug("Finished!"),t;o.debug("Unsharp result");var a=document.createElement("canvas");a.width=i.toWidth,a.height=i.toHeight;var n=a.getContext("2d",{alpha:Boolean(i.alpha)});n.drawImage(e,0,0),e.close();var r=n.getImageData(0,0,i.toWidth,i.toHeight);return o.__mathlib.unsharp_mask(r.data,i.toWidth,i.toHeight,i.unsharpAmount,i.unsharpRadius,i.unsharpThreshold),c.putImageData(r,0,0),r=n=a=c=null,o.debug("Finished!"),t})}var p={};return function e(t,o,i,u){if(s)return l;var d,c=n(t.shift(),2),g=c[0],v=c[1],p=0===t.length;return u=r({},u,{toWidth:g,toHeight:v,quality:p?u.quality:Math.min(1,u.quality)}),p||((d=document.createElement("canvas")).width=g,d.height=v),a(o,p?i:d,u).then(function(){return p?i:(u.width=g,u.height=v,e(t,d,i,u))})}(g(i.width,i.height,i.toWidth,i.toHeight,o.options.tile,u),e,t,i)})},i.prototype.resizeBuffer=function(e){var t=this,a=r({},P,e);return this.init().then(function(){return t.__mathlib.resizeAndUnsharp(a)})},i.prototype.toBlob=function(e,t,a){return t=t||"image/png",new Promise(function(n){if(e.toBlob)e.toBlob(function(e){return n(e)},t,a);else{for(var o=atob(e.toDataURL(t,a).split(",")[1]),i=o.length,r=new Uint8Array(i),s=0;s<i;s++)r[s]=o.charCodeAt(s);n(new Blob([r],{type:t}))}})},i.prototype.debug=function(){},t.exports=i},{"./lib/mathlib":1,"./lib/pool":9,"./lib/stepper":10,"./lib/tiler":11,"./lib/utils":12,"./lib/worker":13,"object-assign":24,webworkify:25}]},{},[])("/")}),define("vvCallbackManager",[],function(){function e(){var t={onDocumentLoad:null,onPageLoadAndRendered:null,onThumbLoadAndRendered:null,saveDocumentBegin:null,saveDocument:null,saveDocumentError:null,saveAsDocumentBegin:null,saveAsDocument:null,saveAsDocumentError:null,uploadDocumentBegin:null,uploadDocument:null,uploadDocumentError:null,exportDocumentBegin:null,exportMultipleDocumentsBegin:null,exportDocumentError:null,exportMultipleDocumentsError:null,printMultipleDocumentsError:null,emailDocumentBegin:null,emailDocument:null,emailDocumentError:null,printDocumentBegin:null,printDocument:null,printMultipleDocumentsBegin:null,printMultipleDocuments:null,printMultipleDocumentsError:null,printDocumentError:null,zoomDocumentBegin:null,zoomDocument:null,zoomDocumentError:null,zoomRubberbandBegin:null,zoomRubberband:null,zoomRubberbandError:null,magnifierBegin:null,magnifier:null,fitDocumentBegin:null,fitDocument:null,sendDocument:null,switchToTab:null,pageChange:null,pageChangeBegin:null,pageChangeError:null,pageCopied:null,pagePasted:null,pageDeleted:null,rotation:null,rotationBegin:null,rotationError:null,cropDocumentBegin:null,cropDocumentError:null,cropDocument:null,textSelect:null,imageLoadCompleted:null,overlayImageLoadCompleted:null,imageLoadRequested:null,annotationCreation:null,annotationDeletion:null,canPlay:null,canPlayThrough:null,mediaEnded:null,mediaError:null,mediaPause:null,mediaPlay:null,switchBetweenTabs:null,requestDocumentModelError:null,saveUserPreferences:null,saveUsername:null,saveTabPreferences:null,saveAnnotationPreferences:null,saveAnnotations:null,saveAnnotationsError:null,saveToolbarPreferences:null,saveCustomStamps:null,saveNoteTemplates:null,saveVideoPreferences:null,saveAudioPreferences:null,saveZoomPreferences:null,postLoadPreferencesVideo:null,postLoadPreferencesAudio:null,onLoadUsername:null,annotationChanged:null,annotationSelection:null,afterTabClosed:null,onShowSelectTextContextMenu:null,pageLoaded:null,pageLoadError:null,pageCountUpdated:null,invertImageBegin:null,brightnessAdjustBegin:null,gammaAdjustBegin:null,contrastAdjustBegin:null,imageManipulation:null,annotationLoadCompleted:null,annotationLoadError:null,
onWindowResize:null,onSplitScreenComplete:null,onFinishedMarkingDocumentThumbnail:null,onFinishedRemoveMarkingDocumentThumbnail:null},a={disableTextContextMenu:null,disablePageManipulationContextMenuOptions:null};e.prototype.init=function(){$("#externalCallbackCenter").length||$("<div id='externalCallbackCenter' style='width=0px; height=0px; display: none;'></div").appendTo("#virtualViewerMain"),$("#internalCallbackCenter").length||$("<div id='internalCallbackCenter' style='width=0px; height=0px; display: none;'></div").appendTo("#virtualViewerMain"),this.setInternalCallback("saveAsDocument",virtualViewer.defaultSaveAsDocumentCallback),this.setInternalCallback("uploadDocument",virtualViewer.defaultUploadDocumentCallback),this.setInternalCallback("onDocumentLoad",virtualViewer.onDocumentModelLoad),this.setInternalCallback("pageLoaded",virtualViewer.onPageLoaded),this.setInternalCallback("requestDocumentModelError",virtualViewer.onDocumentModelError)},e.prototype.callbackExists=function(e){return!!t[e]},e.prototype.call=function(e,a){t[e]&&($("#internalCallbackCenter").trigger(e,a),$("#externalCallbackCenter").trigger(e,a))},e.prototype.callWithReturn=function(e,t){return a[e]&&"function"==typeof a[e]?a[e](t):null},e.prototype.setInternalCallback=function(e,t){return"function"==typeof t&&(!!i(e,t)||s(e,t))},e.prototype.removeInternalCallback=function(e,t){return"function"==typeof t&&r(e,t)},e.prototype.setCallback=function(e,t){return"function"==typeof t&&(!!l(e,t)||s(e,t))},e.prototype.removeCallback=function(e,i){return!(!e||"string"!=typeof e||!a[e]&&!t[e])&&(!!n(e,i)||o(e))};var n=function(e,a){return!(!t[e]&&null!==t[e])&&($("#externalCallbackCenter").off(e),a&&$("#internalCallbackCenter").off(e),$._data($("#internalCallbackCenter")[0],"events")[e]||(t[e]=null),!0)},o=function(e){return("function"==typeof a[e]||null===a[e])&&(a[e]=null,!0)},i=function(e,a){return!(null!==t[e]&&!t[e])&&(t[e]=!0,$("#internalCallbackCenter").on(e,function(e,t){a(t)}),!0)},r=function(e,a){return!(!t[e]&&null!==t[e])&&($("#internalCallbackCenter").off(e,a),!0)},s=function(e,t){return(null===a[e]||"function"==typeof a[e])&&(a[e]=t,!0)},l=function(e,a){return!(null!==t[e]&&!t[e])&&(t[e]=!0,$("#externalCallbackCenter").on(e,function(e,t){a(t)}),!0)}}var t;return function(){return t=t||new e}()}),define("vvImageManager",["vvUtility","user-config/config","vvDefines","3rdparty/pica.min","vvCallbackManager"],function(e,t,a,n,o){function i(e){this.state=e,this.scaleThrottleTimeoutId=0,this.thumbnailImageBuffer=[],this.originalImageBuffer=[],this.scaledImageBuffer=[],this.manipulatedImageBuffer=[],this.errorFallbackImageBuffer=[],this.originalImageIsSVG=[],this.imageCompletionTimeoutBuffer=[],this.upcomingQueue=[],this.picaID=0,this.requestTimeout=0,this.serverScale=t.serverScaling,this.forceBrowserScaling=t.useBrowserScaling,this.pica=new n({idle:a.picaCacheTimeout||2e3}),this.overlayImage=null,this.overlayDataArray=[],this.overlayDocumentId=null,this.pageLockOverlayOffset={offsetX:0,offsetY:0,locked:!0},this.overlayImageStripped=!1}i.prototype.setThumbnailOnPage=function(e,t){this.thumbnailImageBuffer[e]=t},i.prototype.getThumbnailFromPage=function(e){return this.thumbnailImageBuffer[e]},i.prototype.setOriginalOnPage=function(e,t){this.originalImageBuffer[e]=t},i.prototype.getOriginalFromPage=function(e){return this.originalImageBuffer[e]},i.prototype.setFallbackImageOnPage=function(e,t){this.errorFallbackImageBuffer[e]=t},i.prototype.setScaledOnPage=function(e,t){this.scaledImageBuffer[e]=t},i.prototype.getScaledFromPage=function(e){return this.scaledImageBuffer[e]},i.prototype.getManipulatedFromPage=function(e){return this.manipulatedImageBuffer[e]},i.prototype.setManipulatedOnPage=function(e,t){this.manipulatedImageBuffer[e]=t},i.prototype.setForceBrowserScaling=function(e){this.forceBrowserScaling=e},i.prototype.cleanOverlayOffset=function(){this.overlayDataArray=[],this.pageLockOverlayOffset&&(this.pageLockOverlayOffset={offsetX:0,offsetY:0,locked:!0})},i.prototype.getOverlayOffsetForPage=function(e){return e=e||0,e<0?null:null===this.overlayDataArray[e]?null:this.pageLockOverlayOffset.locked?this.pageLockOverlayOffset:(this.overlayDataArray[e]||(this.overlayDataArray[e]={offsetX:this.pageLockOverlayOffset.offsetX||0,offsetY:this.pageLockOverlayOffset.offsetY||0}),this.overlayDataArray[e])},i.prototype.addRequestedOriginalImage=function(e,t,n){var o=this.getOriginalFromPage(e);if(!o||t){o=new Image,this.setOriginalOnPage(e,o),$(o).data("awaitingBlob",!0),Modernizr.cors&&a.imageCrossOriginAttributeValue&&(o.crossOrigin=a.imageCrossOriginAttributeValue);var i=this;return $(o).on("load",function(){u(i,o,e,i.state)}),$(o).on("error",function(e){!o.fromObjectURL&&!o.complete||"Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser?g(n):v(n)}),o}},i.prototype.loadOriginalImageFromData=function(e,t,a,n,o){e=e||this.getOriginalFromPage(t),e||(e=this.addRequestedOriginalImage(t,!1,o)),r(e,a,n)};var r=function(e,a,n){t.enableCacheObfuscation&&(a=p(a)),n||(n=h(a));var o=new Blob([a],{type:n}),i=URL.createObjectURL(o);e.fromObjectURL=!0,e.svg="image/svg+xml"===n,e.src=i,$(e).data("awaitingBlob",!1)};i.prototype.getBestImageFromPage=function(e,t){var a,n=this.state;if(n.pageStates&&n.pageStates[e]&&n.pageStates[e].imageInfoLoaded){n.getLayerManager().imageLayerVisibilityHasChanged&&(n.getLayerManager().imageLayerVisibilityHasChanged=!1,c(n,!1,e,!0));var o=this.originalImageBuffer&&this.originalImageBuffer[e],i=!!o&&s(this.originalImageBuffer[e]),r=!!i&&this.checkIsOriginalImageValidOnIE(e),l=i||s(this.errorFallbackImageBuffer[e]);if(this.originalImageIsSVG[e]&&i&&r)a=this.originalImageBuffer[e];else if(n.isPageCropped(e)&&l)a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e],n.isPageManipulated(e)&&(this.scaledImageBuffer[e]&&this.scaledImageBuffer[e].width===this.originalImageBuffer[e].width?this.scaledImageBuffer[e]&&!this.manipulatedImageBuffer[e]?this.createManipulatedPage(e,n):this.manipulatedImageBuffer&&this.manipulatedImageBuffer[e]&&(a=this.manipulatedImageBuffer[e]):this.scalePageByPercentage(0,1));else if(this.manipulatedImageBuffer&&s(this.manipulatedImageBuffer[e]))a=this.manipulatedImageBuffer[e];else if(n.isPageManipulated(e)&&l&&s(this.scaledImageBuffer[e]))this.createManipulatedPage(e,n),a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e];else if(this.scaledImageBuffer&&s(this.scaledImageBuffer[e]))a=this.scaledImageBuffer[e];else if(l){var u=n.getZoomDecimal();this.scaleDocumentByPercentage(u),a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e]}else this.thumbnailImageBuffer&&s(this.thumbnailImageBuffer[e])&&(a=this.thumbnailImageBuffer[e]);return o||this.errorFallbackImageBuffer[e]||(t?c(n,!1,e):this.throttledRequestImageBatch(n)),a}},i.prototype.cacheImages=function(e){var a=this.state;e=e||a.pageNumber;var n=t.continuousScrollBufferBeforeSize||1,o=t.continuousScrollBufferAfterSize||3,i=e-n;i<0&&(i=0);var r=e+o;r>a.pageCount&&(r=a.pageCount);for(var s=i;s<r;s++)this.originalImageBuffer[s]||this.getBestImageFromPage(s)},i.prototype.invalidateImageObject=function(e){e&&($(e).off("load"),$(e).off("error"),e.src=a.bogusImageURL)},i.prototype.usePica=function(){var e="Explorer"===BrowserDetect.browser;return!(this.serverScale||this.state.getZoom()>=100||this.forceBrowserScaling||e&&!t.enableJSScalingForIE)},i.prototype.proceedWithScale=function(e,t,a){if(this.upcomingQueue=this.upcomingQueue||[],!this.originalImageBuffer||!this.originalImageBuffer[e])return this.upcomingQueue[0]&&this.upcomingQueue[0].page===e&&this.upcomingQueue.shift(),!1;if(this.cleanQueue(),!this.usePica())return!0;var n={page:e,width:t,height:a};if(0===this.picaID){if(!this.upcomingQueue.length)return this.upcomingQueue.push(n),!0;if(this.upcomingQueue[0].page===e)return!0}for(var o=0;o<this.upcomingQueue.length;o++)if(this.upcomingQueue[o].page===e)return this.upcomingQueue[o].width=t,this.upcomingQueue[o].height=a,!1;return this.upcomingQueue.push(n),!1},i.prototype.cleanQueue=function(){if(!this.originalImageBuffer)return void(this.upcomingQueue=[]);for(var e=0;this.upcomingQueue.length&&e<this.upcomingQueue.length;){var t=this.upcomingQueue[e].page;this.originalImageBuffer[t]||this.errorFallbackImageBuffer[t]?e++:this.upcomingQueue.splice(e,1)}},i.prototype.scalePageToDimensions=function(e,t,n){if(0!==t&&0!==n&&this.proceedWithScale(e,t,n)){var o=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e];if(s(o)){if(this.scaledImageBuffer&&this.scaledImageBuffer[e]){var i=this.scaledImageBuffer[e];if(i.width===t&&i.height===n)return}var r=document.createElement("canvas"),l=r.getContext("2d");r.width=o.width,r.height=o.height;try{l.drawImage(o,0,0,o.width,o.height)}catch(e){return}if(!this.usePica())return void this.setScaledOnPage(e,r);var u=document.createElement("canvas");u.width=t,u.height=n;var d=this;this.picaID=1,this.pica.resize(r,u,{quality:a.picaQuality,alpha:a.picaAlpha,unsharpAmount:a.picaUnsharpAmount,unsharpRadius:a.picaUnsharpRadius,unsharpThreshold:a.picaUnsharpThreshold}).then(function(){if(d.setScaledOnPage(e,u),d.upcomingQueue[0].page===e&&d.upcomingQueue.shift(),d.manipulatedImageBuffer[e]&&d.createManipulatedPage(e,d.state),virtualViewer.delayedPaintCanvases(),d.picaID=0,d.upcomingQueue.length>0){var t=d.upcomingQueue[0];d.scalePageToDimensions(t.page,t.width,t.height)}}).catch(function(){if(d.picaID=0,d.upcomingQueue[0]&&d.upcomingQueue[0].page===e&&d.upcomingQueue.shift(),d.upcomingQueue.length>0){var t=d.upcomingQueue[0];d.scalePageToDimensions(t.page,t.width,t.height)}})}}},i.prototype.scalePageByPercentage=function(e,t){var a=this.errorFallbackImageBuffer[e]||this.originalImageBuffer[e],n=this.scaledImageBuffer[e];if(s(a)){var o=Math.round(this.state.getOriginalWidthForPage(e)*t),i=Math.round(this.state.getOriginalHeightForPage(e)*t);(!n||n.width!==o&&n.height!==i)&&this.scalePageToDimensions(e,o,i)}},i.prototype.scaleDocumentByPercentage=function(e){this.scaleThrottleTimeoutId&&clearTimeout(this.scaleThrottleTimeoutId);var a=t.zoomTimeout||500,n=(t.continuousScrollBufferBeforeSize||1,t.continuousScrollBufferAfterSize||3,this);this.scaleThrottleTimeoutId=setTimeout(function(){for(var a=n.state,o=t.continuousScrollBufferBeforeSize||t.continuousScrollBufferSize,i=t.continuousScrollBufferAfterSize||t.continuousScrollBufferSize,r=Math.max(a.pageNumber-o,0),s=Math.min(a.getPageCount()-1,a.pageNumber+i),l=r;l<=s;l++)n.serverScale&&!n.originalImageIsSVG[l]?c(a,!1,l,!0):n.scalePageByPercentage(l,e)},a)},i.prototype.requestOverlayImage=function(n){if(!n)return!1;var i="getImage",r=!1,s=0;this.cleanOverlayOffset(),this.overlayImageStripped=!1;var l=new Image;this.overlayImage=l,this.overlayDocumentId=n,t.enableSVGSupport&&this.state.getSVGEnabledForPage(s)&&Modernizr.svg&&(t.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(t.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)&&(r=!0);var u=this.serverScale;this.serverScale=!1;var d=m(this.state,i,!1,s,r,n);this.serverScale=u,Modernizr.cors&&a.imageCrossOriginAttributeValue&&(l.crossOrigin=a.imageCrossOriginAttributeValue);var c=this;$(l).on("load",function(){l.fromObjectURL&&URL.revokeObjectURL(l.src),o.call("overlayImageLoadCompleted",{val:!0,documentId:c.state.getDocumentId(),overlayDocumentID:n});var e=50;"Explorer"!==BrowserDetect.browser||9!==BrowserDetect.version&&10!==BrowserDetect.version&&11!==BrowserDetect.version||(e=a.ie9DrawDelay),virtualViewer.delayedPaintCanvases(e),virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),virtualViewer.setDragMode(a.dragModes.overlay)}),$(l).on("error",function(){virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1);var t=e.getLocalizedValue("errors.imageFailedToLoad","Image failed to load.");c.state.markBadPage(s,!0),virtualViewer.displayExceptionMessage(t),virtualViewer.positionCanvases(state)}),o.call("imageLoadRequested",{documentId:c.state.getDocumentId(),val:!0}),c.requestImageViaXHR(d,l,{imageManager:c,page:null,overlay:!0})},i.prototype.stripWhite=function(t){this.overlayImageStripped||(t.src=e.whiteToTransparent(t),this.overlayImageStripped=!0)},i.prototype.checkIsImageComplete=function(e){return s(e)},i.prototype.checkIsOriginalImageValidOnIE=function(e){var t=this.originalImageBuffer[e];if(!s(t))return!1;var a=this.state.getDPIForPage(e);if(("Explorer"===BrowserDetect.browser||"Edge"===BrowserDetect.browser)&&t.width>1e3&&a>=300){var n=document.createElement("canvas");n.width=t.width,n.height=t.height;try{n.getContext("2d").drawImage(t)}catch(e){return!1}}return!0};var s=function(e){if(!e)return!1;var t=e.naturalWidth||e.width;return!("CANVAS"!==e.tagName||!t)||(!(!t||!e.complete)||!!e.complete&&(!("Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser||t)&&e.complete))},l=function(e,t,a,n){return s(t)?(e.imageCompletionTimeoutBuffer[a]=null,void d(e,t,a,n)):!e.originalImageBuffer[a]&&e.imageCompletionTimeoutBuffer[a]?(clearTimeout(e.imageCompletionTimeoutBuffer[a].timeoutId),void(e.imageCompletionTimeoutBuffer[a]=null)):(e.imageCompletionTimeoutBuffer[a]||(e.imageCompletionTimeoutBuffer[a]={timeoutId:0,polls:0}),e.imageCompletionTimeoutBuffer[a].polls++,void(e.imageCompletionTimeoutBuffer[a].timeoutId=setTimeout(function(){l(e,t,a,n)},50)))},u=function(e,t,a,n){t.fromObjectURL&&URL.revokeObjectURL(t.src),e.originalImageIsSVG[a]=t.svg,l(e,t,a,n),virtualViewer.getAllText(a,n)},d=function(e,n,i,r){n.width&&n.height||(n.width=r.getOriginalWidthForPage(i),n.height=r.getOriginalHeightForPage(i)),e.originalImageIsSVG[i]||e.scalePageByPercentage(i,r.getZoomDecimal()),r.setViewedForPage(i,!0);var s=50;"Explorer"!==BrowserDetect.browser||9!==BrowserDetect.version&&10!==BrowserDetect.version&&11!==BrowserDetect.version||(s=a.ie9DrawDelay),virtualViewer.delayedPaintCanvases(s);var l={state:r};t.positionLastBetweenDocuments&&0===i&&(l.applyAndResetCachedScroll=!0),virtualViewer.sizeScroller(l),virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),o.call("imageLoadCompleted",{documentId:r.documentId,page:i,val:!0})},c=function(n,i,r,s,l){var d="getImage",c=!1;if(n&&n.pageStates[r].imageInfoLoaded&&(r||0===r||(r=n.getPageNumber()),!n.isBadDocument()&&!n.isBadPage(r))){var p=n.getImageManager(),h=p.getOriginalFromPage(r);if(!p.errorFallbackImageBuffer[r]||s){var f={imageManager:p,recoveringFromError:i,page:r};if((!h||i||l)&&(h=new Image,l?p.setFallbackImageOnPage(r,h):p.setOriginalOnPage(r,h),$(h).on("load",function(){u(p,h,r,p.state)}),$(h).on("error",function(){!h.fromObjectURL&&!h.complete||"Explorer"!==BrowserDetect.browser&&"Edge"!==BrowserDetect.browser?g(f):v(f)})),t.enableSVGSupport&&n.getSVGEnabledForPage(r)&&Modernizr.svg&&(t.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(t.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)&&(c=!0),!e.validImageObject(h)&&!$(h).data("awaitingBlob")||s){if(p.cleanBuffers(),!Modernizr.webworkers)switch(t.singleThreadedScalingMode){case"browser":case"js":this.serverScale=!1;break;default:this.serverScale=!0}var y=m(n,d,!1,r,c,"",l);Modernizr.cors&&a.imageCrossOriginAttributeValue&&(h.crossOrigin=a.imageCrossOriginAttributeValue),o.call("imageLoadRequested",{documentId:n.documentId,page:r,val:!0}),p.requestImageViaXHR(y,h,f)}}}};i.prototype.throttledRequestImageBatch=function(e){clearTimeout(this.requestTimeout);var t=this;this.requestTimeout=setTimeout(function(){t.requestCurrentBufferOfImages(e)},"number"==typeof a.imageRequestThrottle?a.imageRequestThrottle:20)},i.prototype.requestCurrentBufferOfImages=function(e){var a=t.continuousScrollBufferBeforeSize||t.continuousScrollBufferSize,n=t.continuousScrollBufferAfterSize||t.continuousScrollBufferSize;"number"==typeof a&&"number"==typeof n||(a=1,n=2);for(var o=Math.max(e.pageNumber-a,0),i=Math.min(e.getPageCount()-1,e.pageNumber+n),r=o;r<=i;r++)c(e,!1,r)},i.prototype.requestFullImage=function(e,t,a){e=e||this.state,c(e,t,a)};var g=function(t){if(t=t||{},!t.thumbnail&&!t.overlay&&t.imageManager){var a=t.imageManager.state;if(virtualViewer.displayWaitIndicator(!1),virtualViewer.displaySaveIndicator(!1),t.imageManager.imageCompletionTimeoutBuffer[t.page]&&clearTimeout(t.imageManager.imageCompletionTimeoutBuffer[t.page].timeoutId),t.recoveringFromError){var n=e.getLocalizedValue("errors.imageFailedToLoad","Image failed to load."),o={client:!0,disable:virtualViewer.disableErrorModals.imageFailedToLoad};a.markBadPage(t.page,!0),virtualViewer.displayExceptionMessage(n,o)}else console.log("Error requesting page "+t.page+" of document "+a.getDocumentId()+". Retrying with a bitmap display."),a.setSVGEnabledForPage(t.page,!1),c(a,!0,t.page);virtualViewer.positionCanvases(a)}},v=function(t){var a=t.imageManager,n=a.state;if(a.imageCompletionTimeoutBuffer[t.page]&&(clearTimeout(a.imageCompletionTimeoutBuffer[t.page].timeoutId),a.imageCompletionTimeoutBuffer[t.page]=null),t.recoveringFromError||a.checkIsOriginalImageValidOnIE(t.page)||a.errorFallbackImageBuffer[t.page]){var o=e.getLocalizedValue("imageLoading.IEImageLoadError","Internet Explorer has failed to load the requested image due to memory limitations."),i={client:!0,disable:virtualViewer.disableErrorModals.IEImageLoadError};virtualViewer.displayExceptionMessage(o,i)}else console.log("Internet Explorer has failed to load the image on page "+t.page+" due to a memory issue. Falling back to a lower-resolution image."),a.originalImageBuffer[t.page].src="",a.originalImageBuffer[t.page]=null,c(n,!0,t.page,!1,!0)};i.prototype.requestImageViaXHR=function(e,t,a){$(t).data("awaitingBlob",!0);var n=this,o=new XMLHttpRequest,i=e.query();e.query(""),o.open("POST",e,!0),o.responseType="arraybuffer",o.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){if(4===o.readyState){if(200===o.status){var e=o.response,i=new Uint8Array(e);return r(t,i,null),void $(t).data("awaitingBlob",!1)}if(500===o.status&&virtualViewer.handle500Status(o.response,n.state?n.state.getDocumentId():null,n.state?n.state.currentPaneIndex:0))return void g(a);500===o.status&&($(t).data("awaitingBlob",!1),g(a),a.thumbnail&&$(t).trigger("error"))}},o.send(i)};var p=function(e){for(var t=[13,3,9,11,15,6,8,14,4,0,11,3,4,2,13,6,9,4,8,9,4,3,7,10,7,2,11,3,11,7,5,10],a=0;a<e.length;a+=1)e[a]=e[a]^t[a%t.length];return e},h=function(e){for(var t=[60,63,120,109,108],a=[137,80,78,71],n=!0,o=!0,i=0;i<4;i+=1)e[i]!==t[i]&&(o=!1),e[i]!==a[i]&&(n=!1);return n?"image/png":o?"image/svg+xml":"image/jpeg"},m=function(e,n,o,i,r,s,l){i||0!==i&&(i=e.pageNumber);var u=document.getElementById("vvOuterDiv"),d=new URI(t.servletPath);if(d.addQuery("action",n),s||(s=virtualViewer.getDocumentIdForPage(i,e)),o===!0?(d.addQuery("documentId",encodeURIComponent(s)),d.addQuery("clientInstanceId",encodeURIComponent(virtualViewer.getClientInstanceId())),d.addQuery("hiddenImageLayers",e.getLayerManager().getHiddenImageLayers(!0))):(d.addQuery("documentId",s),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("hiddenImageLayers",e.getLayerManager().getHiddenImageLayers())),d.addQuery("preferSvg",r),d.addQuery("pageNumber",virtualViewer.getPageIndexForPage(i,e)),d.addQuery("despeckle",e.getDespeckleForPage(i)),d.addQuery("antiAliasOff",e.getAntiAliasOffForPage(i)),e.getImageManager().serverScale)d.addQuery("requestedScale",e.getZoomDecimal());else if(l&&0!==e.getDPIForPage(i)){var c=72/e.getDPIForPage(i);d.addQuery("requestedScale",c)}else d.addQuery("requestedScale",1);return d.addQuery("clientWidth",u.clientWidth),d.addQuery("clientHeight",u.clientHeight),null!==virtualViewer.getOverlayPath()&&d.addQuery("overlayPath",virtualViewer.getOverlayPath()),a.cacheBuster===!0&&d.addQuery("cacheBuster",Math.random()),d.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),d};return i.prototype.cutPages=function(e){var t=[];e.sort(function(e,t){return e-t});for(var a=0,n=0;n<e.length;n+=1){var o=e[n]-a,i={thumb:this.thumbnailImageBuffer.splice(o,1)[0],original:this.originalImageBuffer.splice(o,1)[0],scaled:this.scaledImageBuffer.splice(o,1)[0],errorFallback:this.errorFallbackImageBuffer.splice(o,1)[0]};t.push(i),a+=1}return t},i.prototype.copyPages=function(e){var t=this,a=[];e.sort(function(e,t){return e-t});for(var n=0;n<e.length;n+=1){var o={thumb:t.thumbnailImageBuffer[e[n]],original:t.originalImageBuffer[e[n]],scaled:t.scaledImageBuffer[e[n]],errorFallback:t.errorFallbackImageBuffer[e[n]]};a.push(o)}return a},i.prototype.getPastedPages=function(e,t){for(var a=t;a<t+e;a++)this.cleanPageFromBuffers(a),this.getBestImageFromPage(a,!0)},i.prototype.createManipulatedPage=function(e,t){t||(t=virtualViewer.getCurrentState()),e||0===e||(e=t.pageNumber);var a=document.createElement("canvas"),n=a.getContext("2d");if(!this.scaledImageBuffer||!this.scaledImageBuffer[e])return a.width=0,a.height=0,this.manipulatedImageBuffer[e]=a,this.getBestImageFromPage(e,!0),!1;var i=t.getContrastForPage(e),r=t.getBrightnessForPage(e),s=t.getGammaForPage(e),l=!1,u=t.getInvertImageForPage(e),d=this.scaledImageBuffer[e],c=d.getContext("2d").getImageData(0,0,d.width,d.height),g=this.processImageManipulations(c,i,r,s,l,u);return a.width=d.width,a.height=d.height,n.putImageData(g,0,0),this.manipulatedImageBuffer[e]=a,o.call("imageManipulation",{documentId:t.getDocumentId(),page:e,gamma:t.getGammaForPage(e),brightness:t.getBrightnessForPage(e),contrast:t.getContrastForPage(e),invert:t.getInvertImageForPage(e)}),virtualViewer.delayedPaintCanvases(),!0},i.prototype.processImageManipulations=function(e,t,a,n,o,i){var r=e.data;n/=100;var s=1/n;t*=2;var l=259*(t+255)/(255*(259-t));a*=2;for(var u=0;u<r.length;u+=4){if(0!==t&&(r[u]=this.truncate(l*(r[u]-128)+128),r[u+1]=this.truncate(l*(r[u+1]-128)+128),r[u+2]=this.truncate(l*(r[u+2]-128)+128)),0!==a&&(r[u]=r[u]+a,r[u+1]=r[u+1]+a,r[u+2]=r[u+2]+a),n>1&&n<4&&(r[u]=255*Math.pow(r[u]/255,s),r[u+1]=255*Math.pow(r[u+1]/255,s),r[u+2]=255*Math.pow(r[u+2]/255,s)),o){var d=.299*r[u]+.587*r[u+1]+.114*r[u+2];r[u]=d,r[u+1]=d,r[u+2]=d}i&&(r[u]=255-r[u],r[u+1]=255-r[u+1],r[u+2]=255-r[u+2])}return e.data=r,e},i.prototype.truncate=function(e){return e>255?e=255:e<0&&(e=0),Math.floor(e)},i.prototype.processContrast=function(e,t){var a=t.data;e*=2;for(var n=259*(e+255)/(255*(259-e)),o=0;o<a.length;o+=4)a[o]=this.truncate(n*(a[o]-128)+128),a[o+1]=this.truncate(n*(a[o+1]-128)+128),a[o+2]=this.truncate(n*(a[o+2]-128)+128);return t},i.prototype.processBrightness=function(e,t){for(var a=t.data,n=0;n<a.length;n+=4)a[n]=a[n]+e,a[n+1]=a[n+1]+e,a[n+2]=a[n+2]+e;return t.data=a,t},i.prototype.processGamma=function(e,t){var a=t.data;e/=100;for(var n=1/e,o=0;o<a.length;o+=4)a[o]=255*Math.pow(a[o]/255,n),a[o+1]=255*Math.pow(a[o+1]/255,n),a[o+2]=255*Math.pow(a[o+2]/255,n);return t.data=a,t},i.prototype.processGreyscaleWeighted=function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=.299*t[a]+.587*t[a+1]+.114*t[a+2];t[a]=n,t[a+1]=n,t[a+2]=n}return e.data=t,e},i.prototype.processGreyscaleMean=function(e){for(var t=e.data,a=0;a<t.length;a+=4){var n=(t[a]+t[a+1]+t[a+2])/3;t[a]=n,t[a+1]=n,t[a+2]=n}return e.data=t,e},i.prototype.processInvert=function(e){for(var t=e.data,a=0;a<t.length;a+=4)t[a]=255-t[a],t[a+1]=255-t[a+1],t[a+2]=255-t[a+2];return e.data=t,e},i.prototype.nukeBuffers=function(){this.originalImageBuffer=[],this.scaledImageBuffer=[],this.manipulatedImageBuffer=[],this.thumbnailImageBuffer=[],this.errorFallbackImageBuffer=[],this.originalImageIsSVG=[]},i.prototype.cleanPageFromBuffers=function(e){this.originalImageBuffer[e]=null,this.scaledImageBuffer[e]=null,this.manipulatedImageBuffer[e]=null,this.thumbnailImageBuffer[e]=null,this.errorFallbackImageBuffer[e]=null,this.originalImageIsSVG[e]=null},i.prototype.scrubThumbnailBuffers=function(){this.thumbnailImageBuffer=[]},i.prototype.cleanBuffers=function(e){var a=this.state;e||(e=a.pageNumber);var n,o,i=virtualViewer.scrollPageFinder(a),r=t.continuousScrollBufferBeforeSize||1,s=t.continuousScrollBufferAfterSize||3,l=a.getPageCount();n=e<i?e-r:i-r,o=e>i?e+s:i+s;for(var u=0;u<l;u++)u>=n&&u<=o||this.cleanPageFromBuffers(u)},i}),define("vvMediaManager",["user-config/config","vvUtility"],function(e,t,a){function n(e){this.mediaDiv=document.createElement("div"),this.mediaDiv.className="vvMediaDiv",this.outerDiv=virtualViewer.getOuterDivFromState(e),this.outerDiv.append(this.mediaDiv),this.$captionDiv=$("<div>").addClass("vvCaptionDiv"),this.mediaDiv.appendChild(this.$captionDiv[0]),this.documentId=e.documentId,this.isVideoShown=!1,this.mediaType=null,this.callbackManager=virtualViewer.getCallbackManager(),this.playerLoaded=!1,this.availableCaptions=[];let t=this,a=function(n){t.documentId===n.documentId&&(t.availableCaptions=e.getDocumentModel().model.availableMediaCaptions||[],t.playerIsLoaded&&t.availableCaptions.length>0&&t.installCaptions(t.availableCaptions),t.callbackManager.removeInternalCallback("onDocumentLoad",a))};this.callbackManager.setInternalCallback("onDocumentLoad",a)}return n.prototype.getMedia=function(e){var t=this;return t.player?(t.showMediaDiv(),void t.resizeVideo()):void t.fetchMedia(e)},n.prototype.fetchMedia=function(e){var a,n=this,o=n.mediaSource=document.createElement("source");o.src=n.getMediaURI(),e=e||virtualViewer.getCurrentState(),n.mediaType===vvDefines.mediaType.video?(a=n.player=document.createElement("video"),a.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.ceil(100*(e.loaded/e.total));$("#waitIndicatorProgressBar").show(),$("#waitIndicatorProgressBar").attr("aria-valuenow",t).css("width",t+"%")}}),a.addEventListener("loadstart",function(){$("#vvVideoWaitIndicator").modal("hide"),n.setUpVideo({player:this,self:n})}),a.addEventListener("canplay",function(){n.resizeVideo()}),a.addEventListener("error",function(e){var a=e.currentTarget.error,o=t.getLocalizedValue("videoUnavailable","Video Unavailable");switch(a.code){case a.MEDIA_ERR_ABORTED:o=t.getLocalizedValue("videoAborted","Video aborted due to browser's request.");break;case a.MEDIA_ERR_NETWORK:o=t.getLocalizedValue("videoNetworkError","A network error occured that prevented video fetching.");break;case a.MEDIA_ERR_DECODE:o=t.getLocalizedValue("videoDecodeError","Current browser could not decode the video.");break;case a.MEDIA_ERR_SRC_NOT_SUPPORTED:o=t.getLocalizedValue("videoUnsupported","This video is unsupported on this browser.")}var i={client:!0,disable:virtualViewer.disableErrorModals.media};virtualViewer.displayExceptionMessage(o,i),virtualViewer.closeTab(n.documentId);var r={type:n.mediaType,documentId:n.documentId,error:e};n.callbackManager.call("mediaError",r)})):n.mediaType===vvDefines.mediaType.audio&&(a=n.player=document.createElement("audio"),a.addEventListener("progress",function(e){var t=Math.ceil(100*(e.loaded/e.total));$("#waitIndicatorProgressBar").show(),$("#waitIndicatorProgressBar").attr("aria-valuenow",t).css("width",t+"%")}),a.addEventListener("loadstart",function(){n.setUpAudio({player:this,self:n})}),a.addEventListener("error",function(e){var a=t.getLocalizedValue("audioUnavailable","Audio Unavailable"),o={client:!0,disable:virtualViewer.disableErrorModals.media};virtualViewer.displayExceptionMessage(a,o),virtualViewer.closeTab(n.documentId);var i={type:n.mediaType,documentId:n.documentId,event:e};n.callbackManager.call("mediaError",i)})),a.addEventListener("loadedmetadata",function(){n.playerIsLoaded=!0,n.availableCaptions.length>0&&n.installCaptions(n.availableCaptions)}),a.addEventListener("canplay",function(e){var t={type:n.mediaType,documentId:n.documentId,event:e};n.callbackManager.call("canPlay",t)}),a.addEventListener("canplaythrough",function(e){var t={type:n.mediaType,documentId:n.documentId,event:e};n.callbackManager.call("canPlayThrough",t)}),a.addEventListener("ended",function(e){var t={type:n.mediaType,documentId:n.documentId,event:e};n.callbackManager.call("mediaEnded",t)}),a.addEventListener("pause",function(e){var t={type:n.mediaType,documentId:n.documentId,event:e};n.callbackManager.call("mediaPause",t)}),a.addEventListener("play",function(e){var t={type:n.mediaType,documentId:n.documentId,event:e};n.callbackManager.call("mediaPlay",t)}),n.mediaDiv.appendChild(a),a.appendChild(o),virtualViewer.displayWaitIndicator(!0)},n.prototype.setUpVideo=function(t){var a=t.self||this,n=t.player||a.player,o=virtualViewer.getUserPreferences().videoPreferences;if(null==o.autoplay)return void virtualViewer.getCallbackManager().setInternalCallback("postLoadPreferencesVideo",this.setUpVideo);var i=e.videoPreload||"auto";n.preload=i,n.controls=o.controls,n.autoplay=o.autoplay,n.muted=o.mute,a.showMediaDiv(),a.resizeVideo(t),virtualViewer.displayWaitIndicator(!1)},n.prototype.setUpAudio=function(t){var a=t.self||this,n=t.player||a.player,o=virtualViewer.getUserPreferences().audioPreferences;if(null===o.loop)return void virtualViewer.getCallbackManager().setInternalCallback("postLoadPreferencesAudio",this.setUpAudio);var i=e.audioPreload||"auto";n.preload=i,n.mute=!1,n.controls=!0,n.autoplay=!1,n.style.display="block",this.applyMediaPreferences(o),a.showMediaDiv(),virtualViewer.displayWaitIndicator(!1),$(a.mediaDiv).addClass("vvAudioDiv"),this.resizeAudio(a)},n.prototype.fixMediaDivs=function(e){e&&(this.mediaType=e.documentModel.getMediaType()),e&&!$(this.mediaDiv).parent().length&&(this.outerDiv=virtualViewer.getOuterDivFromState(e),this.outerDiv.append(this.mediaDiv),this.documentId=e.documentId)},n.prototype.hideMediaDiv=function(e){var t=virtualViewer.getUserPreferences().audioPreferences;e=e||this.outerDiv.find(".vvInner"),$(this.mediaDiv).hide(),(this.mediaType===vvDefines.mediaType.audio&&!t.background||this.mediaType===vvDefines.mediaType.video)&&this.player.pause(),$(this.player).hide(),$(e).show(),this.outerDiv.find(".vvCanvas").show(),!$(this.outerDiv).hasClass("withScroll")&&$(this.outerDiv).hasClass("panMode")||$(this.outerDiv).css({overflow:"auto"}),virtualViewer.getEventManager().eventSwitch(!0),this.isVideoShown=!1},n.prototype.showMediaDiv=function(e){if(e=e||this.outerDiv.find(".vvInner"),$(this.mediaDiv).show(),this.player.autoplay){var t=this.player.play(),a=function(e){console.log(e.message)};t&&t.then(null,a)}$(this.player).show(),$(e).hide(),this.outerDiv.find(".vvCanvas").hide(),$(this.outerDiv).css({overflow:"hidden"}),virtualViewer.getEventManager().eventSwitch(!1),this.isVideoShown=!0},n.prototype.applyMediaPreferences=function(e){if(!e)return!1;var t=this.player;return null!==e.autoplay&&(t.autoplay=e.autoplay),null!==e.mute&&(t.muted=e.mute),null!==e.controls&&(t.controls=e.controls),null!==e.loop&&(t.loop=e.loop),!0},n.prototype.resizeMedia=function(e){"Audio"===this.mediaType?this.resizeAudio():this.resizeVideo(e)},n.prototype.resizeAudio=function(){var e=$(this.outerDiv).width(),t=$(this.player),a=$(this.mediaDiv);e>300?(width=e/2,a.css("margin-left",-width/2)):(width=300,a.css("margin-left",-150)),t.width(width),this.$captionDiv.width(width)},n.prototype.resizeVideo=function(e){var t,a;self=this,e||(e=virtualViewer.getUserPreferences().videoPreferences);var n=$(this.outerDiv).width(),o=$(this.outerDiv).height();self.mediaType===vvDefines.mediaType.audio?(t=300,a=100,self.resizeVideoTheater(t,a,n,o)):e.stretch?self.resizeVideoStretch(t,a,n,o):self.resizeVideoTheater(t,a,n,o)},n.prototype.resizeVideoStretch=function(e,t,a,n){e||(e=a),t||(t=n),this.player.width=e,this.player.height=t,"fixed"===$(this.mediaDiv).css("position")&&$(this.mediaDiv).css({top:0,left:0,position:"relative"})},n.prototype.resizeVideoTheater=function(e,t,a,n){(!e||e>a)&&(e=a),(!t||t>n)&&(t=n),e>this.player.videoWidth&&(e=this.player.videoWidth),t>this.player.videoHeight&&(t=this.player.videoHeight),t<300&&(t=300),e<400&&(e=400),this.player.width=e,this.player.height=t;var o=(a-e)/2+35,i=(n-t)/2+75;$(this.mediaDiv).css({top:i,left:o,position:"fixed"})},n.prototype.getMediaURI=function(){let t=new URI(e.servletPath);return clientInstanceId=virtualViewer.getClientInstanceId(),t.addQuery("action","getMedia"),t.addQuery("documentId",this.documentId),
t.addQuery("clientInstanceId",clientInstanceId),t},n.prototype.getCaptionURI=function(t){let a=new URI(e.servletPath);return clientInstanceId=virtualViewer.getClientInstanceId(),a.addQuery("action","getMediaCaption"),a.addQuery("documentId",this.documentId),a.addQuery("clientInstanceId",clientInstanceId),a.addQuery("captionIndex",t),a},n.prototype.toggleCaptions=function(e){"number"!=typeof e&&"string"!=typeof e&&(e=0);let t=this.player.textTracks,a=null,n=!1;for(let o=0;o<t.length;o++){let i=t[o];"showing"===i.mode&&(n=!0,i.mode="disabled"),o!==e&&i.label!==e||(a=i)}n||(a.mode="showing")},n.prototype.installCaptions=function(e){let t=virtualViewer.getUserPreferences(),a=!1;a=this.mediaType===vvDefines.mediaType.video?t.videoPreferences.captions:t.audioPreferences.captions;let n=this;for(let o=0;o<n.availableCaptions.length;o++){let t=e[o],i=document.createElement("track");i.default=t.default||0===o&&a,i.label=t.label,i.kind=t.kind||"captions",i.src=t.src||n.getCaptionURI(o),i.srclang=t.srclang,this.mediaType===vvDefines.mediaType.audio&&i.addEventListener("cuechange",function(e){n.$captionDiv.html("").show();let t=e.target.track.activeCues;for(let a=0;a<t.length;a++){let e=$("<p>").addClass("cue").html(t[a].text);n.$captionDiv.append(e)}}),this.player.appendChild(i)}},n}),define("vvThumbs",["require","vvUtility","user-config/config","vvDefines","vvImageManager","vvStateManager","vvCallbackManager"],function(e,t,a,n,o){var i=function(){var i=null,r=function(e){virtualViewer.openInTab($(this).data("thumbInfo").documentId)},s=function(e){var t=$(e.target).offset();$(e.target).closest(".vvThumbBox").trigger($.Event("contextmenu",{pageX:t.left-100,pageY:t.top}))},l=function(e){e.preventDefault(),virtualViewer.addPageToSelection($(e.target).closest(".vvThumbBox").data("thumb-info").pageNumber)},u=function(e){if(e.tapCount>1)return void l(e);virtualViewer.draggingPage=!0;var t=virtualViewer.getDocumentModel(),a=$(this).data("thumbInfo");a||(a=$(e.target).closest(".vvThumbBox").data("thumbInfo"));var n=a.pageNumber;e.ctrlKey===!0||e.metaKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.togglePageSelection(n):e.shiftKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.selectRange(n):(virtualViewer.checkPageManipulationsEnabled()&&(t.clearPageSelection(),t.addPageToSelection(n)),virtualViewer.currentMatch=0,virtualViewer.setPage(n),virtualViewer.skipScrollEvent=!0,$("#vvOuterDiv").scrollTop(virtualViewer.findPagePosition(n)))},d=function(e){this.src="resources/pageNotFound.png",$(this).parents(".vvThumbBox").find(".vvLoadingGif").remove(),$(this).removeClass(".vvImageLoading"),$(this).show(),$(this).addClass("displayedThumb");var t=parseInt($(this).css("width"),10),a=parseInt($(this).css("height"),10),o=n.thumbnailSize;t>a?($(this).css("height",a/(t/o)+"px"),$(this).css("width",o+"px")):($(this).css("width",t/(a/o)+"px"),$(this).css("height",o+"px"));var i=$(this).parents(".vvThumbBox").find(".vvThumbFooter");$(this).parents(".vvThumbBox").find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage"),i.width($(this).width()-2*parseInt(i.css("padding-left"),10))},c=function(t){var a=e("vvStateManager").getCurrentState(),n=$(this).closest(".vvThumbBox");let o=$(this);n.find(".vvLoadingGif").remove(),o.removeClass("vvImageLoading");let i=n.data("thumbInfo").pageNumber,r=o.parents("#vvPageThumbs").length,s=!!a&&n.data("thumbInfo").documentId===virtualViewer.getDocumentIdForPage(i,a);if(s&&r){var l=a.getImageManager();l.setThumbnailOnPage(i,o[0])}if(n.parent().length&&s){let e=a.getRotationForPage(i);e&&n.addClass("isRotated"),R(o,e)}o.addClass("displayedThumb vvImgLoaded"),o.show(),B(n),e("vvCallbackManager").call("onThumbLoadAndRendered",{documentId:n.data("thumbInfo").documentId,pageNumber:i})},g=function(e){var t=$(e).closest(".vvThumbBox"),a=t.data("thumbInfo").pageNumber;return 0===a||a?a:-1},v=function(t){if(virtualViewer.cleanupDrag(),virtualViewer.checkPageManipulationsEnabled()&&t.originalEvent&&t.originalEvent.dataTransfer){t.preventDefault();var a=g(this),n=t.originalEvent.dataTransfer.getData("text");if(n){var o=JSON.parse(n);if(!virtualViewer.clipIsVVObject(o))return M($("#vvPageThumbs .thumbPanel")),L(),void y($("#vvPageThumbs .thumbPanel"));var i=a;if(p($(this),t.clientY)||(i=a+1),virtualViewer.fixClipState(o),virtualViewer.draggingPage&&o.sessionGUID===virtualViewer.viewerSessionID){if(o.pageNums.indexOf(a)>-1||!virtualViewer.deleteSelection(o))return!1;for(var r=0;r<=o.pageNums.length-1&&o.pageNums[r]<=i;r++)i-=1}virtualViewer.draggingPage=!1,i>e("vvStateManager").getCurrentState().pageCount&&(i=e("vvStateManager").getCurrentState().pageCount),virtualViewer.pasteClip(o,null,i)}}},p=function(e,t){var a=e.height(),n=e.offset().top,o=n+a/2;return t<=o},h=function(e){var t=g(e.target);if(t>=0){var a=e.clientY;m(t,p($(this),a))}},m=function(e,t){var a=$("#vvPageThumbs .vvThumbBox").eq(e);$(".vvThumbDivider").remove(),t?$(a).before($("<div></div>").addClass("vvThumbDivider")):$(a).after($("<div></div>").addClass("vvThumbDivider"))},f=function(t){if(virtualViewer.checkPageManipulationsEnabled()&&t.originalEvent&&t.originalEvent.dataTransfer){var a=g(t.target);if(!(a<0)){virtualViewer.draggingPage=!0;var n=e("vvStateManager").getCurrentState().getDocumentModel();t.ctrlKey?n.addPageToSelection(a):t.shiftKey||t.metaKey===!0?n.selectRange(a):n.isPageSelected(a)||(n.clearPageSelection(),n.addPageToSelection(a));var o=t.originalEvent.dataTransfer;o.setData("text",JSON.stringify(virtualViewer.createClipObject())),o.dropEffect="move",o.effectAllowed="move"}}},y=function(t){if(t=t||_(),t.hasClass("thumbPanel")||(t=t.find(".thumbPanel")),t.length){var n=t.attr("id");n||(n=t.parent(".tab-pane").attr("id"));var i=O(t),r=e("vvStateManager").getCurrentState(),s=$(i).filter(function(){return $(this).hasClass("vvEmptyStandInThumb")});if(i=$(i).filter(function(){return!$(this).hasClass("vvEmptyStandInThumb")}),s.length){for(var l=$("#thumbnailPaneTemplate"),u=r.getDocumentModel().model.pageData,g=0;g<s.length;g++){var v=s.eq(g).data("subDocumentPageNumber"),p=s.eq(g).data("wholeDocumentPageNumber"),h={documentId:virtualViewer.getDocumentIdForPage(p,r),subDocumentPageNumber:v,wholeDocumentPageNumber:p,displayName:u[p].displayName},m={useFooter:!!a.displayThumbFooters,thumbList:[h],useImage:!a.doNotLoadPageThumbs,pageCount:r.getPageCount()},f=$(l.render(m));s.eq(g).replaceWith(f),s.eq(g).hasClass("activeThumbBox")&&f.addClass("activeThumbBox"),N(f),i.push(f)}B(i)}for(var y=0;y<i.length;y++){var P=$(i[y]),T=P.data("thumbInfo").pageNumber,A=P.find("img.vvLoadingGif"),I=P.find("img.vvImageLoading");if(A.length&&!I.length){var S=new Image;let e=$(S);e.on("load",c),e.on("error",d),e.insertBefore(A).hide(),e.addClass("vvThumbImage vvImageLoading");var w=z(P.data("thumbInfo"));if(P.hasClass("activeThumbBox")&&(e.addClass("activeThumb"),P.find(".vvThumbFooter").addClass("activeThumb")),r&&r.getDocumentModel()&&r.getDocumentModel().selection[T]&&b(T,!0),P.hasClass("selectedThumbBox")&&(e.addClass("selectedThumb"),P.find(".vvThumbFooter").addClass("selectedThumb")),S.draggable="true"===P.attr("draggable"),P.on("dragstart",function(e){"false"===P.attr("draggable")&&e.preventDefault()}),Modernizr.touchevents&&(Hammer(S).on("press",function(e){e.preventDefault()}),Hammer(P[0]).on("pressup",function(e){e.preventDefault()})),w){var C;r&&(C=r.getImageManager()),C||(C=new o),C.requestImageViaXHR(w,S,{thumbnail:!0})}}}}},b=function(e,t){var a=$("#vvPageThumbs .vvThumbBox").eq(e);return t?(a.addClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(a.removeClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").removeClass("selectedThumb"))},P=function(e,t,a){var n=$("#vvPageThumbs .vvThumbBox").slice(e,t);return a?(n.addClass("selectedThumbBox"),void n.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(n.removeClass("selectedThumbBox"),void n.find(".selectedThumb").removeClass("selectedThumb"))},T=function(t){$(".activeThumbBox").removeClass("activeThumbBox"),$(".activeThumb").removeClass("activeThumb");var a;if(t=t||e("vvStateManager").getCurrentState()){var n=t.getPageNumber();a=$("#vvPageThumbs .vvThumbBox").eq(n),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb"),a=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").pageNumber===n}),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")}var o=virtualViewer.getDocumentId(0),i=$("#vvDocThumbs .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").documentId===o});0===i.length&&(i=$("#vvDocThumbs .vvThumbBox:visible").first()),i.addClass("activeThumbBox"),i.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")},A=function(t){t=t||e("vvStateManager").getCurrentState();var a=0;t&&(a=t.getPageNumber());var n=$("#vvPageThumbs .vvThumbBox").eq(a);k($("#vvPageThumbs"),n)},I=function(e){e=e||virtualViewer.getDocumentId(0);var t=$("#vvDocThumbs .vvThumbBox").filter(function(t){return $(this).data("thumbInfo").documentId===e});t.length||(t=$("#vvDocThumbs .vvThumbBox").eq(0)),k($("#vvDocThumbs"),t)},S=function(t){t=t||e("vvStateManager").getCurrentState();var a=0;t&&(a=t.getPageNumber());var n=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").pageNumber===a});k($("#vvSearchResults"),n)},w=function(e){e?($("#vvImagePanel").removeClass("noThumbs noThumbsLeftSide"),$("#vvThumbs").show(),L(),x(virtualViewer.documentList),y($("#vvPageThumbs .thumbPanel")),y($("#vvDocThumbs .thumbPanel"))):(a.leftSideThumbPanel?$("#vvImagePanel").addClass("noThumbsLeftSide"):$("#vvImagePanel").addClass("noThumbs"),$("#vvThumbs").hide()),virtualViewer.processWindowResize()},C=function(){$(".thumbPanel").click(function(e){var t=virtualViewer.getDocumentModel(),a=$(e.target).closest("div.vvThumbBox, div.thumbStandIn");!a.length||a.hasClass("vvThumbBox")||a.hasClass("thumbStandIn")||t&&t.clearPageSelection()}).preventFocusOutlineOnClick().focus(function(e){T()}).keydown(function(e){var t=$(this),a=function(e){var a=t.find(".activeThumbBox");0===a.length&&(a=t.find(".vvThumbBox").first()),a.removeClass("activeThumbBox").find(".activeThumb").removeClass("activeThumb");var n=D(a,e);0===n.length&&(n=a),n.addClass("activeThumbBox").find(".displayedThumb, .vvThumbFooter").addClass("activeThumb");var o=n[0];o.scrollIntoViewIfNeeded?o.scrollIntoViewIfNeeded():o.scrollIntoView&&o.scrollIntoView()};if("ArrowUp"===e.key||"Up"===e.key||"ArrowLeft"===e.key||"Left"===e.key)a(!1),e.preventDefault();else if("ArrowDown"===e.key||"Down"===e.key||"Right"===e.key||"ArrowRight"===e.key)a(!0),e.preventDefault();else if("Enter"===e.key||" "===e.key||"Spacebar"===e.key){if("vvSearch"===e.currentTarget.id)return;var n=t.find(".activeThumbBox");if(!n)return;var o=t.find(".selectedThumbBox");if($("#vvSplitPaneDiv").is(":hidden")){var i;return i=0===n.length?0:n.data().thumbInfo.pageNumber,virtualViewer.toggleFullscreenThumbs(),void virtualViewer.setPage(i)}o&&(o.removeClass("selectedThumbBox"),o.find(".displayedThumb").removeClass("selectedThumb"));var r=n.data().thumbInfo;r.documentListThumb?virtualViewer.openInTab(r.documentId):(b(r.pageNumber,!0),virtualViewer.setPage(r.pageNumber)),e.preventDefault()}})},D=function(e,t){if(t){var a=e.nextUntil(".vvThumbBox:visible");return 0===a.length?e.next():a.last().next()}var n=e.prevUntil(".vvThumbBox:visible");return 0===n.length?e.prev():n.last().prev()},M=function(e){e&&!e.hasClass("thumbPanel")&&e.find(".thumbPanel"),e=e||_(),e.find(".vvThumbBox, .vvThumbDivider").tooltip("hide").remove()},x=function(e){var t=$("#vvDocThumbs .thumbPanel");if(M(t),e=e||virtualViewer.documentList,e.length){var a={thumbList:e,useImage:!0,isDocThumb:!0};U(t,a);var n=t.children(".vvThumbBox");if(n.on("click",r),n.contextMenu("vvDocThumbContextMenu",virtualViewer.docThumbContextMenu),Modernizr.touchevents)for(var o=0;o<n.length;o++){var l=new Hammer(n[o]);l.get("press").set({enable:!0}),l.on("press",s)}j(n,i)}},L=function(t){if(t=t||e("vvStateManager").getCurrentState(),t&&t.documentFullyLoaded()){var n=$("#vvPageThumbs .thumbPanel");if(M(n),a.showPageThumbnails){var o=virtualViewer.getDocumentModel(t).model.pageData,i={thumbList:o,useImage:!a.doNotLoadPageThumbs,pageCount:t.getPageCount()};U(n,i)}}},N=function(e){if(e.on("dragstart",f),e.on("dragover",h),e.on("drop",v),e.contextMenu("vvThumbContextMenu",virtualViewer.pageThumbContextMenuOptions),virtualViewer.showAllAnnotationIndicators(),!Modernizr.touchevents)return void e.on("click",u);for(var t=0;t<e.length;t++){var a=new Hammer(e[t]);a.get("press").set({enable:!0}),a.on("press",s),a.get("doubletap").set({domEvents:!0,enable:!0}),a.get("doubletap").recognizeWith("tap"),a.get("tap").requireFailure("doubletap"),a.on("tap",u)}BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&e.bind("touchstart",function(e){var t=e.timeStamp,a=$(this).data("lastTouch")||t,n=t-a,o=e.originalEvent.touches.length;$(this).data("lastTouch",t),!n||n>500||o>1||e.preventDefault()})},V=function(t,n){if(t=t||e("vvStateManager").getCurrentState(),t&&t.documentFullyLoaded()){var o=$("#vvSearchResults"),i=t.getDocumentModel().model.pageData,r=[];n=n||[];for(var s=0;s<n.length;s++){var l=n[s],d={};i[l]&&(d.documentId=virtualViewer.getDocumentIdForPage(l,t),d.wholeDocumentPageNumber=l,d.subDocumentPageNumber=virtualViewer.getPageIndexForPage(l,t),r.push(d))}var c={isSearchThumb:!0,thumbList:r,useImage:!a.doNotLoadPageThumbs,pageCount:t.getPageCount()},g=U(o,c,!0);g.on("click",u)}},k=function(e,t){if(!e||e.hasClass("thumbPanel")||e.hasClass("tab-pane")||(e=e.find(".thumbPanel")),t&&t.length&&e&&e.length){var a=e.scrollTop(),n=a+e[0].clientHeight,o=t[0].offsetTop,i=o+t[0].clientHeight;(i>n||o<a)&&e.scrollTop(o)}},F=function(t,a,n){if(e("vvStateManager").getOpenDocumentId()===t.getDocumentId()){let e=$("#vvPageThumbs .vvThumbBox").eq(a);e.addClass("isRotated"),R(e,n),B(e);var o=$("#vvSearchResults .vvThumbBox").filter(function(e){return $(this).data().thumbInfo.pageNumber===a});o&&o.length&&(o.addClass("isRotated"),R(o,n),B(o))}},R=function(e,t){let a=e;if(e.hasClass("vvThumbImage")||(a=e.find(".vvThumbImage")),a.removeClass("shadow90 shadow180 shadow270"),!t||!a.length||e.hasClass("vvEmptyStandInThumb")||a.hasClass("thumbStandIn"))return a.css("transform",""),void a.removeClass("dimensionFlip");a.addClass("shadow"+t);let n=a.height()||a[0].height||140,o=a.width()||a[0].width||140;if(180===t)a.css("transform","rotate(180deg)");else{let e=(n-o)/-2;270===t&&(e=-e),n>o?a.css("transform","rotate("+t+"deg) translateX("+e+"px) "):a.css("transform","rotate("+t+"deg) translate("+e+"px, "+e+"px) ")}a.toggleClass("dimensionFlip",180!==t),a.parent().toggleClass("dimensionFlip",180!==t)},B=function(e){if(e.length)for(var t=0;t<e.length;t++){var a=$(e[t]);if(a.find(".displayedThumb").length){a.find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage");var n=a.find(".vvThumbImage"),o=140;n.length&&(o=n.width()||n[0].width||o);let e=a.find(".vvThumbFooter"),t=a.find(".vvThumbShadowWrapper");if(e.width(""),t.width(""),t.height(""),e.css("transform",""),t.css({}),n.hasClass("dimensionFlip")){t.height(o+e.height());let a=n.height()||n[0].height;a>o?e.css("transform","translateY(-"+(a-o)+"px)"):e.css("transform","translateY("+Math.abs(a-o)+"px)"),o=a||140}e.width(o),t.width(o),E(a)}}},E=function(e){var a=e.find(".vvThumbImage"),n=e.data(),o=e.parents(".tab-pane").attr("id"),i="";n.thumbInfo?i=n.thumbInfo.displayName||n.thumbInfo.documentId:virtualViewer.getCurrentState(0)&&(i=virtualViewer.getCurrentState(0).getDisplayName()||virtualViewer.getCurrentState(0).getDocumentId());var r,s="number"==typeof n.wholeDocumentPageNumber?n.wholeDocumentPageNumber:n.thumbInfo.pageNumber;"vvPageThumbs"===o?r=t.getLocalizedValue("altText.pageThumbs.page","Thumbnail image for page ")+(s+1)+t.getLocalizedValue("altText.pageThumbs.doc"," of the document ")+i:"vvDocThumbs"===o?r=t.getLocalizedValue("altText.docThumbs","Thumbnail image for the document ")+i:"vvSearch"===o&&(r=t.getLocalizedValue("altText.searchThumbs.page","Search Result thumbnail image for page ")+(s+1)+t.getLocalizedValue("altText.searchThumbs.doc"," of the document ")+i),a.attr("alt",r)},O=function(e){if(e&&!e.hasClass("thumbPanel")&&(e=e.find(".thumbPanel")),!e.length)return[];var t=e;e.hasClass("tab-pane")||(t=e.parents(".tab-pane"));var a=e.find(".vvThumbBox"),n=$(a[0]).height()||1;n=n+parseInt($(a[0]).css("margin-top"),10)+parseInt($(a[0]).css("margin-bottom"),10);for(var o=t.scrollTop(),i=o+t[0].clientHeight,r=Math.max(parseInt(o/n,10)-2,0),s=[],l=r;l<a.length;l++)if(a[l].offsetTop+a[l].clientHeight>o&&a[l].offsetTop<i&&s.push(a[l]),a[l].offsetTop>i)return s;return s},_=function(){var e=$(".tab-pane.active .thumbPanel");return e},U=function(e,t,n){if(n||e.find(".vvThumbBox").remove(),t.useFooter=!!a.displayThumbFooters,e.parents("#vvPageThumbs").length){for(var o=document.createDocumentFragment(),i=0;i<t.thumbList.length;i++){var r=document.createElement("img");r.src="resources/loader.gif";var s=document.createElement("div");s.appendChild(r),s.classList.add("vvEmptyStandInThumb"),s.classList.add("vvThumbBox"),s.dataset.subDocumentPageNumber=t.thumbList[i].pageIndex,s.dataset.wholeDocumentPageNumber=i,o.appendChild(s)}return e[0].appendChild(o),void(t.useImage||y(e))}var l=$.templates("#thumbnailPaneTemplate"),u=$(l(t));return u.appendTo(e),n&&a.doNotLoadPageThumbs&&a.displayThumbFooters&&B(u),u},z=function(e){var t=new URI(a.servletPath);return t.addQuery("action","getThumbnail"),t.addQuery("pageNumber",e.subDocumentPageNumber),t.addQuery("searchThumb",!!e.searchThumb),t.addQuery("documentListThumb",!!e.documentListThumb),t.addQuery("documentId",e.documentId),t.addQuery("thumbnailSize",n.thumbnailSize),t.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t.addQuery("virtualPageNumber",e.pageNumber),t.addQuery("pageCount",e.pageCount||1),virtualViewer.getOverlayPath()&&t.addQuery("overlayPath",virtualViewer.getOverlayPath()),n.cacheBuster!==!0&&"Explorer"!==BrowserDetect.browser||t.addQuery("cacheBuster",Math.random()),t.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),t},W=function(e,t){var a=$("#vvDocThumbs .vvThumbBox.activeThumbBox");if(!a.length||a.data("thumb-info").documentId!==e)for(var n=$("#vvDocThumbs .vvThumbBox"),o=0;o<n.length;o++)if($(n[o]).data("thumb-info").documentId===e){a=$(n[o]);break}a.attr("data-original-title",t).tooltip("fixTitle"),a.find(".vvThumbFooter > div").text(t)},H=function(e){var t=$("#vvDocThumbs .thumbPanel"),a=t.find(".vvThumbBox");j(a,e),i=e,y(t)},j=function(e,t){t?e.each(function(e,a){var n=$(a),o=n.data().thumbInfo,i=o.displayName||o.documentId;i&&i.toLowerCase().indexOf(t.toLowerCase())>=0?n.show():n.hide()}):e.show()},Q=function(e,t){if(e&&e.length){var a;a=t?$("#vvDocThumbs .vvThumbBox"):$("#vvDocThumbs .vvThumbBox.vvDocumentIndicator");for(var n=virtualViewer.getCallbackManager(),o=0,i=0;i<a.length;i++){if(e.length===o)return;var r=$(a[i]),s=r.data().thumbInfo.documentId;if(!(e.indexOf(s)<0)){o++;var l={documentId:s};if(t){if(r.hasClass("vvDocumentIndicator"))continue;$("<div></div>",{class:"vvDocumentIndicatorCheckmark icon"}).prependTo(r),r.addClass("vvDocumentIndicator"),n.call("onFinishedMarkingDocumentThumbnail",l)}else r.children(".vvDocumentIndicatorCheckmark").remove(),r.removeClass("vvDocumentIndicator"),n.call("onFinishedRemoveMarkingDocumentThumbnail",l)}}}};return{prepareThumbPanels:C,fillDocThumbs:x,fillPageThumbs:L,fillSearchThumbs:V,buildThumbURI:z,loadVisibleThumbs:y,removeThumbs:M,setPageRangeThumbSelection:P,setPageThumbSelection:b,highlightActiveThumbnail:T,ensurePageThumbIsVisible:A,ensureDocThumbIsVisible:I,ensureSearchThumbIsVisible:S,setThumbPanelVisibility:w,updateDocumentDisplayName:W,filterDocumentThumbsByDisplayName:H,toggleDocViewedIndicator:Q,rotateThumb:F}}();return i}),define("vvFullThumbManager",["require","vvUtility","vvDefines"],function(t,a,n){"use strict";function o(){this.open=!1,this.thumbList=[],this.container=$("#vvFullThumbs"),this.largeThumbs=!1}var i,r;o.prototype.prepareFullThumbs=function(){this.container.on("scroll",g),$("#vvFullThumbSmallButton").hide(),$("#vvFullThumbLargeButton").hide(),$("#vvFullThumbs").hide(),this.fillGridThumbs(),vvConfig.doNotLoadPageThumbs&&$("#vvFullThumbLargeButton").addClass("disabled nonselectable").attr("aria-disabled",!0),vvConfig.disableImageTabs&&$("#vvFullThumbs").addClass("noTopMargin")},o.prototype.fillGridThumbs=function(e){if(e=e||t("vvStateManager").getCurrentState(),e&&e.documentFullyLoaded()){var a=virtualViewer.getDocumentModel(e).model.pageData,n={thumbList:a,useImage:!0,pageCount:e.getPageCount()};0===this.findScrolledThumbImages().length&&this.fillGridWithEmptyThumbs(n,e),this.renderEmptyThumbs(n,e)}},o.prototype.fillGridWithEmptyThumbs=function(e,a){if(0===this.thumbList.length)for(var n=0;n<e.thumbList.length;n++){var o=$("#thumbnailPaneTemplate");a=a||t("vvStateManager").getCurrentState();var i=a.getDocumentModel().model.pageData,r=e.thumbList[n].pageIndex,s=n,l={documentId:virtualViewer.getDocumentIdForPage(s,a),subDocumentPageNumber:r,wholeDocumentPageNumber:s,displayName:i[s].displayName},u={useFooter:!!vvConfig.displayThumbFooters,thumbList:[l],useImage:!vvConfig.doNotLoadPageThumbs,pageCount:a.getPageCount()},d=$(o.render(u));this.largeThumbs&&d.addClass("largeThumbnail"),this.container.append(d),this.assignPageThumbEvents(d),this.thumbList[n]=d}},o.prototype.removeAllThumbs=function(){this.thumbList=[],this.container.children().remove()},o.prototype.createSingleThumb=function(e){var t=$("#thumbnailPaneTemplate"),a={thumbList:[e],useImage:!vvConfig.doNotLoadPageThumbs,pageCount:e.pageCount},n=$(t.render(a));return this.largeThumbs&&n.addClass("largeThumbnail"),n},o.prototype.renderEmptyThumbs=function(e,a){a=a||t("vvStateManager").getCurrentState();var n;a&&(n=a.getImageManager()),n||(n=new VVImageManager),e.useFooter=!!vvConfig.displayThumbFooters;var o=this.findScrolledThumbImages();if(0===o.length)return this.fillGridWithEmptyThumbs(e,a),void(e.useImage||this.renderEmptyThumbs(e,a));for(var i=0;i<o.length;i++){var l=$(o[i]),u=l.find("img.vvLoadingGif"),d=l.find("img.vvImageLoading");if(u.length&&!d.length){var c=l.data("thumbInfo").pageNumber,g=new Image;$(g).insertBefore(u).hide();var v=this.buildThumbURI(l.data("thumbInfo"));$(g).addClass("vvThumbImage vvImageLoading"),$(g).on("load",this.thumbLoaded),$(g).on("error",this.thumbFailed),l.hasClass("activeThumbBox")&&($(g).addClass("activeThumb"),l.find(".vvThumbFooter").addClass("activeThumb")),a&&a.getDocumentModel()&&a.getDocumentModel().selection[c]&&r.setGridThumbSelection(c,!0),l.hasClass("selectedThumbBox")&&($(g).addClass("selectedThumb"),l.find(".vvThumbFooter").addClass("selectedThumb")),g.draggable="true"===l.attr("draggable"),l.on("dragstart",function(e){"false"===l.attr("draggable")&&e.preventDefault()}),Modernizr.touchevents&&(Hammer(g).on("press",function(e){e.preventDefault()}),Hammer(l[0]).on("pressup",function(e){e.preventDefault()})),v&&n.requestImageViaXHR(v,g,{thumbnail:!0}),s(l)}}};var s=function(e){if(e.length)for(var t=0;t<e.length;t++){var a=$(e[t]);if(a.find(".displayedThumb").length){a.find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage");var n=a.find(".vvThumbImage"),o=n.width(),i=n.height();let e=a.find(".vvThumbFooter"),t=a.find(".vvThumbShadowWrapper");e.width(""),t.width(""),t.height(""),t.removeClass("dimensionFlip"),e.css("transform",""),t.css({}),n.hasClass("dimensionFlip")&&(t.height(o+e.height()),t.addClass("dimensionFlip"),i>o?e.css("transform","translateY(-"+(i-o)+"px)"):e.css("transform","translateY("+Math.abs(i-o)+"px)"),o=i),e.width(o),t.width(o),l(a)}}},l=function(e){var t=e.find(".vvThumbImage"),n=e.data(),o=e.parents(".tab-pane").attr("id"),i="";n.thumbInfo?i=n.thumbInfo.displayName||n.thumbInfo.documentId:virtualViewer.getCurrentState(0)&&(i=virtualViewer.getCurrentState(0).getDisplayName()||virtualViewer.getCurrentState(0).getDocumentId());var r,s="number"==typeof n.wholeDocumentPageNumber?n.wholeDocumentPageNumber:n.thumbInfo.pageNumber;"vvPageThumbs"===o?r=a.getLocalizedValue("altText.pageThumbs.page","Thumbnail image for page ")+(s+1)+a.getLocalizedValue("altText.pageThumbs.doc"," of the document ")+i:"vvDocThumbs"===o?r=a.getLocalizedValue("altText.docThumbs","Thumbnail image for the document ")+i:"vvSearch"===o&&(r=a.getLocalizedValue("altText.searchThumbs.page","Search Result thumbnail image for page ")+(s+1)+a.getLocalizedValue("altText.searchThumbs.doc"," of the document ")+i),t.attr("alt",r)};o.prototype.ensureThumbIsVisible=function(e){e=e||t("vvStateManager").getCurrentState();var a=0;e&&(a=e.getPageNumber());var n=$("#vvFullThumbs .vvThumbBox").eq(a);if(!(this.container.children().length<1)){var o=this.container.scrollTop(),i=o+this.container.height(),r=n[0].offsetTop-($("#vvImageTabs").height()+2),s=r+n[0].clientHeight;(s>i||r<o)&&this.container.scrollTop(r)}},o.prototype.highlightActiveThumbnail=function(e){$("#vvFullThumbs .activeThumbBox").removeClass("activeThumbBox"),$("#vvFullThumbs .activeThumb").removeClass("activeThumb");var a;if(e=e||t("vvStateManager").getCurrentState()){var n=e.getPageNumber();a=$("#vvFullThumbs .vvThumbBox").eq(n),a.addClass("activeThumbBox"),a.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")}var o=virtualViewer.getDocumentId(0),i=$("#vvDocThumbs .vvThumbBox").filter(function(e){return $(this).data("thumbInfo").documentId===o});0===i.length&&(i=$("#vvDocThumbs .vvThumbBox:visible").first()),i.addClass("activeThumbBox"),i.find(".vvThumbImage, .vvThumbFooter").addClass("activeThumb")},o.prototype.assignPageThumbEvents=function(e){if(e.on("dragstart",A),e.on("dragover",y),e.on("drop",v),e.on("dragleave",b),e.contextMenu("vvThumbContextMenu",virtualViewer.pageThumbContextMenuOptions),!Modernizr.touchevents)return e.on("click",m),void e.on("dblclick",f);for(var t=0;t<e.length;t++){var a=new Hammer(e[t]);a.get("press").set({enable:!0}),a.on("press",p),a.get("doubletap").set({domEvents:!0,enable:!0}),a.get("doubletap").recognizeWith("tap"),a.get("tap").requireFailure("doubletap"),a.on("tap",m)}BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&e.bind("touchstart",function(e){var t=e.timeStamp,a=$(this).data("lastTouch")||t,n=t-a,o=e.originalEvent.touches.length;$(this).data("lastTouch",t),!n||n>500||o>1||e.preventDefault()})};var u=function(e,t){var a=e.width(),n=e.offset().left,o=n+a/2;return t<=o};o.prototype.findScrolledThumbImages=function(){var e=this.container,t=e.find(".vvThumbBox"),a=$(t[0]).height()||1;a=a+parseInt($(t[0]).css("margin-top"),10)+parseInt($(t[0]).css("margin-bottom"),10);for(var n=e.scrollTop(),o=n+e[0].clientHeight,i=Math.max(parseInt(n/a,10)-2,0),r=[],s=i;s<t.length;s++)if(t[s].offsetTop+t[s].clientHeight>n&&t[s].offsetTop<o&&r.push(t[s]),t[s].offsetTop>o)return r;return r},o.prototype.enlargeFullscreenThumbs=function(){if(!this.largeThumbs){for(var e=this.container.children(),t=0;t<e.length;t++){var a=$(e[t]);a.removeClass("smallThumbnail largeThumbnail"),a.addClass("largeThumbnail")}this.largeThumbs=!0,this.shallowRotateUpdate(),this.updateThumbImages(),this.ensureThumbIsVisible(),this.updateButtonColors()}},o.prototype.shrinkFullscreenThumbs=function(){if(this.largeThumbs){for(var e=this.container.children(),t=0;t<e.length;t++){var a=$(e[t]);a.removeClass("largeThumbnail smallThumbnail"),a.addClass("smallThumbnail")}this.largeThumbs=!1,this.shallowRotateUpdate(),this.updateThumbImages(),this.ensureThumbIsVisible(),this.updateButtonColors()}},o.prototype.updateButtonColors=function(){$("#vvFullThumbLargeButton, #vvFullThumbSmallButton").removeClass("selectedButton"),this.largeThumbs?$("#vvFullThumbLargeButton").addClass("selectedButton"):$("#vvFullThumbSmallButton").addClass("selectedButton")},o.prototype.disableToggleButton=function(e){e?$("#vvFullThumbToggleButton").addClass("disabled nonselectable").attr("aria-disabled",!0):$("#vvFullThumbToggleButton").removeClass("disabled nonselectable").attr("aria-disabled",!1)},o.prototype.deleteGridThumbs=function(e){if(Array.isArray(e)){for(var t=e.length-1;t>=0;t--){var a=e[t];$(this.thumbList[a]).remove(),this.thumbList.splice(a,1)}this.updatePageNumbers()}},o.prototype.pasteGridThumbs=function(e,t){if("number"==typeof e&&t){var a=virtualViewer.getCurrentState(),n=a.getPageCount(),o=this.container.children()[e];a.getImageManager().scrubThumbnailBuffers();for(var i=0;i<t.pageNums.length;i++){var r=t.model[0].documentId,s=t.pageNums[i]+e,l=e,u=(a.getDisplayName(),{documentId:r,subDocumentPageNumber:s,wholeDocumentPageNumber:l,pageCount:n}),d=t.pageState[i],c={thumbList:d,useImage:!0,pageCount:a.getPageCount()},g=this.createSingleThumb(u,a);this.renderEmptyThumbs(c,a),g.insertBefore(o),this.assignPageThumbEvents(g),this.thumbList.splice(e,0,g)}this.updatePageNumbers()}},o.prototype.nukeThenReload=function(e){this.removeAllThumbs(),this.fillGridThumbs(e),setTimeout(r.updateThumbImages,50),this.ensureThumbIsVisible(e)},o.prototype.updatePageNumbers=function(){var e=t("vvStateManager").getCurrentState(),a=virtualViewer.getDocumentModel(e).model.pageData,n={thumbList:a,useImage:!0,pageCount:e.getPageCount()};this.renderEmptyThumbs(n,e);for(var o=0;o<r.thumbList.length;o++){var i=$(r.thumbList[o]),s=i.data("thumbInfo");s.pageNumber=o,s.pageCount=e.pageCount,$(r.thumbList[o]).data("thumbInfo",s),i.data("aria-label","Page "+(o+1)),i.attr("data-original-title","Page "+(o+1))}},o.prototype.updateThumbList=function(){var e=this.container.children();this.thumbList=[];for(var t=0;t<e.length;t++)$(e[t]).hasClass("vvThumbBox")&&(this.thumbList[t]=e[t])},o.prototype.setOpen=function(e){this.open=e;var t=$("#vvFullThumbToggleButton");e?t.addClass("selectedButton"):t.removeClass("selectedButton")},o.prototype.toggleToolbarsForFullscreen=function(e){e?(vvConfig.disableAnnToolbar||$("#vvImageAndThumbs").removeClass("disabledAnnToolbar"),$("#virtualViewerMain").removeClass("fullscreen-thumbs")):($("#vvImageAndThumbs").addClass("disabledAnnToolbar"),$("#virtualViewerMain").addClass("fullscreen-thumbs"))},o.prototype.buildThumbURI=function(e){var t=new URI(vvConfig.servletPath);return t.addQuery("action","getThumbnail"),t.addQuery("pageNumber",e.subDocumentPageNumber),t.addQuery("searchThumb",!!e.searchThumb),t.addQuery("documentListThumb",!!e.documentListThumb),t.addQuery("documentId",e.documentId),t.addQuery("thumbnailSize",n.fullThumbnailSize),t.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t.addQuery("virtualPageNumber",e.pageNumber),t.addQuery("pageCount",e.pageCount||1),virtualViewer.getOverlayPath()&&t.addQuery("overlayPath",virtualViewer.getOverlayPath()),n.cacheBuster!==!0&&"Explorer"!==BrowserDetect.browser||t.addQuery("cacheBuster",Math.random()),t.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),t},o.prototype.thumbFailed=function(e){this.src="resources/pageNotFound.png",$(this).parents(".vvThumbBox").find(".vvLoadingGif").remove(),$(this).removeClass(".vvImageLoading"),$(this).show(),$(this).addClass("displayedThumb");var t=parseInt($(this).css("width"),10),a=parseInt($(this).css("height"),10),o=n.thumbnailSize;t>a?($(this).css("height",a/(t/o)+"px"),$(this).css("width",o+"px")):($(this).css("width",t/(a/o)+"px"),$(this).css("height",o+"px"));var i=$(this).parents(".vvThumbBox").find(".vvThumbFooter");$(this).parents(".vvThumbBox").find(".vvThumbFooterNoImage").removeClass("vvThumbFooterNoImage"),i.width($(this).width()-2*parseInt(i.css("padding-left"),10))},o.prototype.thumbLoaded=function(e){var a=t("vvStateManager").getCurrentState(),n=$(this).closest(".vvThumbBox");r.thumbLoadedCore(n,a,this),t("vvCallbackManager").call("onThumbLoadAndRendered",{documentId:n.data("thumbInfo").documentId,pageNumber:n.data("thumbInfo").pageNumber})},o.prototype.thumbLoadedCore=function(e,t,a){e.find(".vvLoadingGif").remove();var n=$(a);if(n.removeClass("vvImageLoading"),t&&n.parents("#vvFullThumbs").length){
var o=t.getImageManager();o.setThumbnailOnPage(e.data("thumbInfo").pageNumber,a)}if(t&&e.parent().length){let a=t.getRotationForPage(e.data("thumbInfo").pageNumber);a&&e.addClass("isRotated"),d(n,a)}n.addClass("displayedThumb vvImgLoaded"),n.show(),s(e)},o.prototype.clearThumbSelection=function(){var e=$("#vvFullThumbs .vvThumbBox.selectedThumbBox");e.removeClass("selectedThumbBox"),e.children().removeClass("selectedThumb")},o.prototype.setGridThumbSelection=function(e,t){var a=$("#vvFullThumbs .vvThumbBox").eq(e);return t?(a.addClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(a.removeClass("selectedThumbBox"),void a.find(".vvThumbImage, .vvThumbFooter").removeClass("selectedThumb"))},o.prototype.setPageRangeThumbSelection=function(e,t,a){var n=$("#vvFullThumbs .vvThumbBox").slice(e,t);return a?(n.addClass("selectedThumbBox"),void n.find(".vvThumbImage, .vvThumbFooter").addClass("selectedThumb")):(n.removeClass("selectedThumbBox"),void n.find(".selectedThumb").removeClass("selectedThumb"))},o.prototype.displaySelectedThumb=function(e){e=e||virtualViewer.getCurrentState();var t=e.getPageNumber(),a=this.thumbList[t][0];a.scrollIntoViewIfNeeded?a.scrollIntoViewIfNeeded():a.scrollIntoView&&a.scrollIntoView()},o.prototype.rotateThumb=function(e,a,n){if(t("vvStateManager").getOpenDocumentId()===e.getDocumentId()){let e=$("#vvFullThumbs .vvThumbBox").eq(a);e.addClass("isRotated"),d(e,n),s(e)}};var d=function(e,t){let a=e;e.hasClass("vvThumbImage")||(a=e.find(".vvThumbImage"));let n=a.parent();if(a.removeClass("shadow90 shadow180 shadow270"),!t||!a.length||e.hasClass("vvEmptyStandInThumb")||a.hasClass("thumbStandIn"))return a.css("transform",""),a.removeClass("dimensionFlip"),void n.removeClass("dimensionFlip");a.addClass("shadow"+t);let o=a.height()||a[0].height||200,i=a.width()||a[0].width||150;if(!r.largeThumbs&&(o>200||i>150)&&(o/=2,i/=2),180===t)a.css("transform","rotate(180deg)");else{let e=(o-i)/-2;270===t&&(e=-e),o>i?a.css("transform","rotate("+t+"deg) translateX("+e+"px) "):a.css("transform","rotate("+t+"deg) translate("+e+"px, "+e+"px) ")}a.toggleClass("dimensionFlip",180!==t),n.toggleClass("dimensionFlip",180!==t)};o.prototype.shallowRotateUpdate=function(){for(var e=virtualViewer.getCurrentState(),t=0;t<r.thumbList.length;t++){let a=r.thumbList[t],n=e.getRotationForPage(t);0!==n&&d(a,n)}s(r.thumbList)};var c=function(e){var t=$(e).closest(".vvThumbBox"),a=t.data("thumbInfo").pageNumber;return 0===a||a?a:-1};o.prototype.updateThumbImages=function(){var e=t("vvStateManager").getCurrentState();if(e&&e.documentFullyLoaded()){var a=virtualViewer.getDocumentModel(e).model.pageData,n={thumbList:a,useImage:!0,pageCount:e.getPageCount()};r.renderEmptyThumbs(n,e)}};var g=function(e){r.updateThumbImages()},v=function(e){if(virtualViewer.cleanupDrag(),virtualViewer.checkPageManipulationsEnabled()&&e.originalEvent&&e.originalEvent.dataTransfer){e.preventDefault();var a=c(this);T(a);var n=e.originalEvent.dataTransfer.getData("text");if(n){var o=JSON.parse(n);if(!virtualViewer.clipIsVVObject(o))return removeThumbs($("#vvFullThumbs .thumbPanel")),fillGridThumbs(),void loadVisibleThumbs($("#vvFullThumbs .thumbPanel"));if(1===o.pageNums.length&&o.pageNums[0]===a&&virtualViewer.viewerSessionID===o.sessionGUID)return void(virtualViewer.draggingPage=!1);var i=a;if(u($(this),e.clientX)||(i=a+1),virtualViewer.fixClipState(o),virtualViewer.draggingPage&&o.sessionGUID===virtualViewer.viewerSessionID){if(o.pageNums.indexOf(a)>-1||!virtualViewer.deleteSelection(o))return!1;for(var r=0;r<=o.pageNums.length-1&&o.pageNums[r]<=i;r++)i-=1}virtualViewer.draggingPage=!1,i>t("vvStateManager").getCurrentState().pageCount&&(i=t("vvStateManager").getCurrentState().pageCount),virtualViewer.pasteClip(o,null,i)}}},p=function(e){var t=$(e.target).offset();$(e.target).closest(".vvThumbBox").trigger($.Event("contextmenu",{pageX:t.left-100,pageY:t.top}))},h=function(e){e.preventDefault(),virtualViewer.addPageToSelection($(e.target).closest(".vvThumbBox").data("thumb-info").pageNumber)},m=function(e){if(e.tapCount>1)return void h(e);virtualViewer.draggingPage=!0;var t=virtualViewer.getDocumentModel(),a=$(this).data("thumbInfo");a||(a=$(e.target).closest(".vvThumbBox").data("thumbInfo"));var n=a.pageNumber;e.ctrlKey===!0||e.metaKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.togglePageSelection(n):e.shiftKey===!0?virtualViewer.checkPageManipulationsEnabled()&&t.selectRange(n):(virtualViewer.checkPageManipulationsEnabled()&&(t.clearPageSelection(),r.setPageRangeThumbSelection(0,t.model.pageData.length,!1),t.addPageToSelection(n)),virtualViewer.setPage(n),virtualViewer.skipScrollEvent=!0)},f=function(t){virtualViewer.toggleFullscreenThumbs();var a=$(this).data("thumbInfo");a||(a=$(e.target).closest(".vvThumbBox").data("thumbInfo"));var n=a.pageNumber;virtualViewer.setPage(n)},y=function(e){var t=c(e.target);t>=0&&P(t,u($(this),e.clientX))},b=function(e){var t=c(e.target);t>=0&&T(t)},P=function(e,t){var a=$("#vvFullThumbs .vvThumbBox").eq(e);$(".vvThumbDividerL").removeClass("vvThumbDividerL"),$(".vvThumbDividerR").removeClass("vvThumbDividerR"),t?$(a).addClass("vvThumbDividerL"):$(a).addClass("vvThumbDividerR")},T=function(e){$("#vvFullThumbs .vvThumbBox").eq(e);$(".vvThumbDividerL").removeClass("vvThumbDividerL"),$(".vvThumbDividerR").removeClass("vvThumbDividerR")},A=function(e){if(virtualViewer.checkPageManipulationsEnabled()&&e.originalEvent&&e.originalEvent.dataTransfer){var a=c(e.target);if(!(a<0)){virtualViewer.draggingPage=!0;var n=t("vvStateManager").getCurrentState().getDocumentModel();e.ctrlKey?n.addPageToSelection(a):e.shiftKey||e.metaKey===!0?n.selectRange(a):n.isPageSelected(a)||(n.clearPageSelection(),n.addPageToSelection(a));var o=e.originalEvent.dataTransfer,i=JSON.stringify(virtualViewer.createClipObject());o.setData("text",i),o.dropEffect="move",o.effectAllowed="all"}}},I=function(){return r=i=i||new o,i};return I()}),define("vvDocumentModel",["vvUtility","vvThumbs","vvFullThumbManager","vvDefines","user-config/config"],function(e,t,a,n,o){function i(e){return e?(this.model=e,this.selection=[],this.model.propertyHash={},this.lastSelectedPageNumber=0,this.model.watermarks||(this.model.watermarks=[]),void(this.model.documentNotes||(this.model.documentNotes={},this.model.documentNotes.notes=[]))):null}return i.prototype.init=function(){this.setPagesModifiedSinceInit(!1),this.setMetadataModifiedSinceInit(!1),this.setAnnotationsModifiedSinceInit(!1),this.setBookmarksModifiedSinceInit(!1),this.setNotesModifiedSinceInit(!1),this.setWatermarksModifiedSinceInit(!1),this.selection.length=this.getDocumentLength(),this.resetPageViewed()},i.prototype.addPageToSelection=function(e){this.lastSelectedPageNumber=e,this.selection[e]=!0,t.setPageThumbSelection(e,!0),a.setGridThumbSelection(e,!0)},i.prototype.removePageFromSelection=function(e){this.selection[e]=!1,t.setPageThumbSelection(e,!1),a.setGridThumbSelection(e,!1)},i.prototype.togglePageSelection=function(e){this.selection[e]=!this.selection[e],t.setPageThumbSelection(e,this.selection[e]),a.setGridThumbSelection(e,this.selection[e])},i.prototype.isPageSelected=function(e){return!!this.selection[e]},i.prototype.isInitialized=function(){return!!(this.model&&this.model.pageData.length>0)},i.prototype.selectRange=function(e){var n=this.lastSelectedPageNumber,o=e+1;o<=n&&(n=e,o=this.lastSelectedPageNumber);for(var i=n;i<o;i+=1)this.selection[i]=!0;t.setPageRangeThumbSelection(n,o,!0),a.setPageRangeThumbSelection(n,o,!0)},i.prototype.selectAll=function(){this.lastSelectedPageNumber=0,this.selectRange(this.selection.length-1)},i.prototype.clearPageSelection=function(){this.lastSelectedPageNumber=0,this.selection=[],this.selection.length=this.model.pageData.length,t.setPageRangeThumbSelection(0,this.model.pageData.length,!1),a.setPageRangeThumbSelection(0,this.model.pageData.length,!1)},i.prototype.cleanAfterSave=function(t,a,o){var i=this.model.pageData,r=encodeURIComponent(t);t&&(this.model.documentId=r),o&&(this.model.emailAttachmentInfo=null),this.setPagesModifiedSinceInit(!1),this.setMetadataModifiedSinceInit(!1),this.setAnnotationsModifiedSinceInit(!1),this.setBookmarksModifiedSinceInit(!1),this.setNotesModifiedSinceInit(!1),this.setWatermarksModifiedSinceInit(!1),this.setAnnotationsAsNotNew(),this.model.annotationLayersDeletedSinceInit=[];for(var s=0;s<i.length;s+=1){var l=i[s];e.isVirtualDocument(t)||(l.pageIndex=s),t&&!e.isVirtualDocument(t)&&(l.documentId=r,l.annotationHash&&$.each(l.annotationHash,function(e,t){t&&t.documentId&&(t.documentId=r)})),a&&0!==l.rotateAngle&&a.rotatePageTextSelectionBoxes(s,l.rotateAngle),l.rotateAngle=0,l.invertImage=!1,l.brightness=0,l.contrast=0,l.gamma=n.defaultGammaValue,l.despeckle=0}},i.prototype.cutSelection=function(e){var t=[];this.setPagesModifiedSinceInit(!0);for(var a=0;a<this.model.pageData.length;a+=1)e.indexOf(a)<0&&t.push(this.model.pageData[a]);this.model.pageData=t,this.clearPageSelection()},i.prototype.copySelection=function(){for(var t=[],a=0;a<this.selection.length;a+=1)if(this.selection[a]===!0){var n=this.model.pageData[a],o=e.deepObjCopy(n);t.push(o)}return t},i.prototype.paste=function(t,a){var n=0;this.setPagesModifiedSinceInit(!0);for(var o=0;o<t.length;o+=1)this.model.pageData.splice(a+n,0,e.deepObjCopy(t[o])),n+=1;this.clearPageSelection()},i.prototype.getMediaType=function(){return this.model.mediaType},i.prototype.getModifiedSinceInit=function(){return this.model.pagesModifiedSinceInit||this.model.metadataModifiedSinceInit||this.model.annotationsModifiedSinceInit||this.model.bookmarksModifiedSinceInit||this.model.notesModifiedSinceInit||this.model.watermarksModifiedSinceInit},i.prototype.getPagesModifiedSinceInit=function(){return this.model.pagesModifiedSinceInit},i.prototype.setPagesModifiedSinceInit=function(e,t,a){var n=this.model;if(n.pagesModifiedSinceInit=e,"number"==typeof t)n.pageData[t].isModified=e;else if(!e)for(var o=0;o<n.pageData.length;o++)n.pageData[o].isModified=!1;virtualViewer.updateTabName(a)},i.prototype.getMetadataModifiedSinceInit=function(){return this.model.metadataModifiedSinceInit},i.prototype.setMetadataModifiedSinceInit=function(e,t){this.model.metadataModifiedSinceInit=e,virtualViewer.updateTabName(t)},i.prototype.getAnnotationsModifiedSinceInit=function(){return this.model.annotationsModifiedSinceInit},i.prototype.setAnnotationsModifiedSinceInit=function(e,t){if(this.model.annotationsModifiedSinceInit=e,!e)for(var a=this.model.layerManager.layers,n=0;n<a.length;n+=1)a[n].dirty=!1;virtualViewer.updateTabName(t)},i.prototype.getBookmarksModifiedSinceInit=function(){return this.model.bookmarksModifiedSinceInit},i.prototype.setBookmarksModifiedSinceInit=function(e,t){this.model.bookmarksModifiedSinceInit=e,virtualViewer.updateTabName(t)},i.prototype.getNotesModifiedSinceInit=function(){return this.model.notesModifiedSinceInit},i.prototype.setNotesModifiedSinceInit=function(e,t){this.model.notesModifiedSinceInit=e,virtualViewer.updateTabName(t)},i.prototype.getWatermarksModifiedSinceInit=function(){return this.model.watermarksModifiedSinceInit},i.prototype.setWatermarksModifiedSinceInit=function(e,t){this.model.watermarksModifiedSinceInit=e,virtualViewer.updateTabName(t)},i.prototype.setAnnotationsAsNotNew=function(){for(var e=this.model.layerManager.layers,t=0;t<e.length;t+=1)e[t].newLayer=!1},i.prototype.getSelectedPageNumbers=function(){for(var e=[],t=0;t<this.selection.length;t+=1)this.selection[t]===!0&&e.push(t);return e},i.prototype.renameLayer=function(e,t){for(var a=this.model.layerManager.layers,n=null,o=0;o<a.length;o+=1)if(n=a[o],decodeURIComponent(n.annotationId)===e){n.annotationId=encodeURIComponent(t);break}for(var i=this.model.pageData,r=0;r<i.length;r+=1){var s=i[r],l=s.annotationHash;l&&(n=l[e],n&&(n.layerAnnotationId=t,l[t]=n,l[e]=void 0))}var u=(this.model.annotationLayersDeletedSinceInit||[]).indexOf(t);u>-1&&this.model.annotationLayersDeletedSinceInit.shift(u)},i.prototype.deleteLayer=function(e){for(var t=this.model.layerManager.layers,a=null,n=!1,i=!1,r=0;r<t.length;r++)if(a=t[r],decodeURIComponent(a.annotationId)===e){this.markLayerDirty(a),i=a.newLayer,a.annotationId=void 0,t.splice(r,1),n=!0;break}for(var s=this.model.pageData,l=0;l<s.length;l++){var u=s[l],d=u.annotationHash;d&&(a=d[e],a&&(delete d[e],a.layerAnnotationId=void 0,d[e]=void 0,n=!0),o.showAnnIndicators&&(virtualViewer.pageContainsAnnotations(l)||virtualViewer.removeAnnotationIndicators(l)))}n&&!i&&(this.model.annotationLayersDeletedSinceInit||(this.model.annotationLayersDeletedSinceInit=[]),this.model.annotationLayersDeletedSinceInit.indexOf(e)===-1&&this.model.annotationLayersDeletedSinceInit.push(e))},i.prototype.getDocumentLength=function(){return this.model.pageData.length},i.prototype.markLayerDirty=function(e){this.setAnnotationsModifiedSinceInit(!0);for(var t=this.model.layerManager.layers,a=0;a<t.length;a+=1)if(e.layerName===decodeURIComponent(t[a].annotationId)){t[a].dirty=!0;break}},i.prototype.setProperty=function(e,t){null===this.model.propertyHash&&(this.model.propertyHash={}),this.model.propertyHash[e]=t,this.setMetadataModifiedSinceInit(!0)},i.prototype.getProperty=function(e){return null===this.model.propertyHash?null:this.model.propertyHash[e]},i.prototype.setPropertyHash=function(e){this.model.propertyHash=e},i.prototype.isLayerDirty=function(e){this.isLayerDirtyByName(e.layerName)},i.prototype.isLayerDirtyByName=function(e){for(var t=this.model.layerManager.layers,a=0;a<t.length;a+=1)if(e===decodeURIComponent(t[a].annotationId))return!!t[a].dirty},i.prototype.resetPageViewed=function(){for(var e=this.model.pageData,t=0;t<e.length;t+=1)e[t].pageViewed=!1},i.prototype.hasRedactions=function(){for(var e=this.model.layerManager.layers,t=0;t<e.length;t+=1){var a=e[t];if(a&&a.isRedaction&&a.permissionLevel<n.permissionLevels.PERM_VIEW)return!0}return!1},i}),define("vvBookmarks",["vvUtility"],function(e){function t(){this.bookmark={page:null,note:null},this.bookmarkArray=[],a=this,this.editingBookmark=null,this.pageToAdd=-1}var a;return t.prototype.addBookmark=function(t,a,n,o){try{var i=virtualViewer.getCurrentState();if(i.isVirtualDocument())throw new Error(e.getLocalizedValue("errors.virtualDocumentBookmark","VirtualDocuments can't use Bookmarks"));var r=i.getDocumentModel();if(this.editingBookmark&&(this.editingBookmark=null),null===a||"undefined"==typeof a)if(this.pageToAdd!==-1)a=this.pageToAdd,this.pageToAdd=-1;else{var s=r.getSelectedPageNumbers();if(s.length>1)throw new Error(e.getLocalizedValue("errors.tooManyPagesSelected","Multiple pages are selected, and bookmarks may only be applied to a single page"));s.length<1&&(s=[i.pageNumber]),a=s[0]}var l=a>=0&&a<i.pageCount;if("number"!=typeof a||!l)return!1;if(this.bookmarkExists(a)){var u=e.getLocalizedValue("errors.bookmarkExists","Bookmark already exists!");throw new Error(u)}this.bookmark.page=a,0===t.length?this.bookmark.note=e.getLocalizedValue("bookmarks.bookmarkDefault","Bookmark"):this.bookmark.note=t;var d=this.copyBookmark(this.bookmark);this.bookmarkArray.push(d);var c=e.encodeForHTML(this.bookmark.note),g=$('<div id="page'+this.bookmark.page+'" class="vvBookmark"> ');return g.append("<hr>"),g.append('<div class="vvBookmarkPageNumber"> <a href=<b> Page: '+(this.bookmark.page+1)+"</b></a> <button type ='button' id = 'vvBookmarksCloseButton' class='smallClose vvBookmarksCloseButton'><span aria-hidden='true'>x</span></button></div>"),g.append('<span class="vvBookmarkContent ellipsis">'+c+"</span></div>"),$("#vvBookmarksInternal").prepend(g),$("#vvBookmarksCloseButton").attr("title",e.getLocalizedValue("bookmarks.deleteButton","Delete Bookmark")),$("#vvBookmarksCloseButton").attr("data-tooltip","tooltip"),this.addClickEvent(g,a),this.removeClickDefaults(),this.addXButton(a),o||r.setBookmarksModifiedSinceInit(!0,i),n||this.orderBookmarks(),!0}catch(e){var v={client:!0,disable:virtualViewer.disableErrorModals.bookmark,e:e};return virtualViewer.displayExceptionMessage(e.message,v),!1}},t.prototype.updateBookmarkDisplay=function(e){var t="#page"+e,a=$(t+" .vvBookmarkContent");a.text(this.editingBookmark.note)},t.prototype.editBookmark=function(t){try{if(!t&&0!==t)throw new Error(e.getLocalizedValue("bookmarkDialog.errors.noPage","Please pass a page number to edit a bookmark"));if(virtualViewer.getCurrentState().isVirtualDocument())throw new Error(e.getLocalizedValue("bookmarkDialog.errors.virtualDocument","Bookmarks are not supported on Virtual Documents"));for(var a,n=0;n<this.bookmarkArray.length;n++)if(this.bookmarkArray[n].page===t){this.editingBookmark=this.copyBookmark(this.bookmarkArray[n]),a=this.bookmarkArray[n];break}if(!a)throw new Error(e.getLocalizedValue("bookmarkDialog.errors.noBookmarks","No bookmark exists for the provided page"));var o=e.getLocalizedValue("bookmarkDialog.editTitle","Edit Bookmark");$("#vvBookmarkTitle").text(o),$("#vvBookmarkDialogNoteInput").val(a.note),$(".ui-widget-overlay ui-front").onContextMenu=function(){return!1},$("#vvBookmarkDialog").modal("show")}catch(e){var i={client:!0,disable:virtualViewer.disableErrorModals.bookmark,e:e};return virtualViewer.displayExceptionMessage(e.message,i),!1}},t.prototype.saveEditedBookmark=function(t){for(var a=virtualViewer.getCurrentState(),n=a.getDocumentModel(),o=-1,i=0;i<this.bookmarkArray.length;i++)if(this.bookmarkArray[i].page===this.editingBookmark.page){o=i;break}return o===-1?void(this.editingBookmark=null):(this.editingBookmark.note=t,0===this.editingBookmark.note.length&&(this.editingBookmark.note=e.getLocalizedValue("bookmarks.bookmarkDefault","Bookmark")),this.bookmarkArray[i]=this.editingBookmark,this.updateBookmarkDisplay(this.editingBookmark.page),void n.setBookmarksModifiedSinceInit(!0,a))},t.prototype.restoreBookmark=function(){null!==this.deletedBookmark&&(this.addBookmark(this.deletedBookmark.note,this.deletedBookmark.page,!1,!1),this.deletedBookmark=null)},t.prototype.bookmarkExists=function(e){for(var t=0;t<this.bookmarkArray.length;t++)if(this.bookmarkArray[t].page===e)return!0;return!1},t.prototype.removeClickDefaults=function(){$(".vvBookmark").click(function(e){e.preventDefault()}),$(".vvBookmarkPageNumber").click(function(e){e.preventDefault()}),$(".vvBookmarkContent").click(function(e){e.preventDefault()})},t.prototype.addClickEvent=function(e,t){$(e).click(function(e){return 2!==e.button&&(virtualViewer.getSplit()&&virtualViewer.setActivePane(0),virtualViewer.setPage(t),!1)}),$(e).on("contextmenu",function(e){e.preventDefault(),virtualViewer.getBookmarks().editBookmark(t)})},t.prototype.addXButton=function(e){for(var t=$("#vvBookmarksInternal")[0].children,a=0;a<t.length;a++){var n=parseInt(t[a].children[1].children[0].text.substring(7))-1;n===e&&$(t[a].children[1].children[1]).click(function(){return virtualViewer.getBookmarks().deleteBookmark(this,e),this.remove(),!1})}},t.prototype.deleteBookmark=function(t,n,o){try{var i,r=$("#vvBookmarksInternal")[0];if(0===r.children.length)throw new Error(e.getLocalizedValue("errors.pageHasNoBookmark","Page has no bookmark to delete."));var s=virtualViewer.getCurrentState();if(s.isVirtualDocument())throw new Error(e.getLocalizedValue("bookmarkDialog.errors.virtualDocument","Bookmarks are not supported on Virtual Documents"));if(null===n||void 0===n){if(!this.bookmark)throw new Error(e.getLocalizedValue("errors.invalidBookmark","Invalid Page or Bookmark"));n=this.bookmark.page}for(var l=!1,u=0;u<this.bookmarkArray.length;u++)if(this.bookmarkArray[u].page===n){l=!0;break}if(!l)throw i=e.getLocalizedValue("errors.pageHasNoBookmark","Page has no bookmark to delete."),new Error(i);var d=s.getDocumentModel();if(r&&t){var c=t.parentElement.parentElement,g=$(r).children().index(c);if(g<0||g>$(r).children().length)return;$($(r).children()[g]).remove(),g=this.bookmarkArray.length-(g+1),a.deletedBookmark=this.bookmarkArray.splice(g,1)[0],d.setBookmarksModifiedSinceInit(!0,s)}else if(r){for(var v=r.children,p=0;p<v.length;p++){var h=$(v[p]).html();h=h.substring(h.indexOf("Page:")+5,h.indexOf("</a>"));var m=parseInt(h)-1;if(m===n)break}$($(r).children()[p]).remove(),p=this.bookmarkArray.length-(p+1),a.deletedBookmark=this.bookmarkArray.splice(p,1)[0],this.clearBookmark(),d.setBookmarksModifiedSinceInit(!0,s)}}catch(e){if(!o){var f={client:!0,disable:virtualViewer.disableErrorModals.bookmark,e:e};virtualViewer.displayExceptionMessage(e.message,f)}return!1}},t.prototype.deleteBookmarks=function(e){if(!e)return!1;for(var t=e.length-1;t>=0;t--)this.deleteBookmark(null,e[t],!0);return!0},t.prototype.cutBookmarks=function(e){var t=[],a=$("#vvBookmarksInternal")[0],n=virtualViewer.getCurrentState(),o=n.getDocumentModel();if(a){if((null===e||void 0===e)&&this.bookmark)return null;for(var i=a.children,r=0;r<e.length;r++){var s=e[r];if(this.bookmarkArray[s]){var l=this.bookmarkArray[s].note;if(null===l)return!1;for(var u=0;u<i.length;u++){var d=i[u].innerText,c=parseInt(d.substring(d.indexOf(":")+1,d.indexOf(l)))-1;if(c===s)break}$($(a).children()[u]).remove(),u=this.bookmarkArray.length-(u+1),t.push(this.bookmarkArray.splice(u,1)[0]),this.clearBookmark(),o.setBookmarksModifiedSinceInit(!0,n)}}return t}return null},t.prototype.clearBookmark=function(){this.bookmark={page:null,note:null}},t.prototype.clearAllBookmarks=function(){this.clearBookmark();for(var e=$("#vvBookmarksInternal")[0],t=e.children.length-1;t>=0;t--)$(e.children[t]).remove();this.bookmarkArray=[]},t.prototype.copyBookmark=function(e){var t={page:e.page,note:e.note};return t},t.prototype.loadBookmarks=function(e){if(null!==e&&void 0!==e||(e=virtualViewer.getCurrentState()),e.isVirtualDocument())return!1;this.clearAllBookmarks();var t=e.getDocumentModel(),a=t.model.bookmarks;for(var n in a)if(n){var o=parseInt(n);this.addBookmark(decodeURIComponent(a[o][0]),o,!0,!0)}this.orderBookmarks()},t.prototype.saveBookmarks=function(e){null!==e&&void 0!==e||(e=virtualViewer.getCurrentState());for(var t=e.getDocumentModel(),a={},n=0;n<this.bookmarkArray.length;n++){var o=this.bookmarkArray[n];a[o.page]=[encodeURIComponent(o.note)]}t.model.bookmarks=a},t.prototype.addPages=function(e,t){for(var a=0;a<this.bookmarkArray.length;a++)this.bookmarkArray[a].page>=e&&(this.bookmarkArray[a].page+=t)},t.prototype.reducePages=function(e){for(var t=0;t<this.bookmarkArray.length;t++)for(var a=e.length-1;a>=0;a--)this.bookmarkArray[t].page>e[a]&&this.bookmarkArray[t].page--},t.prototype.shiftBookmarks=function(e,t,a){a?this.addPages(e,t.length):this.reducePages(t),this.orderBookmarks()},t.prototype.orderBookmarks=function(){for(var e=[],t=virtualViewer.getCurrentState(),a=0;a<t.pageCount;a++){for(var n=0;n<this.bookmarkArray.length;n++)this.bookmarkArray[n].page===a&&e.push(this.copyBookmark(this.bookmarkArray[n]));if(e.length==this.bookmarkArray.length)break}for(this.clearAllBookmarks(),a=e.length-1;a>=0;a--)this.addBookmark(e[a].note,e[a].page,!0,!0)},t.prototype.copyBookmarksForPageRange=function(e){for(var t=[],a=this.bookmarkArray.length-1;a>=0;a--)for(var n=this.bookmarkArray[a],o=0;o<e.length;o++)if(n.page===e[o]&&t.push(n),e.length===t.length)return t;return t},t.prototype.shiftPastePageNumbers=function(e,t,a){for(var n=[],o=0;o<e.length;o++)for(var i=0;i<t.length;i++)if(t[i].page===e[o]){book={page:o+a,note:t[i].note},n.push(book);break}return n},t.prototype.switchTabs=function(e,t){e&&e.getDocumentModel()&&this.saveBookmarks(e),this.clearAllBookmarks(),t&&t.getDocumentModel()&&this.loadBookmarks(t)},t}),define("vvWatermarks",["user-config/config","vvPoint","vvStateManager","vvDefines","vvUtility"],function(e,t,a,n,o){var i=function(){var n=function(e){if(e=e||a.getActivePaneState(),e.getDocumentModel().model.watermarks){var t=e.getDocumentModel().model.watermarks;e.watermarks=[];for(var n=0;n<t.length;n++)e.watermarks[n]=$.extend(!0,{},t[n]),e.watermarks[n].text=decodeURIComponent(e.watermarks[n].text)}else e.watermarks=[]},i=function(e){e=e||a.getActivePaneState();for(var t=[],n=$("#vvImageCanvas")[0].getContext("2d"),o=0;o<e.watermarks.length;o++){var i=$.extend(!0,{},e.watermarks[o]);if(i.text.indexOf(L.pageNumber.tagText)>=0)i.widthAtTenPx=0;else{var r=M(i,{state:e,pageNumber:0});n.save(),n.font='10px "'+i.format.font+'"';for(var s=0,l=0;l<r.length;l++)r[l].length>r[s].length&&(s=l);i.widthAtTenPx=Math.round(n.measureText(r[s]).width),n.restore()}i.text=encodeURIComponent(i.text),i.dynamicData=i.dynamicData||{},i.dynamicData.printTime=L.printTime.callback(),i.dynamicData.username=virtualViewer.getUserPreferences().getUsername(),t.push(i)}e.getDocumentModel().model.watermarks=t},r=function(e,t){P(e).push(t),b(e).push(t),e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)},s=function(e,t){e=e||a.getActivePaneState();var n=b(e);if(n&&n.length){var o=function(e,t){return e-t};t=t.sort(o);for(var i=0;i<n.length;i++){var r=n[i];if(!r.allPages&&r.pages){r.pages=r.pages.sort(o);for(var s=[],l=0,u=0;u<t.length;u++)for(var d=l;d<r.pages.length;d++)if(r.pages[d]!==t[u]){if(r.pages[d]>t[u]&&r.pages[d]>t[u+1]){l=d;break}r.pages[d]<t[u]?s.push(r.pages[d]-u):s.push(r.pages[d]-(u+1))}r.pages=s}}e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)}},l=function(e){var t=[];switch(e=e||"center",e.toLowerCase()){case"center":t=[N.CENTER,V.HORIZONTAL];break;case"top":t=[N.TOP,V.HORIZONTAL];break;case"bottom":t=[N.BOTTOM,V.HORIZONTAL];break;case"diagonal ascending":t=[N.BOTTOM,V.DIAGONAL];break;case"diagonal descending":t=[N.TOP,V.DIAGONAL];break;default:t=[N.CENTER,V.HORIZONTAL]}return t},u=function(t,n,i){t=t||a.getActivePaneState(),i=i||{};var s=n,u=i.transparency||!1,d=i.appearance,c=l(d),g={vertical:c[0],direction:c[1]},v=i.pageRangeType,p=i.pageRangeValue,h=o.validatePageRangeInput(v,p,t);if("OK"!==h)return!1;var m=!1,f=null;"all"===v&&(m=!0),"page range"===v?p&&(f=o.parseComplexPageString(p,t.getPageCount())):"current"===v&&(f=[t.getPageNumber()]),m||v||p||(v="current",f=[t.getPageNumber()]);var y=i.stretchPercent||1,b=i.fontName;let P=o.fontNames();P.indexOf(b)===-1&&(b="Times New Roman");var T=i.color;isHex(T)||(T="000000");var A={text:s,image:null,transparency:u,position:g,allPages:m,stretchPercent:y,pages:f,format:{font:b,color:T},adminCreated:e.adminCreated};r(t,A)},d=function(e){e=e||a.getActivePaneState();var t=b(e);if(t)for(var n=t.length-1;n>=0;n--)y(e,n),t[n]&&t[n].pages&&(t[n].pages=[])},c=function(e,t,a){var n=a.getPageCount(),o=t.pages||[];if(t.allPages)for(var i=n-1;i>=0;i--)o.push(i);var r=o.indexOf(e);r>-1&&o.splice(r,1),t.pages=o},g=function(e,t){t=t||a.getActivePaneState(),"number"!=typeof e&&(e=t.getPageNumber());var n=b(t);if(n){for(var o=0;o<n.length;o++){var i=n[o];(i.allPages||i.pages.indexOf(e)>-1)&&(c(e,i,t),0===i.pages.length&&y(t,o),i.allPages=!1)}t.getDocumentModel().setWatermarksModifiedSinceInit(!0,t)}},v=function(e,t,n){e=e||a.getActivePaneState();for(var o=b(e),i=[],r=0;r<o.length;r++){var s=o[r],l=$.extend(!0,{},s);if(n||(l.allPages=!1),s.pages=s.pages||[],l.pages=[],s.allPages)for(var u=0;u<t.length;u++)l.pages.push(u);else for(var d=0;d<s.pages.length;d++)(s.allPages||t.indexOf(s.pages[d])>-1)&&l.pages.push(d);i.push(l)}return i},p=function(e,t,n){e=e||a.getActivePaneState();var o=b(e);o||(o=e.watermarks=[]);for(var i=t.pageNums.length,r=t.watermarks.slice()||[],s=0;s<o.length;s++)o[s].allPages||(o[s].pages=o[s].pages.map(function(e){return e>=n?e+i:e}));for(var l=0;l<r.length;l++)r[l].pages=r[l].pages.map(function(e){return e+n});r=m(r,o),e.watermarks=r.concat(o),e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e)},h=function(e,t){for(var a,n=[];e.length&&t.length;)a=e.shift(),a===t[0]&&t.shift(),n.push(a);return n=n.concat(e).concat(t),n.sort(function(e,t){return e-t}),n},m=function(e,t){if(!e.length||!t.length)return e;for(var a=[],n=0;n<e.length;n++){for(var o=!1,i=0;i<t.length;i++)if(o=f(e[n],t[i]),o&&!t[i].allPages){t[i].pages=h(e[n].pages,t[i].pages);break}if(!o){var r=e[n],s=$.extend(!0,{},r);a.push(s)}}return a},f=function(e,t){return!(!e||!t)&&(e.position.direction===t.position.direction&&(e.position.vertical===t.position.vertical&&e.text===t.text))},y=function(e,t){var a=b(e),n=P(e),o=a[t],i=n.indexOf(o);return a&&a.length>t&&a.splice(t,1),n&&i>-1?(n.splice(i,1),0===n.length&&e.getDocumentModel().setWatermarksModifiedSinceInit(!1,e)):e.getDocumentModel().setWatermarksModifiedSinceInit(!0,e),o},b=function(e){return e.watermarks},P=function(e){return e.newWatermarks},T=function(e,t,a){if(a&&t&&(e||0===e))for(var n=b(t),o=0;o<n.length;o++){var i=n[o];(i.allPages||i.pages.indexOf(e)>-1)&&I(i,e,t,a)}},A=function(t){e.adminCreated=status},I=function(e,t,a,n){n.save();var o,i=a.getRequestedWidthForPage(t),r=a.getRequestedHeightForPage(t);if(a.isPageCropped(t)){var s=a.getOriginalWidthForPage(t)/i,l=a.getPageCropBox(t);i=Math.ceil(l.cropWidth/s),r=Math.ceil(l.cropHeight/s),o={cropWidth:i,cropHeight:r,cropLeft:Math.ceil(l.cropLeft/s),cropTop:Math.ceil(l.cropTop/s)}}var u=15*a.getZoomDecimal(),d={state:a,pageNumber:t},c=M(e,d),g=C(e,i,r),v=S(i,r,u,e,n,g,c),p=v/.85,h=c.length*p/2,m=w(e,i,r,u,o),f=D(e);n.translate(m.x,m.y),n.rotate(g),n.font=v+'px "'+e.format.font+'"',n.textAlign=f,n.fillStyle="#"+e.format.color,e.transparency&&(n.globalAlpha=.4);var y=0,b=0;e.position.vertical===N.TOP&&(n.textBaseline="hanging"),e.position.vertical!==N.CENTER&&"center"!==f||(b-=h,n.textBaseline="top");for(var P=0;P<c.length;P++)n.fillText(c[P],y,b),b+=p;n.restore()},S=function(e,t,a,n,o,i,r){for(var s=0,l=10,u=0;u<r.length;u++)r[u].length>r[s].length&&(s=u);o.font=l+'px "'+n.format.font+'"';var d=o.measureText(r[s]).width,c=e*n.stretchPercent,g=t;if(n.position.direction===V.VERTICAL)c=t*n.stretchPercent,g=e;else if(n.position.direction===V.DIAGONAL){n.position.vertical===N.BOTTOM&&(i=2*Math.PI-i);var v=r.length*l*.85/2,p=v/d,h=Math.sqrt(Math.pow(e,2)+Math.pow(t,2)),m=h*p/(Math.pow(Math.tan(i),-1)+2*p);c=h-2*m}c-=2*a,g-=2*a;var f=c/d,y=l*f,b=r.length*y;return b>g&&(y=g/r.length),y},w=function(e,a,n,o,i){var r=new t(o,o),s=new t(a/2,n/2),l=new t(a-o,n-o);i&&(r=new t(o+i.cropLeft,o+i.cropTop),s=new t(i.cropLeft+i.cropWidth/2,i.cropTop+i.cropHeight/2),l=new t(i.cropLeft+i.cropWidth-o,i.cropTop+i.cropHeight-o));var u=r;return e.position.vertical===N.BOTTOM?u.y=l.y:e.position.vertical===N.CENTER&&(u.y=s.y-o),e.position.direction===V.DIAGONAL&&(u=s),u},C=function(e,t,a){var n;return n=e.position.vertical===N.BOTTOM&&e.position.direction===V.DIAGONAL?2*Math.PI-Math.atan(a/t):e.position.vertical===N.TOP&&e.position.direction===V.DIAGONAL?Math.atan(a/t):e.position.direction===V.VERTICAL?Math.PI/2:0},D=function(e){return e.position.direction===V.DIAGONAL?"center":"left"},M=function(e,t){var a=e.text;for(var n in L)if(n&&L[n]&&L[n].tagText){var o=L[n].callback(t),i=L[n].tagText.replace("@@","/@/@").replace("@@","/@/@"),r=new RegExp(L[n].tagText,"ig");a=a.replace(r,o);var s=new RegExp(i,"ig");a=a.replace(s,L[n].tagText)}return a.split("\n")},x="LLL",L={username:{tagText:"@@username@@",callback:function(e){return virtualViewer.getUserPreferences().getUsername()}},totalPages:{tagText:"@@totalPages@@",callback:function(e){return e.state.pageCount}},pageNumber:{tagText:"@@pageNumber@@",callback:function(e){return e.pageNumber+1}},printTime:{tagText:"@@printTime@@",callback:function(e){return moment().format(x)}},serverTime:{tagText:"@@serverTime@@",callback:function(e){return moment().format(x)}},docName:{tagText:"@@documentName@@",callback:function(e){return e.state.getDisplayName()}}},N={TOP:0,CENTER:1,BOTTOM:2},V={HORIZONTAL:0,VERTICAL:1,DIAGONAL:2};return{loadWatermarks:n,saveWatermarks:i,addWatermarkJSON:r,removePages:s,removeAllWatermarks:d,addWatermark:u,copyWatermarksForPageRange:v,pastePagesWithWatermarks:p,removeWatermark:y,removeWatermarksFromPage:g,getWatermarksArray:b,paintPageWatermarks:T,setAdminStatus:A,renderFormattedText:M,tags:L,verticalPositionOptions:N,textDirectionOptions:V}}();return i}),define("vvDocViewState",["require","vvUtility","vvDocViewStateElement","vvLayerManager","vvImageManager","vvMediaManager","vvCallbackManager","vvDocumentModel","vvBookmarks","vvWatermarks","vvDefines","user-config/config","annotations","vvAnnotationManager","vvThumbs"],function(e,t,a,n,o,i,r,s,l,u,d,c){
function g(e,t,a,r,s,l){this.documentId=e,this.documentModel=t,this.documentByteSize=0,this.pageCount=a,this.pageNumber=r,this.tabNumber=s,this.currentPaneIndex=0,this.awaitingPageCount=!a,this.preferSVG=c.enableSVGSupport,this.closedTab=!0,this.currentLayer=null,this.autoLayerCounter=0,this.layerNames=[],this.layerManager=new n,this.imageManager=new o(this),this.mediaManager=new i(this),this.displayName=null,this.isSearchable=null,this.badDocument=!1,this.docFormat=null,this.documentNoteArray=[],this.cachedSearch=null,this.cachedServerLayers=null,this.cachedScroll={},this.zoom=100,this.zoomMode=l,this.timeout=-1,this.watermarks=null,this.demerits=0,this.initPageStatesArray(l),this.temporaryDocumentModelPropertyHash=null,this.newAnnotations=[],this.trueAnnChange=!1,this.newWatermarks=[],this.pagesAddedOrRemovedSinceInit=!1}g.prototype.documentFullyLoaded=function(){return!this.awaitingPageCount&&(!!(this.getDocumentModel()&&this.getDocumentModel().model&&this.getDocumentModel().model.pageData)&&!!(this.pageStates&&this.pageStates.length&&this.pageStates[this.getPageCount()-1]))},g.prototype.imageInfoLoaded=function(e){return!!this.pageStates&&(!(e<0||e>this.pageStates.length)&&(!!this.pageStates[e]&&this.pageStates[e].imageInfoLoaded))},g.prototype.proceedWithRequestPage=function(e,a,n,o){if(e<0||e>=this.getPageCount())return!1;if(!this.pageStates||!this.pageStates[e])return!1;if(c.delayFirstPageLoad&&!this.documentFullyLoaded())return!1;if(this.isVirtualDocument()&&0!==e&&!this.documentFullyLoaded())return!1;if(this.pageStates[e].imageInfoRequested&&!this.pageStates[e].imageInfoLoaded)return!1;var i=this.imageManager.getOriginalFromPage(e);if(this.pageStates[e].imageInfoLoaded&&t.validImageObject(i)&&(!n||!a))return!1;var r=t.validImageObject(i);return o&&o.recoveringFromImageError?(this.setSVGEnabledForPage(e,!1),!1):!(this.pageStates[e].imageInfoLoaded&&r&&n&&!a||this.pageStates[e].imageInfoLoaded&&r)},g.prototype.requestPage=function(e,a,n,o){if(this.proceedWithRequestPage(e,a,n,o)){this.imageManager.addRequestedOriginalImage(e,a||n,{imageManager:this.imageManager,page:e,recoveringFromError:!1}),r.call("imageLoadRequested",{documentId:this.getDocumentId(),page:e,val:!0});var i=new URI(c.servletPath);i.addQuery("action","getPage"),i.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.cacheBuster===!0&&i.addQuery("cacheBuster",Math.random()),i.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),c.enableSVGSupport&&Modernizr.svg&&(c.enableSVGSupportForIE||"Explorer"!==BrowserDetect.browser)&&(c.enableSVGSupportForEdge||"Edge"!==BrowserDetect.browser)?i.addQuery("preferSvg",!0):i.addQuery("preferSvg",!1),this.getLayerManager()&&i.addQuery("hiddenImageLayers",this.getLayerManager().getHiddenImageLayers(!0));var s,l;if(this.documentFullyLoaded())s=virtualViewer.getDocumentIdForPage(e,this),l=this.getDocumentModel().model.pageData[e].pageIndex;else if(this.isVirtualDocument()){var u=t.getVirtualDocumentFirstPageInfo(this.getDocumentId());s=u.documentId,l=u.pageIndex}else s=this.getDocumentId(),l=e;i.addQuery("documentId",s),i.addQuery("pageNumber",l),i.addQuery("imageInfoFields",JSON.stringify(c.imageInfoFields)),this.imageManager.serverScale?i.addQuery("requestedScale",this.getZoomDecimal()):i.addQuery("requestedScale",1),null!==virtualViewer.getOverlayPath()&&i.addQuery("overlayPath",virtualViewer.getOverlayPath());var g=this;this.pageStates[e].imageInfoRequested=!0;var v=new XMLHttpRequest,p=i.query();i.query(""),v.open("POST",i.toString(),!0),v.responseType="arraybuffer",v.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),v.onreadystatechange=function(){if(4===v.readyState){if(500===v.status){var t;if(v.response){var i=new Uint8Array(v.response),s=(new TextDecoder).decode(i);try{t=JSON.parse(s)}catch(e){t=null}}return t&&virtualViewer.checkServerException(t,g.getDocumentId(),g.currentPaneIndex),o&&o.recoveringFromInfoError?(g.markBadPage(e,!0),void r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:e,finalTry:!0})):(g.pageStates&&(g.pageStates[e].imageInfoRequested=!1),r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:e,finalTry:!1}),void g.requestPage(e,a,n,{recoveringFromInfoError:!0}))}for(var l=v.response,u=new Uint8Array(l),d=0,c="";d<=5&&!isNaN(parseInt(String.fromCharCode(u[d])))&&(c+=String.fromCharCode(u[d]),d++,"{"!==String.fromCharCode(u[d])););var p=parseInt(c);if(!c||!p)return o&&o.recoveringFromInfoError?void g.markBadPage(e,!0):(g.pageStates[e].imageInfoRequested=!1,void g.requestPage(e,a,n,{recoveringFromInfoError:!0}));var h=c.length,m=u.slice(h,p+h),f=(new TextDecoder).decode(m),y={};try{y=JSON.parse(f)}catch(e){y=null}if(!y)return o&&o.recoveringFromInfoError?(g.markBadPage(e,!0),void r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:pageNumber,finalTry:!0})):(g.pageStates[e].imageInfoRequested=!1,r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:pageNumber,finalTry:!1}),void g.requestPage(e,a,n,{recoveringFromInfoError:!0}));if(y.isMedia)return;g.processPage(e,y);var b=u.slice(p+h,u.length);if(!b)return void r.call("pageLoadError",{documentId:this.documentId,paneIndex:this.currentPaneIndex,pageNumber:pageNumber,finalTry:!1});var P=y.pageImageMimeType;g.imageManager.loadOriginalImageFromData(null,e,b,P,{imageManager:this.imageManager,page:e,recoveringFromError:!1})}},v.send(p)}},g.prototype.processPage=function(e,t){e===this.pageCount-1&&this.awaitingPageCount&&t.hasNextPage&&this.extendPageCount();var a=this.pageStates[e];a.imageInfoLoaded=!0;var n=this.getDocFormat();null!==n&&""!==n||this.setDocFormat(t.fileExtension);var o=this.getIsSearchable()||!1;this.setIsSearchable(t.isSearchable||o),a.isSearchable=t.isSearchable,a.originalWidth=t.imageWidth,a.originalHeight=t.imageHeight,a.dpi=t.imageDPI,a.bitDepth=t.imageBitDepth,a.imageFormat=t.imageFormat,a.compressionType=t.compressionType,this.setDocumentByteSize(t.documentByteSize),this.setImageLayers(t.imageLayerNames);var i=t.customerMetadataKeys||[],s=t.customerMetadataValues||[],l=t.tiffTagDataValues||[],u=t.tiffTagDataLabels||[],d={};if(i){for(var c=0;c<i.length;c++)d[i[c]]=s[c];this.setDocumentModelPropertyHash(d)}for(var g={},v=0;v<u.length;v++)g[u[v]]=l[v];return this.setTiffTagHashForPage(e,g),this.isPageManipulated(e)&&(this.getSVGEnabledForPage(e)?(this.setSVGEnabledForPage(e,!1),this.imageManager.cleanPageFromBuffers(e),this.imageManager.getBestImageFromPage(e,!0)):(this.imageManager.manipulatedImageBuffer[e]=null,this.imageManager.createManipulatedPage(e,this))),r.call("pageLoaded",{documentId:this.documentId,newDisplayName:decodeURIComponent(t.displayName),paneIndex:this.currentPaneIndex,loadedPageNumber:e,searchableStatusBeforeLoad:o}),!0},g.prototype.extendPageCount=function(){if(this.awaitingPageCount){this.pageStates[this.pageCount]=new a(this.zoomMode);var e=this.pageCount;this.setPageCount(e+1),r.call("pageCountUpdated",{documentId:this.documentId,paneIndex:this.currentPaneIndex,oldPageCount:e,newPageCount:this.pageCount})}},g.prototype.requestDocumentModel=function(e,t,a){a=a||{};var n=new URI(c.servletPath);n.addQuery("action","getDocumentModel"),n.addQuery("documentId",this.getDocumentId()),n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),a.ignoreXlsxPrintArea&&n.addQuery("ignoreXlsxPrintArea",a.ignoreXlsxPrintArea);var o=n.query();if(n.query(""),!this.getDocumentModel()||e){var i=this;$.ajax({url:n.toString(),type:"POST",data:o,dataType:"json",success:function(e){i.onDocumentModelLoadSuccess(e,t)},error:function(e){virtualViewer.checkServerException(e,i.getDocumentId(),i.currentPaneIndex),i.documentModelError(e)}})}},g.prototype.onDocumentModelLoadSuccess=function(e,t){if(virtualViewer.checkServerException(e,this.getDocumentId(),this.currentPaneIndex))return void this.documentModelError(e);var a=new s(e);a.init(),this.setDocumentModel(a),this.processDocumentModel(),this.isMedia()&&virtualViewer.setFullScreenThumbsVisibility(!1),r.call("onDocumentLoad",{documentId:this.getDocumentId(),paneIndex:this.currentPaneIndex}),"function"==typeof t&&t(this)},g.prototype.processDocumentModel=function(e){e||(e=this.documentModel),this.cachedServerLayers=t.deepObjCopy(e.model.layerManager.layers),(this.awaitingPageCount||this.getPageCount()!==e.model.pageData.length)&&(this.setPageCount(e.model.pageData.length),this.awaitingPageCount=!1,this.updatePageStatesArray(this.getPageCount(),this.zoomMode)),e.lastSelectedPageNumber=this.getPageNumber(),u.loadWatermarks(this),this.temporaryDocumentModelPropertyHash&&!e.model.propertyHash&&(e.setPropertyHash(this.temporaryDocumentModelPropertyHash),this.temporaryDocumentModelPropertyHash=null),!e.model.displayName||this.displayName&&!c.preferServerDisplayName?this.documentModel.model.displayName=encodeURIComponent(this.displayName):virtualViewer.setDisplayName(e.model.displayName,this.documentId)},g.prototype.documentModelError=function(e){var t={documentId:this.getDocumentId(),paneIndex:this.currentPaneIndex,exceptionMessage:e.exceptionMessage,statusText:e.statusText};r.call("requestDocumentModelError",t)},g.prototype.initPageStatesArray=function(e){this.pageStates=[new a(e)]},g.prototype.updatePageStatesArray=function(e,t){for(var n=new Array(e),o=0;o<e;o++)this.pageStates&&this.pageStates[o]?n[o]=this.pageStates[o]:n[o]=new a(t);this.pageStates=n},g.prototype.cutPages=function(e,t){var a=[];e.sort(function(e,t){return e-t});for(var n=0,o=0;o<e.length;o+=1){var i=e[o]-n;a.push(this.pageStates.splice(i,1)[0]),n+=1}return this.pageCount-=e.length,this.pageNumber=t,this.fixAnnPages(),a},g.prototype.copyPages=function(e){var a=[];e.sort(function(e,t){return e-t});for(var n=0;n<e.length;n+=1){var o=this.pageStates[e[n]],i=t.deepObjCopy(o);a.push(i)}return a},g.prototype.pastePages=function(e,t){for(var a=0;a<e.length;a++)this.pageStates.splice(t+a,0,e[a])},g.prototype.fixAnnPages=function(){for(var t=0;t<this.pageStates.length;t++){e("vvAnnotationManager").checkLayerIntegrity(t);for(var a=this.pageStates[t].annotationLayers,n=0;n<this.layerNames.length;n++){var o=a[this.layerNames[n]];if(o){for(var i=0;i<o.anns.length;i++)o.anns[i].page=t;o.pageNumber=t,this.getDocumentModel().markLayerDirty(o)}}}},g.prototype.saveAnnotationLayers=function(e){var t=this,a=this.getAnnotationLayers(e,!0,!0);if(a.length>0){var n=new URI(c.servletPath);n.addQuery("action","saveAnnotationModel"),n.addQuery("documentId",t.getDocumentId()),n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),n.addQuery("pageCount",t.getPageCount()),n.addQuery("modelJSON",JSON.stringify(a)),d.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var o=n.query();n.query(""),$.ajax({type:"POST",url:n.toString(),dataType:"json",data:o,success:function(e){var a=virtualViewer.getClientInstanceId(),n=virtualViewer.getCallbackManager();if(n.call("saveAnnotation",{documentId:t.getDocumentId(),clientInstanceId:a,documentIdToReload:e.documentIdToReload}),virtualViewer.checkServerException(e,t.getDocumentId(),t.currentPaneIndex)===!0){var o={documentId:t.documentId,clientInstanceId:a,exceptionMessage:e.exceptionMessage,statusText:e.statusText};return void r.call("saveAnnotationsError",o)}for(var i=t.documentModel.model.layerManager.layers,s=0;s<i.length;s+=1)i[s].dirty=!1;0===t.currentPaneIndex&&virtualViewer.updateTabName(t)},error:function(e){if(virtualViewer.checkServerException(e,t.getDocumentId(),t.currentPaneIndex)===!0){var a=virtualViewer.getClientInstanceId(),n={documentId:t.documentId,clientInstanceId:a,exceptionMessage:e.exceptionMessage,statusText:e.statusText};return void r.call("saveAnnotationsError",n)}}})}virtualViewer.displaySaveIndicator(!1)};var v=function(t,a){for(var n={},o=Object.keys(t),i=0;i<o.length;i++)n[o[i]]=t[o[i]];n.anns=[];for(var r=a.pageStates[t.pageNumber].originalWidth,s=a.pageStates[t.pageNumber].originalHeight,l=0;l<t.anns.length;l++){var u=(new(e("annotations"))).copyFrom(t.anns[l]),d=r/u.pageWidth;u.pageWidth=r,u.pageHeight=s,u.scaleAnn(d),u.getFontSize()&&u.setFontSize(u.getFontSize(!0)*d,!0),n.anns.push(u)}return n.pageWidth=r,n.pageHeight=s,n.docDPI=72,n};return g.prototype.getAnnotationLayers=function(a,n,o,i,r,s,l,u){var g=this,p="number"==typeof u?u:d.permissionLevels.PERM_EDIT,h=[];if(!g.pageStates)return h;for(var m=0;m<g.pageStates.length;m+=1){var f=g.pageStates[m];if(f.annotationLayers){n&&g.rotateLayersForPage(m,g.getRotationForPage(m),o);for(var y=0;y<g.layerNames.length;y+=1){var b=g.layerNames[y],P=f.annotationLayers[b],T=g.getDocumentModel().isLayerDirtyByName(b),A=null;if(P){if(e("vvAnnotationManager").checkLayerPermission(P,p)===!1||c.oneLayerPerAnnotation&&(!P.anns||!P.anns.length))continue;if(T||a){l&&f.dpi&&f.dpi<72&&P.anns.length&&72*P.pageWidth/P.docDPI*(72*P.pageHeight/P.docDPI)>1e9&&(P=v(P,g)),P.pageNumber=m,A='<?xml version="1.0" encoding="ISO-8859-1"?><document xmlns="http://snowbound.com/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://snowbound.com/XMLSchema flexAnn.xsd"><docMeta><docID>DOC_ID</docID><docName>ANNOTATED_FILE_NAME</docName><docDPI>',A+=P.docDPI>0?P.docDPI:f.dpi,A+="</docDPI></docMeta><docLayers><layer/></docLayers><docPages><page><pageMeta><pageNumber>",A+=P.pageNumber+"</pageNumber><pageWidth>",A+=P.pageWidth+"</pageWidth><pageHeight>",A+=P.pageHeight+"</pageHeight><doubleByte>",A+=P.doubleByte+"</doubleByte></pageMeta><pageObjects>";var I=!1;t.isRedactionLayer(P)&&(I=!0);for(var S=!1,w=!1,C=g.getRotationForPage(P.pageNumber),D=0;D<P.anns.length;D++)P.anns[D].getTextString()&&P.anns[D].getTextString().length&&(S=!0),w=I&&i||S&&r,I||S||!s||(w=!0),A+=P.anns[D].toXML(I,w,C),w=!1,S=!1;A+="</pageObjects></page></docPages></document>"}}A&&h.push({layerName:g.layerNames[y],isRedaction:P.isRedaction,pageNumber:P.pageNumber,layerXML:A})}}}return h},g.prototype.validatePageNumber=function(e){return(isNaN(e)||e===1/0||void 0===e||null===e||e<0)&&(e=this.getPageNumber()),e>=this.pageCount&&(e=this.pageCount-1),e},g.prototype.getDocumentLinks=function(e){e=this.validatePageNumber(e);let t=this.pageStates[e]||{};return t.sortedLinks||null},g.prototype.setDocumentLinks=function(e,t){e=this.validatePageNumber(e);let a=this.pageStates[e];t&&t.length>0&&a&&(a.sortedLinks=t)},g.prototype.rotateLayersForPage=function(e,t,a){e=this.validatePageNumber(e);var n=this.pageStates[e];if(n.annotationLayers)for(var o=0;o<this.layerNames.length;o+=1){var i=n.annotationLayers[this.layerNames[o]];if(i){for(var r=0;r<i.anns.length;r++)i.anns[r].rotate(t,a);if(0!==t&&this.getDocumentModel().markLayerDirty(i),!a&&(90===Math.abs(t)||270===Math.abs(t))){var s=i.pageWidth,l=i.pageHeight;i.pageHeight=s,i.pageWidth=l}}}},g.prototype.renameLayer=function(e,t){for(var a=0;a<this.layerNames.length;a+=1)if(this.layerNames[a]===e){this.layerNames[a]=t;break}for(var n=0;n<this.pageStates.length;n+=1){var o=this.getLayersForPage(n);if(o){var i=o[e];if(i){for(var r=0;r<i.anns.length;r+=1)i.anns[r].setLayerName(t);i.layerName=t,o[e]=null,o[t]=i}}}},g.prototype.deleteLayer=function(e){for(var t=0;t<this.pageStates.length;t++){var a=this.getLayersForPage(t);a&&delete a[e]}this.documentModel.deleteLayer(e)},g.prototype.deleteAnnotationsOnLayer=function(e){for(var t=this.pageNumber,a=0;a<this.pageStates.length;a+=1){virtualViewer.setPage(a);var n=this.getLayersForPage(a);if(n)for(var o=n[e].anns,i=0;i<o.length;i++)o[i].setDelete(!0)}virtualViewer.setPage(t)},g.prototype.deleteAllLayers=function(){for(var e=0;e<this.layerNames.length;e++)this.deleteAnnotationsOnLayer(this.layerNames[e])},g.prototype.deleteAllAnnsOnPage=function(e){for(var t=this.getLayersForPage(e),a=0;a<this.layerNames.length;a++)for(var n=this.layerNames[a],o=t[n],i=0;i<o.anns.length;i++){let e=o.anns[i];e.setDelete(!0),r.call("annotationDeletion",{documentId:this.getDocumentId(),annotationLayerId:e.layerName,annotationId:e.annId,type:e.getRefinedType()})}},g.prototype.restoreAllAnnsOnPage=function(e){for(var t=this.getLayersForPage(e),a=0;a<this.layerNames.length;a++)for(var n=this.layerNames[a],o=t[n],i=0;i<o.anns.length;i++)o.anns[i].setDelete(!1)},g.prototype.removeAnnotationsOnCroppedPages=function(){if(this.isDocumentCropped())for(var e=0;e<this.pageCount;e++)this.isPageCropped(e)&&this.deleteAllAnnsOnPage(e)},g.prototype.getDocumentId=function(){return this.documentId},g.prototype.isVirtualDocument=function(){return t.isVirtualDocument(this.documentId)},g.prototype.isCompoundDocument=function(){return!(!this.getDocumentModel()||!this.getDocumentModel().model)&&this.getDocumentModel().model.isCompoundDocument},g.prototype.getVirtualDocumentComponents=function(){var e=[];if(this.isVirtualDocument())for(var t=this.documentId.split(":")[1],a=t.split(","),n=0;n<a.length;n+=1)e.push(a[n].split("[")[0]);else e.push(this.documentId);return e},g.prototype.isMedia=function(){if(!this.documentModel)return!1;var e=this.documentModel.getMediaType();return e===d.mediaType.video||e===d.mediaType.audio||void 0},g.prototype.isVideo=function(){if(!this.documentModel)return!1;var e=this.documentModel.getMediaType();return e===d.mediaType.video||void 0},g.prototype.isAudio=function(){if(!this.documentModel)return!1;var e=this.documentModel.getMediaType();return e===d.mediaType.audio||void 0},g.prototype.isMediaLoaded=function(){return Boolean(this.isMedia()&&this.mediaManager.player&&this.mediaManager.mediaSource)},g.prototype.getTabNumber=function(){return this.tabNumber},g.prototype.setTabNumber=function(e){this.tabNumber=e},g.prototype.getClosedTab=function(){return this.closedTab},g.prototype.setClosedTab=function(e){this.closedTab=e},g.prototype.getDisplayName=function(){return this.displayName},g.prototype.setDisplayName=function(e){this.displayName=e,this.documentModel&&(this.documentModel.model.displayName=encodeURIComponent(e))},g.prototype.setPageDisplayNames=function(t){t=t||[];for(var a=this.getDocumentModel().model.pageData,n=0;n<a.length;n++)a[n].displayName=t[n];e("vvThumbs").fillPageThumbs(this),e("vvThumbs").loadVisibleThumbs($("#vvPageThumbs"))},g.prototype.getDocumentByteSize=function(){return this.documentByteSize},g.prototype.setDocumentByteSize=function(e){this.documentByteSize=e},g.prototype.getIsSearchable=function(){return this.isSearchable},g.prototype.setIsSearchable=function(e){this.isSearchable=e},g.prototype.getPageIsSearchable=function(e){return!(e<0||e>=this.getPageCount())&&this.pageStates[e].isSearchable},g.prototype.isBadDocument=function(){return this.badDocument},g.prototype.markBadDocument=function(e){this.badDocument=e},g.prototype.setDocFormat=function(e){this.docFormat=e},g.prototype.getDocFormat=function(){return this.docFormat},g.prototype.resetDocFormat=function(){this.docFormat=null},g.prototype.getDocumentModel=function(){return this.documentModel},g.prototype.setDocumentModel=function(e){this.documentModel=e},g.prototype.getPageCount=function(){return"undefined"==typeof this.pageCount&&this.pageStates?this.pageStates.length:this.pageCount},g.prototype.setPageCount=function(e){this.pageCount=e},g.prototype.getPageNumber=function(){return this.pageNumber},g.prototype.setPageNumber=function(e){isNaN(e)&&(e=0),this.pageNumber=e},g.prototype.getLayerNames=function(){return this.layerNames},g.prototype.setLayerNames=function(e){this.layerNames=e},g.prototype.getZoom=function(){return this.zoom},g.prototype.setZoom=function(e){this.zoom=e},g.prototype.getZoomDecimal=function(){return this.zoom/100},g.prototype.setZoomDecimal=function(e){this.zoom=100*e},g.prototype.getZoomMode=function(){return this.zoomMode},g.prototype.setZoomMode=function(e){this.zoomMode=e},g.prototype.zoomPage=function(e,t){var a=this.getOriginalWidthForPage(t),n=this.getOriginalHeightForPage(t);this.setRequestedWidthForPage(t,Math.round(a*e)),this.setRequestedHeightForPage(t,Math.round(n*e))},g.prototype.getCurrentLayer=function(){var e=this.pageStates[this.getPageNumber()];return this.currentLayer&&e.annotationLayers?e.annotationLayers[this.currentLayer]:null},g.prototype.setCurrentLayer=function(e){e?this.currentLayer=e.layerName:this.currentLayer=void 0},g.prototype.getCurrentLayerOnPage=function(e){var t=this.pageStates[e];return this.currentLayer&&t.annotationLayers?t.annotationLayers[this.currentLayer]:null},g.prototype.setCurrentLayerOnPage=function(e,t){t?this.currentLayer=t.layerName:this.currentLayer=void 0},g.prototype.getLayerManager=function(){return this.layerManager},g.prototype.getMediaManager=function(){return this.mediaManager},g.prototype.getImageManager=function(){return this.imageManager},g.prototype.getMedia=function(){if(this.mediaManager)return this.mediaManager.getMedia(this)},g.prototype.getViewedForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].pageViewed},g.prototype.setViewedForPage=function(e,t){e=this.validatePageNumber(e),t||(t=!0),this.documentModel&&(this.documentModel.model.pageData[e].pageViewed=t)},g.prototype.isBadPage=function(e){return e=this.validatePageNumber(e),this.pageStates[e].isBad},g.prototype.markBadPage=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].isBad=t},g.prototype.getSVGEnabledForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>e)return!!this.preferSVG&&this.pageStates[e].preferSVG},g.prototype.setSVGEnabledForPage=function(e,t){t||t===!1||(t=c.enableSVGSupport),e=this.validatePageNumber(e),this.pageStates[e].preferSVG=t},g.prototype.setPreferSVGForDocument=function(e){this.preferSVG=e},g.prototype.resetSVGSupport=function(e){null!==e&&void 0!==e||(e=c.enableSVGSupport),this.setPreferSVGForDocument(e),this.imageManager.nukeBuffers()},g.prototype.getOriginalHeightForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].originalHeight:0},g.prototype.getOriginalWidthForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].originalWidth:0},g.prototype.getRequestedHeightForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].requestedHeight:0},g.prototype.setRequestedHeightForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&(this.pageStates[e].requestedHeight=t)},g.prototype.getRequestedWidthForPage=function(e){return this.pageStates&&this.pageStates.length>0&&this.pageStates[e]?this.pageStates[e].requestedWidth:0},g.prototype.setRequestedWidthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&(this.pageStates[e].requestedWidth=t)},g.prototype.getRotationForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].rotateAngle/100},g.prototype.widthIsOnXAxis=function(e){var t=this.getRotationForPage(e);switch(t){case 0:case 180:case 18e3:return!0;case 90:case 9e3:case 270:case 27e3:return!1;default:return!0}},g.prototype.setRotationForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&this.documentModel.model.pageData[e].rotateAngle!==t&&(this.documentModel.model.pageData[e].rotateAngle=100*t,this.documentModel.setPagesModifiedSinceInit(!0,e))},g.prototype.getHorizontalFlipForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].flipHorizontal},g.prototype.setHorizontalFlipForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].flipHorizontal=t)},g.prototype.getVerticalFlipForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].flipVertical},g.prototype.setVerticalFlipForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].flipVertical=t)},g.prototype.getInvertImageForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].invertImage},g.prototype.setInvertImageForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&this.documentModel.model.pageData[e].invertImage!==t&&(this.documentModel.model.pageData[e].invertImage=t,this.documentModel.setPagesModifiedSinceInit(!0,e),this.imageManager&&this.imageManager.createManipulatedPage(e,this))},g.prototype.getBrightnessForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].brightness},g.prototype.getCachedBrightnessForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates)return this.pageStates[e].currentBrightness||d.defaultBrightnessValue},g.prototype.setCachedBrightnessForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].currentBrightness=t)},g.prototype.setBrightnessForPage=function(e,t){e=this.validatePageNumber(e),r.call("brightnessAdjustBegin",{documentId:this.getDocumentId(),page:e,currentBrightness:this.getBrightnessForPage(e),requestedBrightness:t}),this.documentModel&&(this.documentModel.model.pageData[e].brightness=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].brightness=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},g.prototype.getContrastForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].contrast},g.prototype.getCachedContrastForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates)return this.pageStates[e].currentContrast||d.defaultContrastValue},g.prototype.setCachedContrastForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].currentContrast=t)},g.prototype.setContrastForPage=function(e,t){e=this.validatePageNumber(e),r.call("contrastAdjustBegin",{documentId:this.getDocumentId(),page:e,currentContrast:this.getContrastForPage(e),requestedContrast:t}),this.documentModel&&(this.documentModel.model.pageData[e].contrast=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].contrast=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},g.prototype.getGammaForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].gamma},g.prototype.getCachedGammaForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates)return this.pageStates[e].currentGamma||d.defaultGammaValue},g.prototype.setCachedGammaForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].currentGamma=t)},g.prototype.setGammaForPage=function(e,t){e=this.validatePageNumber(e),r.call("gammaAdjustBegin",{documentId:this.getDocumentId(),page:e,currentGamma:this.getGammaForPage(e),requestedGamma:t}),0===t?t=1:400===t&&(t=399),this.documentModel&&(this.documentModel.model.pageData[e].gamma=t,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&(this.pageStates[e].gamma=t),this.imageManager&&this.imageManager.createManipulatedPage(e,this)},g.prototype.resetCachedPictureControlValues=function(){if(this.pageStates)for(var e=0;e<this.pageStates.length;e++)this.pageStates[e].currentContrast=d.defaultContrastValue,this.pageStates[e].currentBrightness=d.defaultBrightnessValue,this.pageStates[e].currentGamma=d.defaultGammaValue},g.prototype.getDespeckleForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].despeckle},g.prototype.setDespeckleForPage=function(e){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].despeckle=50,this.documentModel.setPagesModifiedSinceInit(!0,e)),this.pageStates&&this.pageStates[e].despeckle+30<=100&&(this.pageStates[e].despeckle+=30)},g.prototype.getAntiAliasOffForPage=function(e){if(e=this.validatePageNumber(e),this.documentModel&&this.documentModel.isInitialized())return this.documentModel.model.pageData[e].antiAliasOff},g.prototype.setAntiAliasOffForPage=function(e,t){e=this.validatePageNumber(e),this.documentModel&&(this.documentModel.model.pageData[e].antiAliasOff=t,this.documentModel.setPagesModifiedSinceInit(!0,e))},g.prototype.isPageManipulated=function(e){e=this.validatePageNumber(e);var t=!1;if(this.documentModel){var a=this.documentModel.model.pageData[e];(100!==a.gamma||0!==a.brightness||0!==a.contrast||a.invertImage)&&(t=!0)}return t},g.prototype.getAnnotationsForPage=function(t,a){for(var n=this.getLayersForPage(t)||{},o=[],i=Object.keys(n),r=0;r<i.length;r++){var s=n[i[r]]||{anns:[]};if(!a||e("vvAnnotationManager").checkLayerPermission(s,d.permissionLevels.PERM_VIEW))for(var l=0;l<s.anns.length;l++)a&&s.anns[l].annDelete||o.push(s.anns[l])}return o},g.prototype.getLayersForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0&&this.pageStates[e].annotationLayers)return this.pageStates[e].annotationLayers},g.prototype.pageContainsAnnotations=function(e){if(this.documentFullyLoaded()){if(e<0||e>=this.getPageCount())return!1;var t=this.getDocumentModel().model,a=t.layerManager.layers;if(!a||0===a.length)return!1;var n=t.pageData[e];if(!n)return!1;var o=n.annotationHash;if(!o)return!1;for(var i=0;i<a.length;i++){var r=o[a[i].annotationId];if(r&&r.annExists){var s=this.getLayersForPage(e);if(!s)return!0;for(var l=s[a[i].annotationId],u=l.anns,d=0;d<u.length;d++){var c=u[d];if(!c.annDelete)return!0}}}return!1}},g.prototype.documentContainsAnnotations=function(){for(var e=0;e<this.getPageCount();e++){var t=this.pageContainsAnnotations(e);if(t)return!0}return!1},g.prototype.setImageLayers=function(e){e&&e.length&&(this.imageLayers=e)},g.prototype.getImageLayers=function(){return this.imageLayers},g.prototype.setLayersForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].annotationLayers=t)},g.prototype.getLayerFromPage=function(e,t){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates[e].annotationLayers)return this.pageStates[e].annotationLayers[t]},g.prototype.addLayerToPage=function(e,t){e=this.validatePageNumber(e),this.addLayerToLayerNames(t.layerName),this.pageStates&&(this.pageStates[e].annotationLayers||this.setLayersForPage(e,{}),this.pageStates[e].annotationLayers[t.layerName]=t)},g.prototype.addLayerToLayerNames=function(e){this.layerNames.indexOf(e)<0&&this.layerNames.push(e)},g.prototype.clearAllLayers=function(){this.layerNames=[];for(var e=0;e<this.pageStates.length;e+=1){var t=this.pageStates[e];t.annotationLayers=void 0}this.documentModel.setAnnotationsModifiedSinceInit(!1,this)},g.prototype.rollbackModelLayers=function(){var e=this.getDocumentModel();e.model.layerManager.layers=t.deepObjCopy(this.cachedServerLayers),e.model.annotationLayersDeletedSinceInit=[]},g.prototype.getDPIForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].dpi},g.prototype.setDPIForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].dpi=t)},g.prototype.getCompressionTypeForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].compressionType},g.prototype.setCompressionTypeForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].compressionType=t)},g.prototype.getBitDepthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].bitDepth},g.prototype.setBitDepthForPage=function(e,t){
e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].bitDepth=t)},g.prototype.getFormatForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].imageFormat},g.prototype.setFormatForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].imageFormat=t)},g.prototype.getTiffTag=function(e,t){if(e=this.validatePageNumber(e),this.pageStates)return this.pageStates[e].tiffTagHash[t]},g.prototype.setTiffTag=function(e,t,a){e=this.validatePageNumber(e),this.pageStates&&(null===this.pageStates[e].tiffTagHash&&(this.pageStates[e].tiffTagHash={}),this.pageStates[e].tiffTagHash[t]=a)},g.prototype.setTiffTagHashForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].tiffTagHash=t)},g.prototype.getOriginalWidthForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalWidth},g.prototype.setOriginalWidthForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].originalWidth=t)},g.prototype.getOriginalHeightForPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates.length>0)return this.pageStates[e].originalHeight},g.prototype.setOriginalHeightForPage=function(e,t){e=this.validatePageNumber(e),this.pageStates&&(this.pageStates[e].originalHeight=t)},g.prototype.getCachedScrollLeft=function(){return this.cachedScroll.left},g.prototype.setCachedScrollLeft=function(e){"number"==typeof e&&(this.cachedScroll.left=e)},g.prototype.getCachedScrollTop=function(){return this.cachedScroll.top},g.prototype.setCachedScrollTop=function(e){"number"==typeof e&&(this.cachedScroll.top=e)},g.prototype.clearCachedScroll=function(){this.cachedScroll={}},g.prototype.setDocumentModelProperty=function(e,t){return this.documentModel?void this.documentModel.setProperty(e,t):(this.temporaryDocumentModelPropertyHash=this.temporaryDocumentModelPropertyHash||{},void(this.temporaryDocumentModelPropertyHash[e]=t))},g.prototype.getDocumentModelProperty=function(e){return!this.documentModel&&this.temporaryDocumentModelPropertyHash?this.temporaryDocumentModelPropertyHash[e]:this.documentModel.getProperty(e)},g.prototype.setDocumentModelPropertyHash=function(e){return this.documentModel?void this.documentModel.setPropertyHash(e):void(this.temporaryDocumentModelPropertyHash=e)},g.prototype.nukePageStates=function(){this.imageManager.nukeBuffers(),this.pageStates=[],this.initPageStatesArray(this.zoomMode),this.updatePageStatesArray(this.pageCount,this.zoomMode),this.preferSVG=c.enableSVGSupport,this.pagesAddedOrRemovedSinceInit=!1,this.pageNumber>=this.pageCount&&virtualViewer.setPage(0)},g.prototype.resetPageManipulations=function(e){this.imageManager.cleanPageFromBuffers(e),this.preferSVG=c.enableSVGSupport,this.setSVGEnabledForPage(e,c.enableSVGSupport)},g.prototype.resetAfterSave=function(){for(var e=0;e<this.pageCount;e+=1)this.setRotationForPage(e,0),this.pageStates[e].imageInfoRequested=!1,this.pageStates[e].imageInfoLoaded=!1,this.pageStates[e].requestedWidth=0,this.pageStates[e].requestedHeight=0;this.imageManager.nukeBuffers(),this.pagesAddedOrRemovedSinceInit=!1,this.isDocumentCropped()&&this.removeAllCrop();var a=this.getDocumentModel();a.setPagesModifiedSinceInit(!1),a.setMetadataModifiedSinceInit(!1),a.setAnnotationsModifiedSinceInit(!1),a.setBookmarksModifiedSinceInit(!1),a.setNotesModifiedSinceInit(!1),a.setWatermarksModifiedSinceInit(!1),this.cachedServerLayers=t.deepObjCopy(a.model.layerManager.layers)},g.prototype.isPageCropped=function(e){return e||0===e||(e=this.pageNumber),!this.isMedia()&&this.getPageCropBox(e).cropTop>=0},g.prototype.setPageCropBox=function(e,t){e||0===e||(e=this.pageNumber),!this.isMedia()&&this.documentFullyLoaded()&&(this.getDocumentModel().model.pageData[e].cropTop=t.cropTop,this.getDocumentModel().model.pageData[e].cropLeft=t.cropLeft,this.getDocumentModel().model.pageData[e].cropWidth=t.cropWidth,this.getDocumentModel().model.pageData[e].cropHeight=t.cropHeight)},g.prototype.getPageCropBox=function(e){return e||0===e||(e=this.pageNumber),this.isMedia()||!this.documentFullyLoaded()?{}:{cropTop:this.getDocumentModel().model.pageData[e].cropTop,cropLeft:this.getDocumentModel().model.pageData[e].cropLeft,cropWidth:this.getDocumentModel().model.pageData[e].cropWidth,cropHeight:this.getDocumentModel().model.pageData[e].cropHeight}},g.prototype.isDocumentCropped=function(){for(var e=0;e<this.pageCount;e++)if(this.isPageCropped(e))return!0;return!1},g.prototype.removeCropOnPage=function(e){"number"!=typeof e&&(e=this.pageNumber),this.setPageCropBox(e,{}),this.restoreAllAnnsOnPage(e),this.resetSVGSupport(!0)},g.prototype.removeAllCrop=function(){for(var e=0;e<this.pageCount;e++)this.isPageCropped(e)&&this.removeCropOnPage(e);this.resetSVGSupport(!0)},g.prototype.getAllTextOnPage=function(e){if(e=this.validatePageNumber(e),this.pageStates&&this.pageStates[e])return this.pageStates[e].allText},g.prototype.getPageText=function(e){if(this.pageStates&&!(this.pageStates.length<1))return e=this.validatePageNumber(e),this.pageStates[e]?this.pageStates[e].pageText:void 0},g.prototype.getDocumentText=function(){for(var e=[],t=0;t<this.pageCount;t++)e.push(this.getPageText(t));return e},g.prototype.addPageText=function(e,t){!this.pageStates||this.pageStates.length<1||(t=this.validatePageNumber(t),this.pageStates[t]&&(this.pageStates[t].pageText=e))},g.prototype.logPageText=function(e){e=this.validatePageNumber(e);var t=this.pageStates[e].pageText,a=t.wordRects;console.log("logPageText"),console.log(a.length)},g.prototype.removePageText=function(e){e=this.validatePageNumber(e),this.pageStates[e].pageText=null},g.prototype.rotatePageTextSelectionBoxes=function(e,t){var a=this.pageStates[e];if(a.pageText&&a.pageText.wordRects)for(var n=0;n<a.pageText.wordRects.length;n++){var o,i=a.pageText.wordRects[n];9e3===t?(o=i.top,i.top=i.left,i.left=a.originalHeight-i.bottom,i.bottom=i.right,i.right=a.originalHeight-o):18e3===t?(o=i.top,i.top=a.originalHeight-i.bottom,i.bottom=a.originalHeight-o,o=i.left,i.left=a.originalWidth-i.right,i.right=a.originalWidth-o):27e3===t&&(o=i.top,i.top=a.originalWidth-i.right,i.right=i.bottom,i.bottom=a.originalWidth-i.left,i.left=o)}},g.prototype.removeDocumentNote=function(e){e=this.documentNoteArray.length-e-1,this.documentNoteArray.splice(e,1)},g.prototype.getPagesAddedOrRemovedSinceInit=function(){return this.pagesAddedOrRemovedSinceInit},g.prototype.setPagesAddedOrRemovedSinceInit=function(e){this.pagesAddedOrRemovedSinceInit=e},g.prototype.pushUndoObject=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].undoObjectArray.length=this.pageStates[e].undoIndex+1,this.pageStates[e].undoObjectArray.push(this.cloneUndoObject(t)),this.pageStates[e].undoIndex=this.pageStates[e].undoObjectArray.length-1,this.pageStates[e].poppedObjectArray.length=0},g.prototype.pushPoppedObject=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].poppedObjectArray.length=this.pageStates[e].poppedIndex+1,this.pageStates[e].poppedObjectArray.push(t),this.pageStates[e].poppedIndex=this.pageStates[e].poppedObjectArray.length-1},g.prototype.popPoppedObject=function(e){e=this.validatePageNumber(e);var t=this.pageStates[e].poppedObjectArray.pop();return this.pageStates[e].poppedIndex=this.pageStates[e].poppedObjectArray.length-1,t},g.prototype.resetUndoObject=function(e){e=this.validatePageNumber(e),this.pageStates[e].undoObject.unchangedAnn=void 0,this.pageStates[e].undoObject.modifiedAnn=void 0,this.pageStates[e].undoObject.referenceAnn=void 0,this.pageStates[e].undoObject.layer=void 0,this.pageStates[e].undoObject.type=void 0},g.prototype.getUndoObject=function(e){if(this.pageStates&&!(this.pageStates.length<1))return e=this.validatePageNumber(e),this.pageStates[e].undoObject},g.prototype.cloneUndoObject=function(e){var t={unchangedAnn:e.unchangedAnn,modifiedAnn:e.modifiedAnn,referenceAnn:e.referenceAnn,layer:e.layer,type:e.type};return t},g.prototype.getUndoObjectArray=function(e){return e=this.validatePageNumber(e),this.pageStates[e].undoObjectArray},g.prototype.getPoppedObjectArray=function(e){return e=this.validatePageNumber(e),this.pageStates[e].poppedObjectArray},g.prototype.getUndoIndex=function(e){return e=this.validatePageNumber(e),this.pageStates[e].undoIndex},g.prototype.setUndoIndex=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].undoIndex=t},g.prototype.getPoppedIndex=function(e){return e=this.validatePageNumber(e),this.pageStates[e].poppedIndex},g.prototype.setPoppedIndex=function(e,t){e=this.validatePageNumber(e),this.pageStates[e].poppedIndex=t},g.prototype.setUndoIndexToMax=function(e){e=this.validatePageNumber(e),this.pageStates[e].undoIndex=this.pageStates[e].undoObjectArray.length-1},g.prototype.getNewAnnList=function(){return this.newAnnotations},g.prototype.clearNewAnnList=function(){return this.newAnnotations=[]},g.prototype.addAnnToNewAnnList=function(e){return this.newAnnotations.push(e),this.newAnnotations},g.prototype.removeNewAnnFromList=function(e){return this.newAnnotations.splice(e,1),this.newAnnotations},g.prototype.getTrueAnnChange=function(){return this.trueAnnChange},g.prototype.setTrueAnnChange=function(e){this.trueAnnChange=e},g.prototype.getNewWMList=function(){return this.newWatermarks},g.prototype.clearNewWMList=function(){this.newWatermarks=[]},g.prototype.addWMToNewWMList=function(e){return this.newWatermarks.push(e),this.newWatermarks},g.prototype.cleanBeforeRemoval=function(){this.imageManager.nukeBuffers()},g}),define("vvStateManager",["vvDiffManager","vvDocViewState"],function(e,t){"use strict";function a(){this.states=[{},{}],this.displayedDocuments=[],this.splitInstance=null,this.activePane=0,this.diffs={}}var n;a.prototype.setSplit=function(e){this.splitInstance=e},a.prototype.getActivePaneState=function(){var e=this.displayedDocuments[this.activePane];if(e)return this.states[this.activePane][e]},a.prototype.getInactivePaneState=function(){var e;e=0===this.activePane?1:0;var t=this.displayedDocuments[e];if(t)return this.states[e][t]},a.prototype.getCurrentState=function(e){if(e=e||0,!(e>this.displayedDocuments.length)&&this.displayedDocuments[e]){var t=this.displayedDocuments[e];return this.states[e][t]}},a.prototype.getOpenDocumentId=function(e){return e=e||0,this.displayedDocuments[e]},a.prototype.getOuterDivFromState=function(e){if(!e)return $();var t=e.currentPaneIndex||0;return this.states[t][e.getDocumentId()]?$(".vvOuter").eq(t):$(".vvOuter").eq(this.activePane)},a.prototype.setActivePane=function(e){this.activePane=e},a.prototype.setStateForDocumentId=function(e,t,a){return a=a||0,this.states[a][e]=t,t.currentPaneIndex=a,t},a.prototype.openNewState=function(e){var a=e.paneIndex||0;if(e.documentId){var n=new t(e.documentId,e.documentModel,e.pageCount,e.pageNumber,e.tabNumber,e.zoomMode);return n.displayName=e.displayName,this.setStateForDocumentId(e.documentId,n,a),n}},a.prototype.getStateForDocumentId=function(e,t){var a=t||0;if(this.states[a][e])return this.states[a][e];if(!(t>=0))return this.states[1][e]},a.prototype.getAllStates=function(){for(var e=[],t=0;t<this.states.length;t++)for(var a=Object.keys(this.states[t]),n=0;n<a.length;n++)e.push(this.getStateForDocumentId(a[n],t));return e},a.prototype.removeStateForDocumentId=function(e,t){t=t||0,this.displayedDocuments[t]===e&&(this.displayedDocuments[t]=""),this.states[t][e]&&(this.states[t][e].cleanBeforeRemoval(),delete this.states[t][e])},a.prototype.setDisplayedState=function(e,t){t=t||0,this.displayedDocuments[t]=e.getDocumentId()},a.prototype.isVideoOpen=function(){for(var e=!1,t=0;t<this.displayedDocuments.length;t++)if(this.displayedDocuments[t]){var a=this.getStateForDocumentId(this.displayedDocuments[t]);if(!a)return!1;e=e||a.isMedia()}return e},a.prototype.getCurrentDiff=function(){var e=this.displayedDocuments[0],t=this.displayedDocuments[1];if(e&&this.diffs[e]&&t&&!this.states[0][e].closedTab&&!this.states[1][t].closedTab)return this.diffs[e][t]},a.prototype.setDiff=function(e){var t=this.displayedDocuments[0],a=this.displayedDocuments[1];a&&(this.diffs[t]={},this.diffs[t][a]=e)};var o=function(){return n=n||new a};return o()}),define("vvNoteBase",["vvUtility","vvStateManager","vvAnnotationManager"],function(e,t){function a(){n=this,this.username="",this.ableToAddNote=!0,this.timestamp=null,this.displayedTimestamp=null,this.createdTag=null,this.note={text:null,createDate:null,editDate:null,idxFlag:null,userId:null}}var n;a.prototype.getAbleToAddNote=function(){return this.ableToAddNote},a.prototype.setAbleToAddNote=function(e){this.ableToAddNote=e},a.prototype.getUsername=function(){return this.username&&e.encodeForHTML(this.username)===$("#vvAnnotationNoteAdderAuthor").html()||n.setUsername(),this.username},a.prototype.setUsername=function(e){e&&0!==e.length?(this.username=e,virtualViewer.getUserPreferences().setUsername(e)):this.username=virtualViewer.getUserPreferences().getUsername()},a.prototype.getNote=function(){return this.note},a.prototype.getTimestamp=function(){return this.timestamp},a.prototype.setTimestamp=function(e){this.timestamp=e},a.prototype.getDisplayedTimestamp=function(){return this.displayedTimestamp},a.prototype.setDisplayedTimestamp=function(e){this.displayedTimestamp=e},a.prototype.createTimestamp=function(){var e=new Date,t=e.toUTCString();t=t.replace(/,/g,""),n.setTimestamp(t);var a=new Date(t);a=a.toDateString()+" "+a.toLocaleTimeString(),n.setDisplayedTimestamp(a)},a.prototype.addNote=function(a,r){if(n.getAbleToAddNote()){n.resetNote();var s,l,u=t.getCurrentState(),d=u.getDocumentModel(),c="";if("Document"===a)s="#vvDocumentNoteContentInput",l="#vvDocumentNotesInternal";else{if("Annotation"!==a)return;s="#vvAnnotationNoteContentInput",l="#vvAnnotationNotesInternal",r||(r=virtualViewer.getCurrentAnnObject())}if(""!==$(s).val().trim()){n.createTimestamp();var g=n.getNote();if(g.userId=n.getUsername(),g.text=$(s).val(),g.createDate=n.getTimestamp(),"Document"===a){var v=d.model.documentNotes.notes,p=n.copyNote(g);p.userId=encodeURIComponent(p.userId),p.text=encodeURIComponent(p.text),c=" ellipsis",v.splice(0,0,p),d.setNotesModifiedSinceInit(!0,u)}else if("Annotation"===a){r.noteArray.unshift(n.copyNote(g));var h=virtualViewer.getCurrentAnnObject();h.markRevised(),require("vvAnnotationManager").markLayerWithAnnDirty(h)}var m=$("<div class=\"vvNote\"> <button type ='button' title = '"+e.getLocalizedValue("notes.deleteNote","Delete Note")+"'class='smallClose vvNotesCloseButton' data-tooltip='tooltip'><span aria-hidden='true'>x</span></button> </div>");m.append('<div class="vvNoteAuthor"> <b>'+e.encodeForHTML(g.userId)+"</b> </div>"),m.append('<span class="vvNoteContent'+c+'">'+e.encodeForHTML(g.text)+"</span>"),m.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited"></span><span id="vvNoteTimeStamp">'+n.getDisplayedTimestamp()+"</span></div>"),$(l).prepend(m),o(a,r),$("#vvCreatedOrEdited").text(e.getLocalizedValue("notes.created","Created: ")),i(a,r,m),$(s).val(""),n.setAbleToAddNote(!0)}}};var o=function(e,a){$(".vvNotesCloseButton").click(function(){var o=this.parentElement.parentElement;if(o){var i=$(o).children().index(this.parentElement);$($(o).children()[i]).remove();var r=t.getCurrentState(),s=r.getDocumentModel();if("Document"===e){var l=s.model.documentNotes.notes;l.splice(i,1),virtualViewer.docHasNotes()||$("#vvNotesTabSpan").removeClass("docNotesExist"),s.setNotesModifiedSinceInit(!0,r)}else if("Annotation"===e){a.removeNoteFromArray(i);var u=virtualViewer.getCurrentAnnObject();u.markRevised(),require("vvAnnotationManager").markLayerWithAnnDirty(u)}n.setAbleToAddNote(!0)}})},i=function(e,t,a){if(a&&a.length){var o=function(a){if(1!==a.tapCount){a.tapCount>1&&a.preventDefault();var o=$(".vvNotesInternal").find("input");if(o.length)return void o.focus();var i=$(this);$(this).hasClass("vvNote")||(i=$(a.target).closest(".vvNote")),n.getAbleToAddNote()&&n.editNote(i,e,t)}};if(Modernizr.touchevents){var i=new Hammer(a[0]);i.on("tap",o)}a.dblclick(o)}};a.prototype.editNote=function(a,o,i){n.setAbleToAddNote(!1),n.resetNote();var l=$(a).find(".vvNoteContent"),u=$(a).find(".vvNoteDate");u.remove(),l.remove();var d,c,g=$(a).parent().children().index($(a)),v=t.getCurrentState();if("Document"===o){var p=v.getDocumentModel(),h=p.model.documentNotes.notes,m=h[g];c=decodeURIComponent(m.text),d="vvDocumentNoteEditContentInput"}else if("Annotation"===o){var m=i.noteArray[g];c=m.text,d="vvAnnotationNoteEditContentInput"}a.append("<input id="+d+' type="text" name="vvNoteEditContentInputName">'),$("#"+d).val(c),a.append('<button id="vvNoteEditButton" type="button"></button>'),a.append('<button id="vvNoteCancelEditButton" type="button"></button>'),$("#vvNoteEditButton").text(e.getLocalizedValue("notes.applyButton","Apply")),$("#vvNoteCancelEditButton").text(e.getLocalizedValue("notes.cancelButton","Cancel"));var f=v.getDocumentId(),y=v.currentPaneIndex;$("#vvNoteEditButton").click(function(){var e=t.getStateForDocumentId(f,y);""!==$("#"+d).val().trim()&&(r(a,o,i),e.getNewAnnList().indexOf(i)===-1&&e.setTrueAnnChange(!0))}),$("#vvNoteCancelEditButton").click(function(){s(a,o,c,u.text())}),n.setAbleToAddNote(!0)};var r=function(e,a,o){var i;if("Document"===a)i="vvDocumentNoteEditContentInput";else{if("Annotation"!==a)return;i="vvAnnotationNoteEditContentInput"}var r=$("#"+i).val();n.createTimestamp();var s,l=t.getCurrentState(),u=l.getDocumentModel(),d=e.parent().children().index(e);if("Document"===a){var c=u.model.documentNotes.notes;s=c[d],s.userId=encodeURIComponent(n.getUsername()),s.text=encodeURIComponent(r),u.setNotesModifiedSinceInit(!0,l)}else{if("Annotation"!==a)return;s=o.noteArray[d],s.userId=n.getUsername(),s.text=r;var g=virtualViewer.getCurrentAnnObject();g.markRevised(),require("vvAnnotationManager").markLayerWithAnnDirty(g)}s.editDate=n.getTimestamp(),n.setAbleToAddNote(!0),"Document"===a?virtualViewer.getDocumentNotes().loadDocumentNotes():"Annotation"===a&&o.loadAnnotationNotes()},s=function(t,a,o,i){var r,s="";if("Document"===a)r="vvDocumentNoteEditContentInput",s=" ellipsis";else{if("Annotation"!==a)return;r="vvAnnotationNoteEditContentInput"}$("#"+r).remove(),$("#vvNoteEditButton").remove(),$("#vvNoteCancelEditButton").remove(),t.append('<span class="vvNoteContent'+s+' ">'+e.encodeForHTML(o)+"</span>"),t.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited"> </span> <span id="vvNoteTimeStamp">'+i+"</span></div>"),n.setAbleToAddNote(!0)};return a.prototype.addExistingNote=function(t,a,r){var s;n.resetNote();var l=n.getNote();l.userId=t.userId,l.text=t.text;var u="",d="",c="";t.editDate?(u=e.getLocalizedValue("notes.edited","Edited: "),d=t.editDate):(u=e.getLocalizedValue("notes.created","Created: "),d=t.createDate),d=d.replace(/,/g,""),d=d.replace("Z","UTC"),"Document"===a?(s="#vvDocumentNotesInternal",c=" ellipsis",l.userId=decodeURIComponent(l.userId),l.text=decodeURIComponent(l.text)):"Annotation"===a&&(s="#vvAnnotationNotesInternal");var g=new Date(d);g=g.toDateString()+" "+g.toLocaleTimeString();var v=$("<div class=\"vvNote\"> <button type ='button' title = '"+e.getLocalizedValue("notes.deleteNote","Delete Note")+"' data-tooltip='tooltip' class='smallClose vvNotesCloseButton'><span aria-hidden='true'>x</span></button></div>");v.append('<div class="vvNoteAuthor"> <b>'+e.encodeForHTML(l.userId)+"</b> </div>"),v.append('<span class="vvNoteContent'+c+'">'+e.encodeForHTML(l.text)+"</span>"),v.append('<div class="vvNoteDate"><span id="vvCreatedOrEdited">'+u+'</span><span id="vvNoteTimeStamp">'+g+"</span></div>"),$(s).append(v),o(a,r),i(a,r,v)},a.prototype.resetNote=function(){this.note={text:null,createDate:null,editDate:null,idxFlag:null,userId:null}},a.prototype.copyNote=function(e){var t={text:e.text,createDate:e.createDate,editDate:e.editDate,idxFlag:e.idxFlag,userId:e.userId};return t},a}),define("annotations",["vvUtility","vvDefines","user-config/config","vvNoteBase","vvBoundingBox","vvPoint","vvStateManager"],function(e,t,a,n,o,i,r){function s(){}s.prototype.init=function(e,o,i,r,s,l,u,d,c,g,v,p){this.page=i,this.pageWidth=r,this.pageHeight=s,this.preview=!1,this.annDelete=!1,this.doubleByte=u,this.index=d,this.docDPI=c,this.isFilenet=g,this.isDaeja=v,this.isIDM=p,this.layerName=l,this.opacity=1,this.slope,this.revisionHistory=[],this.currentRevision={user:"",date:"",modificationType:""},this.collapsed=!!a.collapseStickiesByDefault&&this.getType()===t.annotationTypes.SANN_POSTIT,this.notes=new n,this.wrappedText=[],this.wrappedTextIsStale=!0,this.pasteLocation=null,e&&this.initFromXML(e),o&&this.initFromObject(o)},s.prototype.initFromXML=function(n){this.annId=e.getValue(n,"annID"),this.isDaeja=e.fixBooleanString(e.getValue(n,"isDaeja")),this.createDate=e.getValue(n,"annCreateDate"),this.modifyDate=e.getValue(n,"annModifyDate"),this.fontName=e.getValue(n,"fontName"),this.fontSize=e.getValue(n,"fontSize"),this.fontBold=e.fixBooleanString(e.getValue(n,"fontBold")),this.fontItalic=e.fixBooleanString(e.getValue(n,"fontItalic")),this.fontStrike=e.fixBooleanString(e.getValue(n,"fontStrike")),this.fontUnderline=e.fixBooleanString(e.getValue(n,"fontUnderline")),this.fontColor=e.getValue(n,"fontColor"),this.type=e.getValue(n,"annType"),this.createUser=decodeURIComponent(e.getValue(n,"annCreateUser")),this.revisionHistory=l(n),this.ordinal=parseInt(e.getValue(n,"annOrdinal"),10),this.lineStyle=e.getValue(n,"lineStyle"),this.setRotationAngle(e.getValue(n,"rotationAngle")),this.lineColor=e.getValue(n,"lineColor"),this.fillColor=e.getValue(n,"fillColor"),this.lineWidthPx=e.getValue(n,"lineWidth"),this.setTextString(e.getValue(n,"textString"),!0),this.bitmapData=e.getValue(n,"bitmapData"),this.annotationTags=e.parseAnnTags(n),this.noteArray=e.parseAnnNotes(n),this.box=new o(parseInt(e.getValue(n,"annStartX"),10),parseInt(e.getValue(n,"annStartY"),10),parseInt(e.getValue(n,"annWidth"),10),parseInt(e.getValue(n,"annHeight"),10)),this.fontSize?this.setFontSize(parseInt(this.fontSize,10),!0):this.fontSize=0;var i=e.getValue(n,"pointArray");i&&(this.pointArray=e.parsePointArray(i),this.fixBoundingBox());var r=e.getValue(n,"fillOpacityPercent");this.opacity=r?parseInt(r)/100:1,a.enableCustomOpacity||(this.opacity&&this.isFillOnly()?this.opacity=1:this.type!==t.annotationTypes.SANN_HIGHLIGHT_RECT&&(this.opacity=Math.round(this.opacity))),this.isHighlight=e.getValue(n,"isHighlight"),this.isHighlight&&(this.opacity=a.annotationDefaults.highlightOpacity);var s=e.getValue(n,"annLayerID");"ANNOTATION_LAYER_ID"!==s&&(this.layerName=s),this.lineWidthPx?this.lineWidthPx=parseInt(this.lineWidthPx,10):this.lineWidthPx=1,this.rotationAngle?this.setRotationAngle(parseInt(this.rotationAngle,10)):this.setRotationAngle(0)},s.prototype.initFromObject=function(e){if(this.annId=e.annId,this.isDaeja=e.isDaeja,this.annDelete=e.annDelete,this.createDate=e.createDate,this.modifyDate=e.modifyDate,this.fontName=e.fontName,this.fontSize=e.fontSize,this.fontBold=e.fontBold,this.fontItalic=e.fontItalic,this.fontStrike=e.fontStrike,this.fontUnderline=e.fontUnderline,this.fontColor=e.fontColor,this.type=e.type,this.createUser=e.createUser,this.revisionHistory=e.revisionHistory||[],this.ordinal=e.ordinal,this.lineStyle=e.lineStyle,this.setRotationAngle(e.rotationAngle),this.lineColor=e.lineColor,this.fillColor=e.fillColor,this.lineWidthPx=e.lineWidthPx,this.setTextString(e.textString,!0),this.bitmapData=e.bitmapData,this.layerTemp=e.layerName,this.annotationTags=e.annotationTags,this.noteArray=e.noteArray,e.pointArray){this.pointArray=[];for(var t=0;t<e.pointArray.length;t++)this.pointArray.push(new i(e.pointArray[t].x,e.pointArray[t].y))}this.box=new o(e.box.one.x,e.box.one.y,e.box.two.x-e.box.one.x,e.box.two.y-e.box.one.y),this.opacity=e.opacity,this.isHighlight=e.isHighlight},s.prototype.isSameAs=function(e){var t=this,a=e;if(void 0===t||void 0===a)return!1;if(t.page!==a.page)return!1;if(t.annDelete!==a.annDelete)return!1;var n=t.getBoundingBox(),o=a.getBoundingBox();if(n.one.x!==o.one.x)return!1;if(n.one.y!==o.one.y)return!1;if(n.two.x!==o.two.x)return!1;if(n.two.y!==o.two.y)return!1;if(t.doubleByte!==a.doubleByte)return!1;if(t.fillColor!==a.fillColor)return!1;if(t.fontBold!==a.fontBold)return!1;if(t.fontColor!==a.fontColor)return!1;if(t.fontItalic!==a.fontItalic)return!1;if(t.fontName!==a.fontName)return!1;if(t.fontSize!==a.fontSize)return!1;if(t.fontStrike!==a.fontStrike)return!1;if(t.fontUnderline!==a.fontUnderline)return!1;if(t.index!==a.index)return!1;if(t.layerName!==a.layerName)return!1;if(t.lineColor!==a.lineColor)return!1;if(t.lineStyle!==a.lineStyle)return!1;if(t.lineWidthPx!==a.lineWidthPx)return!1;if(t.opacity!==a.opacity)return!1;if(t.ordinal!==a.ordinal)return!1;if(t.pageHeight!==a.pageHeight)return!1;if(t.pageWidth!==a.pageWidth)return!1;var i=t.pointArray,r=a.pointArray;if(i||r){if(!i)return!1;if(!r)return!1;var s=i.length;r.length>i.length&&(s=r.length);for(var l=0;l<s;l+=1){if(i[l].x!==r[l].x)return!1;if(i[l].y!==r[l].y)return!1}}if(t.preview!==a.preview)return!1;if(t.getRotationAngle()!==a.getRotationAngle())return!1;if(t.textString!==a.textString)return!1;if(t.type!==a.type)return!1;for(var u=0;u<t.noteArray.length;u++)if(t.noteArray[u]!==a.noteArray[u])return!1;return!0},s.prototype.copyFrom=function(e){var t=this,a=e;t.annDelete=a.annDelete;var r=a.annotationTags;if(t.annotationTags=[],r)for(var s=0;s<r.length;s+=1)t.annotationTags.push(r[s]);t.bitmapData=a.bitmapData,t.isDaeja=a.isDaeja,t.box=new o,t.box.copyFrom(a.box),t.collapsed=a.collapsed,t.createDate=a.createDate,t.modifyDate=a.modifyDate,t.createUser=a.createUser,t.modifyUser=a.modifyUser,t.docDPI=a.docDPI,t.doubleByte=a.doubleByte,t.isHighlight=a.isHighlight,t.fillColor=a.fillColor,t.fontBold=a.fontBold,t.fontColor=a.fontColor,t.fontItalic=a.fontItalic,t.fontName=a.fontName,t.fontSize=a.fontSize,t.fontStrike=a.fontStrike,t.fontUnderline=a.fontUnderline,t.index=a.index,t.layerName=a.layerName,t.annId=a.annId,t.lineColor=a.lineColor,t.lineStyle=a.lineStyle,t.lineWidthPx=a.lineWidthPx,t.opacity=a.opacity,t.ordinal=a.ordinal,t.page=a.page,t.pageHeight=a.pageHeight,t.pageWidth=a.pageWidth;var l=a.pointArray;if(t.pointArray=[],l)for(var u=0;u<l.length;u+=1)t.pointArray.push(new i(l[u].x,l[u].y));else t.pointArray=null;t.preview=a.preview,t.setRotationAngle(a.rotationAngle),t.textString=a.textString,t.type=a.type,t.notes=new n,t.revisionHistory=[],a.revisionHistory=a.revisionHistory||[];for(var d=0;d<a.revisionHistory.length;d++){var c={user:a.revisionHistory[d].user,date:a.revisionHistory[d].date,modificationType:a.revisionHistory[d].modificationType};t.revisionHistory.push(c)}t.currentRevision={user:a.currentRevision.user,date:a.currentRevision.date,modificationType:a.currentRevision.modificationType};var g=a.noteArray;if(t.noteArray=[],g)for(var v=0;v<g.length;v+=1)t.noteArray.push(g[v]);else t.noteArray=null;return t},s.prototype.useLineResize=function(){return!(!this.pointArray||2!==this.pointArray.length)&&(this.getType()===t.annotationTypes.SANN_ARROW||this.getType()===t.annotationTypes.SANN_LINE)};var l=function(t){if(!t)return[];var a=t.getElementsByTagName("annModificationItem");if(!a||!a.length){var n=e.getValue(t,"annModifyDate");return n?[{user:e.getLocalizedValue("annPopUp.annUnknownUser","Undefined User"),date:n,modificationType:""}]:[]}for(var o=[],i=0;i<a.length;i++){var r=a[i];if(r){var s={};s.user=decodeURIComponent(e.getValue(r,"annModifyUser")),s.date=e.getValue(r,"annModifyDate"),s.modificationType=e.getValue(r,"annModifyType"),o.push(s)}}return o};return s.prototype.clone=function(){var e=new s;return e.init(),e.copyFrom(this),e},s.prototype.getType=function(){return this.type},s.prototype.isFillOnly=function(){let e=this.getRefinedType();return!(e!==t.annotationTypes.SANN_RECTANGLE&&e!==t.annotationTypes.SANN_ELLIPSE&&e!==t.annotationTypes.SANN_POLYGON||this.getLineColor())},s.prototype.getRefinedType=function(){return this.type===t.annotationTypes.SANN_RECTANGLE&&e.isRedactionLayer(this.layerName)?t.annotationTypes.SANN_REDACTION_RECT:this.type===t.annotationTypes.SANN_RECTANGLE&&this.isHighlight?t.annotationTypes.SANN_HIGHLIGHT_RECT:this.type===t.annotationTypes.SANN_LINE&&this.pointArray.length>2?t.annotationTypes.SANN_FREEHAND:this.type},s.prototype.getLocalizedTypeName=function(){var t=this.getRefinedType(),a=e.getLocalizedValue("annotationInfoList.annotationTypes."+t);return a||(a=e.getLocalizedValue("annotationInfoList.annotationTypes.general","Annotation")),a},s.prototype.getDelete=function(){return this.annDelete},s.prototype.setDelete=function(e){this.annDelete=e},s.prototype.getDoubleByte=function(){return this.doubleByte},s.prototype.setDoubleByte=function(e){this.doubleByte=e},s.prototype.setAbleToAddNote=function(e){this.ableToAddNote=e},s.prototype.getAbleToAddNote=function(){return this.ableToAddNote},s.prototype.fixCoordinates=function(e){"use strict";var t=this.getWidthRatio(e),a=this.getHeightRatio(e);if(t>0&&a>0&&(this.box=new o(Math.round(this.box.getX1()/t),Math.round(this.box.getY1()/a),Math.round(this.box.getWidth()/t),Math.round(this.box.getHeight()/a)),this.pointArray))for(var n=0;n<this.pointArray.length;n++){var i=this.pointArray[n];i.setX(Math.round(i.getX()/t)),i.setY(Math.round(i.getY()/a))}},s.prototype.fixBoundingBox=function(e,a){var n=null,i=null,s=null,l=null,u=this.box;e&&(u=e);var d=this.pointArray;if(a&&(d=a),d&&d.length>1){var c=d[0].getX(),g=d[0].getY(),v=d[0].getX(),p=d[0].getY();if(d)for(var h=0;h<d.length;h+=1)d[h].getX()<c&&(c=d[h].getX()),d[h].getY()<g&&(g=d[h].getY()),d[h].getX()>v&&(v=d[h].getX()),d[h].getY()>p&&(p=d[h].getY());if(n=c,i=g,s=v-c,l=p-g,this.type===t.unsupportedAnnotationTypes.SANN_CIRCLE){var m=r.getActivePaneState(),f=m.getRotationForPage(m.getPageNumber());0===f?l=s:90===f?s=l:180===f?(l=s*-1,i=p):270===f&&(s=l*-1,n=v)}return void(e?e=new o(n,i,s,l):this.box=new o(n,i,s,l))}n=u.getX1(),i=u.getY1(),s=u.getWidth(),l=u.getHeight(),s<0&&(s*=-1,n-=s),l<0&&(l*=-1,i-=l),e?e=new o(n,i,s,l):this.box=new o(n,i,s,l)},s.prototype.rotate=function(e,t){this.rotateAnnotation(e,t),this.fixBoundingBox()},s.prototype.rotatePointArray=function(e,t,a,n){if(!this.pointArray&&!t)return null;a||(a=this.pageWidth),n||(n=this.pageHeight);var o;o=t?this.pointArray.length:t.length;for(var i=0;i<o;i+=1)t?t[i].rotate(e,a,n):this.pointArray[i].rotate(e,a,n)},s.prototype.getPointRotatedForAnn=function(e,t){t||(t=r.getActivePaneState());var a,n=this.getRotationAngle(),o=t.getRequestedWidthForPage(this.page),s=t.getRequestedHeightForPage(this.page);return a=90===n?new i(e.y,o-e.x):180===n?new i(o-e.x,s-e.y):270===n?new i(s-e.y,e.x):new i(e.x,e.y)},s.prototype.updatePageDimensions=function(e){e||(e=r.getActivePaneState());var a=e.getOriginalWidthForPage(this.page),n=e.getOriginalHeightForPage(this.page),o=e.getDPIForPage(this.page),i=this.getPageWidth(),s=this.getPageHeight();this.docDPI;if(this.isFilenet&&3300===s&&2550===i&&"number"==typeof o){var l=this.docDPI/Math.max(o,t.minimumAnnotationDPI);0!==a&&this.setPageWidth(a*l),0!==n&&this.setPageHeight(n*l)}if(0===this.rotationAngle||180===this.rotationAngle){if(a>=n&&this.getPageWidth()>=this.getPageHeight()||a<n&&this.getPageWidth()<this.getPageHeight())return}else if((90===this.rotationAngle||270===this.rotationAngle)&&(a>=n&&this.getPageWidth()<=this.getPageHeight()||a<n&&this.getPageWidth()>this.getPageHeight()))return;var u=this.getPageHeight();this.setPageHeight(this.getPageWidth()),this.setPageWidth(u)},s.prototype.getIndex=function(){return this.index},s.prototype.setIndex=function(e){this.index=e},s.prototype.getOrdinal=function(){return this.ordinal},s.prototype.setCreateDate=function(e){this.createDate=e},s.prototype.getCreateDate=function(){return this.createDate},s.prototype.setModifyDate=function(e){this.modifyDate=e},s.prototype.getModifyDate=function(){return this.modifyDate},s.prototype.getCreateUser=function(){return this.createUser},s.prototype.setCreateUser=function(e){this.createUser=e},s.prototype.getModifyUser=function(){
return this.modifyUser},s.prototype.setModifyUser=function(e){this.modifyUser=e},s.prototype.setOrdinal=function(e){this.ordinal=e},s.prototype.getWidthRatio=function(e){e||(e=r.getActivePaneState());var t=this.page,a=e.getRequestedWidthForPage(t),n=e.getRequestedHeightForPage(t),o=1;return o=a>n&&this.pageWidth>this.pageHeight||a<n&&this.pageWidth<this.pageHeight?a/this.pageWidth:n/this.pageWidth,0===o&&(o=1),o},s.prototype.getHeightRatio=function(e){e||(e=r.getActivePaneState());var t,a=this.page,n=e.getRequestedWidthForPage(a),o=e.getRequestedHeightForPage(a);return t=n>o&&this.pageWidth>this.pageHeight||n<o&&this.pageWidth<this.pageHeight?o/this.pageHeight:n/this.pageHeight,0===t&&(t=1),t},s.prototype.setHeight=function(e){if(e&&!(e<1)){e=parseInt(e,10);var t=this.box.getY1(),a=t+e;this.updatePageDimensions(),a>this.pageHeight&&(e=this.pageHeight-t);var n=new o(this.box.getX1(),t,this.box.getWidth(),e);this.stretchPointArray(this.box,n),this.box=n}},s.prototype.getHeight=function(){return this.box.getHeight()},s.prototype.getWidth=function(){return this.box.getWidth()},s.prototype.setWidth=function(e){if(e&&!(e<1)){e=parseInt(e,10);var t=this.box.getX1(),a=t+e;this.updatePageDimensions(),a>this.pageWidth&&(e=this.pageWidth-t);var n=new o(t,this.box.getY1(),e,this.box.getHeight());this.stretchPointArray(this.box,n),this.box=n}},s.prototype.scaleAnn=function(e){if(e&&!(e<0)){var t=this.box.getX1()*e,a=this.box.getX2()*e,n=this.box.getY1()*e,i=this.box.getY2()*e,r=a-t,s=i-n,l=new o(t,n,r,s);this.stretchPointArray(this.box,l),this.box=l}},s.prototype.getAdjustedHeight=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t||270===t?parseInt(this.box.getWidth()*this.getWidthRatio(e),10):parseInt(this.box.getHeight()*this.getHeightRatio(e),10)},s.prototype.getAdjustedWidth=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t||270===t?parseInt(this.box.getHeight()*this.getHeightRatio(e),10):parseInt(this.box.getWidth()*this.getWidthRatio(e),10)},s.prototype.getAdjustedTop=function(){var e=r.getActivePaneState(),t=(this.getRotationAngle()+e.getRotationForPage(this.page))%360;return 90===t?this.box.getX1()*this.getWidthRatio(e):180===t?(this.pageHeight-this.box.getY2())*this.getHeightRatio(e):270===t?(this.pageWidth-this.box.getX2())*this.getWidthRatio(e):this.box.getY1()*this.getHeightRatio(e)},s.prototype.getAdjustedLeft=function(){var e,t=r.getActivePaneState(),a=(this.getRotationAngle()+t.getRotationForPage(this.page))%360;return e=90===a?(this.pageHeight-this.box.getY2())*this.getHeightRatio(t):180===a?(this.pageWidth-this.box.getX2())*this.getWidthRatio(t):270===a?this.box.getY1()*this.getHeightRatio(t):this.box.getX1()*this.getWidthRatio(t),parseInt(e,10)},s.prototype.fitBoxToText=function(e){var n=virtualViewer.getActivePane(),o=r.getActivePaneState();if(a.autoResizeTextAnnotations&&this.getType()===t.annotationTypes.SANN_EDIT||a.autoResizeStickyNoteAnnotations&&this.getType()===t.annotationTypes.SANN_POSTIT){var i=0;this.getType()===t.annotationTypes.SANN_POSTIT&&(i=a.annotationDefaults.stickyMargin),e||(e=0===n?$("#vvImageCanvas")[0].getContext("2d"):$("#vvSplitCanvas")[0].getContext("2d")),this.updatePageDimensions(),e.save();var s=this.getFontSize(!0)*this.getHeightRatio(o),l="";this.getFontBold()&&(l+="bold "),this.getFontItalic()&&(l+="italic "),e.font=l+s+'px "'+this.getFontName()+'"';for(var u=this.pageWidth-this.box.getX1(),d=this.getTextString().split("\n"),c=0,g=0;g<d.length;g++){var v=e.measureText(d[g]+"M").width/this.getWidthRatio();v>c&&(c=Math.round(v))}var p=Math.min(u,c);this.setWidth(p);var h=this.wrapTextString(e,i,o);e.restore();var m=this.getFontSize(!0)/.85,f=m/1.5;if(f+=h.length*m,f=parseInt(f,10),this.getType()===t.annotationTypes.SANN_POSTIT){var y=1.25*virtualViewer.collapsedStickySize(o.getZoomDecimal());f=Math.max(f,y)}this.setHeight(f)}},s.prototype.getPageWidth=function(){return this.pageWidth},s.prototype.setPageWidth=function(e){this.pageWidth=e},s.prototype.getPageHeight=function(){return this.pageHeight},s.prototype.setPageHeight=function(e){this.pageHeight=e},s.prototype.getLayerName=function(){return this.layerName?this.layerName:"ANNOTATION_LAYER_ID"},s.prototype.setLayerName=function(e){this.layerName=e},s.prototype.getBoundingBox=function(e){var t=r.getActivePaneState();if(e){var a=virtualViewer.collapsedStickySize()/this.getWidthRatio(t),n=new o(this.box.getX1(),this.box.getY1(),a,a);return n}return this.box},s.prototype.setBoundingBox=function(e){this.box=e},s.prototype.getLineColor=function(){return this.lineColor&&"NO_COLOR"!==this.lineColor?e.parseColorString(this.lineColor):null},s.prototype.setLineColor=function(e){this.lineColor=e},s.prototype.getFillColor=function(){return this.fillColor?e.parseColorString(this.fillColor,this.opacity):null},s.prototype.setFillColor=function(e){this.fillColor=e},s.prototype.getLineColorRGB=function(){return this.lineColor?this.lineColor:null},s.prototype.setLineColorRGB=function(e){this.lineColor=e},s.prototype.getFillColorRGB=function(){return this.fillColor?this.fillColor:null},s.prototype.setFillColorRGB=function(e){this.fillColor=e},s.prototype.getRotationAngle=function(){return this.rotationAngle?this.rotationAngle:0},s.prototype.setRotationAngle=function(e){e=e||0,this.xmlRotate=e,this.rotationAngle=e,a.rotateTextAnnotations||(this.wrappedTextIsStale=!0)},s.prototype.rotateAnnotation=function(e,t){var a=this.getRotationAngle()+e;a<0?t?this.xmlRotate=360+a%360:this.setRotationAngle(360+a%360):t?this.xmlRotate=a%360:this.setRotationAngle(a%360)},s.prototype.getLineWidthInPixels=function(){return this.lineWidthPx},s.prototype.setLineWidthInPixels=function(e){return this.lineWidthPx=e,this.lineWidthPx},s.prototype.setLineWidthInPoints=function(e){var a=Math.max(this.docDPI,t.minimumAnnotationDPI);this.isIDM?this.setLineWidthInPixels(120*e/7.2):this.setLineWidthInPixels(e*a/72)},s.prototype.getLineWidthInPoints=function(){var e=Math.max(this.docDPI,t.minimumAnnotationDPI);return this.isIDM?Math.round(7.2*this.getLineWidthInPixels()/120):Math.round(72*this.getLineWidthInPixels()/e)},s.prototype.getLineStyle=function(){return this.lineStyle},s.prototype.setLineStyle=function(e){this.lineStyle=e},s.prototype.getOpacity=function(){return this.opacity},s.prototype.setOpacity=function(e){this.opacity=e},s.prototype.getPointArray=function(){return this.pointArray},s.prototype.setPointArray=function(e){this.pointArray=e},s.prototype.getFontName=function(){return this.fontName},s.prototype.setFontName=function(e){this.fontName=e},s.prototype.getFontSize=function(e){var a=Math.max(this.docDPI,t.minimumAnnotationDPI);return e?this.fontSize:this.isIDM?Math.round(7.2*this.fontSize/120):Math.round(72*this.fontSize/a)},s.prototype.setFontSize=function(e,a){var n=Math.max(this.docDPI,t.minimumAnnotationDPI);a?this.fontSize=e:this.isIDM?this.fontSize=120*e/7.2:this.fontSize=e*n/72},s.prototype.getFontBold=function(){return this.fontBold},s.prototype.setFontBold=function(e){this.fontBold=e},s.prototype.getFontItalic=function(){return this.fontItalic},s.prototype.setFontItalic=function(e){this.fontItalic=e},s.prototype.getFontStrike=function(){return this.fontStrike},s.prototype.setFontStrike=function(e){this.fontStrike=e},s.prototype.getFontUnderline=function(){return this.fontUnderline},s.prototype.setFontUnderline=function(e){this.fontUnderline=e},s.prototype.getPreview=function(){return this.preview},s.prototype.setPreview=function(e){this.preview=e},s.prototype.getFontColor=function(){return this.fontColor},s.prototype.setFontColor=function(e){this.fontColor=e},s.prototype.getMinimizeButtonSize=function(e){if(this.type!==t.annotationTypes.SANN_POSTIT)return 0;var a=t.annMinimizeButtonSize,n=e.getZoomDecimal(),o=this.getBoundingBox(this.collapsed),i=o.getWidth()*this.getWidthRatio(e),r=o.getHeight()*this.getHeightRatio(e);return(i/3<a||r/3<a)&&(a=Math.max(t.annMinimizeButtonSize*n,5)),i<=5||r<=5?0:a+2>i/2||a+2>r/2?0:a},s.prototype.getTextString=function(a){return this.type!==t.annotationTypes.SANN_POSTIT&&this.type!==t.annotationTypes.SANN_EDIT?"":a||!this.doubleByte?this.textString:e.Base64.decode(this.textString)},s.prototype.setTextString=function(t,n){if(!t){var o=a.annotationDefaults.textString;return void(o&&this.setTextString(o))}n||!this.doubleByte?this.textString=t:(this.textString=e.Base64.encode(t),this.doubleByte=!0),virtualViewer.updateAnnotationListItem(this)},s.prototype.saveTextString=function(){this.previousTextStrings||(this.previousTextStrings=[]),this.previousTextStrings.push(this.getTextString(!0))},s.prototype.restoreTextString=function(){return this.previousTextStrings?void this.setTextString(this.previousTextString.pop()):void(this.previousTextStrings=[])},s.prototype.wrapTextString=function(e,t,n){var o=virtualViewer.getActivePane();if(e||(e=0===o?$("#vvImageCanvas")[0].getContext("2d"):$("#vvSplitCanvas")[0].getContext("2d")),!this.getTextString())return[];var i=this,r=this.getTextString(),s=r.split("\n"),l=(this.box.getWidth()-2*t)*this.getWidthRatio(n)-this.getMinimizeButtonSize(n);if(!a.rotateTextAnnotations){var u=(this.getRotationAngle()+n.getRotationForPage(this.page))%360;90!==u&&270!==u||(l=(this.box.getHeight()-2*t)*this.getWidthRatio(n))}if(l<1)return[];l-=5,this.wrappedTextIsStale=!1;var d=function(t){for(var a=t.split(""),n="",o=0;o<a.length;o++){var r=n+a[o];e.measureText(r).width>=l&&o>0?(i.wrappedText.push(n),n=a[o]):n+=a[o]}n.trim()&&i.wrappedText.push(n)};this.wrappedText=[];for(var c=0;c<s.length;c++){for(var g=s[c].split(" "),v="",p=0,h=0;h<g.length;h++){var m=v+g[h],f=e.measureText(m).width;f>l?(v.length&&1===p?d(v):v.length&&this.wrappedText.push(v),v=g[h]+" ",p=g[h].trim().length?1:0):(v=m+" ",g[h].trim().length&&(p+=1))}1===p?d(v):this.wrappedText.push(v)}return this.wrappedText},s.prototype.getWrappedText=function(){return this.wrappedText||(this.wrappedText=[]),this.wrappedText},s.prototype.move=function(e){var t=this.box;this.box=new o(Math.round(e.getX()/this.getWidthRatio()),Math.round(e.getY()/this.getHeightRatio()),t.getWidth(),t.getHeight());var a=this.box.getX1()-t.getX1(),n=this.box.getY1()-t.getY1();return this.movePointArray(a,n),0!==a||0!==n},s.prototype.stretchLine=function(e,a,n){var o=Math.round(a/this.getWidthRatio()),r=Math.round(n/this.getHeightRatio());return e===t.lineEnds.start?this.pointArray[0]=new i(o,r):e===t.lineEnds.end&&(this.pointArray[1]=new i(o,r)),!0},s.prototype.stretch=function(e,n,i,r){n>$("#vvDummyScroller").width()?n=$("#vvDummyScroller").width():n<0&&(n=0),i>$("#vvDummyScroller").height()?i=$("#vvDummyScroller").height():i<0&&(i=0);var s,l=n/this.getWidthRatio(),u=i/this.getHeightRatio(),d=this.box;if(this.getType()===t.annotationTypes.SANN_POSTIT){var c=1.25*virtualViewer.collapsedStickySize()/this.getWidthRatio();s=r?this.stretchWithLockedAspectRatio(d,l,u,e,c):this.basicStretchMath(d,l,u,e,c)}else s=a.enableStampAspectRatioLock&&this.getType()===t.annotationTypes.SANN_BITMAP||r?this.stretchWithLockedAspectRatio(d,l,u,e):this.basicStretchMath(d,l,u,e);return s.height>0&&s.width>0&&(this.box=new o(s.x,s.y,s.width,s.height),this.pointArray&&this.stretchPointArray(d,this.box)),this.getTextString()&&this.getTextString().length&&(this.wrappedTextIsStale=!0),!0},s.prototype.stretchWithLockedAspectRatio=function(a,n,o,i,r){this.slope||(this.slope=a.getSlope());var s,l,u,d,c,g,v,p,h=r||e.getNubSize();i===t.corners.upperLeft?(u=Math.abs(n-a.getX1()),d=Math.abs(o-a.getY1()),s=Math.min(u,d),l=s===u,l?(c=n,v=a.getX2()-c,p=this.slope*v,g=a.getY2()-p):(g=o,p=a.getY2()-g,v=p/this.slope,c=a.getX2()-v),p<h&&(p=h,g=a.getY2()-p),v<h&&(v=h,c=a.getX2()-v)):i===t.corners.upperRight?(u=Math.abs(n-a.getX2()),d=Math.abs(o-a.getY1()),s=Math.min(u,d),l=s===u,l?(c=a.getX1(),v=n-c,p=this.slope*v,g=a.getY2()-p):(c=a.getX1(),g=o,p=a.getY2()-g,v=p/this.slope),v<h&&(v=h),p<h&&(p=h,g=a.getY2()-p)):i===t.corners.lowerLeft?(u=Math.abs(n-a.getX1()),d=Math.abs(o-a.getY2()),s=Math.min(u,d),l=s===u,l?(c=n,v=a.getX2()-c,p=this.slope*v,g=a.getY1()):(g=a.getY1(),p=o-g,v=p/this.slope,c=a.getX2()-v),v<h&&(v=h,c=a.getX2()-v),p<h&&(p=h)):i===t.corners.lowerRight&&(c=a.getX1(),g=a.getY1(),u=Math.abs(n-a.getX2()),d=Math.abs(o-a.getY2()),s=Math.min(u,d),l=s===u,l?(v=n-c,p=this.slope*v):(p=o-g,v=p/this.slope),v<h&&(v=h),p<h&&(p=h));var m={x:c,y:g,width:v,height:p};return m},s.prototype.basicStretchMath=function(a,n,o,i,r){var s,l,u,d,c=r||e.getNubSize();i===t.corners.upperLeft?(s=n,l=o,u=a.getX2()-s,d=a.getY2()-l,u<c&&(u=c,s=a.getX2()-u),d<c&&(d=c,l=a.getY2()-d)):i===t.corners.upperRight?(s=a.getX1(),l=o,u=n-s,d=a.getY2()-l,u<c&&(u=c),d<c&&(d=c,l=a.getY2()-d)):i===t.corners.lowerLeft?(s=n,l=a.getY1(),u=a.getX2()-s,d=o-l,u<c&&(u=c,s=a.getX2()-u),d<c&&(d=c)):i===t.corners.lowerRight&&(s=a.getX1(),l=a.getY1(),u=n-s,d=o-l,u<c&&(u=c),d<c&&(d=c));var g={x:s,y:l,width:u,height:d};return g},s.prototype.movePointArray=function(e,t){if(this.pointArray)for(var a=0;a<this.pointArray.length;a+=1)this.pointArray[a].setX(Math.round(this.pointArray[a].getX()+e)),this.pointArray[a].setY(Math.round(this.pointArray[a].getY()+t))},s.prototype.stretchPointArray=function(e,t){var a=t.getX1(),n=t.getY1(),o=t.getWidth()/e.getWidth(),i=t.getHeight()/e.getHeight();if(this.pointArray)for(var r=0;r<this.pointArray.length;r+=1)this.pointArray[r].setX(Math.round(a+(this.pointArray[r].getX()-e.getX1())*o)),this.pointArray[r].setY(Math.round(n+(this.pointArray[r].getY()-e.getY1())*i))},s.prototype.getRevisionHistory=function(){return this.revisionHistory},s.prototype.getMostRecentModifyDate=function(){return this.currentRevision.date?this.currentRevision.date:this.revisionHistory.length?this.revisionHistory[0].date:this.createDate},s.prototype.getMostRecentModifyDateFormatted=function(){var t=this.getMostRecentModifyDate();return t?e.createAnnTimeStamp(t):""},s.prototype.getCreateDateFormatted=function(){return this.createDate?e.createAnnTimeStamp(this.createDate):""},s.prototype.getMostRecentModifyUser=function(){return this.currentRevision.user?this.currentRevision.user:this.revisionHistory.length?this.revisionHistory[0].user:this.createUser},s.prototype.getFormattedFootnote=function(){var e=this.getCreateDateFormatted(),t=this.getCreateUser(),a="\nCreated: "+e+" By: "+t;return a},s.prototype.markRevised=function(t,a){var n=this.currentRevision.user,o=new Date(this.currentRevision.date);this.currentRevision={},this.currentRevision.user=virtualViewer.getUserPreferences().getUsername(),this.currentRevision.date=a||e.toSnowDateString(new Date);var i=new Date(this.currentRevision.date),r=i-o;(this.currentRevision.user!==n||isNaN(r)||r>500)&&virtualViewer.updateAnnotationListItem(this)},s.prototype.toXML=function(n,r,s){var l=this.getType();if(l===t.unsupportedAnnotationTypes.SANN_CIRCLE&&(l=t.annotationTypes.SANN_ELLIPSE),l===t.annotationTypes.SANN_REDACTION_RECT&&(l=t.annotationTypes.SANN_RECTANGLE),this.annDelete===!0)return"";var u=l===t.annotationTypes.SANN_EDIT||l===t.annotationTypes.SANN_POSTIT||l===t.unsupportedAnnotationTypes.SANN_BUBBLE||l===t.unsupportedAnnotationTypes.SANN_CLOUD_EDIT,d=this.pointArray,c=this.rotationAngle;this.isFilenet&&(c=this.xmlRotate||c);var g=this.getBoundingBox(!1);if(r||this.isFilenet&&!u){if(this.pointArray){d=[];for(var v=0;v<this.pointArray.length;v+=1)d.push(new i(this.pointArray[v].x,this.pointArray[v].y))}g=new o(g.getX1(),g.getY1(),g.getWidth(),g.getHeight()),this.updatePageDimensions();var p=this.pageWidth,h=this.pageHeight;if((90===c||270===c)&&!this.isFilenet){var m=p;p=h,h=m}g.rotate(c,p,h),this.rotatePointArray(c,d,p,h),this.fixBoundingBox(g,d)}var f="";f=this.annId?"<annObject><annMeta><annID>"+this.annId+"</annID>":"<annObject><annMeta><annID>ANN_ID</annID>",this.isDaeja&&(f+="<isDaeja>true</isDaeja>"),this.isFilenet&&(f+="<isFilenet>true</isFilenet>"),f+="<annType>",f+=l+"</annType><annLayerID>",f+=this.getLayerName()+"</annLayerID><annOrdinal>",f+=this.getOrdinal()+"</annOrdinal><annDelete>false</annDelete><annHistory><annCreateDate>",f+=this.getCreateDate()+"</annCreateDate><annModifyDate>",f+=(this.currentRevision.date||this.getModifyDate())+"</annModifyDate>",f+=this.getCreateUser()&&""!==this.getCreateUser()?"<annCreateUser>"+encodeURIComponent(this.getCreateUser())+"</annCreateUser>":"<annCreateUser/>",this.currentRevision&&this.currentRevision.user&&(this.revisionHistory.unshift(this.currentRevision),this.currentRevision={user:"",date:"",modificationType:""}),f+="<annModifications>";for(var v=0;v<this.revisionHistory.length;v++)f+="<annModificationItem>",f+="<annModifyUser>"+encodeURIComponent(this.revisionHistory[v].user)+"</annModifyUser>",f+="<annModifyDate>"+this.revisionHistory[v].date+"</annModifyDate>",f+="<annModifyType />",f+="</annModificationItem>";if(f+="</annModifications>",f+="</annHistory></annMeta>",this.annotationTags.length>0){f+="<annTags>";for(var y=0;y<this.annotationTags.length;y++)f+="<tag>"+encodeURIComponent(this.annotationTags[y])+"</tag>";f+="</annTags>"}else f+="<annTags/>";if(this.noteArray.length>0){f+="<annNotes>";for(var b=0;b<this.noteArray.length;b++){var P=this.noteArray[b];f+="<Note>",f+="<userId>"+encodeURIComponent(P.userId)+"</userId>",f+="<createDate>"+P.createDate+"</createDate>",f+=P.editDate?"<modifyDate>"+P.editDate+"</modifyDate>":"<modifyDate/>",f+="<noteText>"+encodeURIComponent(P.text)+"</noteText>",f+="<idxFlag>"+P.idxFlag+"</idxFlag>",f+="</Note>"}f+="</annNotes>"}else f+="<annNotes/>";if(f+="<annTransparent>false</annTransparent>",this.bitmapData&&(f+="<bitmapData>"+this.bitmapData+"</bitmapData>"),u&&(f+="<fontInfo><fontName>",f+=this.getFontName()+"</fontName><fontSize>",f+=Math.round(this.getFontSize(!0))+"px</fontSize><fontBold>",f+=this.getFontBold()+"</fontBold><fontItalic>",f+=this.getFontItalic()+"</fontItalic><fontStrike>",f+=this.getFontStrike()+"</fontStrike><fontUnderline>",f+=this.getFontUnderline()+"</fontUnderline><fontColor>",f+=this.getFontColor()+"</fontColor></fontInfo><textString>",f+=this.getTextString(!0)+"</textString>"),(!this.getFillColor()&&this.getLineColor()||l===t.annotationTypes.SANN_POLYGON)&&(f+="<lineInfo><lineStyle>Solid</lineStyle><lineWidth>",f+=Math.round(this.getLineWidthInPixels())+"</lineWidth>",f+=l===t.annotationTypes.SANN_POLYGON&&this.getFillColor()?"<lineColor>NO_COLOR</lineColor>":"<lineColor>"+this.getLineColorRGB()+"</lineColor>",f+="<lineTransparent>false</lineTransparent>",d?(f+="<pointArray>",f+=e.generatePointArrayString(d),f+="</pointArray>"):f+="<pointArray/>",f+="</lineInfo>"),this.getFillColor()){f+="<fillInfo><fillColor>",f+=this.getFillColorRGB()+"</fillColor>",this.getRefinedType()===t.annotationTypes.SANN_HIGHLIGHT_RECT&&(f+="<isHighlight>true</isHighlight>");var T=Math.round(100*this.getOpacity());this.getRefinedType()===t.annotationTypes.SANN_REDACTION_RECT&&(T=100),f+="<fillOpacityPercent>"+T+"</fillOpacityPercent>",f+="</fillInfo>"}r?f+=u&&!a.rotateTextAnnotations?"<rotationAngle>"+(360-s)+"</rotationAngle>":"<rotationAngle>"+c+"</rotationAngle>":"undefined"===this.xmlRotate?(this.xmlRotate=0,f+="<rotationAngle>"+this.xmlRotate+"</rotationAngle>"):f+="<rotationAngle>"+this.xmlRotate+"</rotationAngle>";var A=Math.round(g.getX1()),I=Math.round(g.getY1()),S=Math.round(g.getHeight()),w=Math.round(g.getWidth());return f+="<annStartX>"+A+"</annStartX><annStartY>",f+=I+"</annStartY><annHeight>",f+=S+"</annHeight><annWidth>",f+=w+"</annWidth></annObject>"},s.prototype.lineAnnotationContains=function(t,a,n){var o=Math.max(this.lineWidthPx,e.getNubSize()/a),r=new i(t.x/a,t.y/n);if(!this.box.contains(t,a,n))return!1;var s=e.getDistanceFromPointToLine(r,this.pointArray);return!(s>o)},s.prototype.drawnAnnotationContains=function(e,a,n){return this.type!==t.annotationTypes.SANN_LINE&&this.type!==t.annotationTypes.SANN_ARROW||2!==this.pointArray.length?this.box.contains(e,a,n,this.collapsed):this.lineAnnotationContains(e,a,n)},s.prototype.findLineEndpoint=function(a,n,o){var i=e.getNubSize()/2/n,r=a.getX()/n,s=a.getY()/o,l=this.pointArray[0].getX(),u=this.pointArray[0].getY(),d=this.pointArray[1].getX(),c=this.pointArray[1].getY();return r>=l-i&&r<=l+i&&s>=u-i&&s<=u+i?t.lineEnds.start:r>=d-i&&r<=d+i&&s>=c-i&&s<=c+i?t.lineEnds.end:null},s.prototype.addNewNote=function(){this.notes.addNote("Annotation",this)},s.prototype.editNote=function(e){this.notes.editNote(e,"Annotation",this)},s.prototype.removeNoteFromArray=function(e){this.noteArray.splice(e,1)},s.prototype.loadAnnotationNotes=function(){$("#vvAnnotationNotesInternal").empty();var e=r.getActivePaneState();if(e&&e.pageStates&&!(e.pageStates.length<1)){this.noteArray.sort(function(e,t){return e=e.editDate?new Date(e.editDate):new Date(e.createDate),t=t.editDate?new Date(t.editDate):new Date(t.createDate),t-e});for(var t=0;t<this.noteArray.length;t++)this.notes.addExistingNote(this.noteArray[t],"Annotation",this)}},s.prototype.loadAnnotationInformation=function(){$("#vvAnnCreateUser").html(e.encodeForHTML(this.createUser));var t=e.createAnnTimeStamp(this.createDate);if($("#vvAnnCreateDate").html(t),$("#vvAnnotationRevisionHistory").empty(),$.views.helpers({createAnnTimeStamp:e.createAnnTimeStamp}),this.revisionHistory&&this.revisionHistory.length){$("#vvAnnViewRevisions").show();var a=$($("#vvAnnPopUpRevisionItemTmpl").render(this.revisionHistory));a.appendTo("#vvAnnotationRevisionHistory")}else $("#vvAnnViewRevisions").hide()},s.prototype.fixDimensionsForPage=function(){var e=this.getWidth()/this.pageWidth,t=this.getHeight()/this.pageHeight,a=Math.max(e,t);if(a>1){var n=new o(this.box.one.x,this.box.one.y,this.box.getWidth()/a,this.box.getHeight()/a);this.stretchPointArray(this.box,n),this.box=n}var r=Math.max(this.box.getX1()*this.getWidthRatio(),0),s=Math.max(this.box.getY1()*this.getHeightRatio(),0);this.box.getX2()>this.pageWidth&&(r=(this.pageWidth-this.box.getWidth())*this.getWidthRatio()),this.box.getY2()>this.pageHeight&&(s=(this.pageHeight-this.box.getHeight())*this.getHeightRatio()),this.move(new i(r,s))},s.prototype.fixForPaste=function(t,a,n){a||(a=r.getActivePaneState()),null!==t&&void 0!==t||(t=a.getPageNumber());var i=a.pageStates[t];if(n||(n=i.annotationLayers[this.getLayerName()]),this.doubleByte!==n.doubleByte&&(n.doubleByte?(this.textString=e.Base64.encode(this.textString),this.doubleByte=!0):(this.textString=e.Base64.decode(this.textString),this.doubleByte=!1)),this.page=t,this.pageWidth=n.pageWidth,this.pageHeight=n.pageHeight,this.setRotationAngle(0),n.docDPI&&n.docDPI!==this.docDPI){var s=this.getFontSize(),l=this.getLineWidthInPoints(),u=new o(this.box.getX1()*(n.docDPI/this.docDPI),this.box.getY1()*(n.docDPI/this.docDPI),this.getWidth()*(n.docDPI/this.docDPI),this.getHeight()*(n.docDPI/this.docDPI));this.stretchPointArray(this.box,u),this.box=u,this.docDPI=n.docDPI||200,s&&this.setFontSize(s,!1),l&&this.setLineWidthInPoints(l)}if(this.fixDimensionsForPage(),this.bitmapData&&!this.bitmapImage){this.bitmapImage=new Image,this.bitmapImage.vvDeadEnd=!0,this.bitmapImage.src="data:image/png;base64,"+this.bitmapData;var d=this;$(this.bitmapImage).on("error",function(){d.bitmapImage=null})}this.revisionHistory=[],this.currentRevision={},this.createDate=e.toSnowDateString(new Date),this.createUser=virtualViewer.getUserPreferences().getUsername()},s}),define("vvAnnotationManager",["vvUtility","annotations","user-config/config","vvDefines","vvPoint","vvStateManager"],function(e,t,a,n,o,i){function r(){}var s=null,l=new Image(14,14);l.src="resources/annMinimize.svg",r.prototype.getCurrentLayer=function(e){var t=virtualViewer.getActivePaneState(),a=t.getLayerNames();e||(e=t.getPageNumber());var o=t.getLayersForPage(e);if(!t.getCurrentLayerOnPage(e)&&a.length>0){if(!o)return;var i=o.Default;if(i&&this.checkLayerPermission(i,n.permissionLevels.PERM_EDIT))t.setCurrentLayer(i);else{for(var r=!1,s=0;s<a.length;s+=1){var l=o[a[s]];if(this.checkLayerPermission(l,n.permissionLevels.PERM_EDIT)){r=!0,t.setCurrentLayer(l);break}}if(!r){var u=this.createLayer("Default "+Math.floor(1024*Math.random()));t.setCurrentLayer(u)}}}return t.getCurrentLayer()},r.prototype.getRedactionLayer=function(t,o){o=o||virtualViewer.getActivePaneState();var i;return a.oneLayerPerAnnotation?i=this.createLayer(n.redactionLayerPrefix+"-"+e.vvGUID(),t):(i=o.getLayerFromPage(t,n.redactionLayerPrefix),i||(i=this.createLayer(n.redactionLayerPrefix,t))),o.pageStates[t]&&o.pageStates[t].imageInfoLoaded&&(i.docDPI=o.getDPIForPage(t)||72),o.setViewedForPage(t,!0),i},r.prototype.initializeLayerFromFirstPage=function(e,t,a){if(e=e||virtualViewer.getActivePaneState(),a){var n=e.getDPIForPage(0),o=e.getRequestedWidthForPage(0),i=e.getRequestedHeightForPage(0);e.setDPIForPage(t,n),0===n&&(n=72),a&&(a.docDPI=n),0===e.getRequestedWidthForPage(t)&&e.setRequestedWidthForPage(t,o),0===e.getRequestedHeightForPage(t)&&e.setRequestedHeightForPage(t,i)}},r.prototype.staleAnnTextWrapping=function(e,t){if(e&&"number"==typeof t){var a=e.getLayersForPage(t),o=e.getLayerNames();if(a&&o)for(var i=o.length,r=0;r<i;r++){var s=a[o[r]];if(void 0!==s&&s.permissionLevel>=n.permissionLevels.PERM_VIEW&&s.visibility===!0)for(var l=0;l<s.anns.length;l++)s.anns[l].getDelete()!==!0&&s.anns[l].page===t&&(s.anns[l].wrappedTextIsStale=!0)}}},r.prototype.parseLayer=function(n,o,i){var r=n.getElementsByTagName("pageMeta")[0],s=n.getElementsByTagName("annObject"),l=e.fixBooleanString(e.getValue(n,"isFilenet")),u=e.fixBooleanString(e.getValue(n,"isDaeja")),d=e.fixBooleanString(e.getValue(n,"isIDM"));if(r){var c={};c.layerName=e.getValue(n,"annLayerID"),c.pageNumber=parseInt(e.getValue(r,"pageNumber"),10),c.pageWidth=parseInt(e.getValue(r,"pageWidth"),10),c.pageHeight=parseInt(e.getValue(r,"pageHeight"),10),c.doubleByte=e.fixBooleanString(e.getValue(n,"doubleByte")),c.visibility=!0,c.docDPI=parseInt(e.getValue(n,"docDPI"),10)||72,c.isFilenet=l,c.isDaeja=u,c.isIDM=d,null!==i&&void 0!==i?c.pageNumber=i:i=c.pageNumber,d&&(c.docDPI=200);var g=o.getOriginalWidthForPage(i),v=o.getOriginalHeightForPage(i);if(l&&3300===c.pageHeight&&2550===c.pageWidth){var p=o.getDPIForPage(i);if(0!==p){var h=c.docDPI/p;0!==g&&(c.pageWidth=parseInt(g*h,10)),0!==v&&(c.pageHeight=parseInt(v*h,10))}}else u&&0===c.pageWidth&&0===c.pageHeight&&(c.pageWidth=o.getOriginalWidthForPage(i),c.pageHeight=o.getOriginalHeightForPage(i));c.anns=[];var m=virtualViewer.getDocumentModel(o);if(!m)return;for(var f=m.model.layerManager.layers.length,y=0;y<f;y++){var b=m.model.layerManager.layers[y],P=decodeURIComponent(b.annotationId);if(P===c.layerName){c.displayName=decodeURIComponent(b.displayName),c.isRedaction=b.isRedaction,c.isDeletable=b.isDeletable,c.permissionLevel=b.permissionLevel;break}}for(var T=0;T<s.length;T++){var A=new t;A.init(s[T],null,i,c.pageWidth,c.pageHeight,c.layerName,c.doubleByte,T,c.docDPI,l,u,d),e.isRedactionLayer(c)&&(virtualViewer.showRedactionWarningDialog(),A.setFillColorRGB(a.annotationDefaults.redactionFillColor),A.setOpacity(a.annotationDefaults.redactionOpacity)),c.anns[T]=A}o.addLayerToPage(i,c)}},r.prototype.checkLayerPermission=function(e,t){return!e||!(e.permissionLevel<t)},r.prototype.createLayer=function(e,t,a){if(a=a||virtualViewer.getActivePaneState(),!a.pageStates)return null;var n=a.getDocumentModel();t||0===t||(t=a.getPageNumber());for(var o,i=0;i<a.getPageCount();i++){var r=a.pageStates[i].annotationLayers;if(!r||!r[e]){var s=this.createAnnotationLayer(e,i,a.pageStates[i]);a.addLayerToPage(i,s),this.addLayerToPageHash(e,i,a),i===t&&(o=s,a.setCurrentLayer(o))}}if(o){var l=this.createModelAnnotationLayer(o);n.model.layerManager.layers.push(l),n.setAnnotationsModifiedSinceInit(!0,a);var u=(n.model.annotationLayersDeletedSinceInit||[]).indexOf(o.layerName);u>-1&&n.model.annotationLayersDeletedSinceInit.shift(u)}return o},r.prototype.addLayerToPageHash=function(e,t,a){a=a||virtualViewer.getActivePaneState();var n=a.getDocumentModel(),o=n.model.pageData[t];o.annotationHash||(o.annotationHash={});var i=o.annotationHash[e];if(i)i.annExists=!0;else{var r={annExists:!0,documentId:a.getDocumentId(),layerAnnotationId:e,layersToMerge:[],pageIndex:t,rotateAngle:a.getRotationForPage()};o.annotationHash[e]=r}},r.prototype.createDefaultLayer=function(e){var t="Default",a=(e.getLayerNames(),e.getLayersForPage(e.getPageNumber())),n=null;return a&&a[t]||(n=this.createLayer(t)),n},r.prototype.createModelAnnotationLayer=function(e){return{newLayer:!0,annotationId:encodeURIComponent(e.layerName),isDeletable:!0,isRedaction:!1,permissionLevel:e.permissionLevel,dirty:!0,visible:!0}},r.prototype.createAnnotationLayer=function(e,t,o){o=o||virtualViewer.getActivePaneState().pageStates[t];var i=o.dpi;void 0===i&&(i=virtualViewer.getActivePaneState().getDPIForPage(0)),0===i&&(i=72);var r={};return r.layerName=e,r.pageNumber=t,r.pageWidth=o.originalWidth,r.pageHeight=o.originalHeight,r.docDPI=i,a.createIDMAnnotations&&(r.pageWidth=1e4,r.pageHeight=1e4,r.docDPI=200,r.isIDM=!0),a.base64EncodeAnnotations?r.doubleByte=!0:r.doubleByte=!1,r.visibility=!0,r.isRedaction=!1,r.isDeletable=!0,r.permissionLevel=n.permissionLevels.PERM_DELETE,r.anns=[],r},r.prototype.renameLayerCore=function(e,t){var o=virtualViewer.getActivePaneState().getDocumentId();if(!o)return null;var i=new URI(a.servletPath);i.addQuery("action","renameAnnotationLayer"),i.addQuery("documentId",o),i.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),i.addQuery("pageCount",virtualViewer.getPageCount()),i.addQuery("oldLayerName",e),i.addQuery("newLayerName",t),n.cacheBuster===!0&&i.addQuery("cacheBuster",Math.random()),i.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var r=i.query();i.query(""),$.ajax({url:i.toString(),type:"POST",data:r,success:function(e){virtualViewer.checkServerException(e)},error:function(e){virtualViewer.checkServerException(e,o),console.log("error")}})},r.prototype.deleteCurrentLayer=function(){for(var e=virtualViewer.getActivePaneState(),t=e.getLayerNames(),a=this.getCurrentLayer(),n=[],o=0;o<t.length;o+=1){var i=t[o];i!==a.layerName&&this.newLayerNames.push(i)}e.setLayerNames(n),e.deleteLayer(a.layerName),"Master Layer"===a.layerName&&$("#vvLayerManagerConsolidateLayerButton").prop("disabled",!1).css("opacity",1),e.setCurrentLayer(void 0),this.getCurrentLayer(),virtualViewer.delayedPaintCanvases()},r.prototype.renameCurrentLayer=function(e){if(this.getCurrentLayer()){var t=this.getCurrentLayer().layerName;this.renameLayerCore(t,e);var a=virtualViewer.getCurrentState();a.renameLayer(t,e),virtualViewer.getDocumentModel().renameLayer(t,e)}},r.prototype.markCurrentLayerDirty=function(){var e=virtualViewer.getActivePaneState();e.getDocumentModel().markLayerDirty(this.getCurrentLayer())},r.prototype.markLayerDirty=function(e){var t=virtualViewer.getActivePaneState();t.getDocumentModel().markLayerDirty(e)},r.prototype.markLayerWithAnnDirty=function(e){var t=virtualViewer.getActivePaneState();if(t){var a=this.getLayerWithAnn(e);a&&(this.markLayerDirty(a),virtualViewer.getCallbackManager().call("annotationChanged",{documentId:t.getDocumentId(),annotationLayerId:a.layerName,annotationId:e.annId,type:e.getRefinedType(),modifyDate:e.getMostRecentModifyDate()}))}},r.prototype.getLayerWithAnn=function(e){var t=virtualViewer.getActivePaneState();if(!e||!t)return null;var a=t.getLayersForPage(e.page);if(!a)return null;var n=e.layerName;if(!n)return null;var o=a[n];return o?o:null},r.prototype.checkLayerIntegrity=function(e,t){t=t||virtualViewer.getActivePaneState();var a=t.pageStates[e].annotationLayers;a||(a={},t.pageStates[e].annotationLayers=a);for(var n=t.getLayerNames(),o=0;o<n.length;o++)a[n[o]]||(a[n[o]]=this.createLayer(n[o],e,t));t.pageStates[e].annotationLayers=a},r.prototype.getAnnotationAtPoint=function(e,t){t=t||virtualViewer.getActivePaneState();var a=t.getPageNumber(),o=t.getLayersForPage(a),i=t.getLayerNames();if(o){for(var r=null,s=0;s<i.length;s++){var l=o[i[s]];if(this.checkLayerPermission(l,n.permissionLevels.PERM_EDIT)&&l&&l.visibility)for(var u=l.anns.length-1;u>=0;u--){
var d=l.anns[u];if(d.getDelete()===!1&&d.page===t.pageNumber){var c=d.getPointRotatedForAnn(e,t);if(d.drawnAnnotationContains(c,d.getWidthRatio(t),d.getHeightRatio(t)))return r=d}}}return r}},r.prototype.isAnnotationAtPoint=function(e,t){var a=this.getAnnotationAtPoint(e,t,!0);return!!a},r.prototype.getAnnotationAtIndex=function(e){return this.getCurrentLayer().anns[e]},r.prototype.getAnnotationCount=function(){return this.getCurrentLayer().anns.length},r.prototype.paintAnnotations=function(e,t,a,o){e=e||virtualViewer.getActivePaneState(),o||0!==o&&(o=e.getPageNumber());var i=e.getLayersForPage(o),r=e.getLayerNames();if(i&&r)for(var s=r.length,l=0;l<s;l++){var u=i[r[l]];if(void 0!==u&&u.permissionLevel>=n.permissionLevels.PERM_VIEW&&u.visibility===!0)for(var d=0;d<u.anns.length;d++)u.anns[d].getDelete()!==!0&&u.anns[d].page===o&&this.paintAnnotation(e,t,a,u.anns[d])}},r.prototype.addAnnotation=function(t,o,i,r,s){var l=virtualViewer.getActivePaneState();if(null!==o&&void 0!==o||(o=l.getPageNumber()),!i){var u=l.getLayersForPage(o),d=l.getLayerNames(),c=d.length;if(!this.areDimensionsValid(t))return null;if(t.getType()===n.annotationTypes.SANN_POSTIT&&t.setLineColor(null),0!==c&&u)if(this.getCurrentLayer())e.isRedactionLayer(this.getCurrentLayer())&&(u.Default?l.setCurrentLayer(u.Default):this.createDefaultLayer(l));else{for(var g=0;g<c;g+=1){var v=this.checkLayerPermission(u[d[g]],n.permissionLevels.PERM_CREATE);if(v===!0){l.setCurrentLayer(u[d[g]]);break}}this.getCurrentLayer()||this.createDefaultLayer(l)}else this.createDefaultLayer(l),c=d.length;i=this.getCurrentLayer()}if(this.checkLayerPermission(this.getCurrentLayer(),n.permissionLevels.PERM_CREATE)===!1)return alert(e.getLocalizedValue("errors.createAnnOnLayerPermission","You do not have permission to create annotations on this layer.")),null;var p=-1;0===i.pageWidth&&(i.pageWidth=l.getOriginalWidthForPage(o)),0===i.pageHeight&&(i.pageHeight=l.getOriginalHeightForPage(o)),t.setLayerName(i.layerName),t.setPageWidth(i.pageWidth),t.setPageHeight(i.pageHeight),r||t.fixCoordinates();for(var h=0;h<i.anns.length;h++)i.anns[h].getOrdinal()>p&&(p=i.anns[h].getOrdinal());t.setOrdinal(p+1),t.setIndex(i.anns.length),i.anns.push(t),this.addLayerToPageHash(i.layerName,o),s||l.getDocumentModel().markLayerDirty(i),a.showAnnIndicators&&(virtualViewer.pageContainsAnnotations(o)&&!virtualViewer.pageHasIndicator(o)&&(virtualViewer.showAnnotationIndicator(o),virtualViewer.addToPagesWithAnnotations(o)),virtualViewer.createNavigationOptionsLabels()),virtualViewer.addSingleAnnotationListItem(t);var m=l.getNewAnnList().indexOf(t);return m===-1&&l.addAnnToNewAnnList(t),t},r.prototype.deleteAnn=function(e){e||(e=virtualViewer.getActivePaneState());var t=virtualViewer.getCurrentAnnObject(),a=e.pageNumber;if(t){var n=e.getUndoObject(a);n.referenceAnn=t,n.unchangedAnn=t.clone(),n.layer=this.getLayerWithAnn(t),t.setDelete(!0),this.markLayerWithAnnDirty(t),n.modifiedAnn=t.clone(),n.type="modify",n.modifiedAnn.isSameAs(n.unchangedAnn)||e.pushUndoObject(a,n),e.resetUndoObject(),virtualViewer.setCurrentAnnObject(null),virtualViewer.updateAnnotationListItem(t);var o=e.getNewAnnList().indexOf(t);if(o>-1){if(e.removeNewAnnFromList(o),0===e.getNewAnnList().length&&e.getTrueAnnChange()===!1){var i=e.getDocumentModel();i.setAnnotationsModifiedSinceInit(!1,e)}}else e.setTrueAnnChange(!0);var r=virtualViewer.getCallbackManager();r.call("annotationDeletion",{documentId:e.getDocumentId(),annotationLayerId:t.layerName,annotationId:t.annId,type:t.getRefinedType()})}virtualViewer.pageContainsAnnotations(a)||(virtualViewer.removeAnnotationIndicators(a),virtualViewer.removeFromPagesWithAnnotations(a)),virtualViewer.delayedPaintCanvases()},r.prototype.copyAnn=function(){var e=virtualViewer.getCurrentAnnObject();virtualViewer.setAnnClipboard(e.clone())},r.prototype.cutAnn=function(e){this.copyAnn(),e||(e=virtualViewer.getActivePaneState()),this.deleteAnn(e)},r.prototype.pasteAnn=function(t,n){null!==t&&void 0!==t||(t=virtualViewer.getActivePaneState()),null!==n&&void 0!==n||(n=t.pageNumber);var o=virtualViewer.getAnnClipboard(),i=o.getLayerName(),r=t.getLayersForPage(n),s=null,l=!1;"vvRedaction"===i.substring(0,11)&&(l=!0),a.oneLayerPerAnnotation?(s=virtualViewer.createAutoLayer(l),i=s.layerName,o.setLayerName(i)):r&&r[i]?(s=r[i],0===s.pageWidth&&(s.pageWidth=t.getOriginalWidthForPage(n)),0===s.pageHeight&&(s.pageHeight=t.getOriginalHeightForPage(n))):(s=this.createLayer(i,n,t),t.addLayerToLayerNames(i),t.addLayerToPage(n,s),this.addLayerToPageHash(i,n,t));var d=o.clone();d.fixForPaste(n,t,s);var c=u(o.pasteLocation,d,t);d.move(c),o.pasteLocation=null,d.setCreateUser(virtualViewer.getUserPreferences().getUsername()),d.setCreateDate(e.toSnowDateString(new Date)),d.markRevised(null,d.getCreateDate()),this.addAnnotation(d,n,s,!0);let g=virtualViewer.getCurrentAnnObject();virtualViewer.setCurrentAnnObject(d),virtualViewer.getCallbackManager().call("annotationCreation",{documentId:t.getDocumentId(),annotationLayerId:d.layerName,annotationId:d.annId,type:d.getRefinedType(),createDate:d.getCreateDate()}),virtualViewer.setCurrentAnnObject(g),virtualViewer.delayedPaintCanvases()};var u=function(e,t,a){var n=t.pageWidth*t.getWidthRatio(a),i=t.pageHeight*t.getHeightRatio(a);return e.getX()<0?e=new o(0,e.getY()):e.getX()+t.box.getWidth()*t.getWidthRatio()>n&&(e=new o(n-t.box.getWidth()*t.getWidthRatio(),e.getY())),e.getY()<0?e=new o(e.getX(),0):e.getY()+t.box.getHeight()*t.getHeightRatio()>i&&(e=new o(e.getX(),i-t.box.getHeight()*t.getHeightRatio())),e};return r.prototype.rotateContextForAnnotation=function(t,a,n,o,i,r){o||(o=virtualViewer.getActivePaneState()),i||(i=$("#vvOuterDiv")),r||(r=$("#vvDummyScroller"));var s=o.getRotationForPage(n.page),l=n.getRotationAngle(),u={page:n.page,state:o,pageWidth:n.pageWidth*n.getWidthRatio(o),pageHeight:n.pageHeight*n.getHeightRatio(o),rotateAngle:(s+l)%360,dummyScroller:r,outerDiv:i,canvas:t},d=virtualViewer.getTransformedPageLeft(u),c=virtualViewer.getTransformedPageTop(u),g=Math.sin(e.degreesToRadians(s+l)),v=Math.cos(e.degreesToRadians(s+l));a.setTransform(v,g,-g,v,d,c)},r.prototype.paintAnnotation=function(e,t,a,o){e=e||virtualViewer.getActivePaneState(),a.save();var i=o.getType();o.updatePageDimensions(e),e.currentPaneIndex>0?this.rotateContextForAnnotation(t,a,o,e,$("#vvSplit1Panel"),$("#vvSplitScroller")):this.rotateContextForAnnotation(t,a,o,e,null,null),a.lineWidth=o.getLineWidthInPixels()*o.getHeightRatio(e),o.getLineColor()&&(a.strokeStyle=o.getLineColor()),o.getFillColor()&&(a.fillStyle=o.getFillColor()),i===n.annotationTypes.SANN_RECTANGLE?o.getFillColor()?this.rectanglePrimitive(a,o,!0,e):o.getLineColor()&&this.rectanglePrimitive(a,o,!1,e):i===n.annotationTypes.SANN_REDACTION_RECT?this.rectanglePrimitive(a,o,!0,e):i===n.annotationTypes.SANN_LINE?this.linePrimitive(a,o,!1,!1,e):i===n.annotationTypes.SANN_ELLIPSE?this.ellipsePrimitive(a,o,e):i===n.annotationTypes.SANN_BITMAP?this.bitmapPrimitive(a,o,e):i===n.annotationTypes.SANN_POSTIT?this.stickyPrimitive(a,o,e):i===n.annotationTypes.SANN_POLYGON?this.linePrimitive(a,o,!1,!0,e):i===n.annotationTypes.SANN_ARROW?this.linePrimitive(a,o,!0,!1,e):i===n.annotationTypes.SANN_EDIT?this.textPrimitive(a,o,!0,0,e):i===n.unsupportedAnnotationTypes.SANN_TRANSPARENT_BITMAP||(i===n.unsupportedAnnotationTypes.SANN_BUBBLE?this.ellipsePrimitive(a,o,e):i===n.unsupportedAnnotationTypes.SANN_CLOUD_EDIT?this.ellipsePrimitive(a,o,e):i===n.unsupportedAnnotationTypes.SANN_CUSTOM_STAMP||i===n.unsupportedAnnotationTypes.SANN_CIRCLE),virtualViewer.getCurrentAnnObject()&&o.isSameAs(virtualViewer.getCurrentAnnObject())&&this.addResizeNubs(a,o),a.restore()},r.prototype.addResizeNubs=function(e,t){if(!a.readOnlyAnnotationMode){var o=t.getBoundingBox(t.collapsed),i=virtualViewer.getActivePaneState(),r=t.getPointArray(),s=null,l=null;if(r&&(s=r[0],l=r[1]),t.getType()!==n.annotationTypes.SANN_ARROW&&t.getType()!==n.annotationTypes.SANN_LINE||2!==r.length){var u=o.getX1()*t.getWidthRatio(i),d=o.getY1()*t.getHeightRatio(i),c=o.getWidth()*t.getWidthRatio(i),g=o.getHeight()*t.getHeightRatio(i);e.lineWidth=1,e.strokeStyle="rgb(0,0,0)",e.strokeRect(u,d,c,g),t.collapsed||(this.createNub(e,t,u,d),this.createNub(e,t,u+c,d),this.createNub(e,t,u,d+g),this.createNub(e,t,u+c,d+g))}else this.createNub(e,t,s.getX()*t.getWidthRatio(i),s.getY()*t.getHeightRatio(i)),this.createNub(e,t,l.getX()*t.getWidthRatio(i),l.getY()*t.getHeightRatio(i));virtualViewer.getEventManager().setDragMode(n.dragModes.moveAnnotation)}},r.prototype.createNub=function(t,n,o,i){var r=e.getNubSize(),s=r/2;t.fillStyle=a.polygonNubFillColor||"rgba(0, 0, 255, .40)",t.fillRect(o-s,i-s,r,r)},r.prototype.rectanglePrimitive=function(e,t,a,n){n||(n=virtualViewer.getActivePaneState());var i=t.getBoundingBox(t.collapsed);if(a)return e.fillStyle=t.getFillColor(),void e.fillRect(i.getX1()*t.getWidthRatio(n),i.getY1()*t.getHeightRatio(n),i.getWidth()*t.getWidthRatio(n),i.getHeight()*t.getHeightRatio(n));var r=[];r[0]=new o(i.getX1(),i.getY1()),r[1]=new o(i.getX2(),i.getY1()),r[2]=new o(i.getX2(),i.getY2()),r[3]=new o(i.getX1(),i.getY2()),r[4]=new o(i.getX1(),i.getY1()),t.setPointArray(r),this.linePrimitive(e,t,!1,a,n),t.setPointArray(null)},r.prototype.redactionRectanglePrimitive=function(e,t,n){n||(n=virtualViewer.getActivePaneState()),t.setFillColorRGB(a.annotationDefaults.redactionFillColor),t.setOpacity(a.annotationDefaults.redactionOpacity),this.rectanglePrimitive(e,t,!0,n)},r.prototype.bubblePrimitive=function(e,t,a){a=a||virtualViewer.getActivePaneState(),this.textPrimitive(e,t,!0,0,a)},r.prototype.cloudPrimitive=function(t,a,n){n=n||virtualViewer.getActivePaneState(),this.ellipsePrimitive(t,a,n),this.textPrimitive(t,a,!1,0,n);var o=e.getTextAnnDOMId(a),i=document.getElementById(o);i.style.textAlign="center"},r.prototype.areDimensionsValid=function(e){if(e.collapsed)return!0;var t=e.getBoundingBox(),o=t.getX1(),i=t.getY1(),r=t.getWidth(),s=t.getHeight();if(isNaN(o)||isNaN(i)||isNaN(r)||isNaN(s))return!1;if((e.getType()===n.annotationTypes.SANN_EDIT||e.getType()===n.unsupportedAnnotationTypes.SANN_CLOUD_EDIT)&&(r<n.minTextAnnDrawSize||s<n.minTextAnnDrawSize))return!1;if(e.getType()===n.annotationTypes.SANN_POSTIT){var l=t.getWidth(),u=5,d=a.annotationDefaults.stickyMargin+1;if(l-u-d<n.minTextAnnDrawSize)return!1}return!0},r.prototype.stickyPrimitive=function(e,t,n){if(this.areDimensionsValid(t)){n=n||virtualViewer.getActivePaneState(),e.save(),e.shadowColor="#777777",e.shadowOffsetX=4,e.shadowOffsetY=4,e.shadowBlur=2,this.rectanglePrimitive(e,t,!0,n),e.restore();var o=t.getBoundingBox(t.collapsed),i=n.getZoomDecimal(),r=t.getMinimizeButtonSize(n);if(r){var s=Math.ceil(a.annotationDefaults.stickyMargin*i);e.drawImage(l,o.getX2()*t.getWidthRatio(n)-r-s,o.getY1()*t.getHeightRatio(n)+s,r,r)}t.collapsed||this.textPrimitive(e,t,!1,a.annotationDefaults.stickyMargin,n)}},r.prototype.textPrimitive=function(t,o,i,r,s){s=s||virtualViewer.getActivePaneState(),i&&this.rectanglePrimitive(t,o,!0,s);var l=Math.round(o.getFontSize(!0)*o.getHeightRatio(s)),u=o.getFontName();o.isIDM&&"Explorer"===BrowserDetect.browser&&"TIMES ROMAN"===o.getFontName()&&(u="Times New Roman");var d=l/.85,c=0,g=d/1.5,v=o.getBoundingBox(),p=o.getWidthRatio(s),h=o.getHeightRatio(s),m=o.type===n.annotationTypes.SANN_POSTIT,f=o.getMinimizeButtonSize(s);r||(r=0);var y="";o.getFontBold()&&(y+="bold "),o.getFontItalic()&&(y+="italic "),t.save(),t.font=y+l+'px "'+u+'"',t.fillStyle="#"+o.getFontColor(),t.translate((v.getX1()+r)*p,(v.getY1()+r)*h);var b=v.getHeight()*h,P=(o.getRotationAngle()+s.getRotationForPage(o.page))%360;a.rotateTextAnnotations||90!==P?a.rotateTextAnnotations||180!==P?a.rotateTextAnnotations||270!==P||(b=v.getWidth()*h,t.rotate(-e.degreesToRadians(P)),t.translate(0,-v.getWidth()*p),m&&(c+=f,g+=f)):(t.rotate(-e.degreesToRadians(P)),t.translate(-v.getWidth()*p,-v.getHeight()*h),m&&(c+=f,g+=f)):(b=v.getWidth()*h,t.rotate(-e.degreesToRadians(P)),t.translate(-v.getHeight()*h,0),m&&(c+=f));var T=o.getWrappedText();T.length&&!o.wrappedTextIsStale||(T=o.wrapTextString(t,r,s));for(var A=0;A<T.length&&!(g>b&&A>0);A++)t.fillText(T[A],c,g),g+=d;t.restore()},r.prototype.ellipsePrimitive=function(e,t,a){var n=t.getBoundingBox();a=a||virtualViewer.getActivePaneState();var o=n.getX1()*t.getWidthRatio(a),i=n.getY1()*t.getHeightRatio(a),r=n.getX2()*t.getWidthRatio(a),s=n.getY2()*t.getHeightRatio(a),l=4*((Math.sqrt(2)-1)/3),u=(r-o)/2,d=(s-i)/2,c=o+u,g=i+d;e.save(),e.beginPath(),e.moveTo(c,g-d),e.bezierCurveTo(c+l*u,g-d,c+u,g-l*d,c+u,g),e.bezierCurveTo(c+u,g+l*d,c+l*u,g+d,c,g+d),e.bezierCurveTo(c-l*u,g+d,c-u,g+l*d,c-u,g),e.bezierCurveTo(c-u,g-l*d,c-l*u,g-d,c,g-d),t.getFillColor()&&(e.strokeStyle=t.getFillColor(),t.isIDM&&(e.globalAlpha=.5),e.fill()),e.closePath(),e.stroke(),e.restore()},r.prototype.linePrimitive=function(t,o,i,r,s){s=s||virtualViewer.getActivePaneState();var l=o.getFillColor(),u=o.getPointArray();if(u){t.beginPath(),t.moveTo(u[0].getX()*o.getWidthRatio(s),u[0].getY()*o.getHeightRatio(s));for(var d=1;d<u.length;d+=1)t.lineTo(u[d].getX()*o.getWidthRatio(s),u[d].getY()*o.getHeightRatio(s));if(l&&(t.strokeStyle=l,t.fill()),r&&o.getPreview()!==!0&&t.closePath(),t.stroke(),o.getPreview()===!0&&o.getType()===n.annotationTypes.SANN_POLYGON){t.fillStyle=a.polygonNubFillColor||"rgba(0, 0, 255, .40)";var c=e.getNubSize();t.fillRect(u[0].getX()-c/2,u[0].getY()-c/2,c,c)}}if(i===!0){var g=u[0].getX()*o.getWidthRatio(s),v=u[0].getY()*o.getHeightRatio(s),p=u[1].getX()*o.getWidthRatio(s),h=u[1].getY()*o.getHeightRatio(s),m=this.lineAngle(g,v,p,h),f=this.lineLength(g,v,p,h),y=.11*f;y<8&&(y=8),y>25&&(y=25);var b=30;t.save(),t.moveTo(p,h),t.translate(p,h),t.rotate(m),t.rotate(e.degreesToRadians(b)),t.moveTo(0,y),t.lineTo(0,0),t.moveTo(p,h),t.rotate(e.degreesToRadians(2*b*-1)),t.moveTo(0,y),t.lineTo(0,0),t.stroke(),t.restore()}},r.prototype.bitmapPrimitive=function(e,t,n){if(t.bitmapData){var o=new Image;if(t.bitmapImage)this.paintBitmapStamp(e,t,t.bitmapImage,n);else{var r=this,s=n.getDocumentId(),l=n.currentPaneIndex;$(o).on("load",function(){if(t.bitmapImage=this,t.bitmapImage.vvDeadEnd=!0,a.enableSingleClickImageRubberStamp){var e=i.getStateForDocumentId(s,l);r.paintBitmapStamp(null,t,this,e)}});var u=t.bitmapData;u&&!u.includes("data:image/png;base64")&&(u="data:image/png;base64,"+t.bitmapData),o.src=u,$(o).ready(function(){if(!a.enableSingleClickImageRubberStamp){var n=i.getStateForDocumentId(s,l);r.rotateContextForAnnotation(e.canvas,e,t,n),r.paintBitmapStamp(e,t,o,n)}})}}},r.prototype.paintBitmapStamp=function(e,t,a,n){var o=t.getBoundingBox(),i=o.getX1()*t.getWidthRatio(n),r=o.getY1()*t.getHeightRatio(n),s=o.getWidth()*t.getWidthRatio(n),l=o.getHeight()*t.getHeightRatio(n),u=!e;if(u){var d=$(".vvOuter").eq(n.currentPaneIndex),c=d.find(".vvCanvas");e=c[0].getContext("2d"),e.save(),n.currentPaneIndex>0?this.rotateContextForAnnotation(c,e,t,n,$("#vvSplit1Panel"),$("#vvSplitScroller")):this.rotateContextForAnnotation(c,e,t,n,null,null)}e.drawImage(a,i,r,s,l),u&&e.restore()},r.prototype.addFootnote=function(e,t,a){e||(e=virtualViewer.getActivePaneState()),t=t||virtualViewer.getCurrentAnnObject();var n=a||t.getTextString(),o=t.getFormattedFootnote();n=n.concat("\n",o),t.setTextString(n,!1),t.wrappedTextIsStale=!0},r.prototype.lineLength=function(e,t,a,n){return Math.sqrt(Math.pow(a-e,2)+Math.pow(n-t,2))},r.prototype.lineSlope=function(e,t,a,n){return(n-t)/(a-e)},r.prototype.lineAngle=function(t,a,n,o){var i=t,r=a,s=t,l=o,u=this.lineSlope(t,a,n,o),d=(n-t)*(s-i)+(o-a)*(l-r),c=Math.sqrt(Math.pow(n-t,2)+Math.pow(o-a,2)),g=Math.sqrt(Math.pow(s-i,2)+Math.pow(l-r,2)),v=Math.acos(d/(c*g));return v=isNaN(v)===!0?90:e.radiansToDegrees(v),u>0&&(v=90-v),n>t?u>0&&(v+=90):n===t?v=u<0?0:180:v+=u>0?270:180,e.degreesToRadians(v)},r.getInstance=function(){return null==s&&(s=new r),s},r.getInstance()}),define("vvSearch",["user-config/config"],function(e){function t(){this.documentId="",this.searchCursor={page:0,match:0},this.performOCR=!1,this.searchTerm="",this.pattern="",this.matchCount=0,this.patternIndex=-1,this.inProgress=!1,this.presearchedPages=null,this.batchIndex=-1,this.numberOfBatches=1,this.lastBatchPage=null,this.firstPageToSearch=null,this.lastPageToSearch=null,this.firstResultPage=null,this.lastResultPage=null,this.searchCancelled=!1,this.searchAnnotationResults=[],this.searchDocumentResults=[],this.caseSensitive=!!e.searchCaseSensitive,this.exactMatch=!1,this.matchRedactions=[],this.annotationSearch=!1}return t.prototype.clearResults=function(){this.firstResultPage=null,this.lastResultPage=null,this.firstPageOfCurrentBatch=0,this.searchCancelled=!1,this.searchAnnotationResults=[],this.searchDocumentResults=[],this.matchCount=0},t.prototype.getCurrentMatch=function(){var e=this.getPageResults(this.searchCursor.page);if(!e||!e.matches||!e.matches.length)return null;var t=e.matches;return this.searchCursor.match>t.length||this.searchCursor.match<0?null:t[this.searchCursor.match]},t.prototype.getResults=function(){return this.searchAnnotationResults.length&&this.annotationSearch?this.searchAnnotationResults:this.searchDocumentResults||[]},t.prototype.getMatchedPages=function(){for(var e=this.getResults(),t=[],a=0;a<e.length;a++)e[a]&&e[a].matches&&e[a].matches.length&&t.push(a);return t},t.prototype.getPageResults=function(e){if("number"!=typeof e||e<0)return null;var t=this.getResults();return t[e]||{matches:[]}},t.prototype.getSearchedPageDimensions=function(e){if("number"!=typeof e||e<0)return null;var t=this.getPageResults(e);return{pageWidth:t.pageWidth,pageHeight:t.pageHeight,dpi:t.dpi}},t.prototype.noResultsFound=function(){if(!this.searchTerm&&!this.pattern)return!1;var e=this.getPageResults(this.firstResultPage);return!e||!e.matches.length},t.prototype.addAnnotationSearchResultToPage=function(e,t){e&&"number"==typeof t&&(this.matchCount++,this.searchAnnotationResults[t]=this.searchAnnotationResults[t]||{matches:[]},this.searchAnnotationResults[t].matches.push(e),this.updateFirstOrLastSearchPage(t))},t.prototype.addDocumentSearchResults=function(e){var t=[];if(!e||!e.results)return t;for(var a=e.results,n=Object.keys(a),o=0;o<n.length;o++){var i=n[o];if(a[i]&&a[i].matches&&a[i].matches.length&&!(a[i].pageNumber<0)){var r=parseInt(i);t.push(r),this.matchCount+=a[i].matches.length,this.searchDocumentResults[r]=a[i],this.updateFirstOrLastSearchPage(r)}}return t},t.prototype.addPresearchedPages=function(e){if(e&&e.presearches){var t=Object.keys(e.presearches),a=this;t&&t.length&&(this.presearchedPages=this.presearchedPages||{},t.forEach(function(t){a.presearchedPages[t]=e.presearches[t]}))}},t.prototype.updateFirstOrLastSearchPage=function(e){this.firstResultPage||0===this.firstResultPage||(this.firstResultPage=e),this.lastResultPage||0===this.lastResultPage||(this.lastResultPage=e),e<this.firstResultPage&&(this.firstResultPage=e),e>this.lastResultPage&&(this.lastResultPage=e)},t}),define("vvPrintManager",["vvUtility","vvWatermarks","user-config/config","vvDefines","vvStateManager","vvCallbackManager"],function(e,t,a,n,o,i){var r=function(){var r=function(e,t){if(f(),$("#vvPrintIndicator").modal("hide"),t||(t={}),"string"==typeof e?e=[e]:t.printDocumentList&&(e=[],virtualViewer.documentList.forEach(function(t){"string"==typeof t?e.push(t):e.push(t.documentId)})),!e||!e.length)throw new Error("no document IDs provided");var a={};return a.fitToPage=t.fitToPage,a.documentIds=e,i.call("printMultipleDocumentsBegin",{documentIds:e,fitToPage:a.fitToPage,clientInstanceId:virtualViewer.getClientInstanceId()}),l(a)},s=function(a){f(),$("#vvPrintIndicator").modal("hide"),a||(a={});var r=o.getActivePaneState(),s={};if(a.documentId){var u=o.getStateForDocumentId(a.documentId);if(!u){var d=e.getLocalizedValue("errors.printDocumentMustBeOpened","The document you asked to print is not open in VirtualViewer."),c={client:!0,disable:virtualViewer.disableErrorModals.print};return void virtualViewer.displayExceptionMessage(d,c)}r=u,s.state=r}t.saveWatermarks(r);var g=r.getDocumentModel();s.state=r,s.model=g,a.includeAnnotations?(s.includeTextAnnotations=!0,s.includeNonTextAnnotations=!0):(s.includeTextAnnotations=!1,s.includeNonTextAnnotations=!1),s.includeRedactions=a.includeRedactions,s.includeRedactionTags=a.includeRedactionTags,s.includeWatermarks=a.includeWatermarks,s.includeDocumentNotes=a.includeDocumentNotes,s.fitToPage=a.fitToPage,null!==a.pageRangeType&&void 0!==a.pageRangeType&&(s.pageRangeType=a.pageRangeType),null!==a.pageRangeValue&&void 0!==a.pageRangeValue&&(s.pageRangeValue=a.pageRangeValue),"current"===s.pageRangeType&&(s.pageRangeValue=r.getPageNumber());var v=e.normalizePageRangeInput(s.pageRangeType,s.pageRangeValue,r);if(i.call("printDocumentBegin",{documentId:s.state.getDocumentId(),includeAnnnotations:a.includeAnnotations,includeRedactions:s.includeRedactions,includeRedactionTags:s.includeRedactionTags,includeWatermarks:s.includeWatermarks,includeDocumentNotes:s.includeDocumentNotes,fitToPage:s.fitToPage,pageRangeType:s.pageRangeType,pageRangeValue:s.pageRangeValue,clientInstanceId:virtualViewer.getClientInstanceId()}),"Explorer"===BrowserDetect.browser&&v.length>n.printIE11PageLimit){var p="Due to limitations of Internet Explorer, printing of more than %n pages at a time is unsupported.  Please split your print task up into sets of %n or fewer pages.",h=e.getLocalizedValue("errors.printTooManyPagesForIE",p);return h=h.replace(/%n/g,n.printIE11PageLimit),alert(h),void i.call("printDocumentError",{documentId:s.state.getDocumentId(),exceptionMessage:h})}if("Firefox"===BrowserDetect.browser&&v.length>n.printFirefoxPageLimit){var m="Due to limitations of Firefox, printing of more than %n pages at a time is unsupported.  Please split your print task up into sets of %n or fewer pages.",y=e.getLocalizedValue("errors.printTooManyPagesForFirefox",m);return y=y.replace(/%n/g,n.printFirefoxPageLimit),alert(y),void i.call("printDocumentError",{documentId:s.state.getDocumentId(),exceptionMessage:y})}return l(s)},l=function(e){var t,n=new URI(a.servletPath);return t=e.documentIds?d(e):u(e),c(e,n,t),S(e),"Printed Via Local Printing"},u=function(e){var t=new URI(a.servletPath);return t.addQuery("action","newExport"),t.addQuery("format","pdf"),t.addQuery("includeTextAnnotations",e.includeTextAnnotations),t.addQuery("includeNonTextAnnotations",e.includeNonTextAnnotations),t.addQuery("includeRedactions",e.includeRedactions),t.addQuery("includeRedactionTags",e.includeRedactionTags),t.addQuery("includeWatermarks",e.includeWatermarks),t.addQuery("includeDocumentNotes",e.includeDocumentNotes),t.addQuery("fitToPage",e.fitToPage),t.addQuery("pageRangeType",e.pageRangeType),t.addQuery("pageRangeValue",e.pageRangeValue),t.addQuery("annotations",JSON.stringify(e.state.getAnnotationLayers(!0,!1,!1,e.includeRedactions,e.includeTextAnnotations,e.includeNonTextAnnotations,!0,n.permissionLevels.PERM_PRINT))),t.addQuery("modelJSON",JSON.stringify(e.model.model)),t.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t.addQuery("asAttachment",!1),t.addQuery("pageCount",e.state.getPageCount()),virtualViewer.getOverlayPath()||t.addQuery("overlayPath",virtualViewer.getOverlayPath()),t.query()},d=function(e){var t=new URI(a.servletPath);return t.addQuery("action","exportDocuments"),t.addQuery("format","pdf"),t.addQuery("fitToPage",e.fitToPage),e.documentIds.forEach(function(e){let a=o.getStateForDocumentId(e);if(a&&a.documentFullyLoaded()&&a.getDocumentModel().getPagesModifiedSinceInit()){let n=a.getDocumentModel().model;t.addQuery(e+".modelJson",JSON.stringify(n))}}),t.addQuery("documentIdArray[]",e.documentIds),t.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t.addQuery("asAttachment",!1),virtualViewer.getOverlayPath()||t.addQuery("overlayPath",virtualViewer.getOverlayPath()),t.query()},c=function(e,t,a){var n=$("<iframe></iframe>").appendTo("#virtualViewerMain").addClass("vvPrintFrame");n.off("load"),n.attr("src","about:blank"),n.addClass("onScreen"),$("#vvNewPrintDialog").modal("hide"),$("#vvPrintIndicator").modal("show");var o=e.state?e.state.getDocumentId():e.documentIds;T()&&!P(e.state)?g(t,a,n,o):v(t,a,b(e.state),n,o)},g=function(t,a,n,o){y(t,a,function(t){n.on("load",function(e){try{var t=JSON.parse($(this.contentWindow.document).text().substr(0,1e3));if(virtualViewer.checkServerException(t,null,null,{suppressDownloadDialogs:"string"!=typeof o}))return void h(o,t.exceptionMessage,n)}catch(e){}this.contentWindow.print(),m(-1,o,n)}),n.on("error",function(){h(o,e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."),n)}),n.attr("src",t)},function(e){h(o,e,n)})},v=function(t,a,n,o,i){o.on("load",function(e){y(t,a,function(e){o[0].contentWindow.renderPDF(e,"#vvPDFJSCanvasHolder",n,p,function(e){m(e,i,o)},function(e){h(i,e,o)})},function(e){h(i,e,o)})}),o.on("error",function(t){var a=e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."),n={client:!0,disable:virtualViewer.disableErrorModals.print,e:t};virtualViewer.displayExceptionMessage(a,n),h(i,e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing."),o)}),o.attr("src","resources/print.html")},p=function(e,t){},h=function(t,a,n){"string"==typeof t?i.call("printDocumentError",{documentId:t,exceptionMessage:a||e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing.")}):i.call("printMultipleDocumentsError",{documentIds:t,exceptionMessage:a||e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing.")}),$("#vvPrintIndicator").modal("hide"),setTimeout(function(){n.removeClass("onScreen")},1e4)},m=function(e,t,a){$("#vvPrintIndicator").modal("hide"),setTimeout(function(){a.removeClass("onScreen")},1e4),"string"==typeof t?i.call("printDocument",{totalPagesPrinted:e,documentId:t}):i.call("printMultipleDocuments",{documentIds:t})},f=function(){var e=$(".vvPrintFrame").not(".onScreen");setTimeout(function(){for(var t=0;t<e.length;t++)$(e[t]).remove()},3e3)},y=function(t,a,n,o){var i=new XMLHttpRequest,r=t.toString();i.open("POST",r,!0),i.responseType="blob",i.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),i.onreadystatechange=function(){if(4===i.readyState){if(200===i.status){var t=URL.createObjectURL(i.response);return void n(t)}let r=e.getLocalizedValue("errors.printUndefinedError","An error has occurred while printing.");if(i.response.data&&i.response.data.responseJSON&&(r=i.response.data.responseJSON.exceptionMessage||r),500!==i.status||!virtualViewer.handle500Status(i.response)){var a={server:!0,disable:virtualViewer.disableErrorModals.print};virtualViewer.displayExceptionMessage(r,a)}o(r)}},i.send(a)},b=function(e){if(!e)return null;var t=e.getImageManager();if(!t||!t.overlayImage)return null;var a=t.overlayImage;return t.stripWhite(a),{overlayImage:a,lockedOverlayOffset:t.pageLockOverlayOffset,overlayData:t.overlayDataArray}},P=function(e){if(!e)return!1;var t=e.getImageManager();return!(!t||!t.overlayImage)},T=function(){if(a.disableDirectPDFPrinting)return!1;if("Explorer"!==BrowserDetect.browser)return I(["Adobe Acrobat","Chrome PDF Viewer","WebKit built-in PDF","Microsoft Edge PDF Viewer"]);if(BrowserDetect.version<11)return A("AcroPDF.PDF")||A("PDF.PdfCtrl");for(var e=0;e<navigator.plugins.length;e++){var t=navigator.plugins[e];if(t.name.toLowerCase().indexOf("pdf")!==-1)return!0}},A=function(e){try{var t=new ActiveXObject(e);return t}catch(e){}},I=function(e){"string"==typeof e&&(e=[e]);for(var t=0;t<navigator.plugins.length;t++){var a=navigator.plugins[t];if(e.indexOf(a.name)>-1)return a}},S=function(e){var t=e.state;t?virtualViewer.event(t,"VALUE_EVENT_PRINT",{KEY_EVENT_PRINT_PAGE_NUMBERS:e.pageRangeValue}):virtualViewer.event(null,"VALUE_EVENT_PRINT",{KEY_DOCUMENT_ID:e.documentIds.join(";")})};return{printDocument:s,printMultipleDocuments:r}}();return r}),define("vvColorpicker",["vvUtility","vvDefines"],function(e,t){"use strict";function a(e,t){let a=$.extend({},$.fn.colorpicker.defaultOptions,t);this.element=e,this.onChange="function"==typeof a.onChange?a.onChange:function(){},this.lastValidColor=null,this.colorInput=null,this.colorInputPreview=null,this.colorSquares=null,this.opacityContainer=null,this.opacitySlider=null,this.opacityValueLabel=null,this.foldingDrawer=null,this.continuousOpacity=!0,this.__init(),this.color(a.color),this.opacity(a.opacity),this.toggleOpacityControls(a.showOpacity),this.allowContinuousOpacity(a.allowContinuousOpacity),this.setMinimumOpacity(a.minimumOpacity)}function n(t){return t&&e.isHex(t)}$.fn.colorpicker=function(e,t){if(!(this.length<=0))return"string"==typeof e?this.data().colorpicker[e](t):this.each(function(){var t=$(this);t.data("colorpicker")||t.data("colorpicker",new a(t,e))})},$.fn.colorpicker.defaultOptions={color:"FFFFFF",opacity:1,showOpacity:!1,allowContinuousOpacity:!0,onChange:null,minimumOpacity:0},a.prototype.api=function(){return this},a.prototype.expand=function(){return this.foldingDrawer.show(),this},a.prototype.shrink=function(){return this.foldingDrawer.hide(),this},a.prototype.toggle=function(){return"none"===this.foldingDrawer.css("display")?this.expand():this.shrink(),this},a.prototype.reset=function(){return this.shrink(),this.colorSquares.removeClass(".vvColorPickerSquareSelected"),this.colorInput.attr("aria-invalid",!1),this},a.prototype.color=function(e){return"undefined"==typeof e?this.__getColor():(n(e)&&(this.__setColor(e),this.__updateColorPreview(e,this.__getOpacity()),this.__selectColorSquare(e)),this)},a.prototype.colorRgba=function(){return e.parseColorString(this.__getColor(),this.__getOpacity())},a.prototype.opacity=function(e){return"undefined"==typeof e?this.__getOpacity():("number"==typeof e&&0<=e<=1&&(this.continuousOpacity||(e=Math.round(e)),this.__setOpacity(e),this.__updateColorPreview(this.__getColor(),e),this.__updateOpacityLabel(e)),this)},a.prototype.toggleOpacityControls=function(e){return this.opacityContainer.toggle(e),this},a.prototype.setMinimumOpacity=function(e){this.opacitySlider.slider("setAttribute","min",e)},a.prototype.allowContinuousOpacity=function(e){return e?(this.continuousOpacity=!0,this.opacitySlider.slider("setAttribute","step",1)):(this.continuousOpacity=!1,this.opacity(Math.round(this.opacity())),this.opacitySlider.slider("setAttribute","step",100)),this},a.prototype.__setColor=function(e){this.lastValidColor=e,this.colorInput.val(e).attr({"aria-invalid":!1,placeholder:""})},a.prototype.__getColor=function(){return this.lastValidColor},a.prototype.__selectColorSquare=function(e){this.colorSquares.removeClass("vvColorPickerSquareSelected");var a=t.annColors.indexOf(e);a>=0?this.colorSquares.eq(a).addClass("vvColorPickerSquareSelected"):this.colorSquares.last().addClass("vvColorPickerSquareSelected").css("background-color","#"+e).data("hex-color",e)},a.prototype.__setOpacity=function(e){var t=Math.round(100*e);this.opacitySlider.slider("setValue",t),this.__updateColorPreview(this.__getColor(),e)},a.prototype.__getOpacity=function(){var e=this.opacitySlider.slider("getValue");return e/100},a.prototype.__updateColorPreview=function(t,a){this.colorInputPreview.css("background-color",e.parseColorString(t,a)).toggleClass("no-color",0===a),0===a?this.colorInput.attr("placeholder",e.getLocalizedValue("colorpicker.transparentDescription","No color")).val(null):this.colorInput.attr("placeholder","").val(this.lastValidColor)},a.prototype.__updateOpacityLabel=function(e){var t=Math.round(100*e);this.opacityValueLabel.text(t)},a.prototype.__init=function(){var e=$("<div/>",{class:"vvColorPickerContainer form-group"}).append(this.__buildColorInput(),this.foldingDrawer=$("<div/>").hide().append(this.__buildOpacityInput(),this.__buildColorSquares()));this.__attachEvents(),this.element.addClass("vvColorPickerOuterWrapper").append(e)},a.prototype.__buildColorInput=function(){var e=$("<div/>",{class:"input-group-addon vvColorInputPreview",html:"&ZeroWidthSpace;"});return this.colorInputPreview=$("<div/>",{
class:"preview-color",html:"&ZeroWidthSpace;"}),e.append(this.colorInputPreview),this.colorInput=$("<input>",{class:"form-control vvColorInputBox",attr:{type:"text",maxlength:"6",size:"6"}}),$("<div/>",{class:"input-group vvColorInputGroup"}).append(e,this.colorInput)},a.prototype.__buildOpacityInput=function(){var t=e.getLocalizedValue("colorpicker.opacity","Opacity");this.opacityContainer=$("<div class='vvColorOpacityRow clearfix'></div>").append($("<span></span>",{class:"vvColorOpacityIcon","data-tooltip":"tooltip","data-placement":"top","data-title":t,"aria-label":t}));var a="vvColorOpacityLabel"+Math.floor(1e3*Math.random());$("<label></label>",{id:a,class:"sr-only",text:t}).appendTo(this.opacityContainer),this.opacitySlider=$("<input/>",{class:"form-control vvColorOpacitySlider",attr:{type:"number","data-slider-min":0,"data-slider-max":100,"data-slider-step":1,"data-slider-tooltip":"hide","data-slider-labelledby":a}}).appendTo(this.opacityContainer).slider();var n=this;return setTimeout(function(){n.opacityContainer.find(".slider").attr({"data-tooltip":"tooltip",title:t})},0),this.opacityValueLabel=$("<span></span>",{class:"vvColorOpacityPercent","data-tooltip":"tooltip","data-placement":"top","data-title":t,"aria-label":t}).appendTo(this.opacityContainer),this.opacityContainer},a.prototype.__buildColorSquares=function(){for(var a=$("<div/>",{class:"vvColorSquaresContainer clearfix","aria-label":e.getLocalizedValue("colorpicker.presetColorsDescription")}),n=0;n<t.annColors.length;n+=1)a.append(this.__buildSingleColorSquare(t.annColors[n]));var o=$("<div/>",{class:"vvCustomColorRow vvColorChooserRow clearfix"}),i=e.getLocalizedValue("colorpicker.customColor","Custom:"),r=$("<div/>",{class:"vvCurrentCustomColorLabel"}).text(i),s=this.__buildSingleColorSquare("C3C3C3").addClass("vvCustomColorPickerSquare").attr("data-label",i.replace(":",""));return a.append(o.append(r,s)),this.colorSquares=a.find(".vvColorPickerSquare"),a},a.prototype.__buildSingleColorSquare=function(t){var a="#"+t,n=e.getLocalizedValue("colorpicker."+a,a);return $("<div/>",{class:"vvColorPickerSquare","data-tooltip":"tooltip","data-placement":"bottom","data-title":n,"aria-label":n,css:{"background-color":a},data:{"hex-color":t}})},a.prototype.__attachEvents=function(){var e=this;e.colorSquares.click(function(){e.colorSquares.removeClass("vvColorPickerSquareSelected");var t=$(this).addClass("vvColorPickerSquareSelected").data("hex-color");e.__setColor(t);var a=e.__getOpacity();return e.__updateColorPreview(t,a),e.onChange.call(e,t,a),!1}),e.colorInput.focus(function(){e.expand()}),e.colorInputPreview.click(function(){return e.toggle(),!1}),e.opacitySlider.slider().on("slideStop slide",function(){var t=e.__getColor(),a=e.__getOpacity();e.__updateColorPreview(t,a),e.__updateOpacityLabel(a),e.onChange.call(e,t,a)}),e.colorInput.change(function(){var t=$(this),a=t.val();return n(a)?(t.attr("aria-invalid",!1),e.color(a),void e.onChange.call(e,a,e.__getOpacity())):void t.attr("aria-invalid",!0)})}}),define("vvDialogs",["vvUtility","vvWatermarks","vvPrintManager","user-config/config","vvStateManager","vvColorpicker"],function(e,t,a,n,o){"use strict";var i=function(){var a,i=function(e){return{dialogName:e,bodyTemplate:"#"+e+"BodyTemplate",documentName:{},pages:{},format:{},annotations:{},redactions:{}}},v=function(){a=$.templates("#confirmCancelDialogTemplate");var e=null;$("body").on("show.bs.modal",function(t){e=document.activeElement,$(t.target).removeAttr("aria-hidden")}).on("hide.bs.modal",function(t){$(t.target).attr("aria-hidden","true"),$(e).focus(),e=null})},p=function(e,t,n){var o=i(e);$.extend(o,t.defaultOptions,n);var s=$(a.render(o));s.appendTo("body"),t.setup(s),s.modal("show"),"#savePreferencesFooterTemplate"===o.footerTemplate&&(s.find(".preference-button").click(function(){r.saveDialogOptions(s),s.find(".preference-button").hide(),s.find(".preference-saved-button").show()}),s.on("change",function(){var e=s.find(".preference-button"),t=s.find(".preference-saved-button");"none"===e.css("display")&&(e.show(),t.hide())}));var l=s.find("input[name=pageRangeType]");return l.length>0&&o.pages.pageRangeValue&&(l[0].checked=!1,l[2].checked=!1,l[1].checked=!0),s.find(".confirm-button").click(function(){t.confirm(s)&&s.modal("hide")}),s.find(".cancel-button").click(function(){t.cancel&&t.cancel()}),s.on("hidden.bs.modal",function(){s.remove()}),s},h=function(e,t,a){a=a||{},a.footerTemplate="#confirmRefuseCancelDialogFooterTemplate";var n=p(e,t,a);n.find(".refuse-button").click(function(){t.refuse&&(t.refuse(),n.modal("hide"))})},m=function(e){var t={setup:function(){},confirm:function(){return e(),!0}};p("permanentChangeDialog",t)},f=function(e,t){var a={setup:function(){},confirm:function(){return e(),!0},cancel:t};p("ocrDialog",a)},y=function(e,t,a){var n={setup:function(){},confirm:function(){return e(),!0},refuse:t,cancel:a};h("ocrDialogForVirtualDocumentSearch",n)},b=function(e){e.footerTemplate="#savePreferencesFooterTemplate",p("saveAsDialog",s,e)},P=function(t,a,n){var o={useCut:a,documentName:{documentName:t},pages:{allPagesDisabled:a,pageRangeValue:e.createComplexPageString(n)}};p("copyToNewDialog",l,o)},T=function(t){var a={pages:{pageRangeValue:e.createComplexPageString(t)},footerTemplate:"#savePreferencesFooterTemplate"};p("exportDialog",u,a)},A=function(e){e.footerTemplate="#savePreferencesFooterTemplate",p("emailDialog",d,e)},I=function(t){var a={pages:{pageRangeValue:e.createComplexPageString(t)},fitToPage:{display:n.showFitToPageOption},footerTemplate:"#savePreferencesFooterTemplate"};p("printDialog",c,a)},S=function(e){var a=o.getActivePaneState(),n=t.getWatermarksArray(a);e=$.extend({},e,{existingWatermarks:n}),p("watermarksDialog",g,e)},w=function(e,t,a,n){var o={setup:function(){},confirm:function(){return e(),!0},refuse:t};h("confirmChangesDialog",o,{documentName:a,overwrite:n})},C=function(e,t){var a=e.find(".vvDialogErrorBanner");return t?(a.show(),void a.text(t)):(a.empty(),void a.hide())};return{init:v,permanentChangeDialog:m,ocrDialog:f,ocrDialogForVirtualDocumentSearch:y,saveAsDialog:b,copyToNewDialog:P,exportDialog:T,emailDialog:A,printDialog:I,watermarksDialog:S,confirmChangesDialog:w,toggleErrorBanner:C}}(),r=function(){var e=function(e,t){var a=t||"Original"===e.find("input[name=format]:checked").val();a&&e.find("input[name=pageRangeType][value=all]").prop("checked",!0),e.find("input[name=pageRangeType][value=complex]").prop("disabled",a),e.find("input[name=pageRangeType][value=current]").prop("disabled",a),e.find("input[name=pageRangeValue]").prop("disabled",a),e.find("input[name=includeDocumentNotes]").prop("disabled",a)},t=function(e){var t,a=o.getActivePaneState();e.find("input[name=includeRedactions]").is(":checked");e.find("input[name=includeAnnotations][burn=true]").is(":checked")||e.find("input[name=includeRedactions]").is(":checked")||e.find("input[name=includeWatermarks][burn=true]").is(":checked")||a.isVirtualDocument()?(t=e.find("input[name=format][value=Original]"),t.prop("disabled",!0),t.closest("label").addClass("vvDialogDisabledText"),t.is(":checked")&&e.find("input[name=format]:first").prop("checked",!0)):(t=e.find("input[name=format][value=Original]"),t.prop("disabled",!1),t.closest("label").removeClass("vvDialogDisabledText"))},a=function(e){e.find("input[name=documentName]").keypress(function(e){13===e.which&&e.preventDefault()}),e.find("input[name=format]").change(function(){if("Original"!==this.value){var t=o.getActivePaneState(),a=t.getDocumentId(),n=t.getDisplayName(),i="PDF"===this.value?"pdf":"tif",r=virtualViewer.getSaveAsDocumentNameGenerator(),s=r(a,n,i);e.find("input[name=documentName]").val(s)}})},i=function(e,t){e.find("input[name=pageRangeValue]").keypress(function(t){e.find("input[name='pageRangeType'][value='complex']").prop("checked",!0),13===t.which&&t.preventDefault()});var a=e.find("input[name=pageRangeValue]");t&&!a.val()&&a.val("1 - "+t.getPageCount())},r=function(t){t.find("input[name=format]").change(function(){e(t)})},s=function(a){a.find("input[name=includeAnnotations]").change(function(){t(a),e(a)})},l=function(a){a.find("input[name=includeRedactions]").change(function(){t(a),e(a);var n=$(this).is(":checked"),o=a.find("input[name=includeRedactionTags]");o.prop("disabled",!n),o.closest("label").toggleClass("vvDialogDisabledText",!n)})},u=function(e){var t=e.find("#fitToPageLabel");t.tooltip({trigger:"hover"})},d=function(e,t){var a=function(a){a=a||{allPages:!0,pageRanges:!1,currentPage:!1,fileTypePDF:!0,fileTypeTIFF:!1,fileTypeOriginal:!1,includeDocumentNotes:n.includeDocumentNotes,burnAnnotations:"undefined"==typeof n.burnAnnotations||n.burnAnnotations,includeRedactions:"undefined"==typeof n.includeRedactions||n.includeRedactions,includeRedactionTags:"undefined"==typeof n.includeRedactionTags||n.includeRedactionTags,includeWatermarks:"undefined"==typeof n.includeWatermarks||n.includeWatermarks};var o=null;o="SaveAs"===t?a.allPages&&!a.includeRedactions:a.allPages&&!a.burnAnnotations&&!a.includeDocumentNotes&&!a.includeRedactions&&!a.includeWatermarks;var i=e.find("input[value=Original]");o&&(i.prop("disabled",!1),i.closest("label").removeClass("vvDialogDisabledText"));var r=!a.fileTypePDF&&!a.fileTypeTIFF&&!a.fileTypeOriginal,s=0===i.length||i.prop("disabled");r||a.fileTypeOriginal&&s?e.find("input[value=PDF]").prop("checked",!0):(e.find("input[value=PDF]").prop("checked",!!a.fileTypePDF),e.find("input[value=TIFF]").prop("checked",!!a.fileTypeTIFF),e.find("input[value=Original]").prop("checked",!!a.fileTypeOriginal));var l=e.find("input[name=pageRangeType]");l.length>0&&(a.allPages||a.pageRanges||a.currentPage?(l[0].checked=!!a.allPages,l[1].checked=!!a.pageRanges,l[2].checked=!!a.currentPage):l[0].checked=!0),e.find("input[name=includeAnnotations]").prop("checked",!!a.burnAnnotations),e.find("input[name=includeRedactions]").prop("checked",!!a.includeRedactions),e.find("input[name=includeRedactionTags]").prop("checked",!!a.includeRedactionTags).prop("disabled",!a.includeRedactions).toggleClass("vvDialogDisabledText",!a.includeRedactions),e.find("input[name=includeDocumentNotes]").prop("checked",!!a.includeDocumentNotes),e.find("input[name=includeWatermarks]").prop("checked",!!a.includeWatermarks),e.find("input[name=fitToPage]").prop("checked",!!a.fitToPage)},o=function(){a(null)},i=localforage.getItem("dialogTemplateOptions");return i.then(a,o),i},c=function(e){localforage.getItem("dialogTemplateOptions").then(function(t){t=t||{};var a=e.find("input[name=pageRangeType]");a.length>0&&(t.allPages=a[0].checked,t.pageRanges=a[1].checked,t.currentPage=a[2].checked);var n=function(t,a){var n=e.find(t).prop("checked");return"undefined"==typeof n?a:n};t.fileTypePDF=n("input[value=PDF]",t.fileTypePDF),t.fileTypeTIFF=n("input[value=TIFF]",t.fileTypeTIFF),t.fileTypeOriginal=n("input[value=Original]",t.fileTypeOriginal),t.burnAnnotations=n("input[name=includeAnnotations]",t.burnAnnotations),t.includeRedactions=n("input[name=includeRedactions]",t.includeRedactions),t.includeRedactionTags=n("input[name=includeRedactionTags]",t.includeRedactionTags),t.includeDocumentNotes=n("input[name=includeDocumentNotes]",t.includeDocumentNotes),t.includeWatermarks=n("input[name=includeWatermarks]",t.includeWatermarks),t.fitToPage=n("input[name=fitToPage]",t.fitToPage),localforage.setItem("dialogTemplateOptions",t)})},g=function(a){a.find("input[name=includeWatermarks]").change(function(){t(a),e(a)})},v=function(e){e.find("input").keypress(function(e){13===e.which&&e.preventDefault()})};return{setupDocumentNameTemplate:a,setupPagesTemplate:i,setupFormatTemplate:r,setupAnnotationsTemplate:s,setupRedactionsTemplate:l,setupDisableRadioEnter:v,setupWatermarksTemplate:g,setupFitToPageTemplate:u,loadDialogOptions:d,saveDialogOptions:c}}(),s=function(){var t={format:{includeOriginalOption:!0}},a=function(e){r.setupDocumentNameTemplate(e),r.setupPagesTemplate(e,o.getActivePaneState()),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.loadDialogOptions(e,"SaveAs"),r.setupWatermarksTemplate(e),e.find("input[name=includeAnnotations]").attr("burn","false"),e.find("input[name=includeWatermarks]").attr("burn","false")},n=function(t){var a=e.getFormData(t.find("form")),n=o.getActivePaneState(),r=n.getDocumentId(),s=$.trim(a.documentName);if(!s)return i.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.noDocumentName","Please enter a new document name.")),$("#vvDocumentName").addClass("has-error"),$("#vvDocumentName").focus(),$("#vvDocumentName").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;if(s.includes("%"))return i.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.invalidDocumentName","Please enter a valid document name.")),$("#vvDocumentName").addClass("has-error"),$("#vvDocumentName").focus(),$("#vvDocumentName").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;var l=a.pageRangeType,u="undefined";"complex"===l?u=a.pageRangeValue:"current"===l&&(u=n.getPageNumber());var d=e.validatePageRangeInput(l,u,n);return"OK"!==d?(i.toggleErrorBanner(t,d),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1):(i.toggleErrorBanner(t),virtualViewer.saveDocument(r,{newDocumentId:s,newDisplayName:s,burnRedactions:a.includeRedactions,includeRedactionTags:!!a.includeRedactionTags,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:a.includeAnnotations,includeDocumentNotes:a.includeDocumentNotes,includeWatermarks:!1,saveAsFormat:a.format,pageRangeType:l,pageRangeValue:u,copyWatermarks:a.includeWatermarks}),!0)};return{defaultOptions:t,setup:a,confirm:n}}(),l=function(){var t={format:{includeOriginalOption:!1}},a=function(e){r.setupDocumentNameTemplate(e),r.setupPagesTemplate(e,o.getActivePaneState()),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e)},n=function(t){var a=e.getFormData(t.find("form")),n=o.getActivePaneState(),r=n.getDocumentId(),s=$.trim(a.documentName);if(!s)return i.toggleErrorBanner(t,e.getLocalizedValue("saveAsDialog.errors.noDocumentName","Please enter a new document name.")),$("#vvDocumentName").addClass("has-error"),$("#vvDocumentName").focus(),$("#vvDocumentName").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;var l=a.pageRangeType,u="undefined",d=null;if("complex"===l){if(u=a.pageRangeValue,d=e.normalizePageRangeInput(l,u,n),a.useCut&&d.length>=n.getPageCount())return i.toggleErrorBanner(t,e.getLocalizedValue("errors.onePageLimit")),!1;i.toggleErrorBanner(t)}else"current"===l&&(u=n.getPageNumber(),d=[u]);var c=e.validatePageRangeInput(l,u,n);return"OK"!==c?(i.toggleErrorBanner(t,c),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1):(i.toggleErrorBanner(t),virtualViewer.saveDocument(r,{newDocumentId:s,newDisplayName:s,burnRedactions:a.includeRedactions,includeRedactionTags:a.includeRedactionTags,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:a.includeAnnotations,includeDocumentNotes:!1,includeWatermarks:!1,saveAsFormat:a.format,pageRangeType:l,pageRangeValue:u,copyWatermarks:a.includeWatermarks,useCut:a.useCut,pageNums:d,createNew:!0}),!0)};return{defaultOptions:t,setup:a,confirm:n}}(),u=function(){var t={format:{includeOriginalOption:!0}},a=function(e){r.setupPagesTemplate(e,o.getActivePaneState()),r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupWatermarksTemplate(e),r.loadDialogOptions(e)},n=function(t){var a=e.getFormData(t.find("form")),n=e.validatePageRangeInput(a.pageRangeType,a.pageRangeValue,o.getActivePaneState());if("OK"!==n)return i.toggleErrorBanner(t,n),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;i.toggleErrorBanner(t);var r=s(a);return r&&l(a.format),r},s=function(e){var t=o.getActivePaneState(),a=e.format,n=t.getDocFormat();"PDF"===a?n="pdf":"TIFF"===a&&(n="tif");var i=e.pageRangeType,r="undefined";return"complex"===i?r=e.pageRangeValue:"current"===i&&(r=t.getPageNumber()),virtualViewer.exportDocument({exportFormat:a,fileExtension:n,includeTextAnnotations:e.includeAnnotations,includeNonTextAnnotations:e.includeAnnotations,burnRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeDocumentNotes:e.includeDocumentNotes,includeWatermarks:e.includeWatermarks,pageRangeType:i,pageRangeValue:r})},l=function(e){virtualViewer.event(o.getActivePaneState(),"VALUE_EVENT_EXPORT",{KEY_EVENT_EXPORT_FORMAT_NAME:e})};return{defaultOptions:t,setup:a,confirm:n}}(),d=function(){var t={format:{includeOriginalOption:!0}},a=function(t){var a=function(t,a){var n=$(t).val();if(!n)return!a||($(t).addClass("has-error"),!1);for(var o=n.split(","),i=0;i<o.length;i++)if(!e.isValidEmailAddress(o[i].trim()))return $(t).addClass("has-error"),!1;return $(t).removeClass("has-error"),!0};return!!a(t.find("input[name=fromAddress]"),!0)&&(!!a(t.find("input[name=toAddresses]"),!0)&&(!!a(t.find("input[name=ccAddresses]"))&&!!a(t.find("input[name=ccAddresses]"))))},n=function(e){e?$("#vvEmailIndicator").modal("show"):$("#vvEmailIndicator").modal("hide")},o=function(e){r.setupFormatTemplate(e),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupWatermarksTemplate(e);var t=function(){a(e)||e.find(".confirm-button").prop("disabled",!0)};r.loadDialogOptions(e).then(t,t),e.find(".vvEmailAddressEntry").on("input",function(t){var n=a(e);e.find(".confirm-button").prop("disabled",!n)})},i=function(t){if(!a(t))return!1;var o=t.find("form"),i=e.getFormData(o);return e.addToAutoComplete(o.find("input[name=toAddresses]")),t.modal("hide"),n(!0),window.setTimeout(function(){var e=s(i),t=l(e);t&&(n(!1),u(e))},200),!0},s=function(e){return{format:e.format,includeTextAnnotations:e.includeAnnotations,includeNonTextAnnotations:e.includeAnnotations,burnRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeDocumentNotes:e.includeDocumentNotes,includeWatermarks:e.includeWatermarks,pageRangeType:"all",fromAddress:e.fromAddress||"",toAddresses:e.toAddresses||"",ccAddresses:e.ccAddresses||"",bccAddresses:e.bccAddresses||"",subject:e.subject||"",emailBody:e.message||""}},l=function(e){return virtualViewer.emailDocument(e)},u=function(e){virtualViewer.event(null,"VALUE_EVENT_EMAIL",{KEY_EVENT_EMAIL_FORMAT_NAME:e.format,KEY_EVENT_EMAIL_FROM_ADDRESS:e.fromAddress,KEY_EVENT_EMAIL_TO_ADDRESSES:e.toAddresses,KEY_EVENT_EMAIL_CC_ADDRESSES:e.ccAddresses,KEY_EVENT_EMAIL_BCC_ADDRESSES:e.bccAddresses,KEY_EVENT_EMAIL_SUBJECT:e.subject,KEY_EVENT_EMAIL_BODY:e.emailBody})};return{defaultOptions:t,setup:o,confirm:i}}(),c=function(){var t={},s=function(e){r.setupPagesTemplate(e,o.getActivePaneState()),r.setupAnnotationsTemplate(e),r.setupRedactionsTemplate(e),r.setupDisableRadioEnter(e),r.setupFitToPageTemplate(e);var t=function(){e.find("input[name=fitToPage]").trigger("change")};r.loadDialogOptions(e).then(t,t),e.find("input[name=includeAnnotations]").prop("checked",n.printBurnAnnotations!==!1),e.find("input[name=fitToPage]").change(function(t){var a=$(t.target).prop("checked");e.find("input[name=includeWatermarks]").prop("disabled",a).closest("label").toggleClass("vvDialogDisabledText",a)})},l=function(t){var a=e.getFormData(t.find("form")),r=e.validatePageRangeInput(a.pageRangeType,a.pageRangeValue,o.getActivePaneState());return"OK"!==r?(i.toggleErrorBanner(t,r),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1):(i.toggleErrorBanner(t),n.printBurnAnnotations=a.includeAnnotations,u(a))},u=function(e){var t=o.getActivePaneState(),n=e.pageRangeType,i="undefined";"complex"===n?i=e.pageRangeValue:"current"===n&&(i=t.getPageNumber());var r={includeAnnotations:e.includeAnnotations,includeRedactions:e.includeRedactions,includeRedactionTags:e.includeRedactionTags,includeWatermarks:e.includeWatermarks,includeDocumentNotes:e.includeDocumentNotes,fitToPage:e.fitToPage,pageRangeType:n,pageRangeValue:i};return a.printDocument(r)};return{defaultOptions:t,setup:s,confirm:l}}(),g=function(){var a,s={horizontalTop:{verticalPosition:t.verticalPositionOptions.TOP,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-top",allowStretchPercent:!0},horizontalBottom:{verticalPosition:t.verticalPositionOptions.BOTTOM,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-bottom",allowStretchPercent:!0},horizontalCenter:{verticalPosition:t.verticalPositionOptions.CENTER,textDirection:t.textDirectionOptions.HORIZONTAL,imageClass:"horizontal-center",allowStretchPercent:!0},diagonalTop:{verticalPosition:t.verticalPositionOptions.TOP,textDirection:t.textDirectionOptions.DIAGONAL,imageClass:"diagonal-top",allowStretchPercent:!1},diagonalBottom:{verticalPosition:t.verticalPositionOptions.BOTTOM,textDirection:t.textDirectionOptions.DIAGONAL,imageClass:"diagonal-bottom",allowStretchPercent:!1}},l=s.horizontalCenter,u=null,d={pages:{includePageRangeOption:!0},position:l},c=function(e,t){e.find("input[name=verticalPosition]").val(t.verticalPosition),e.find("input[name=textDirection]").val(t.textDirection),e.find(".watermark-image").removeClass(u.imageClass).addClass(t.imageClass);var a=e.find("select[name=stretchPercent]");a.parent().toggle(t.allowStretchPercent),t.allowStretchPercent||a.find("option:first").prop("selected",!0),u=t,g(e)},g=function(e){var a=e.find(".watermark-image"),n=a.parent().width(),o=!1,i=a.width(),r=u.textDirection===t.textDirectionOptions.DIAGONAL;if(r){var s=53*(Math.PI/180),l=a.width()/a.height(),d=a.parent().height(),c=Math.sqrt(n*n+d*d),g=c/(2*Math.tan(s)*l+2);n=c-2*g,o=!0}var h=6;n-=2*h;var m=+e.find("select[name=stretchPercent]").val(),f=n*m/i;a.attr("style","");var y=a.css("transform");"none"===y&&(y="");var b="transform: scale("+f+") "+y;o&&(b="transform: "+y+" scale("+f+")"),a.attr("style",b),v(e,e.find(".fillColor").colorpicker("color")),p(e,!0)},v=function(e,t){e.find(".watermark-image").css("color","#"+t)},p=function(e,t){var a=e.find("select[name=fontNames]").val();e.find(".watermark-image").css("fontFamily",'"'+a+'"'),t||g(e)},h=function(t){var a=e.getLocalizedValue("watermarksDialog.editText."+t,t);return"[["+a+"]]"},m=function(e,t){var a=e.prop("selectionStart"),n=e.prop("selectionEnd"),o=e.val();o=o.substring(0,a)+t+o.substring(n),e.val(o),e.prop("selectionStart",a+t.length),e.prop("selectionEnd",a+t.length),e.focus().trigger("input")},f=function(e,t){var a=h(t);m(e,a)},y=function(e){for(var t=e.find(".watermarks-text-area").val(),n=0;n<a.length;n++)t=t.replace(new RegExp(RegExp.escape(h(a[n])),"g"),"@@"+a[n]+"@@");return t},b=function(e,t){var a=e.find(".watermarks-text-area");t=t.replace(/@@([A-Z]*)@@/gi,function(e,t){var a=h(t);return a}),a.val(t).trigger("input")},P=function(n){var i=n.find(".watermark-text-control-panel .btn");a=i.map(function(){return $(this).attr("data-vvwatermark")}),u=l,r.setupPagesTemplate(n,o.getActivePaneState()),n.find(".fillColor").colorpicker({color:"000000",opacity:.5,onChange:function(e,t){v(n,e,t)}}),n.find(".confirm-button").prop("disabled",!0);var d=n.find(".delete-button");d.click(function(){var e=n.find("select[name=selectedWatermark]"),a=+e.val();if(a||0===a){var i=o.getActivePaneState();t.removeWatermark(i,a),virtualViewer.delayedPaintCanvases(),e.find(":selected").remove(),e.find("option").not(":first-child").each(function(e){$(this).val(e)}),e.val("createNew").change()}});var m=n.find("select[name=fontNames");let y=e.fontNames();for(var P=0;P<y.length;P+=1){var T="";"Times New Roman"===y[P]&&(T=" selected"),m.append("<option"+T+">"+y[P]+"</option>")}n.find("select[name=selectedWatermark]").change(function(){var a=$(this),i={},r=null;if("createNew"===a.val())i={text:"",transparency:!0,allPages:!0,stretch:!0,format:{color:"000000",font:"Times New Roman"}},r=l,d.hide();else{var u=o.getActivePaneState(),g=t.getWatermarksArray(u);i=g[+a.val()],r=null,$.each(s,function(e,t){if(t.verticalPosition===i.position.vertical&&t.textDirection===i.position.direction)return r=t,!1}),d.show()}b(n,i.text),n.find("select[name=stretchPercent]").val(i.stretchPercent).trigger("input"),i.stretchPercent||n.find("select[name=stretchPercent]").find("option:first").prop("selected",!0),n.find("input[name=transparency][value="+i.transparency+"]").prop("checked",!0);var p;i.format?(p=i.format.color,n.find("select[name=fontNames]").val(i.format.font).trigger("input")):(p="000000",n.find("select[name=fontNames]").val("Times New Roman").trigger("input")),n.find(".fillColor").data().colorpicker.shrink().opacity(i.transparency?.5:1).color(p),v(n,p),i.allPages?n.find("input[name=pageRangeType][value=allPages]").prop("checked",!0):(n.find("input[name=pageRangeType][value=complex]").prop("checked",!0),n.find("input[name=pageRangeValue]").val(e.createComplexPageString(i.pages))),r&&c(n,r)});var A=n.find(".watermarks-text-area");A.highlightWithinTextarea({highlight:$.map(a,function(e){return h(e)})});var I=function(){var e=A.val().trim().length>0;n.find(".confirm-button").prop("disabled",!e)};if("Explorer"===BrowserDetect.browser)var S=setInterval(function(){jQuery.contains(document.documentElement,n[0])?I():clearInterval(S)},1e3);else A.on("input",I);n.find(".watermark-text-control-panel .btn").click(function(){var e=$(this).attr("data-vvwatermark");A.focus(),f(A,e),A.trigger("change")}),n.find(".watermark-position-button").click(function(){var e=$(this).attr("data-vvmovement"),t=s[e];return c(n,t),$(".watermark-position-button").attr("aria-pressed",null),$(this).attr("aria-pressed",!0),!1}),n.find("input[name=transparency]").change(function(){n.find(".watermark-image").toggleClass("transparent","true"===this.value),n.find(".fillColor").colorpicker("opacity","true"===this.value?.5:1)}),n.find("select[name=stretchPercent]").change(function(){g(n)}),n.find("select[name=fontNames]").change(function(){p(n)}),setTimeout(function(){g(n)},300)},T=function(a){var r=o.getActivePaneState(),s=r.getDocumentModel(),l=e.getFormData(a.find("form")),u=y(a).trim(),d=l.fontNames,c={vertical:+l.verticalPosition,direction:+l.textDirection},g=l.pageRangeType,v=l.pageRangeValue,p=e.validatePageRangeInput(g,v,r);if("OK"!==p)return i.toggleErrorBanner(a,p),$("#vvPageRangeValue").addClass("has-error"),$("#vvPageRangeValue").focus(),$("#vvPageRangeValue").on("input",function(e){$(e.target).removeClass("has-error"),$(e.target).off("focus")}),!1;i.toggleErrorBanner(a);var h=!1,m=null;"all"===g&&(h=!0),"complex"===g?m=e.parseComplexPageString(v,r.getPageCount()):"current"===g&&(m=[r.getPageNumber()]);var f=a.find(".fillColor").colorpicker("color"),b={text:u,image:null,transparency:l.transparency,position:c,allPages:h,stretchPercent:+l.stretchPercent,pages:m,format:{font:d,color:f},adminCreated:n.adminCreated},P=+l.selectedWatermark;return P||0===P?t.getWatermarksArray(r)[P]=b:t.addWatermarkJSON(r,b),s.setWatermarksModifiedSinceInit(!0,r),virtualViewer.delayedPaintCanvases(),!0};return{defaultOptions:d,setup:P,confirm:T}}();return i}),define("vvSearchManager",["vvUtility","vvDefines","vvStateManager","user-config/config","vvSearch","vvThumbs","vvDialogs"],function(e,t,a,n,o,i,r){var s,l=0,u=new o,d=function(){if($("#vvSearchTerm").show(),N(),h($(".vvSearchButton"),!0),$("#vvSearchTermField").prop("placeholder",e.getLocalizedValue("search.basicSearchMode.title","Basic Search")),$("#vvSearchTermFieldLabel").text(e.getLocalizedValue("search.basicSearchMode.title","Basic Search")),X(),n.searchRedactionTags)for(var t=0;t<n.annotationTags.length;t++){var o=$("<option></option>").text(n.annotationTags[t]);$("#vvAnnTagSearchSelect").append(o)}else $("#vvMainSearchButtons > div").removeClass("col-xs-12").addClass("col-xs-11 col-xs-offset-1"),$("#vvTagAllRedactions").remove();n.readOnlyAnnotationMode&&$("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch").remove(),$("#vvDocSearchStart").click(function(e){if("true"!==$(this).attr("aria-disabled")){var t=$("#vvSearchTermField").val(),n=a.getCurrentState();virtualViewer.checkRedactionsEnabled()&&n.isSearchable&&h($("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch"),!1),Q(t)}}),$("#vvAnnSearchStart").click(function(e){if("true"!==$(this).attr("aria-disabled")){var t="";g()||(t=$("#vvSearchTermField").val()),h($("#vvSearchRedactAllMatches, #vvSearchRedactCurrentMatch"),!0),G(t)}}),$("#vvSearchTermField").on("change",function(){if(!$(this).val()){var e=a.getCurrentState();e&&!e.cacheSearchResults&&(M(),m())}}),$("#vvSearchTermField").on("keyup",function(e){if("true"===$(this).attr("aria-disabled"))return void e.preventDefault();var t=$(this).val();10!==e.which&&13!==e.which||(e.preventDefault(),t.length&&Q(t)),t||M(),m()}),$("#vvSearchControls").on("submit",function(e){e.preventDefault()}),$("#vvSearchPrevious").click(function(){"true"!==$(this).attr("aria-disabled")&&w()}),$("#vvSearchNext").click(function(){"true"!==$(this).attr("aria-disabled")&&D()}),$("#vvSearchProgressCancel").click(function(){L()}),$("#vvSearchRedactAllMatches").click(function(){"true"!==$(this).attr("aria-disabled")&&A()}),$("#vvSearchRedactCurrentMatch").click(function(){"true"!==$(this).attr("aria-disabled")&&T()}),$("#vvTagAllRedactions").click(function(){virtualViewer.showTagAllRedactionsDialog()}),c()},c=function(){var a=e.getLocalizedValue("search.basicSearchMode.title","Basic Search");$("#vvSearchPatternOptionNone").text(a).data("pattern-index",-1).on("click",v);for(var n=$("#vvSearchPatternSelect"),o=0;o<t.searchPatterns.length;o++){var i=t.searchPatterns[o],r=$("<a></a>").text(e.getLocalizedValue(i.localizeKey,i.name)).data("pattern-index",o),s=$("<li></li>");r.on("click",v),s.append(r).appendTo(n)}},g=function(){var e=$("#vvSearchTermField"),a="number"==typeof e.data("pattern-index")?e.data("pattern-index"):-1;return a===-1?null:t.searchPatterns[a].pattern},v=function(e){var a=-1;e&&(a=$(e.target).data("pattern-index")),a===-1?u.pattern=null:u.pattern=t.searchPatterns[a].pattern,u.patternIndex=a,p(a),m()},p=function(a){var n=$("#vvSearchTermField");if(n.data("pattern-index",a),a===-1)h(n,!1),n.val("");else{h(n,!0);var o=t.searchPatterns[a];n.val(e.getLocalizedValue(o.localizeKey,o.name))}},h=function(e,t){e&&(t=!!t,e.attr("aria-disabled",t).css("opacity",t?.2:1),t?e.addClass("disabled"):e.removeClass("disabled"))},m=function(){var e=a.getCurrentState();e&&($("#vvSearchTermField").val()||u.pattern)?((virtualViewer.ocrEnabled||e.getIsSearchable())&&h($("#vvDocSearchStart"),!1),h($("#vvAnnSearchStart"),!1)):h($("#vvDocSearchStart, #vvAnnSearchStart"),!0)},f=function(e){if(e=e||a.getCurrentState()){var t=e.getPageNumber()||0,n=u.firstResultPage,o=u.lastResultPage,i=u.getPageResults(o),r=!n&&0!==n,s=!o&&0!==o;$("#vvSearchTermField").val()||h($("#vvDocSearchStart, #vvAnnSearchStart"),!0);var l=r||n>t||n===t&&0===u.searchCursor.match;h($("#vvSearchPrevious"),l);var d;d=i&&i.matches&&i.matches.length?i.matches.length-1:0,l=s||o<t||o===t&&u.searchCursor.match===d,h($("#vvSearchNext"),l),!virtualViewer.checkRedactionsEnabled()||r&&s?h($(".vvSearchRedactButton, #vvTagAllRedactions"),!0):h($(".vvSearchRedactButton"),!1),u.searchAnnotationResults.length&&h($(".vvSearchRedactButton, #vvTagAllRedactions"),!0)}},y=function(){L(),$("#vvSearchTermField").val(""),M()},b=function(e,t){if(e){var a=require("vvThumbs");L(),a.removeThumbs($("#vvSearch")),$("#vvResultsReport").empty(),t&&(t.cachedSearch=u),e.cachedSearch?(u=e.cachedSearch,a.fillSearchThumbs(e,u.getMatchedPages()),a.loadVisibleThumbs($("#vvSearchResults")),
R(),p(u.patternIndex),u.searchTerm&&$("#vvSearchTermField").val(u.searchTerm)):(u=new o,p(-1)),f(e),m()}},P=function(e){var t=virtualViewer.getCurrentAnnObject();virtualViewer.hideAnnPopUp(),$("#vvAnnotationNotesArea").collapse("hide"),"Sticky Note"===t.type&&(t.collapsed=!1),(e.tag||e.comment)&&(virtualViewer.annPopUpHandler(null,t),e.comment&&$("#vvAnnotationNotesArea").collapse("show"))},T=function(){if(a.getCurrentState()&&u){var e=u.getCurrentMatch();e||(D(),e=u.getCurrentMatch());var t=u.searchCursor.page,n=[];e.annotation||(n=virtualViewer.redactSearchMatch(e,t,u.getSearchedPageDimensions(t))),u.matchRedactions=u.matchRedactions.concat(n)}},A=function(){var e=a.getCurrentState();if(e&&e.documentFullyLoaded()){for(var t=0;t<e.getPageCount();t++)I(t);n.searchRedactionTags&&h($("#vvTagAllRedactions"),!1)}},I=function(e){var t,a=u.getPageResults(e).matches,n=[];if(!a||!a.length)return[];for(var o=0;o<a.length;o++){var i=a[o];t=virtualViewer.redactSearchMatch(i,e,u.getSearchedPageDimensions(e)),n=n.concat(t)}return u.matchRedactions=u.matchRedactions.concat(n),n},S=function(){return u.matchRedactions||[]},w=function(){var e=a.getCurrentState();if(e&&!a.isVideoOpen()){var t=e.getPageNumber(),n=t!==u.searchCursor.page,o=u.getPageResults(t);if(u.searchCursor.match--,!o||n||u.searchCursor.match<0){for(n||t--;t>=u.firstResultPage;){var i=u.getPageResults(t);if(i&&i.matches.length){virtualViewer.setPage(t),u.searchCursor.match=i.matches.length-1;break}t--}t<u.firstResultPage&&(virtualViewer.setPage(u.lastResultPage),t=u.lastResultPage)}u.searchCursor.page=t;var r=u.getCurrentMatch();r&&(r.annotation&&(virtualViewer.setCurrentAnnObject(r.annotation),P(r)),virtualViewer.delayedPaintCanvases(),f())}},C=function(){var e=a.getCurrentState();e&&!a.isVideoOpen()&&(0!==u.firstResultPage?D():virtualViewer.setPage(0,e))},D=function(){var e=a.getCurrentState();if(e&&!a.isVideoOpen()){var t=e.getPageNumber(),n=t!==u.searchCursor.page,o=u.getPageResults(t);if(u.searchCursor.match++,!o||n||u.searchCursor.match>=o.matches.length){for(u.searchCursor.match=0,n||t++;t<=u.lastResultPage;){var i=u.getPageResults(t);if(i&&i.matches.length){virtualViewer.setPage(t);break}t++}t>u.lastResultPage&&(virtualViewer.setPage(u.firstResultPage),t=u.firstResultPage)}u.searchCursor.page=t;var r=u.getCurrentMatch();r&&(r.annotation&&(virtualViewer.setCurrentAnnObject(r.annotation),P(r)),virtualViewer.delayedPaintCanvases(),f())}},M=function(){u=new o,i.removeThumbs($("#vvSearch")),$("#vvResultsReport").addClass("sr-only").empty();var e=a.getCurrentState();e&&(e.cachedSearch=null),f(),virtualViewer.delayedPaintCanvases()},x=function(){(u.searchTerm||u.pattern)&&(u.annotationSearch||(u.clearResults(),Q(u.searchTerm,u.firstPageToSearch,u.lastPageToSearch,u.performOCR)))},L=function(){u.searchCancelled=!0,u.inProgress=!1,clearTimeout(l),R()},N=function(){$("#vvSearchProgressContainer").hide(),$("#vvSearchProgress").attr("aria-valuenow",0).css("width","0%")},V=function(){var t=k(),a=$("#vvSearchProgress"),n=parseInt(a.attr("aria-valuenow"),10),o=Math.min(t,n+1),i=o+"%";a.attr("aria-valuenow",o).css("width",i),a.find(".sr-only").text(i+e.getLocalizedValue("search.searchProgressBarPercentUpdate"," Complete"))},k=function(){var e=u.numberOfBatches,t=u.batchIndex,a=(t+1)/e;t+1>=e&&(a=.95);var n=Math.ceil(100*a);return n=Math.min(100,n)},F=function(){window.clearInterval(s);var t=k(),a=t+"%";$("#vvSearchProgress").attr("aria-valuenow",t).css("width",a),$("#vvSearchProgress .sr-only").text(a+e.getLocalizedValue("search.searchProgressBarPercentUpdate"," Complete")),s=window.setInterval(V,150)},R=function(){$("#vvSearchTerm").show(),N(),m(),f(),window.clearInterval(s),s=null,u.noResultsFound()?E():O(u.matchCount)},B=function(){$("#vvSearchTerm").hide(),$("#vvSearchProgressContainer").show();var e=$("#vvSearchProgress").width();$("#vvSearchProgressText").width(e-2),$("#vvSearchProgressCancel").position({my:"right",at:"right",of:"#vvSearchProgressText"}),h($("#startSearchButtons .btn, #vvSearchRedactButtonsContainer .btn"),!0),s=window.setInterval(V,150)},E=function(){$(".vvNoSearchResults").length||($("#vvResultsReport").empty(),$("<div></div>").text(e.getLocalizedValue("search.noResults","This search found no results.")).addClass("vvNoSearchResults").appendTo($("#vvResultsReport")),$("#vvResultsReport").removeClass("sr-only"))},O=function(t){0===t||$(".vvNoSearchResults").length||($("#vvResultsReport").empty(),$("<div></div>").text(t+e.getLocalizedValue("search.resultsCount"," results have been found.")).appendTo($("#vvResultsReport")),$("#vvResultsReport").addClass("sr-only"))},_=function(){return!(!u||u.searchCancelled)&&u.inProgress},U=function(t,n,o,i){t=t||a.getCurrentState(),o.lineWidth=2;var r=u.searchDocumentResults[i];if(r&&r.matches)for(var s=r.matches,l=0;l<s.length;l++)for(var d=s[l],c=z(l,i),g=0;g<d.rectangles.length;g+=1){var v=d.rectangles[g],p=e.getPixelImageRectFromPercents(v,i,t);virtualViewer.highlightImageRect(p,o,c)}},z=function(e,a){var o,i=n.searchColors||{};return o=e===u.searchCursor.match&&a===u.searchCursor.page?i.selectedMatchColor||t.searchSelectedColor:i.matchColor||t.searchDefaultColor},W=function(n){if(!u.searchCancelled){var o=a.getCurrentState();if(o&&!o.tabClosed&&o.getDocumentId()===n.documentId){u.addPresearchedPages(n);var i=u.addDocumentSearchResults(n);f(),u.batchIndex++,F();var r=require("vvThumbs");r.fillSearchThumbs(o,i),r.loadVisibleThumbs($("#vvSearchResults.thumbPanel")),i.length&&i[0]<=o.getPageNumber()&&i[i.length-1]>=o.getPageNumber()&&virtualViewer.delayedPaintCanvases();var s=u.lastBatchPage+1;return u.isFirstSearchResult&&e.isInteger(u.firstResultPage)&&u.firstResultPage>=0&&(C(),u.isFirstSearchResult=!1),s>=u.lastPageToSearch?(R(),void(u.inProgress=!1)):void(l=setTimeout(function(e){j(u.searchTerm,s,u.batchSize)},t.searchTimeout))}}},H=function(e){if(virtualViewer.checkServerException(e))return void R();if(u.performOCR){var t=a.getCurrentState();t.setIsSearchable(!0),setTimeout(function(){virtualViewer.getAllText(t.pageNumber,t)},0)}W(e)},j=function(e,o,i){var r=a.getCurrentState(),s=r.getDocumentModel().model,d=new URI(n.servletPath);d.escapeQuerySpace(!1),d.addQuery("action","searchDocument"),d.addQuery("documentId",r.getDocumentId()),d.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),d.addQuery("performOcr",u.performOCR),d.addQuery("ocrLanguage",u.OCRLanguage),o+i>=u.lastPageToSearch&&(i=u.lastPageToSearch-o);for(var c={},g=o,v=[],p=0;p<i;p++)for(var h=!1;!h&&g<s.pageData.length;){var m=decodeURIComponent(s.pageData[g].documentId),f=s.pageData[g].pageIndex;u.presearchedPages&&u.presearchedPages[m]?u.presearchedPages[m]&&u.presearchedPages[m].indexOf(f)>-1&&(v.push({pageNumber:f,documentId:m,modelIndex:g}),h=!0):(v.push({pageNumber:f,documentId:m,modelIndex:g}),h=!0,c[m]=!0),g++}d.addQuery("searchBatch",JSON.stringify(v)),u.lastBatchPage=g-1,null!==virtualViewer.getOverlayPath()&&d.addQuery("overlayPath",virtualViewer.getOverlayPath()),t.cacheBuster===!0&&d.addQuery("cacheBuster",Math.random()),u.pattern?d.addQuery("searchPattern",u.pattern):d.addQuery("searchText",e),u.caseSensitive&&d.addQuery("caseSensitive","true"),u.exactMatch&&d.addQuery("exactMatch","true"),l&&clearTimeout(l),u.performOCR&&virtualViewer.displayOcrWaitIndicator(!0),d.addQuery("preSearchIfAvailable",JSON.stringify(Object.keys(c)));var y=d.query();d.query(""),$.ajax({url:d.toString(),type:"POST",dataType:"json",data:y}).done(H).fail(function(e){virtualViewer.checkServerException(e,r.getDocumentId(),r.currentPaneIndex),console.log("Search document error")}).always(function(){virtualViewer.displayOcrWaitIndicator(!1)})},Q=function(e,t,n,o,i){var s=a.getCurrentState();if(s&&s.documentFullyLoaded()){var l=function(a){q(e,t,n,s,a,i)},u=!1;if(s.isVirtualDocument()){if(!virtualViewer.ocrEnabled||!o)return void r.ocrDialogForVirtualDocumentSearch(function(){setTimeout(l(!0),0)},function(){setTimeout(l(!1),0)});u=!0}if(s.getIsSearchable())u=!1;else{if(!virtualViewer.ocrEnabled)return;if(!o)return void r.ocrDialog(function(){setTimeout(l(!0),0)});u=!0}l(u)}},q=function(e,a,o,i,r,s){M(i),B(),u.isFirstSearchResult=!0,u.inProgress=!0,u.batchIndex=0,("number"!=typeof a||a<0)&&(a=0),("number"!=typeof o||o>i.getPageCount())&&(o=i.getPageCount());var l=n.searchBatchSize||t.searchBatchSize;u.batchSize=l,u.numberOfBatches=Math.ceil((o-a)/l),u.documentId=i.getDocumentId(),u.searchTerm=e,u.pattern=g(),u.firstPageToSearch=a,u.lastPageToSearch=o,"boolean"==typeof r&&(u.performOCR=r,u.ocrLanguage=s),j(e,a,l)},G=function(e){if(e||g()){var t,n=e.toUpperCase(),o=a.getActivePaneState();if(!o||a.isVideoOpen())return void h($("#vvAnnSearchStart"),!0);M(),u.searchTerm=e;var i=null;!e&&g()&&(u.pattern=g(),i=new RegExp(u.pattern)),u.annotationSearch=!0;for(var r=o.getPageCount(),s=[],l=null,d=0;d<r;d++){t=o.pageStates[d];var c=!1;for(var v in t.annotationLayers)if(v){var p=t.annotationLayers[v];if(p&&p.anns)for(var m=0;m<p.anns.length;m++){var y=!1,b={annotation:null,text:null,tag:null,comment:null},T=p.anns[m];if(!T.annDelete){if(p.visibility||(p.visibility=!0),"Sticky Note"===T.type||"Rubber Stamp"===T.type){var A=T.getTextString().toUpperCase();(i&&i.test(A)||n&&A.indexOf(n)>-1)&&(b.text=A,y=!0)}for(var I=0;I<T.noteArray.length;I++){var S=T.noteArray[I],w=S.text.toUpperCase();(i&&i.test(w)||n&&w.indexOf(n)>-1)&&(b.comment=w,y=!0)}for(var C=0;C<T.annotationTags.length;C++){var D=T.annotationTags[C].toUpperCase();(i&&i.test(D)||n&&D.indexOf(n)>-1)&&(b.tag=D,y=!0)}y&&(b.annotation=T,c=!0,u.addAnnotationSearchResultToPage(b,d))}}}c&&(s.push(d),null===l&&d>=o.getPageNumber()&&(l=d))}if(R(),s.length){var x=require("vvThumbs");x.fillSearchThumbs(o,s),x.highlightActiveThumbnail(),f(),null!==l?u.searchCursor.page=l:u.searchCursor.page=u.firstResultPage,u.searchCursor.match=0,virtualViewer.setPage(u.searchCursor.page);var L=u.getPageResults(u.searchCursor.page);virtualViewer.setCurrentAnnObject(L.matches[0].annotation),P(L.matches[0]),virtualViewer.delayedPaintCanvases(),x.loadVisibleThumbs($("#vvSearchResults"))}}},Y=function(){return u?u.getResults():[]},X=function(){$("#vvSearchTermField").attr("aria-label",e.getLocalizedValue("search.searchField.title","Search Term Field")),$("#vvDocSearchStart").attr("aria-label",e.getLocalizedValue("search.docSearch.title","Search Document")),$("#vvAnnSearchStart").attr("aria-label",e.getLocalizedValue("search.annSearch.title","Search Annotations")),$("#vvSearchDropDown").attr("aria-label",e.getLocalizedValue("search.searchDropDown.title","Search Pattern Dropdown Menu")),$("#vvSearchPatternSelect").attr("aria-label",e.getLocalizedValue("search.searchDropDown.options","Search Pattern Options")),$("#vvSearchPrevious").attr("aria-label",e.getLocalizedValue("search.previousMatch.title","Previous Match")),$("#vvSearchRedactAllMatches").attr("aria-label",e.getLocalizedValue("search.redactAllMatches.title","Redact All Matches")),$("#vvSearchRedactCurrentMatch").attr("aria-label",e.getLocalizedValue("search.redactCurrentMatch.title","Redact Current Match")),$("#vvTagAllRedactions").attr("aria-label",e.getLocalizedValue("search.tagAllRedactions.title","Tag All Redactions")),$("#vvSearchNext").attr("aria-label",e.getLocalizedValue("search.nextMatch.title","Next Match")),$("#vvSearchResults").attr("aria-label",e.getLocalizedValue("search.searchResults.title","Search Results")),$("#vvSearchPatternOptionNone").attr("aria-label",e.getLocalizedValue("search.searchPatternNone.title","There are no search patterns."))};return{prepareSearch:d,updateSearchButtons:f,handleSearchOnTabSwitch:b,handleSearchOnPageManipulation:y,searchAnnotationText:G,searchDocumentText:Q,clearSearchResults:M,paintDocumentSearchResults:U,rerunCurrentSearch:x,getSearchedRedactions:S,searchInProgress:_,firstSearchResult:C,nextSearchResult:D,previousSearchResult:w,cancelCurrentSearch:L,getCurrentSearchResults:Y,addAccessibleSearchLabels:X}}),define("vvHotkeys",["user-config/config","vvDefines","vvUtility"],function(e,t,a){function n(){this.assignedShortcutHashtable={}}var o;n.prototype.initializeHotkeys=function(){var t=e.hotkeys,a=e.customHotKeys;if(t||a){var n=function(e){for(var t=0;t<e.length;t++)!function(t){i(e[t].key,function(a){return a.preventDefault(),e[t].method(),!1})}(t)};n(a),n(t)}};var i=function(e,t){if(e)for(var a=e.split(","),n=0;n<a.length;n++){var i=a[n];if(h(i)||(i=i.toLowerCase()),o.assignedShortcutHashtable[i]===i)return void console.error(i+" has been detected as a duplicate keyboard shortcut");o.assignedShortcutHashtable[i]=i;var l=g(i),u=d(i);s(i)?jQuery(document).bind(l,i,t):r(l,u,t,i)}},r=function(e,t,a,n){$(document).bind(e,function(e){h(n)?h(n)&&!l(e)&&!$("input, textarea").is(":focus")&&u(t,e.keyCode)&&a(e):l(e)&&u(t,e.keyCode)&&a(e)})},s=function(e){var a=c(e);return!!t.specialKeys[a]},l=function(e){return e.shiftKey&&e.ctrlKey},u=function(e,t){var a={187:61,189:173};return e===t||e===a[t]},d=function(e){var t=c(e);if("="===t)return 61;if("pluskeypad"===t)return 107;if("minuskeypad"===t)return 109;if("-"===t)return 173;var a=t.charCodeAt(0)-32;return a},c=function(e){var t=e.split("+"),a=t[t.length-1];return a},g=function(e){return"keydown"};n.prototype.initKeyboardHintsContent=function(){if(!e.hotkeys)return"";$.views.helpers({prettyPrintShortcut:p});var t=$.templates("#shortcutHintsRowTemplate"),a=e.hotkeys.slice(0,e.hotkeys.length/2);$(t.render(a)).appendTo("#vvShortcutsLeftHalf");var n=e.hotkeys.slice(e.hotkeys.length/2);$(t.render(n)).appendTo("#vvShortcutsRightHalf")};var v=function(e){var a=e,n=t.specialKeys[e];return n&&(a=n),a="<span class='keyboardkey'>"+a+"</span>"},p=function(e){if(!e)return"N/A";e=e.replace("++","+plus");for(var t=e.split(","),a=t[0],n="",o=a.split("+"),i=0;i<o.length;i++){var r=o[i];n+=v(r),i!==o.length-1&&(n+=" ")}return n=n.replace("plus","+")},h=function(e){return 1==e.length};return function(){return o=o||new n}()}),define("vvDocTabs",["vvUtility","user-config/config","vvStateManager"],function(e,t,a){"use strict";function n(){this.tabs=[],this.activeTab=0,this.shortTabNames=!1,i=this}var o,i;n.prototype.findTab=function(e){var t,a=typeof e;return"number"===a&&(t=e),"string"===a&&(t=this.tabs.indexOf(e)),t<0||t>=this.tabs.length?-1:t},n.prototype.prepareTabs=function(){$("#collapsed").on("hide.bs.dropdown",function(){$(this).children('[data-tooltip="tooltip"]').tooltip("hide")}),this.autoTabCollapse()},n.prototype.isOnlyTab=function(e){return 1===this.tabs.length&&0===e},n.prototype.removeTab=function(e){var t=$("#vvImageTabs .docTabs").eq(e);t.remove(),this.tabs.splice(e,1);for(var n=e;n<this.tabs.length;n++){var o=a.getStateForDocumentId(this.tabs[n],0);o.setTabNumber(n)}this.activeTab>=e&&(this.activeTab-=1,this.activeTab<0&&(this.activeTab=0)),this.autoTabCollapse()},n.prototype.getActiveTab=function(){return this.activeTab},n.prototype.getActiveTabId=function(){return this.tabs[this.activeTab]},n.prototype.getIdFromTab=function(e){return this.tabs[e]},n.prototype.clearEmailAttachmentsDropdown=function(e,t){t&&t.length||(t=$(".singleDocTab").eq(e)),t.find(".email-attachment-btn, .email-attachment-menu").remove(),t.find(".vvTabTextSpan").removeClass("hasAttachment")},n.prototype.addEmailAttachmentsDropdown=function(t,a,n){let o=$(".singleDocTab").eq(t);this.clearEmailAttachmentsDropdown(t,o);let i=$("<button class='btn btn-default dropdown-toggle email-attachment-btn' data-tooltip='tooltip' title='"+e.getLocalizedValue("emailAttachments.openAttachmentsDropdown","View Email Attachments")+"' data-toggle='dropdown'> <span class='vvEmailAttachmentIcon icon'></span></button>"),s=$("<ul class='dropdown-menu dropdown-menu-left email-attachment-menu'></ul>");i.on("click",function(e){let t=$(this).parentsUntil("ul").parent();return"collapsed"===t.attr("id")?void r($(this).parent().find(".attachment-item").clone(!0)):void s.toggle("dropdown")}),o.on("show.bs.dropdown",function(){o.tooltip("hide"),o.attr("data-tooltip","")}),o.on("hide.bs.dropdown",function(){o.attr("data-tooltip","tooltip")});let l=this.getIdFromTab(t);for(let u=0;u<a.length;u++){let t=a[u].attachmentName||"";if(a[u].filenameInvalid){let n="",o=t.lastIndexOf(".");o>-1&&(n=t.substring(o)),t=e.getLocalizedValue("emailAttachments.attachmentTemporaryName","Attachment ")+a[u].attachmentIndex+n}let o=$("<li data-tooltip='tooltip' data-placement='right' title='"+e.getLocalizedValue("emailAttachments.openOrDownloadDocumentId","Open or download attachment ")+a[u].attachmentName+"' class='attachment-item'></li>");$("<a></a>").text(t).data({attachmentIndex:u,documentId:l}).on("click",n).appendTo(o),s.append(o)}o.find(".vvTabTextSpan").addClass("hasAttachment").after(i),o.append(s)};var r=function(e){$("#vvViewEmailAttachmentsDialog").modal("show");var t=$("#vvViewEmailAttachmentsDialog .modal-body ul");t.children().detach(),e.on("click",function(){$("#vvViewEmailAttachmentsDialog").modal("hide")}),t.append(e),e.show()};n.prototype.tabExists=function(e){for(var t=0;t<this.tabs.length;t++)if(i.tabs[t]===e)return!0;return!1},n.prototype.canAddTab=function(){var a=t.maxNumberOfTabs||10;if(this.tabs.length>=a){var n=e.getLocalizedValue("errors.tabTooManyOpen","Maximum number of open tabs reached."),o={client:!0,disable:virtualViewer.disableErrorModals.tabs};return virtualViewer.displayExceptionMessage(n,o),!1}return!0},n.prototype.tabHtml=function(t){var a="<li class='docTabs nav' data-toggle='tab' ><a data-tooltip='tooltip' data-placement='bottom' data-title='";return a+=t,a+="' href='#vvOuterDiv' class='singleDocTab'><span class='vvTabTextSpan'></span><button class='close vvTabCloseButton' title='"+e.getLocalizedValue("closeSplitButton.buttonText","Close")+"' data-tooltip='tooltip' type='button' ><span aria-hidden='true'>&times;</span></button></a></li>"},n.prototype.addTab=function(e,n){var o=e.getDocumentId(),r=this.tabExists(o),u=e.getClosedTab(),d=n||r===!1||u===!0;if(!d||t.disableImageTabs)return e.getTabNumber();var c=this.tabs.length;this.tabs[c]=o;var g=e.getDisplayName()||o,v=this.tabHtml(g),p=$(v);0===c?p.insertBefore("#collapseTab"):p.insertAfter($("li.docTabs").last()),p.data("documentId",o);var h=p.find(".vvTabTextSpan"),m=p.find(".singleDocTab");h.text(g),p.on("drop",s),p.on("dragover",l),p.on("dragstart",function(e){e.preventDefault()}),m.click(function(e){var t=$(this.parentElement).data("documentId");if(t){var n=a.getStateForDocumentId(t,0),o=n.getTabNumber();if(!i.tabs[o])return;i.activeTab!==o&&virtualViewer.switchToTab(n)}}),this.autoTabCollapse(),this.setTabCloseEvent(p),e&&(e.setTabNumber(c),e.setClosedTab(!1))},n.prototype.selectTab=function(t){var a=t.getTabNumber();if(a<0||a>=this.tabs.length){var n=e.getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."),o={client:!0,disable:virtualViewer.disableErrorModals.tabs};return virtualViewer.displayExceptionMessage(n,o),!1}var i=$("#vvImageTabs .docTabs");return i.removeClass("active"),i.eq(a).tab("show"),this.activeTab=a,!0};var s=function(e){var t=$(e.target);"LI"===e.target.tagName&&(t=t.find(".singleDocTab"));var a=t.text();"*"===a[0]&&(a=a.substring(1,a.length)),""===a[a.length-1]&&(a=a.substring(0,a.length-1));for(var n=0;n<virtualViewer.newRecentlyViewedList.length;n++)if(virtualViewer.newRecentlyViewedList[n].displayName.startsWith(a)){a=virtualViewer.newRecentlyViewedList[n].documentId;break}var o=virtualViewer.getStateForDocumentId(a);if(o&&(!virtualViewer.checkPageManipulationsEnabled(!1,o)||!virtualViewer.checkPageManipulationsEnabled(!1)||o.isMedia()))return void virtualViewer.cleanupDrag();var i=JSON.parse(e.originalEvent.dataTransfer.getData("text"));virtualViewer.fixClipState(i),o&&i&&(virtualViewer.switchToTab(o),virtualViewer.pasteClip(i,o,0)),e.preventDefault()},l=function(e){e.preventDefault();for(var t=$("#vvImageTabs").children(),a=0;a<t.length;a++)$(t[a].children[0]).removeClass("dragOverTab");$(e.target).addClass("dragOverTab")};return n.prototype.updateTabName=function(e,t){if(e||(e=a.getCurrentState()),e&&!(e.paneIndex>0)&&e.getDocumentModel()){var n=e.getTabNumber(),o=e.getDisplayName()||e.getDocumentId(),i=e.getDocumentModel(),r=$(".docTabs").eq(n),s=o,l=r.find(".vvTabTextSpan");i.getModifiedSinceInit()&&(o="*"+o),this.shortTabNames&&o.length>16?(o=o.substring(0,14),l.addClass("shortenTab shortenTabSixteen")):o.length>24?(o=o.substring(0,24),l.addClass("shortenTab"),l.removeClass("shortenTabSixteen")):l.removeClass("shortenTab shortenTabSixteen"),l.text()!==o&&(l.text(o),r.find("a.singleDocTab").attr("title",s),t||this.autoTabCollapse())}},n.prototype.updateAllTabNames=function(e){for(var t=0;t<this.tabs.length;t++){var n=a.getStateForDocumentId(this.tabs[t],0);n&&this.updateTabName(n,!0)}this.autoTabCollapse(e)},n.prototype.forEachTab=function(e){for(var t=0;t<this.tabs.length;t++)e(this.tabs[t])},n.prototype.updateDocumentId=function(e,t){var a=this.findTab(e);a>0&&(this.tabs[a]=t)},n.prototype.autoTabCollapse=function(e){var t=$("#vvImageTabs"),a=t.innerHeight(),n=60;if(a>=n&&!i.shortTabNames)return i.shortTabNames=!0,void i.updateAllTabNames(!0);if(a<n&&i.shortTabNames&&!e){var o=200*i.tabs.length;if($("#vvImageTabs").width()>o)return i.shortTabNames=!1,void i.updateAllTabNames(!0)}var r=$("#collapseTab"),s=$("#collapsed");if(a>=n){for(;a>n;){var l=t.children("li.docTabs"),u=l.length;$(l[u-1]).prependTo(s),a=t.innerHeight()}$(".email-attachment-menu").hide().attr("aria-expanded","false")}else for(var d=$("#collapsed").children("li"),c=0;c<d.length&&a<n;c+=1)$(d[c]).insertBefore(r),a=t.innerHeight();s.children("li").length>0?r.show():r.hide().tooltip("hide"),a=t.innerHeight(),a>n&&this.autoTabCollapse()},n.prototype.setTabCloseEvent=function(e){e.find(".vvTabCloseButton").unbind().click(function(e){e.preventDefault();var n=this.parentElement.parentElement,o=$(n).data("documentId"),i=a.getStateForDocumentId(o,0);if(i)if(t.unsavedChangesNotification){var r=i.getDocumentModel();r&&r.getModifiedSinceInit()?virtualViewer.confirmCloseDialog(i):virtualViewer.closeDocument(o,0)}else virtualViewer.closeDocument(o,0)})},function(){return o=o||new n}()}),define("vvAnnotationDefaults",["user-config/config","vvDefines"],function(e,t){"use strict";var a=function(e,t){return"boolean"==typeof e?e:t},n=function(e,t){return"number"==typeof e?e:t},o=e.annotationDefaults||{},i=t.annotationTypes,r=t.unsupportedAnnotationTypes,s={};return s[i.SANN_POSTIT]={fillColor:o.stickyFillColor||"FCEFA1",fillOpacity:1,fontFace:o.fontFace||"Arial",fontSize:n(o.fontSize,14),fontBold:a(o.fontBold,!1),fontItalic:a(o.fontItalic,!1),fontStrike:a(o.fontStrike,!1),fontUnderline:a(o.fontUnderline,!1),fontColor:o.fontColor||"000000",textString:o.textString||"Text"},s[i.SANN_EDIT]={fillColor:o.textBackgroundColor||"FFFFFF",fillOpacity:null===o.textBackgroundColor?0:1,fontFace:o.fontFace||"Arial",fontSize:n(o.fontSize,14),fontBold:a(o.fontBold,!1),fontItalic:a(o.fontItalic,!1),fontStrike:a(o.fontStrike,!1),fontUnderline:a(o.fontUnderline,!1),fontColor:o.fontColor||"000000",textString:o.textString||"Text"},s[r.SANN_BUBBLE]={fillColor:"FFFFFF",fillOpacity:1,fontFace:o.fontFace||"Arial",fontSize:n(o.fontSize,14),fontBold:a(o.fontBold,!1),fontItalic:a(o.fontItalic,!1),fontStrike:a(o.fontStrike,!1),fontUnderline:a(o.fontUnderline,!1),fontColor:o.fontColor||"000000",textString:o.textString||"Text"},s[r.SANN_CLOUD_EDIT]={fillColor:"FFFFFF",fillOpacity:1,fontFace:o.fontFace||"Arial",fontSize:n(o.fontSize,14),fontBold:a(o.fontBold,!1),fontItalic:a(o.fontItalic,!1),fontStrike:a(o.fontStrike,!1),fontUnderline:a(o.fontUnderline,!1),fontColor:o.fontColor||"000000",textString:o.textString||"Text"},s[i.SANN_HIGHLIGHT_RECT]={fillColor:o.highlightFillColor||"FCEFA1",fillOpacity:n(o.highlightOpacity,.4)},s[i.SANN_REDACTION_RECT]={fillColor:o.redactionFillColor||"000000",fillOpacity:n(o.redactionOpacity,.5)},s[i.SANN_LINE]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[i.SANN_ARROW]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[i.SANN_FREEHAND]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[i.SANN_FILLED_RECT]={fillColor:o.fillColor||"FE0000",fillOpacity:n(o.fillOpacity,1)},s[i.SANN_FILLED_ELLIPSE]={fillColor:o.fillColor||"FE0000",fillOpacity:n(o.fillOpacity,1)},s[i.SANN_FILLED_POLYGON]={fillColor:o.fillColor||"FE0000",fillOpacity:n(o.fillOpacity,1)},s[i.SANN_RECTANGLE]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[i.SANN_ELLIPSE]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[i.SANN_POLYGON]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[r.SANN_CIRCLE]={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3)},s[r.SANN_CUSTOM_STAMP]=s[i.SANN_EDIT],s[i.SANN_BITMAP]={},s[i.SANN_TRANSPARENT_BITMAP]={},s.default={lineColor:o.lineColor||"FE0000",lineWidth:n(o.lineWidth,3),fillColor:o.fillColor||"FE0000",fillOpacity:n(o.fillOpacity,1),fontFace:o.fontFace||"Arial",fontSize:n(o.fontSize,14),fontBold:a(o.fontBold,!1),fontItalic:a(o.fontItalic,!1),fontStrike:a(o.fontStrike,!1),fontUnderline:a(o.fontUnderline,!1),fontColor:o.fontColor||"000000",textString:o.textString||"Text"},s}),define("vvAnnotationPreferences",["vvUtility","vvAnnotationDefaults","user-config/config","vvDefines"],function(e,t,a,n){"use strict";function o(){}function i(e){var t=n.annotationTypes;switch(e){case t.SANN_FILLED_RECT:case t.SANN_FILLED_ELLIPSE:case t.SANN_FILLED_POLYGON:e=e.slice(6,e.length);break;case t.SANN_HIGHLIGHT_RECT:e=t.SANN_RECTANGLE;break;case t.SANN_FREEHAND:e=t.SANN_LINE}return e}var r=5,s=e.deepObjCopy(t);o.prototype.load=function(){var e=this;return localforage.getItem("annotationPropertyArray").then(function(t){if(t&&t.version===r)for(var a in n.annotationTypes){var o=n.annotationTypes[a];o!==n.annotationTypes.SANN_REDACTION_RECT&&e.updateAnnotationPreference(o,t[o])}})},o.prototype.save=function(){try{s.version=r,localforage.setItem("annotationPropertyArray",s)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={annotationProperties:s};return e.call("saveAnnotationPreferences",t),!0},o.prototype.reset=function(){s=e.deepObjCopy(t)},o.prototype.updateAnnotationPreference=function(e,t){if(e&&t){var a=s[e];a||(a=$.extend({},s.default),s[e]=a),l(a,t)}};var l=function(e,t){for(var a=Object.keys(e),n=0;n<a.length;n++){var o=t[a[n]];"undefined"!=typeof o&&(e[a[n]]=o)}};o.prototype.getInProgressAnnotationPreference=function(e){var t=this.getAnnotationPreference(e);return(e===n.annotationTypes.SANN_EDIT||e===n.annotationTypes.SANN_BITMAP&&!a.enableSingleClickImageRubberStamp)&&(t={type:n.annotationTypes.SANN_RECTANGLE,lineColor:"000000",lineWidth:1}),t},o.prototype.getAnnotationPreference=function(e){var t=s[e];t||(t=s.default);var a=$.extend({},t);return a.refinedType=e,a.type=i(e),a},o.prototype.getAllAnnotationPreferences=function(){var e={};for(var t in n.annotationTypes){var a=n.annotationTypes[t],o=this.getAnnotationPreference(a);e[a]=o}return e},o.prototype.setAllAnnotatonPreferences=function(e){for(var t in e)this.updateAnnotationPreference(t,e[t])};var u;return function(){return u=u||new o}()}),define("vvUserPreferences",["vvUtility","user-config/config","user-config/toolbar-config","vvDefines","vvStateManager","vvAnnotationPreferences","vvColorpicker"],function(e,t,a,n,o,i){"use strict";function r(){this.userPrefType={ANNOTATION:0,OPTION:1,STAMP:2,GENERAL:3,NOTE:4},this.toolbarOption={userPrefType:1,annotation:null,name:null,on:!0},this.noteTemplate={userPrefType:4,templateName:null,templateString:null},this.defaultUsername=e.getLocalizedValue("userPreferencesDialog.userNameInput","Undefined User"),this.username="",this.imageControlToolbar=[],this.annotationToolbar=[],this.fileUploadVisible=!1,this.customStampArray=[],this.noteTemplateArray=[],this.zoomPreferences={mode:-1,zoomLevelIndex:-1,zoomLevel:-1},this.defaultTab=-1,this.errorDialogTimeoutId=null,this.errorTimeoutTime=5,this.panToolPreference=-1,this.versions={zoomPreferences:4,imageToolbarPreferences:3,annotationToolbarPreferences:3,customTextStamps:3,noteTemplates:3},this.exportVersion=1,this.errorState=!1,this.dynamicUPOptionPrefix="vvUPOption",this.defaultZoomPercentIndex=0,this.videoPreferences={autoplay:null,mute:null,controls:null,stretch:null,captions:!1},this.audioPreferences={controls:!0,background:null,captions:!1},this.protoExportBlob={username:"",defaultTab:-1,panToolPreference:{},audioPreferences:{},videoPreferences:{},zoomPreferences:{},imageControlToolbar:[],annotationToolbar:[],annotationPreferences:{},noteTemplateArray:[],customStampArray:[],exportVersion:-1},this.dialogHasBeenOpened=!1,this.saveButtonHit=!1}var s;r.prototype.init=function(){this.readInCurrentToolbarButtons(),this.loadUserPreferences()},r.prototype.cloneTextStamp=function(e){var t={userPrefType:this.userPrefType.STAMP,displayName:e.displayName,textString:e.textString,fillColor:e.fillColor,fillOpacity:e.fillOpacity,fontColor:e.fontColor,fontFace:e.fontFace,fontSize:e.fontSize,fontBold:e.fontBold,fontItalic:e.fontItalic};return t},r.prototype.createDefaultTextStamp=function(e){var t=i.getAnnotationPreference(n.annotationTypes.SANN_EDIT),a={userPrefType:this.userPrefType.STAMP,displayName:"Custom Stamp",textString:"Custom Stamp Text",fontColor:t.fontColor,fillColor:t.fillColor,fillOpacity:t.fillOpacity,fontFace:t.fontFace,fontSize:t.fontSize,fontBold:t.fontBold,fontItalic:t.fontItalic,fontUnderline:t.fontUnderline,fontStrike:t.fontStrike};return e&&(a.displayName=e,a.textString=e+" Text"),a},r.prototype.cloneNoteTemplate=function(e){var t={userPrefType:this.userPrefType.NOTE,templateName:e.templateName,templateString:e.templateString};return t},r.prototype.createDefaultNoteTemplate=function(e){var t={userPrefType:this.userPrefType.NOTE,templateName:"Template",templateString:"Template Text"};return e&&(t.templateName=e),t},r.prototype.cloneToolbarOption=function(e){var t={userPrefType:this.userPrefType.OPTION,annotation:e.annotation,id:e.id,name:e.name,on:e.on};return t},r.prototype.readInCurrentToolbarButtons=function(){this.imageControlToolbar=[],this.annotationToolbar=[],this.toolbarOption.name="Image Controls",this.toolbarOption.on=!0,this.toolbarOption.annotation=!1,this.toolbarOption.id="",this.imageControlToolbar.push(this.cloneToolbarOption(this.toolbarOption));var t=a(virtualViewer).imageToolbarButtons;for(var n in t)"vvFileUpload"===n&&virtualViewer.disableUploadDocument||t[n]&&(t[n].localizeKey?this.toolbarOption.name=e.getLocalizedValueObject(t[n].localizeKey,{title:"Button with ID "+n}).title:this.toolbarOption.name=t[n].name,this.toolbarOption.iconImage=t[n].iconImage,this.toolbarOption.id=n,this.toolbarOption.on=!0,this.imageControlToolbar.push(this.cloneToolbarOption(this.toolbarOption)));this.toolbarOption.name="Annotation Toolbar",this.toolbarOption.on=!0,this.toolbarOption.annotation=!0,this.toolbarOption.id="",this.annotationToolbar.push(this.cloneToolbarOption(this.toolbarOption));var o=a(virtualViewer).annotationToolbarButtons;for(var i in o)o[i]&&(o[i].localizeKey?this.toolbarOption.name=e.getLocalizedValueObject(o[i].localizeKey,{title:"Button with ID "+i}).title:this.toolbarOption.name=o[i].name,this.toolbarOption.iconImage=o[i].iconImage,this.toolbarOption.id=i,o[i].annType&&(this.toolbarOption.annotation=!0),this.toolbarOption.on=!0,this.annotationToolbar.push(this.cloneToolbarOption(this.toolbarOption)))},r.prototype.initDialog=function(){return t.disableUserPreferences?void $("#vvUserPreferencesDialog").remove():(this.prepareToolbarTab(),this.prepareAnnotationTab(),this.prepareStampsTab(),this.prepareNotesTab(),this.prepareGeneralTab(),this.prepareMediaTab(),$("#vvUserPreferencesDialog form").submit(function(e){return e.preventDefault(),!1}),$("#vvUserPreferencesDialogResetButton").click(function(){s.reset()}),$("#vvUserPreferencesDialogSaveButton").click(function(){s.saveButtonHit=!0,s.save(),$("#vvUserPreferencesDialog").modal("hide")}),void $("#userPreferencesClose").attr("title",e.getLocalizedValue("commonDialog.closeButton","Close")))},r.prototype.updateDialog=function(){this.dialogHasBeenOpened||(this.initDialog(),
this.dialogHasBeenOpened=!0),this.updateToolbarConfigurations(),this.updateDialogZoomPreferences(),this.updateDialogDefaultTab(),this.updateMediaTab(),this.createCustomStampsTable(),this.createNoteTemplateTable(),this.setAnnotationProperties(),this.setUsername(this.username),this.updateDialogPanToolPrefs()},r.prototype.reset=function(){localforage.clear(),this.loadDefaults(),t.disableUserPreferences||this.updateDialog()},r.prototype.turnOnErrorState=function(t){this.errorState=!0,t=t||e.getLocalizedValue("errors.failureLoadingUserPreferences","Problem loading User Preferences. Setting User Preferences back to default values."),$("#vvUserPreferencesErrorBanner").html(t),$("#vvUserPreferencesErrorBanner").show(),$("#vvUserPreferencesDialogResetButton").prop("disabled",!0),$("#vvUserPreferencesDialogSaveButton").prop("disabled",!0)},r.prototype.turnOffErrorState=function(){this.errorState=!1,$("#vvUserPreferencesErrorBanner").hide(),$("#vvUserPreferencesDialogResetButton").prop("disabled",!1)},r.prototype.save=function(){if(!t.disableUserPreferences){var e=this.saveZoomPreferences();if(e=e&&this.saveUsername(),e=e&&this.saveTabPreference(),e=e&&this.savePanToolPreference(),e=e&&this.saveAnnotationPreferences(),e=e&&this.saveToolbarPreferences(),e=e&&this.saveCustomStamps(),e=e&&this.saveNoteTemplates(),e=e&&this.saveMediaPreferences()){this.applyUserPreferences();var a={userPreferences:this.exportUserPreferences()};virtualViewer.getCallbackManager().call("saveUserPreferences",a)}}},r.prototype.loadUserPreferences=function(){if(t.disableUserPreferences)return void this.loadDefaults();try{if(!localforage)return this.turnOnErrorState(),void this.loadDefaults()}catch(e){return this.turnOnErrorState(),void this.loadDefaults()}this.turnOffErrorState(),this.loadToolbarPreferences(),i.load().then(function(){},function(){this.turnOnErrorState()}),this.loadStampPreferences(),this.loadTemplatePreferences(),this.loadZoomPreferences(),this.loadTabPreferences(),this.loadUsername(),this.loadPanToolPreference(),this.loadVideoPreferences(),this.loadAudioPreferences()},r.prototype.loadTemplatePreferences=function(){var e=function(){s.turnOnErrorState(),l(null)},t=localforage.getItem("noteTemplateArray");t.then(l,e)};var l=function(e){if(e&&e.version===s.versions.noteTemplates)s.noteTemplateArray=e;else{s.noteTemplateArray=[];for(var a=0;a<t.noteTemplates.length;a++){var n=t.noteTemplates[a],o=s.cloneNoteTemplate(s.noteTemplate),i=s.createDefaultNoteTemplate();for(var r in o)r&&n.hasOwnProperty(r)&&(o[r]=n[r],"templateName"===r&&(o[r]=n.templateName),o[r]&&(i[r]=o[r]));s.noteTemplateArray.push(i)}}virtualViewer.createNoteTemplateContextMenuList()};r.prototype.loadStampPreferences=function(){var e=function(){s.turnOnErrorState(),u(null)},t=localforage.getItem("customStampArray");t.then(u,e)};var u=function(e){if(e&&e.version===s.versions.customTextStamps)s.customStampArray=e.map(function(e){return d(e)});else{s.customStampArray=[];for(var a=t.textRubberStamps||[],n=0;n<a.length;n++){var o=a[n],i=s.createDefaultTextStamp();for(var r in i)r&&"undefined"!=typeof o[r]&&(i[r]=o[r],"textString"===r&&(i.displayName=o[r]));i=d(i),s.customStampArray.push(i)}}virtualViewer.createTextAnnContextMenuList()},d=function(e){if(!e.fillColor){var t=i.getAnnotationPreference(n.annotationTypes.SANN_EDIT);e.fillColor=t.fillColor,e.fillOpacity=0}return e};r.prototype.loadUsername=function(){var e=function(){s.turnOnErrorState(),c(null)},t=localforage.getItem("username");t.then(c,e)};var c=function(e){var t=virtualViewer.getCallbackManager(),a={loadedUsername:e,previousUsername:s.username};t.call("onLoadUsername",a),e&&0!==e.length||s.setUsername(s.defaultUsername),s.username.length&&s.username!==s.defaultUsername||s.setUsername(e)};r.prototype.loadZoomPreferences=function(){var e=function(){s.turnOnErrorState(),g(null)},t=localforage.getItem("zoomPreferences");t.then(g,e)};var g=function(e){e&&e.version===s.versions.zoomPreferences?s.zoomPreferences=e:(s.zoomPreferences.mode=t.defaultZoomMode||n.zoomModes.fitWindow,s.zoomPreferences.zoomLevel=t.defaultZoomLevel||100,s.zoomPreferences.zoomLevelIndex=t.zoomLevels.indexOf(s.zoomPreferences.zoomLevel),s.zoomPreferences.fitWidthPercentage=t.defaultFitWidthPercent||1,s.zoomPreferences.zoomLevelIndex===-1&&(s.zoomPreferences.zoomLevelIndex=s.getMiddleZoomLevel(),s.zoomPreferences.zoomLevel=t.zoomLevels[s.zoomPreferences.zoomLevelIndex])),s.dialogHasBeenOpened||s.applyZoomPreferences()};r.prototype.loadTabPreferences=function(){var e=function(){s.turnOnErrorState(),v(null)},t=localforage.getItem("defaultTab");t.then(v,e)};var v=function(e){"number"!=typeof e&&(e=t.defaultThumbnailTab),s.defaultTab=e;var a=virtualViewer.getActivePaneState();a&&!a.isMedia()||(e=n.thumbnailTabs.document),virtualViewer.openDefaultThumb(e)};r.prototype.loadToolbarPreferences=function(){var e=function(){s.turnOnErrorState(),h(null)},t=localforage.getItem("imageControlToolbar");t.then(h,e);var a=function(){s.turnOnErrorState(),p(null)},n=localforage.getItem("annotationToolbar");n.then(p,a)};var p=function(e){if(e&&e.length&&e.version===s.versions.annotationToolbarPreferences)s.annotationToolbar=e;else if(s.annotationToolbar)for(var t=1;t<s.annotationToolbar.length;t++)s.annotationToolbar[t].on=!0;s.updateToolbarsGeneric(s.annotationToolbar,"vvAnnToolbar")},h=function(e){if(e&&e.length&&e.version===s.versions.imageToolbarPreferences)s.imageControlToolbar=e;else if(s.imageControlToolbar)for(var t=1;t<s.imageControlToolbar.length;t++)s.imageControlToolbar[t].on=!0;s.updateToolbarsGeneric(s.imageControlToolbar,"vvToolbar")};r.prototype.loadPanToolPreference=function(){var e=function(){s.turnOnErrorState(),m(null)},t=localforage.getItem("panToolPrefs");t.then(m,e)};var m=function(e){null===e&&(e="number"!=typeof t.panToolPreference?t.imageScrollBars===!1?n.panToolPref.panToolWithoutScrollbars:n.panToolPref.noPanTool:t.panToolPreference),s.panToolPreference=e,s.applyPanToolPreference(s.panToolPreference)};r.prototype.applyUserPreferences=function(){virtualViewer.setActivePane(0),this.updateToolbarDisplay(),virtualViewer.createTextAnnContextMenuList(),virtualViewer.createNoteTemplateContextMenuList(),virtualViewer.openDefaultThumb(),this.applyZoomPreferences(),this.applyPanToolPreference()},r.prototype.loadDefaults=function(e){this.readInCurrentToolbarButtons(),e||this.updateToolbarDisplay(),g(null,this),c(null,this),u(null,this),l(null,this),i.reset(),x(null,this),L(null,this),v(null),m(null)},r.prototype.prepareToolbarTab=function(){for(var e=1;e<this.imageControlToolbar.length;e++){var t=this.imageControlToolbar[e].name,a=this.createElmtIDWithPrefix(this.imageControlToolbar[e].id,!1),n=$("<label></label>").attr("for",a+"Check").addClass("list-group-item vvUPToolbarCheckItem");n.append($("<input>").attr({type:"checkbox",id:a+"Check"})),n.append($("<span></span>").attr("id",a).html(t)),$("#vvUPImageControl").append(n)}for(var o=1;o<this.annotationToolbar.length;o++){var i=this.annotationToolbar[o].name,r=this.createElmtIDWithPrefix(this.annotationToolbar[o].id,!1),s=$("<label></label>").attr("for",r+"Check").addClass("list-group-item vvUPToolbarCheckItem");s.append($("<input>").attr({type:"checkbox",id:r+"Check"})),s.append($("<span></span>").attr("id",r).html(i)),$("#vvUPAnnotationToolbar").append(s)}$("#ImageControlsCheck").on("change",function(){$("#vvUPImageControl .vvUPToolbarCheckItem > input").attr("disabled",!$(this).prop("checked"))}),$("#AnnotationToolbarCheck").on("change",function(){$("#vvUPAnnotationToolbar .vvUPToolbarCheckItem > input").attr("disabled",!$(this).prop("checked"))})},r.prototype.updateToolbarDisplay=function(){t.enableCrop||$("#vvCropButton").hide(),this.updateToolbarsGeneric(this.imageControlToolbar,"vvToolbar"),this.updateToolbarsGeneric(this.annotationToolbar,"vvAnnToolbar")},r.prototype.updateToolbarsGeneric=function(e,t){var a,n=!1;a="vvToolbar"===t?$("#vvToolbarItems"):$("#vvAnnToolbar, #vvAnnToolbarHamburgerItems");var o;e.length&&e[0].on?a.removeClass("vvHidden"):(n=!0,a.addClass("vvHidden"));for(var i,r=1;r<e.length;r++)o=e[r],i=$("."+o.id),i.toggle(o.on),i.toggleClass("vvPreferenceDisabled",!o.on),i.toggleClass("vvPreferenceEnabled",!!o.on),"vvFileUpload"===o.id&&(this.fileUploadVisible=o.on);n&&!e[0].on||a.show(),virtualViewer.applyToolbarButtonConfigurations()},r.prototype.updateToolbarConfigurations=function(){var e,t;if(0!==this.imageControlToolbar.length&&0!==this.annotationToolbar.length){e=this.imageControlToolbar[0],t=$("#ImageControlsCheck"),t.prop("checked",e.on),$("#vvUPImageControl .vvUPToolbarCheckItem > input").attr("disabled",!e.on);for(var a=1;a<this.imageControlToolbar.length;a++)e=this.imageControlToolbar[a],t=$("#"+this.createElmtIDWithPrefix(e.id,!0)),t.prop("checked",e.on),"vvFileUpload"===e.id&&virtualViewer.disableUploadDocument&&t.parents(".vvUPToolbarCheckItem").hide();for(e=this.annotationToolbar[0],t=$("#AnnotationToolbarCheck"),t.prop("checked",e.on),$("#vvUPAnnotationToolbar .vvUPToolbarCheckItem > input").attr("disabled",!e.on),a=1;a<this.annotationToolbar.length;a++)e=this.annotationToolbar[a],t=$("#"+this.createElmtIDWithPrefix(e.id,!0)),t.prop("checked",e.on)}},r.prototype.saveToolbarPreferences=function(){for(var e=$("#vvUPImageControl input"),t=0;t<this.imageControlToolbar.length;t++)e[t]&&(this.imageControlToolbar[t].on=$(e[t]).prop("checked"));this.imageControlToolbar.version=this.versions.imageToolbarPreferences,e=$("#vvUPAnnotationToolbar input");for(var a=0;a<this.annotationToolbar.length;a++)e[a]&&(this.annotationToolbar[a].on=$(e[a]).prop("checked"));this.annotationToolbar.version=this.versions.annotationToolbarPreferences;try{localforage.setItem("imageControlToolbar",this.imageControlToolbar),localforage.setItem("annotationToolbar",this.annotationToolbar)}catch(e){return!1}var n=virtualViewer.getCallbackManager(),o={imageControlToolbar:this.imageControlToolbar,annotationToolbar:this.annotationToolbar};return n.call("saveToolbarPreferences",o),!0},r.prototype.prepareAnnotationTab=function(){for(var t=$("#vvUPAnnotationsList"),o=$("#vvUPAnnotationProperties"),i=1;i<this.annotationToolbar.length;i++){var r=this.annotationToolbar[i].id,s=a(virtualViewer).annotationToolbarButtons[r].annType;if(s&&s!==n.annotationTypes.SANN_REDACTION_RECT&&s!==n.annotationTypes.SANN_BITMAP){var l=this.createElmtIDWithPrefix(this.sanitizeName(s),!1),u=l+"Edit",d=$("#vvUPAnnotationEditTemplate").clone().attr("id",u).data("anntype",s);o.append(d),d.find(".vvUPAnnotationLineColorChoices, .vvUPAnnotationFontColorChoices").colorpicker(),d.find(".vvUPAnnotationFillColorChoices").colorpicker({showOpacity:!0});var c=$("<li></li>").attr({id:l,role:"tab"}).addClass("vvUPAnnotationItem nav").data("vvTabTarget",u);c.append($("<a></a>").html(this.annotationToolbar[i].name)),d.attr("aria-labelledby",l),b(s,d),d.hide(),t.append(c)}}$(".vvUPAnnotationItem").on("click",function(){y($(this))}),$("#vvUPAnnotationEditTemplate").hide();let g=e.fontNames();for(var v=0;v<g.length;v+=1)$(".vvUPAnnTextFaceSelect").append("<option>"+g[v]+"</option>");for(var p=0;p<n.fontSizes.length;p+=1)$(".vvUPAnnTextSizeSelect").append("<option>"+n.fontSizes[p]+"</option>");$(".vvUPAnnThicknessCell").click(function(){f($(this))});var h=$(".vvUPAnnotationItem")[0];h&&y($(h))};var f=function(e){var t=e.closest(".vvUPAnnotationLineThickness");t.find(".vvUPAnnThicknessCell").attr("aria-pressed","false"),e.attr("aria-pressed","true");var a=e.data("vvlinewidth");a=parseInt(a,10),t.find(".vvUPAnnLineSizeValue").text(a)},y=function(e){var t=e.data("vvTabTarget");$(".vvUPAnnPropPane.active").removeClass("active").hide(),$("#"+t).addClass("active").show(),$(".vvUPSelectedAnnotation.active").removeClass("vvUPSelectedAnnotation active"),e.addClass("vvUPSelectedAnnotation active"),$("#vvSelectedAnnotation").text(e.text())},b=function(e,a){var o=i.getAnnotationPreference(e);"undefined"==typeof o.lineColor&&a.find(".vvUPAnnotationLineColorChoices, .vvUPAnnotationLineThickness").closest(".vvUPAnnotationPropertySection").hide(),"undefined"==typeof o.fillColor&&a.find(".vvUPAnnotationFillColorChoices").closest(".vvUPAnnotationPropertySection").hide(),"undefined"==typeof o.fontColor&&a.find(".vvUPAnnotationFontColorChoices, .vvUPTextAnnOptions").closest(".vvUPAnnotationPropertySection").hide(),t.enableCustomOpacity&&e!==n.annotationTypes.SANN_POSTIT&&e!==n.annotationTypes.SANN_HIGHLIGHT_RECT||a.find(".vvUPAnnotationFillColorChoices").colorpicker("toggleOpacityControls",!1),t.enableCustomOpacity||e!==n.annotationTypes.SANN_EDIT||a.find(".vvUPAnnotationFillColorChoices").colorpicker("api").toggleOpacityControls(!0).allowContinuousOpacity(!1),e===n.annotationTypes.SANN_FILLED_RECT||e===n.annotationTypes.SANN_FILLED_ELLIPSE||e===n.annotationTypes.SANN_FILLED_POLYGON?a.find(".vvUPAnnotationFillColorChoices").colorpicker("setMinimumOpacity",1):a.find(".vvUPAnnotationFillColorChoices").colorpicker("setMinimumOpacity",0)};r.prototype.setAnnotationProperties=function(){for(var e=$("#vvUPAnnotationProperties .vvUPAnnPropPane"),t=0;t<e.length;t++){var a=$(e[t]),n=a.data("anntype");if(n){var o=i.getAnnotationPreference(n);a.find(".vvUPAnnotationFontColorChoices").colorpicker("color",o.fontColor),a.find(".vvUPAnnotationLineColorChoices").colorpicker("color",o.lineColor);var r=a.find(".vvUPAnnotationFillColorChoices").data().colorpicker;r.color(o.fillColor),r.opacity(o.fillOpacity),a.find(".vvUPAnnTextFaceSelect").val(o.fontFace),a.find(".vvUPAnnTextSizeSelect").val(o.fontSize),a.find(".vvUPAnnTextStyleBold").prop("checked",o.fontBold),a.find(".vvUPAnnTextStyleItalic").prop("checked",o.fontItalic);var s=o.lineWidth;s||(s=1),f(a.find(".vvUPAnnThicknessCell-"+s))}}},r.prototype.saveAnnotationPreferences=function(){for(var e=$("#vvUPAnnotationProperties .vvUPAnnPropPane").not("#vvUPAnnotationEditTemplate"),t=0;t<e.length;t++){var a=$(e[t]),n=a.data("anntype"),o=i.getAnnotationPreference(n);o.lineColor=a.find(".vvUPAnnotationLineColorChoices").colorpicker("color")||o.lineColor,o.fontColor=a.find(".vvUPAnnotationFontColorChoices").colorpicker("color")||o.fontColor;var r=a.find(".vvUPAnnotationFillColorChoices").data().colorpicker;o.fillColor=r.color()||o.fillColor,o.fillOpacity=r.opacity(),o.fontFace=a.find(".vvUPAnnTextFaceSelect").val()||o.fontFace,o.fontSize=a.find(".vvUPAnnTextSizeSelect").val()||o.fontSize,o.fontBold=!!a.find(".vvUPAnnTextStyleBold").prop("checked"),o.fontItalic=!!a.find(".vvUPAnnTextStyleItalic").prop("checked"),o.lineWidth=parseInt(a.find(".vvUPAnnLineSizeValue").text(),10)||o.lineWidth,i.updateAnnotationPreference(n,o)}return i.save(),!0},r.prototype.returnCurrentStampIndex=function(){var e=0;return e=$(".vvUPCustomStampItem").index($(".vvUPSelectedCustomStamp")[0])},r.prototype.prepareStampsTab=function(){$("#vvUPAddCustomStamp").click(function(){s.createCustomStamp()}),$("#vvUPRemoveCustomStamp").click(function(){s.removeCurrentCustomStamp()})};var P=function(){var e=$("#vvUPCustomStampEdit .active"),t=$("#vvUPCustomStampPreview"),a=e.find(".vvUPCustomStampStampTextInput").val();a||(a=""),t.text(a);var n=e.find(".vvUPStampFillColorChoices").colorpicker("colorRgba");t.css("background-color",n),t.css("color","#"+e.find(".vvUPStampColorChoices").colorpicker("color")),t.css("font-family",e.find(".vvUPCustomTextFaceSelect").val()),t.css("font-size",e.find(".vvUPCustomTextSizeSelect").val()+"px");var o=parseInt(($("#vvUPCustomStampPreviewWrapper").height()-parseInt(t.css("line-height")))/2);t.css("margin-top",o+"px"),e.find(".vvUPCustomTextStyleBold").prop("checked")?t.css("font-weight","bold"):t.css("font-weight","normal"),e.find(".vvUPCustomTextStyleItalic").prop("checked")?t.css("font-style","italic"):t.css("font-style","normal")};r.prototype.createCustomStampsTable=function(){$("#vvUPSelectedCustomStampName").html(" "),$("#vvUPPreviewWord").html(" "),$("#vvUPCustomStampPreview").html(" "),$("#vvUPCustomStamps").html(" "),$(".vvUPStampEditPane:not(:first)").remove();for(var e=0;e<this.customStampArray.length;e++)this.createCustomStamp(this.customStampArray[e]);if(this.customStampArray.length>0){var t=$(".vvUPCustomStampItem").first();A(t)}else $("#vvUPCustomStampEdit").hide()};var T=function(e){e.find(".vvUPCustomStampDisplayNameInput").change(function(){var e=$("#"+$(this).closest(".vvUPStampEditPane").attr("aria-labelledby")+" > a");e.text($(this).val()),$("#vvUPSelectedCustomStampName").text($(this).val())}),e.find(".vvUPCustomStampStampTextInput").change(function(){P()}),e.find(".vvUPCustomTextFaceSelect").change(function(){P()}),e.find(".vvUPCustomTextSizeSelect").change(function(){P()}),e.find(".vvUPCustomTextStyleBold").change(function(){$(this).prop("checked")?$("#vvUPCustomStampPreview").css("font-weight","bold"):$("#vvUPCustomStampPreview").css("font-weight","normal")}),e.find(".vvUPCustomTextStyleItalic").change(function(){$(this).prop("checked")?$("#vvUPCustomStampPreview").css("font-style","italic"):$("#vvUPCustomStampPreview").css("font-style","normal")})};r.prototype.createCustomStamp=function(e){var t,a=!0,n=$(".vvUPCustomStampItem").length+1,o="vvUPCustomStamp"+n;if(e)t=e.displayName;else{for(;$("#"+o).length;)n++,o="vvUPCustomStamp"+n;t="Custom Stamp #"+n,a=!1,e=this.createDefaultTextStamp(t)}var i=I(o,e),r=i.attr("id"),s=$("<li></li>").attr({id:o,role:"tab"}).addClass("vvUPCustomStampItem nav").data("vvTabTarget",r);s.append($("<a></a>").text(t)),$("#vvUPCustomStamps").append(s),i.attr("aria-labelledby",o),s.on("click",function(){A($(this))}),a||A(s)};var A=function(e){$("#vvUPSelectedCustomStampName").text(e.text()),$("#vvUPCustomStampEdit").show(),$("#vvUPCustomStamps .active").removeClass("active vvUPSelectedCustomStamp"),e.addClass("active vvUPSelectedCustomStamp");var t=e.attr("id")+"Edit";$("#vvUPCustomStampEdit .active").removeClass("active").hide(),$("#"+t).addClass("active").show(),P()},I=function(a,o){var i=$("#vvUPStampEditPaneTemplate").clone();$("#vvUPCustomStampEdit").append(i),i.attr("id",a+"Edit"),i.find(".vvUPStampFillColorChoices").colorpicker({color:o.fillColor,opacity:o.fillOpacity,showOpacity:!0,allowContinuousOpacity:t.enableCustomOpacity,onChange:P}),i.find(".vvUPStampColorChoices").colorpicker({color:o.fontColor,onChange:P});var r=i.find(".vvUPCustomTextFaceSelect");let s=e.fontNames();for(var l=0;l<s.length;l+=1)r.append("<option>"+s[l]+"</option>");r.val(o.fontFace),null===r.val()&&(r.val("Times New Roman"),o.fontFace="Times New Roman");for(var u=i.find(".vvUPCustomTextSizeSelect"),d=0;d<n.fontSizes.length;d+=1)u.append("<option>"+n.fontSizes[d]+"</option>");return u.val(o.fontSize),null===u.val()&&u.val(18),i.find(".vvUPCustomStampDisplayNameInput").val(o.displayName),i.find(".vvUPCustomStampStampTextInput").val(o.textString),i.find(".vvUPCustomTextStyleBold").prop("checked",!!o.fontBold),i.find(".vvUPCustomTextStyleItalic").prop("checked",!!o.fontItalic),T(i),i};r.prototype.removeCurrentCustomStamp=function(){var e=this.returnCurrentStampIndex();if($(".vvUPCustomStampItem")[e]){if($(".vvUPCustomStampItem").eq(e).remove(),$("#vvUPCustomStampEdit .vvUPStampEditPane").eq(e+1).remove(),!$(".vvUPCustomStampItem").length)return void $("#vvUPCustomStampEdit").hide();0===e&&(e=1),A($(".vvUPCustomStampItem").eq(e-1))}},r.prototype.saveCustomStamps=function(){for(var e=[],t=$(".vvUPCustomStampItem"),a=0;a<t.length;a++){var n=this.createDefaultTextStamp(),o=$("#"+$(t[a]).attr("id")+"Edit");n.displayName=o.find(".vvUPCustomStampDisplayNameInput").val(),n.textString=o.find(".vvUPCustomStampStampTextInput").val(),n.fontFace=o.find(".vvUPCustomTextFaceSelect").val(),n.fontSize=o.find(".vvUPCustomTextSizeSelect").val(),n.fontBold=o.find(".vvUPCustomTextStyleBold").prop("checked"),n.fontItalic=o.find(".vvUPCustomTextStyleItalic").prop("checked"),n.fontColor=o.find(".vvUPStampColorChoices").colorpicker("color");var i=o.find(".vvUPStampFillColorChoices").data().colorpicker;n.fillColor=i.color(),n.fillOpacity=i.opacity(),e[a]=n}e.version=this.versions.customTextStamps;try{localforage.setItem("customStampArray",e)}catch(e){return!1}var r=virtualViewer.getCallbackManager(),s={stampsPreferences:e};return r.call("saveCustomStamps",s),this.customStampArray=e,!0},r.prototype.returnCurrentTemplateIndex=function(){var e=0;return e=$(".vvUPNoteTemplateItem").index($(".vvUPSelectedNoteTemplate")[0])},r.prototype.prepareNotesTab=function(){$("#vvUPAddNoteTemplate").click(function(){s.createNoteTemplate()}),$("#vvUPRemoveNoteTemplate").click(function(){s.removeCurrentNoteTemplate()})};var S=function(){var e=$("#vvUPNoteTemplateEdit .active"),t=e.find(".vvUPNoteTemplateTextInput").val();t||(t=""),$("#vvUPNoteTemplatePreview").text(t)};r.prototype.createNoteTemplateTable=function(){$("#vvUPSelectedNoteTemplateName").html(" "),$("#vvUPPreviewWord").html(" "),$("#vvUPNoteTemplates").html(" "),$(".vvUPTemplateEditPane:not(:first)").remove();for(var e=0;e<this.noteTemplateArray.length;e++)this.createNoteTemplate(this.noteTemplateArray[e]);if(this.noteTemplateArray.length>0){var t=$(".vvUPNoteTemplateItem").first();C(t)}else $("#vvUPNoteTemplateEdit").hide()};var w=function(e){e.find(".vvUPNoteTemplateDisplayNameInput").change(function(){var e=$("#"+$(this).closest(".vvUPTemplateEditPane").attr("aria-labelledby")+" > a");e.text($(this).val()),$("#vvUPSelectedNoteTemplateName").text($(this).val())}),e.find(".vvUPNoteTemplateTextInput").change(function(){S()})};r.prototype.createNoteTemplate=function(e){var t,a=!0,n=$(".vvUPNoteTemplateItem").length+1,o="vvUPNoteTemplate"+n;if(e)t=e.templateName;else{for(;$("#"+o).length;)n++,o="vvUPNoteTemplate"+n;t="Note Template #"+n,a=!1,e=this.createDefaultNoteTemplate(t)}var i=D(o,e),r=i.attr("id"),s=$("<li></li>").attr({id:o,role:"tab"}).addClass("vvUPNoteTemplateItem nav").data("vvTabTarget",r);s.append($("<a></a>").html(t)),$("#vvUPNoteTemplates").append(s),i.attr("aria-labelledby",o),s.on("click",function(){C($(this))}),a||C(s)};var C=function(e){$("#vvUPSelectedNoteTemplateName").text(e.text()),$("#vvUPNoteTemplateEdit").show(),$("#vvUPNoteTemplates .active").removeClass("active vvUPSelectedNoteTemplate"),e.addClass("active vvUPSelectedNoteTemplate");var t=e.attr("id")+"Edit";$("#vvUPNoteTemplateEdit .active").removeClass("active").hide(),$("#"+t).addClass("active").show()},D=function(e,t){var a=$("#vvUPTemplateEditPaneTemplate").clone();return $("#vvUPNoteTemplateEdit").append(a),a.attr("id",e+"Edit"),a.find(".vvUPNoteTemplateDisplayNameInput").val(t.templateName),a.find(".vvUPNoteTemplateTextInput").val(t.templateString),w(a),a};r.prototype.removeCurrentNoteTemplate=function(){var e=this.returnCurrentTemplateIndex();if($(".vvUPNoteTemplateItem")[e]){if($(".vvUPNoteTemplateItem").eq(e).remove(),$("#vVUPNoteTemplateEdit .vvUPTemplateEditPane").eq(e+1).remove(),!$(".vvUPNoteTemplateItem").length)return void $("#vvUPNoteTemplateEdit").hide();0===e&&(e=1),C($(".vvUPNoteTemplateItem").eq(e-1))}},r.prototype.saveNoteTemplates=function(){for(var e=[],t=$(".vvUPNoteTemplateItem"),a=0;a<t.length;a++){var n=this.createDefaultNoteTemplate(),o=$("#"+$(t[a]).attr("id")+"Edit");n.templateName=o.find(".vvUPNoteTemplateDisplayNameInput").val(),n.templateString=o.find(".vvUPNoteTemplateTextInput").val(),e[a]=n}e.version=this.versions.noteTemplates;try{localforage.setItem("noteTemplateArray",e)}catch(e){return!1}this.noteTemplateArray=e;var i=virtualViewer.getCallbackManager(),r={notesTemplate:e};return i.call("saveNoteTemplates",r),!0},r.prototype.prepareGeneralTab=function(){$("#vvUPZoomLevelForm").hide();var e=$("#vvUPZoomLevelSelect"),a=$("#vvUPFitWidthPercentage"),n=0;virtualViewer.validateZoomLevels();for(var o=0;o<t.zoomLevels.length;o++){var i=t.zoomLevels[o];i>=t.zoomLevels[n]&&i<=100&&(n=o),i+="%",e.append($("<option/>",{value:o,text:i}))}for(var o=100;o>=50;o-=5)a.append($("<option/>",{value:o,text:o+"%"}));this.defaultZoomPercentIndex=n;var r=100*t.defaultFitWidthPercent||100;e.val(n),a.val(r),this.zoomPreferences.zoomLevelIndex<0&&(this.zoomPreferences.zoomLevelIndex=n,this.zoomPreferences.zoomLevel=t.zoomLevels[n]),e.on("change",function(){$("#vvUPFitCustom").prop("checked",!0)}),a.on("change",function(){$("#vvUPFitToWidth").prop("checked",!0)}),$(".vvUPDefaultFitRadio").on("change",function(){if("vvUPFitCustom"!==$(this).attr("id")){var e=$("#vvUPZoomLevelSelect");e.val(s.defaultZoomPercentIndex)}}),M(),this.updateDialogZoomPreferences()},r.prototype.applyZoomPreferences=function(e){var t;t=e?[e]:o.getAllStates();for(var a=0;a<t.length;a++){let e=t[a];e.isMedia()?e.isVideo()?e.getMediaManager().applyMediaPreferences(this.videoPreferences):e.isAudio()&&e.getMediaManager().applyMediaPreferences(this.audioPreferences):this.applyZoomPreferencesCore(e),e.clearCachedScroll()}},r.prototype.applyZoomPreferencesCore=function(e){if(e)return e.documentId!==o.displayedDocuments[e.currentPaneIndex]?(e.setZoomMode(this.zoomPreferences.mode),void e.setZoom(this.zoomPreferences.zoomLevel)):void(this.zoomPreferences.mode===n.zoomModes.fitWindow?virtualViewer.fitWindowCore(e):this.zoomPreferences.mode===n.zoomModes.fitHeight?virtualViewer.fitHeightCore(e):this.zoomPreferences.mode===n.zoomModes.fitWidth?virtualViewer.fitWidthCore(e):this.zoomPreferences.mode===n.zoomModes.fitCustom&&virtualViewer.setZoomPercentCore(this.zoomPreferences.zoomLevel,e))},r.prototype.saveZoomPreferences=function(e){e||this.setZoomValuesFromHTML(),this.zoomPreferences.version=this.versions.zoomPreferences;try{localforage.setItem("zoomPreferences",this.zoomPreferences)}catch(e){return!1}var t=virtualViewer.getCallbackManager(),a={zoomPreferences:this.zoomPreferences};return t.call("saveZoomPreferences",a),!0},r.prototype.setZoomValuesFromHTML=function(){if($("#vvUPFitToWindow").prop("checked"))this.zoomPreferences.mode=n.zoomModes.fitWindow;else if($("#vvUPFitToHeight").prop("checked"))this.zoomPreferences.mode=n.zoomModes.fitHeight;else if($("#vvUPFitToWidth").prop("checked"))this.zoomPreferences.mode=n.zoomModes.fitWidth;else if($("#vvUPFitCustom").prop("checked")){this.zoomPreferences.mode=n.zoomModes.fitCustom;var e=parseInt($("#vvUPZoomLevelSelect").val());isNaN(e)||void 0===t.zoomLevels[e]?this.zoomPreferences.zoomLevelIndex=this.getMiddleZoomLevel():this.zoomPreferences.zoomLevelIndex=e,this.zoomPreferences.zoomLevel=t.zoomLevels[this.zoomPreferences.zoomLevelIndex]}var a=parseInt($("#vvUPFitWidthPercentage").val());isNaN(a)?this.zoomPreferences.fitWidthPercentage=1:this.zoomPreferences.fitWidthPercentage=a/100},r.prototype.updateDialogZoomPreferences=function(){var e=$("#vvUPZoomLevelSelect"),t=$("#vvUPFitWidthPercentage");e.val(this.defaultZoomPercentIndex),this.zoomPreferences.mode===n.zoomModes.fitWindow?$("#vvUPFitToWindow").prop("checked",!0):this.zoomPreferences.mode===n.zoomModes.fitHeight?$("#vvUPFitToHeight").prop("checked",!0):this.zoomPreferences.mode===n.zoomModes.fitWidth?$("#vvUPFitToWidth").prop("checked",!0):this.zoomPreferences.mode===n.zoomModes.fitCustom&&$("#vvUPFitCustom").prop("checked",!0),e.val(this.zoomPreferences.zoomLevelIndex),t.val(100*this.zoomPreferences.fitWidthPercentage)},r.prototype.getMiddleZoomLevel=function(){var e=t.zoomLevels.length/2;return e-=e%1},r.prototype.getDefaultZoomMode=function(){return this.zoomPreferences.mode},r.prototype.getDefaultZoomLevel=function(){var e=this.zoomPreferences.zoomLevel;return e<0?t.zoomLevels[this.getMiddleZoomLevel()]:e},r.prototype.setUsername=function(t){var a=$("#vvUPUsernameInput");t?(this.username=t,t===s.defaultUsername?a.val(""):a.val(t)):this.username=a.val()||s.defaultUsername,$("#vvDocumentNoteAdderAuthor").html(e.encodeForHTML(this.username)),$("#vvAnnotationNoteAdderAuthor").html(e.encodeForHTML(this.username)),this.username&&virtualViewer.addUsersToDropDown(this.username)},r.prototype.getUsername=function(){return this.username},r.prototype.saveUsername=function(e){this.setUsername(e);try{localforage.setItem("username",this.username)}catch(e){return!1}var t=virtualViewer.getCallbackManager(),a={username:this.username};return t.call("saveUsername",a),!0};var M=function(){for(var e=$("#vvUPDefaultTab .form-group"),a=0;a<e.length;a++){var n=$(e[a]).find("input").attr("id");("vvUPPageTab"!==n||t.showPageThumbnails)&&("vvUPDocumentTab"!==n||t.showDocThumbnails)&&("vvUPSearchTab"!==n||t.showSearch)&&("vvUPNoteTab"!==n||t.enableDocumentNotes)&&("vvUPBookmarkTab"!==n||t.showBookmarkThumbnails)?"vvUPAnnotationTab"!==n||t.showAnnotationList||$(e[a]).remove():$(e[a]).remove()}};r.prototype.updateDialogDefaultTab=function(){switch(this.defaultTab){case n.thumbnailTabs.page:$("#vvUPPageTab").prop("checked",!0);break;case n.thumbnailTabs.document:$("#vvUPDocumentTab").prop("checked",!0);break;case n.thumbnailTabs.search:$("#vvUPSearchTab").prop("checked",!0);break;case n.thumbnailTabs.note:$("#vvUPNoteTab").prop("checked",!0);break;case n.thumbnailTabs.bookmark:$("#vvUPBookmarkTab").prop("checked",!0);break;case n.thumbnailTabs.annList:$("#vvUPAnnotationTab").prop("checked",!0)}},r.prototype.setDefaultTabFromHTML=function(){$("#vvUPPageTab").prop("checked")?this.defaultTab=n.thumbnailTabs.page:$("#vvUPDocumentTab").prop("checked")?this.defaultTab=n.thumbnailTabs.document:$("#vvUPSearchTab").prop("checked")?this.defaultTab=n.thumbnailTabs.search:$("#vvUPNoteTab").prop("checked")?this.defaultTab=n.thumbnailTabs.note:$("#vvUPBookmarkTab").prop("checked")?this.defaultTab=n.thumbnailTabs.bookmark:$("#vvUPAnnotationTab").prop("checked")&&(this.defaultTab=n.thumbnailTabs.annList)},r.prototype.saveTabPreference=function(){this.setDefaultTabFromHTML();try{localforage.setItem("defaultTab",this.defaultTab)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={defaultTab:this.defaultTab};return e.call("saveTabPreferences",t),!0},r.prototype.getDefaultTab=function(){return(null===this.defaultTab||this.defaultTab<0)&&(this.defaultTab=t.defaultThumbnailTab),this.defaultTab},r.prototype.applyPanToolPreference=function(e){e||(e=this.getPanToolPreference()),virtualViewer.turnOnPanTool(e)},r.prototype.setPanToolPreference=function(e){return s.panToolPreference=e},r.prototype.getPanToolPreference=function(){return this.panToolPreference},r.prototype.isPanToolOn=function(){return this.panToolPreference===n.panToolPref.panToolWithoutScrollbars||this.panToolPreference===n.panToolPref.panToolWithScrollbars},r.prototype.updateDialogPanToolPrefs=function(){switch(this.panToolPreference){case n.panToolPref.noPanTool:$("#vvUPNoPan").prop("checked",!0);break;case n.panToolPref.panToolWithoutScrollbars:$("#vvUPPanNoScroll").prop("checked",!0);break;case n.panToolPref.panToolWithScrollbars:$("#vvUPPanWithScroll").prop("checked",!0);break;default:this.turnOnErrorState()}},r.prototype.setPanToolPrefsFromHTML=function(){$("#vvUPNoPan").prop("checked")&&(this.panToolPreference=n.panToolPref.noPanTool),$("#vvUPPanNoScroll").prop("checked")&&(this.panToolPreference=n.panToolPref.panToolWithoutScrollbars),$("#vvUPPanWithScroll").prop("checked")&&(this.panToolPreference=n.panToolPref.panToolWithScrollbars)},r.prototype.savePanToolPreference=function(){this.setPanToolPrefsFromHTML();try{localforage.setItem("panToolPrefs",this.panToolPreference)}catch(e){return!1}return!0},r.prototype.prepareMediaTab=function(){this.updateMediaTab()},r.prototype.updateMediaTab=function(){$("#vvUPVideoAutoplay").prop("checked",!!this.videoPreferences.autoplay),$("#vvUPVideoMute").prop("checked",!!this.videoPreferences.mute),$("#vvUPVideoControls").prop("checked",!!this.videoPreferences.controls),$("#vvUPVideoStretch").prop("checked",!!this.videoPreferences.stretch),$("#vvUPVideoCaptions").prop("checked",!!this.videoPreferences.captions),$("#vvUPAudioLoop").prop("checked",!!this.audioPreferences.loop),$("#vvUPAudioBackground").prop("checked",!!this.audioPreferences.background),$("#vvUPAudioCaptions").prop("checked",!!this.audioPreferences.captions)},r.prototype.setMediaValuesFromHTML=function(){this.setVideoValuesFromHTML(),this.setAudioValuesFromHTML()},r.prototype.setVideoValuesFromHTML=function(){this.videoPreferences.autoplay=$("#vvUPVideoAutoplay").prop("checked"),
this.videoPreferences.mute=$("#vvUPVideoMute").prop("checked"),this.videoPreferences.controls=$("#vvUPVideoControls").prop("checked"),this.videoPreferences.stretch=$("#vvUPVideoStretch").prop("checked"),this.videoPreferences.captions=$("#vvUPVideoCaptions").prop("checked")},r.prototype.setAudioValuesFromHTML=function(){this.audioPreferences.loop=$("#vvUPAudioLoop").prop("checked"),this.audioPreferences.background=$("#vvUPAudioBackground").prop("checked"),this.audioPreferences.captions=$("#vvUPAudioCaptions").prop("checked")},r.prototype.loadVideoPreferences=function(){var e=function(){s.turnOnErrorState(),x(null)},t=localforage.getItem("videoPreferences");t.then(x,e)};var x=function(e){e?s.videoPreferences=e:(s.videoPreferences.autoplay=t.videoAutoplay,s.videoPreferences.mute=t.videoMuted,s.videoPreferences.controls=t.videoControls,s.videoPreferences.stretch=t.videoStretch,s.videoPreferences.captions=t.videoCaptions,s.updateMediaTab());var a=virtualViewer.getCallbackManager();if(a){var n=virtualViewer.getActivePaneState();if(n){var o=n.getMediaManager(),i={player:o.player,self:o};a.call("postLoadPreferencesVideo",i)}}};r.prototype.loadAudioPreferences=function(){var e=function(){s.turnOnErrorState(),L(null)},t=localforage.getItem("audioPreferences");t.then(L,e)};var L=function(e){e?s.audioPreferences=e:(s.audioPreferences.loop=t.audioLoop,s.audioPreferences.background=t.audioBackground,s.audioPreferences.captions=t.audioCaptions,s.updateMediaTab());var a=virtualViewer.getCallbackManager();if(a){var n=virtualViewer.getActivePaneState();if(n){var o=n.getMediaManager(),i={player:o.player,self:o};a.call("postLoadPreferencesAudio",i)}}};return r.prototype.saveMediaPreferences=function(){this.setMediaValuesFromHTML();try{localforage.setItem("videoPreferences",this.videoPreferences),localforage.setItem("audioPreferences",this.audioPreferences)}catch(e){return!1}var e=virtualViewer.getCallbackManager(),t={videoPreferences:this.videoPreferences};return e.call("saveVideoPreferences",t),t={audioPreferences:this.audioPreferences},e.call("saveAudioPreferences",t),!0},r.prototype.sanitizeName=function(e){if(e)return e.replace(/([ ;&,\.\+\*\~':"\!\^#$%@\[\]\(\)\\\/=>\|])/gm,"")},r.prototype.createElmtIDWithPrefix=function(e,t){var a=this.dynamicUPOptionPrefix+e;return t&&(a+="Check"),a},r.prototype.exportUserPreferences=function(){var t=Object.assign({},this.protoExportBlob);return t.username=this.username,t.defaultTab=this.defaultTab,t.panToolPreference=this.panToolPreference,t.audioPreferences=this.audioPreferences,t.videoPreferences=this.videoPreferences,t.zoomPreferences=this.zoomPreferences,t.imageControlToolbar=this.imageControlToolbar,t.annotationToolbar=this.annotationToolbar,t.annotationPreferences=i.getAllAnnotationPreferences(),t.noteTemplateArray=this.noteTemplateArray,t.customStampArray=this.customStampArray,t.exportVersion=this.exportVersion,e.deepObjCopy(t)},r.prototype.importUserPreferences=function(t){if(!t||!t.exportVersion){var a=e.getLocalizedValue("errors.JSONRequired","JSON required for API call."),n={client:!0,disable:!0};return void virtualViewer.displayExceptionMessage(a,n)}var o=Object.keys(t),r=Object.keys(this.protoExportBlob);if(!e.arrayEquals(o,r)){var a=e.getLocalizedValue("errors.import","Please pass in an acceptable JSON object created by the exportUserPreference function."),n={client:!0,disable:!0};return void virtualViewer.displayExceptionMessage(a,n)}if(this.exportVersion!=t.exportVersion){var a=e.getLocalizedValue("errors.exportVersion","Imported user preference version is out of date."),n={client:!0,disable:!0};return void virtualViewer.displayExceptionMessage(a,n)}this.username=t.username,this.defaultTab=t.defaultTab,this.panToolPreference=t.panToolPreference,this.audioPreferences=t.audioPreferences,this.videoPreferences=t.videoPreferences,this.zoomPreferences=t.zoomPreferences,this.imageControlToolbar=t.imageControlToolbar,this.annotationToolbar=t.annotationToolbar,i.setAllAnnotatonPreferences(t.annotationPreferences),this.noteTemplateArray=t.noteTemplateArray,this.customStampArray=t.customStampArray,this.updateDialog(),this.save()},function(){return s=s||new r}()}),define("vvMagnifier",["vvUtility","user-config/config","vvDefines","vvPoint","vvStateManager"],function(e,t,a,n,o){function i(){this.magnifierTemporarilyDisabled=!1,this.magnifierEnabled=!1,this.currentPage=null}var r,s=20;return i.prototype.getMagnifierEnabled=function(){return this.magnifierEnabled},i.prototype.setMagnifierEnabled=function(e){this.magnifierTemporarilyDisabled=!1,e&&virtualViewer.setActivePane(0),this.magnifierEnabled=e},i.prototype.initMagnifier=function(){var e=$("#vvMagnifierCanvas");e.hide(),e.css("left",t.magnifierDefaults.x),e.css("top",t.magnifierDefaults.y),e.width(t.magnifierDefaults.width),e.height(t.magnifierDefaults.height);var n=e[0].getContext("2d");if(n.canvas.width=t.magnifierDefaults.width,n.canvas.height=t.magnifierDefaults.height,"number"==typeof a.magnifierCloseButtonSize&&a.magnifierCloseButtonSize>=0){var o=t.collapseStickiesSize||50;s=Math.min(a.magnifierCloseButtonSize,o)}},i.prototype.toggleMagnifier=function(){this.setMagnifierEnabled(!this.magnifierEnabled),this.magnifierHandler(),this.adjustForWindowResize()},i.prototype.magnifierHandler=function(){var e=$("#vvMagnifierCanvas");this.magnifierEnabled?(e.show(),"hidden"===e.css("visibility")&&e.css("visibility","visible"),this.getMagnifiedImage(),this.paintMagnifierCanvas()):e.hide()},i.prototype.adjustForWindowResize=function(){if(this.magnifierEnabled||this.magnifierTemporarilyDisabled){var e=$("#vvImageCanvas"),t=$("#vvMagnifierCanvas"),a=e.width(),n=e.height(),o=t.width(),i=t.height();if(a<50||n<50||(o>$("#vvImagePanel").width()||i>$("#vvImagePanel").height())&&$("#vvThumbs:visible").length)return this.magnifierTemporarilyDisabled=!0,this.magnifierEnabled=!1,void this.magnifierHandler();this.magnifierTemporarilyDisabled&&(this.magnifierTemporarilyDisabled=!1,this.magnifierEnabled=!0,this.magnifierHandler()),o>a&&(o=Math.max(a/2,50),t.width(o),t[0].width=o),i>n&&(i=Math.max(n/2,50),t.height(i),t[0].height=i);var r=Math.max(parseInt(t.css("left"),10),0),s=Math.max(parseInt(t.css("top"),10),0);r+o>a&&(r=a-o),s+i>n&&(s=n-i),t.css({left:r,top:s})}},i.prototype.paintMagnifierCanvas=function(e){this.clearMagnifier(),null!==e&&e||(e=o.getCurrentState());var t=$("#vvMagnifierCanvas")[0],a=$("#vvDummyScroller"),i=$("#vvOuterDiv"),r=t.getContext("2d"),s=i.scrollLeft(),l=t.offsetLeft+t.width/2,u=t.offsetTop+t.height/2,d=new n(l,u),c=virtualViewer.getEventManager().clickPageFinder(e,d,!1);c===-1&&(c=e.pageNumber),this.getMagnifiedImage(e,c),c===this.currentPage&&null!==this.currentPage||(this.currentPage=c,this.getMagnifiedImage(e,c));var g,v=virtualViewer.scrollPageFinder(e,i,a),p=virtualViewer.scrollerToPaint(e,v,i,a);if(v!==c)for(g=e.getRequestedHeightForPage(v)-p;v<c-1;)v++,g+=e.getRequestedHeightForPage(v);else g=-p;var h=t.offsetLeft+s,m=t.offsetTop,f=e.getRotationForPage(c),y=e.getRequestedWidthForPage(c);90!==f&&270!==f||(y=e.getRequestedHeightForPage(c));var b=(i.width()-$("#vvDummyScroller").width())/2;b<0&&(b=0);var P=($("#vvDummyScroller").width()-y)/2,T=b+P,A=t.offsetLeft/(i.width()-t.scrollWidth)*(t.scrollWidth/2);h=h-T+A,m-=g;var I=h,S=m;90===f?(h=S,m=e.getRequestedHeightForPage(c)-I):180===f?(h=e.getRequestedWidthForPage(c)-I,m=e.getRequestedHeightForPage(c)-S):270===f&&(h=e.getRequestedWidthForPage(c)-S,m=I),this.drawMagnifiedImage(e,r,c,-h,-m,f)},i.prototype.clearMagnifier=function(){var e=$("#vvMagnifierCanvas")[0];e.width=e.width,e.height=e.height},i.prototype.getMagnifiedImage=function(e,t){return e=e||o.getCurrentState(),e.isMedia()?null:(t||0===t||(t=e.pageNumber),e.getImageManager().getBestImageFromPage(t))},i.prototype.drawMagnifiedImage=function(a,n,o,i,r,s){var l=this.getMagnifiedImage(a,o);if(null!==l&&void 0!==l){n.save();var u=Math.sin(e.degreesToRadians(s)),d=Math.cos(e.degreesToRadians(s));n.setTransform(d,u,-u,d,0,0);try{a.getSVGEnabledForPage()&&(a.getHorizontalFlipForPage()&&(n.translate(a.getRequestedWidthForPage(o),0),n.scale(-1,1)),a.getVerticalFlipForPage()&&(n.translate(0,a.getRequestedHeightForPage(o)),n.scale(1,-1))),n.fillStyle="#eeeeee",n.fillRect(-1e3,-1e3,5e3,5e3);var c=t.magnifierDefaults.zoomPercent/100,g=a.getRequestedWidthForPage(o)*c,v=a.getRequestedHeightForPage(o)*c;if(i*=c,r*=c,n.drawImage(l,i,r,g,v),a.getSVGEnabledForPage()&&a.getInvertImageForPage()){for(var p=n.getImageData(0,0,a.getRequestedWidthForPage(o),a.getRequestedHeightForPage(o)),h=p.data,m=0;m<h.length;m+=4)h[m]=255-h[m],h[m+1]=255-h[m+1],h[m+2]=255-h[m+2];n.putImageData(p,0,0)}}catch(e){console.log("exception: "+e)}n.restore(),this.drawResizeArea(n),this.drawCloseButton(n)}},i.prototype.drawResizeArea=function(t){t.fillStyle="#000000";var a=$("#vvMagnifierCanvas")[0],n=a.width,o=a.height,i=e.getNubSize();t.beginPath(),t.moveTo(n,o),t.lineTo(n-i,o),t.lineTo(n,o-i),t.lineTo(n,o),t.fill()},i.prototype.drawCloseButton=function(e){e.save(),e.fillStyle="#000000",e.beginPath(),e.moveTo(0,0),e.lineTo(s,0),e.lineTo(s,s),e.lineTo(0,s),e.lineTo(0,0),e.fill(),e.restore(),e.save(),e.fillStyle="#FFFFFF",e.font='20px "Arial"',e.font=s+'px "Arial"';var t=s/5;e.fillText("",t,s-t),e.restore()},i.prototype.isMagnifierAtPoint=function(e){var t;if(e.getX)t=e;else{if("number"!=typeof e.clientX)return;t=new n(e.clientX,e.clientY)}var a=$("#vvMagnifierCanvas"),o=a.offset();return t.getX()>o.left&&t.getX()<o.left+a.width()&&t.getY()>o.top&&t.getY()<o.top+a.height()},i.prototype.isCloseButtonAtPoint=function(e){var t;if(e.getX)t=e;else{if("number"!=typeof e.clientX)return;t=new n(e.clientX,e.clientY)}var a=$("#vvMagnifierCanvas"),o=a.offset();return t.getX()>o.left&&t.getX()<o.left+s&&t.getY()>o.top&&t.getY()<o.top+s},i.prototype.stretchMagnifier=function(e,a){var n=0,o=0,i=0,r=0,s=$("#vvMagnifierCanvas");e>$("#vvOuterDiv").width()?e=$("#vvOuterDiv").width():e<0&&(e=0),a>$("#vvOuterDiv").height()?a=$("#vvOuterDiv").height():a<0&&(a=0),n=s[0].offsetLeft,o=s[0].offsetTop;var l=t.collapseStickiesSize||50;if(i=Math.max(e-n,l),r=Math.max(a-o,l),i>0&&r>0){s.width(i),s.height(r);var u=s[0].getContext("2d");u.canvas.width=i,u.canvas.height=r}this.paintMagnifierCanvas()},function(){return r=r||new i}()}),define("vvDocumentNotes",["vvNoteBase"],function(e){function t(){var a=new e;t.prototype.getAbleToAddNote=function(){return a.ableToAddNote},t.prototype.setAbleToAddNote=function(e){a.ableToAddNote=e},t.prototype.getUsername=function(){return a.getUsername()},t.prototype.setUsername=function(e){a.setUsername(e)},t.prototype.addNewNote=function(){a.addNote("Document")},t.prototype.editNote=function(e){a.editNote(e,"Document")};var n=function(e){a.addExistingNote(e,"Document")};t.prototype.loadDocumentNotes=function(){$("#vvDocumentNotesInternal").empty();var e=virtualViewer.getCurrentState();if(e&&e.documentFullyLoaded()){var t=e.getDocumentModel();if(t.model.documentNotes){var a=t.model.documentNotes.notes;a.sort(function(e,t){return e=e.editDate?new Date(e.editDate):new Date(e.createDate),t=t.editDate?new Date(t.editDate):new Date(t.createDate),t-e});for(var o=0;o<a.length;o++)n(a[o]);a.length>0?$("#vvNotesTabSpan").addClass("docNotesExist"):$("#vvNotesTabSpan").removeClass("docNotesExist")}}},t.prototype.clearAllDocumentNotes=function(){for(var e=$("#vvDocumentNotesInternal")[0],t=e.children.length-1;t>=0;t--)$(e.children[t]).remove()},t.prototype.abilityToModifyNotes=function(e){var t;e===!0?($(".vvNotesCloseButton").click(function(){var e=this.parentElement.parentElement;if(e){var t=$(e).children().index(this.parentElement);$($(e).children()[t]).remove();var n=virtualViewer.getCurrentState(),o=n.getDocumentModel(),i=o.model.documentNotes.notes;i.splice(t,1),o.setNotesModifiedSinceInit(!0,n),a.setAbleToAddNote(!0)}}),t=document.getElementsByClassName("vvNote"),$(t).dblclick(function(){var e=$(this);a.getAbleToAddNote()&&virtualViewer.getDocumentNotes().editNote(e)})):($(".vvNotesCloseButton").off("click"),t=document.getElementsByClassName("vvNote"),$(t).off("dblclick"))}}return t}),define("vvClickEventManager",["vvUtility","user-config/config","vvDefines","vvPoint","vvAnnotationManager","vvStateManager","vvMagnifier","vvCallbackManager","vvTextUtility"],function(e,t,a,n,o,i,r,s,l){function u(){this.events=!1,this.dragging=!1,this.annDragging=!1,this.endPoint=0,this.selectTextDrag=!1,this.dragMode=a.dragModes.pan,this.dragStartLeft=null,this.dragStopLeft=null,this.dragStartTop=null,this.dragStopTop=null,this.overlayDragOffset=new n(0,0),this.annDragOffsetX=0,this.annDragOffsetY=0,this.errorTimeoutID=-1,this.annLineEnd=null,this.annCorner=null,this.magnifierCorner=null,this.moveTop=0,this.moveLeft=0,this.previousPinchDistance=1,this.panToolPreference=a.noPanTool}function d(){return c=c||new u}var c,g=null;u.prototype.setDragMode=function(e){this.dragMode=e},u.prototype.getDragMode=function(){return this.dragMode},u.prototype.setPanToolMode=function(e){"number"==typeof e&&(this.panToolPreference=e)},u.prototype.initEvents=function(e){e&&e.length||(e=$("#vvOuterDiv"));var t=e.find(".vvScroller");e.on("mousedown",h),e.on("mouseup",m),e.on("mousemove",f),e.on("mouseout",y),e.on("click",b),e.on("touchstart",P),e.on("touchmove",T),e.on("touchend",A),e.on("dblclick",I),t.on("contextmenu",S),this.events=!0},u.prototype.destroyEvents=function(e){e&&e.length||(e=$("#vvOuterDiv"));var t=e.find(".vvScroller");e.off("mousedown",h),e.off("mouseup",m),e.off("mousemove",f),e.off("mouseout",y),e.off("click",b),e.off("touchstart",P),e.off("touchmove",T),e.off("touchend",A),e.off("dblclick",I),t.off("contextmenu",S),this.events=!1},u.prototype.eventSwitch=function(e){if(!(e&&this.events||!e&&!this.events))return e&&!this.events?void this.initEvents():!e&&this.events?void this.destroyEvents():void 0},u.prototype.clean=function(){this.dragging=!1,this.selectTextDrag=!1,this.dragMode=a.dragModes.pan,this.dragStartLeft=null,this.dragStopLeft=null,this.dragStartTop=null,this.dragStopTop=null,this.endPoint=0,this.annDragOffsetX=0,this.annDragOffsetY=0},u.prototype.panMousedown=function(t){var n,s=t.currentTarget||t.target,l=$(s).closest(".split");if(l.length){var u="Split",d=l.attr("id").slice(u.length);virtualViewer.setActivePane(d)}if(n=i.getActivePaneState()){this.annDragging=!1;var c=0;virtualViewer.hideAnnPopUp(),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(c=1),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var g=$(s).find(".vvCanvas");g.length||(g=$(s).parent().find(".vvCanvas"));var v=$(g).offset().left+$(g).width(),p=$(g).offset().top+$(g).height();if(!(t.clientX>v||t.clientY>p)){var h=virtualViewer.getActiveOuterDiv(),m=h.find(".vvCanvas"),f=this.clickPointConverter(t),y=o.getAnnotationAtPoint(f,n),b=!0;y||(b=!1);var P=r.isMagnifierAtPoint(t);if(this.panToolPreference>0){if(t.button===c)return this.dragStartLeft=t.clientX,this.dragStartTop=t.clientY,P&&r.getMagnifierEnabled()?void this.autoSwitchToMagnifierMode(t):b?(e.cursorNormal(),virtualViewer.setCurrentAnnObject(y),void this.autoSwitchToMoveAnnotationMode(t)):virtualViewer.getIsAnnButtonSticky()?void this.autoSwitchToAnnotateMode(t):(this.currentDragMode!==a.dragModes.guides&&e.cursorGrabClosed(),this.moveTop=e.stripPx(m[0].style.top),this.moveLeft=e.stripPx(m[0].style.left),this.dragging=!0,!1)}else{if(P&&r.getMagnifierEnabled())return void this.autoSwitchToMagnifierMode(t);if(b)return virtualViewer.setCurrentAnnObject(y),void this.autoSwitchToMoveAnnotationMode(t);if(virtualViewer.getIsAnnButtonSticky())return void this.autoSwitchToAnnotateMode(t);if(virtualViewer.pageHasText())return void this.autoSwitchToSelectTextMode(t);this.moveTop=e.stripPx(m[0].style.top),this.moveLeft=e.stripPx(m[0].style.left)}}}},u.prototype.panMouseup=function(a){a.preventDefault(),a||(a=window.event),Modernizr.touchevents&&(a=this.fixTouchEvent(a));var n=i.getActivePaneState();if(n){this.dragging=!1,this.annDragging=!1,this.annCorner=null,this.annLineEnd=null;var r=this.clickPointConverter(a),s=o.getAnnotationAtPoint(r,n);s&&a.preventDefault(),virtualViewer.getCurrentAnnObject()!==s&&virtualViewer.hideAnnPopUp(),s?(e.cursorNormal(),virtualViewer.paintCanvases(),t.stickyAnnButtons[virtualViewer.getCurrentAnnType()]&&virtualViewer.getIsAnnButtonSticky()||virtualViewer.disableStickyAnnotationButton()):(this.panToolPreference>0&&e.cursorGrabOpen(),virtualViewer.hideAnnPopUp()),virtualViewer.getIsAnnButtonSticky()&&$(".selectedAnn").length&&virtualViewer.turnOnAnnotationButton(virtualViewer.getCurrentAnnType(),$(".selectedAnn"),!0)}},u.prototype.panMousemove=function(a){a||(a=window.event),virtualViewer.getCurrentAnnObject()||virtualViewer.hideAnnPopUp(),Modernizr.touchevents&&(a=this.fixTouchEvent(a));var n=i.getActivePaneState();if(n){if(n.getDocumentLinks()&&(this.panToolPreference>0&&this.dragging?e.cursorGrabClosed():this.panToolPreference>0?e.cursorGrabOpen():e.cursorNormal(),!this.dragging)){var o=this.clickPointConverter(a,n,!1);virtualViewer.overDocumentLink(o)&&e.cursorPointer()}var r=virtualViewer.getActiveOuterDiv(),s=r.find(".vvScroller");if(this.panToolPreference>0){var l=s.height(),u=s.width();if(this.dragging){var d=this.moveTop+(a.clientY-this.dragStartTop),c=this.moveLeft+(a.clientX-this.dragStartLeft);this.dragStartTop=a.clientY,this.dragStartLeft=a.clientX,u<r[0].clientWidth&&(c=r[0].clientWidth/2-u/2),l<r[0].clientHeight&&(d=r[0].clientHeight/2-l/2),t.invertedPanScrollY?r.scrollTop(r.scrollTop()-d):r.scrollTop(r.scrollTop()+d),t.invertedPanScrollX?r.scrollLeft(r.scrollLeft()-c):r.scrollLeft(r.scrollLeft()+c)}}}},u.prototype.panDoubleClick=function(e){this.panToolPreference>0&&(virtualViewer.horizontalGuide.visible||virtualViewer.verticalGuide.visible)&&(virtualViewer.enterGuideMode(),this.guideDoubleClick(e))},u.prototype.annotateMousedown=function(r){if(3!==r.which){r.preventDefault();var l=this.dragMode===a.dragModes.zoom,u=this.dragMode===a.dragModes.crop;if(!t.readOnlyAnnotationMode||l||u){$("#vvAnnPopUp").length&&(l||u)&&(virtualViewer.hideAnnPopUp(),virtualViewer.setCurrentAnnObject(null));var d=r.currentTarget||r.target,c=$(d).closest(".split");if(c.length){var g="Split",p=c.attr("id").slice(g.length);if(virtualViewer.setActivePane(p)&&virtualViewer.currentPreviewAnnObject&&this.dragging){if(virtualViewer.destroyInProgressAnnotation(),this.setDragMode(a.dragModes.pan),l){var h=i.getActivePaneState();s.call("zoomRubberbandError",{documentId:h.getDocumentId(),currentZoom:h.getZoom(),exceptionMessage:"A document pane came into focus while a draw operation was in progress. The zoom action has been cancelled to avoid error."})}else u&&s.call("cropDocumentError",{documentId:h.getDocumentId(),page:h.pageNumber,exceptionMessage:"A document pane came into focus while a draw operation was in progress. The crop action has been cancelled to avoid error."});return}}var m=this.isCurrentAnnPolygon(),h=i.getActivePaneState(),f=virtualViewer.getActiveOuterDiv(),y=f.find(".vvCanvas")[0],b=$(y).offset();if(v(r,$(y),b)){l?s.call("zoomRubberbandBegin",{documentId:h.getDocumentId(),currentZoom:h.getZoom()}):u&&s.call("cropDocumentBegin",{documentId:h.getDocumentId(),page:h.pageNumber});var P=this.clickPointConverter(r,h,null,b),T=h.pageNumber;if(h.isPageCropped(T)&&this.dragMode!==a.dragModes.crop&&this.dragMode!==a.dragModes.zoom){var A=e.getLocalizedValue("errors.cropBlock","Cannot Annotate on Crop Preview. Save the crop then Annotate."),I={client:!0,disable:virtualViewer.disableErrorModals.cropBlock};return virtualViewer.displayExceptionMessage(A,I),this.setDragMode(a.dragModes.pan),e.cursorNormal(),!1}if(virtualViewer.currentPointArray&&virtualViewer.currentPointArray.length&&virtualViewer.currentPointArray[0]||(virtualViewer.currentPointArray=[],this.endpoint=0),r||(r=window.event),Modernizr.touchevents&&(r=this.fixTouchEvent(r)),P.x<0||P.x>h.getRequestedWidthForPage(T)||P.y>h.getRequestedHeightForPage(T)||P.y<=0){if(l?s.call("zoomRubberbandError",{documentId:h.getDocumentId(),currentZoom:h.getZoom(),exceptionMessage:"The Rubberband Zoom box was initiated out of bounds of the page."}):u&&s.call("cropDocumentError",{documentId:h.getDocumentId(),page:h.pageNumber,exceptionMessage:"The crop rectangle was initiated out of bounds of the page."}),m)return;if(virtualViewer.getIsAnnButtonSticky()&&null===virtualViewer.getCurrentAnnObject())return;return e.cursorNormal(),virtualViewer.setDragMode(a.dragModes.pan),void(this.dragging=!1)}if(!l&&!u){var S=h.getUndoObject(T);S.referenceAnn=void 0,S.unchangedAnn=void 0,S.layer=o.getCurrentLayer()}if(this.dragStartLeft=P.getX(),this.dragStartTop=P.getY(),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp){var w=virtualViewer.createPreviewAnnotation(!0,T,h);virtualViewer.pageContainsAnnotations(h.getPageNumber())||virtualViewer.pageHasIndicator(h.getPageNumber())||(virtualViewer.showAnnotationIndicator(h.getPageNumber()),virtualViewer.addToPagesWithAnnotations(h.getPageNumber())),w.fixDimensionsForPage(),w.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,t.oneLayerPerAnnotation===!0&&virtualViewer.createAutoLayer();var C=o.addAnnotation(w);if(C){S.modifiedAnn=void 0,S.type="add",h.pushUndoObject(h.getPageNumber(),S);let e=virtualViewer.getCurrentAnnObject();virtualViewer.setCurrentAnnObject(C),s.call("annotationCreation",{documentId:h.getDocumentId(),annotationLayerId:C.layerName,annotationId:C.annId,type:C.getRefinedType(),createDate:C.getCreateDate()}),virtualViewer.setCurrentAnnObject(e)}virtualViewer.currentPointArray=[];var D=t.stickyAnnButtons[virtualViewer.getCurrentAnnType()];return D&&virtualViewer.getIsAnnButtonSticky()?(e.cursorAnnotate(),this.setDragMode(a.dragModes.annotate)):(e.cursorNormal(),this.setDragMode(a.dragModes.pan)),this.dragging=!1,virtualViewer.paintCanvases(),virtualViewer.createNavigationOptionsLabels(),!1}if(m){if(virtualViewer.currentPointArray[this.endPoint]=new n(this.dragStartLeft,this.dragStartTop),this.endPoint++,this.canEndCurrentPolygon(P))return;this.moveTop=e.stripPx(y.style.top),this.moveLeft=e.stripPx(y.style.left),this.dragging=!0}else virtualViewer.currentPointArray[0]=new n(this.dragStartLeft,this.dragStartTop),this.endPoint=1,this.moveTop=e.stripPx(y.style.top),this.moveLeft=e.stripPx(y.style.left),this.dragging=!0;return!1}}}},u.prototype.isValidAnnotateMouseUp=function(){return(!this.isCurrentAnnPolygon()||null!==virtualViewer.currentPointArray)&&(!(!t.enableSingleClickImageRubberStamp||virtualViewer.getCurrentAnnType()!==a.SANN_BITMAP)||!(!this.dragging&&!this.annDragging)&&(null!==virtualViewer.currentPointArray||null!==this.dragStartLeft||null!==this.dragStartTop))},u.prototype.annotateMouseup=function(n){if(3!==n.which){n.preventDefault();var r=i.getActivePaneState(),l=this.isCurrentAnnPolygon();if(this.isValidAnnotateMouseUp()){n||(n=window.event),Modernizr.touchevents&&(n=this.fixTouchEvent(n)),this.annDragging=!1,this.dragging=!1;var u=r.pageNumber,d=this.clickPointConverter(n,r,!1);if(d.x<0||d.x>r.getRequestedWidthForPage(u)||d.y>r.getRequestedHeightForPage(u)||d.y<=0){if(l)return void(this.dragging=!0);if(virtualViewer.getIsAnnButtonSticky()&&null===virtualViewer.getCurrentAnnObject()&&0===virtualViewer.currentPointArray.length)return}this.dragStopLeft=d.getX(),this.dragStopTop=d.getY(),this.limitRubberband();var c=virtualViewer.createPreviewAnnotation(!0,u,r),v=c.getType()===a.annotationTypes.SANN_POSTIT||c.getType()===a.annotationTypes.SANN_EDIT;if(c.getType()===a.annotationTypes.SANN_EDIT&&t.enableTextRubberStamp&&(g=virtualViewer.currentStamp,virtualViewer.currentStamp=null,c.isStamp=!0),l){var p=virtualViewer.currentPointArray[this.endPoint-1],h=this.canEndCurrentPolygon(d),m=!1;if(d.x>p.x-1&&d.x<p.x+1&&d.y>p.y-1&&d.y<p.y+1)m=!0;else{virtualViewer.currentPointArray[this.endPoint]=d,this.endPoint++;var f=e.getNubSize();null===virtualViewer.currentPointArray&&(this.annotateMousedown(n),m=!0),(d.x<virtualViewer.currentPointArray[0].getX()-f/2||d.x>virtualViewer.currentPointArray[0].getX()+f/2||d.y<virtualViewer.currentPointArray[0].getY()-f/2||d.y>virtualViewer.currentPointArray[0].getY()+f/2)&&(m=!0)}if(m&&!h)return void(this.dragging=!0)}if(c.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,!(c.box.getHeight()<2&&c.box.getWidth()<2)){if(t.oneLayerPerAnnotation===!0&&c.getType()!==a.annotationTypes.SANN_REDACTION_RECT&&virtualViewer.createAutoLayer(),null===virtualViewer.currentPointArray&&(virtualViewer.currentPointArray=[]),(c.getType()===a.annotationTypes.SANN_ARROW||c.getType()===a.annotationTypes.SANN_LINE)&&virtualViewer.currentPointArray.length<2)return virtualViewer.currentPointArray=[],!1;var y;if(c.getType()===a.annotationTypes.SANN_REDACTION_RECT){var b=r.getPageNumber(),P=o.getRedactionLayer(b);c.type=a.annotationTypes.SANN_RECTANGLE,y=o.addAnnotation(c,b,P)}else virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_BITMAP&&t.enableSingleClickImageRubberStamp||(y=o.addAnnotation(c));if(c.fitBoxToText(),virtualViewer.paintCanvases(),null!==y){var T=r.getUndoObject(r.getPageNumber());T.modifiedAnn=void 0,T.layer=o.getLayerWithAnn(c),T.type="add",r.pushUndoObject(r.getPageNumber(),T);let e=virtualViewer.getCurrentAnnObject();virtualViewer.setCurrentAnnObject(y),s.call("annotationCreation",{documentId:r.getDocumentId(),annotationLayerId:y.layerName,annotationId:y.annId,type:y.getRefinedType(),createDate:y.getCreateDate()}),virtualViewer.setCurrentAnnObject(e)}virtualViewer.currentPointArray=[],this.endPoint=0;var A=t.stickyAnnButtons[virtualViewer.getCurrentAnnType()],I=A&&virtualViewer.getIsAnnButtonSticky();return this.setDragMode(a.dragModes.pan),e.cursorNormal(),I||virtualViewer.disableStickyAnnotationButton(),t.immediatelyEditTextAnnotations&&v&&null!==y?(virtualViewer.setCurrentAnnObject(c),virtualViewer.annPopUpHandler(null,c),$("#vvAnnPopUpEditTextArea").focus().select()):I&&(g>-1&&(virtualViewer.currentStamp=g),e.cursorAnnotate(),this.setDragMode(a.dragModes.annotate)),t.showAnnNavToggle&&null!==y&&(virtualViewer.pageHasIndicator(u)||(virtualViewer.addToPagesWithAnnotations(r.pageNumber),virtualViewer.showAnnotationIndicator(r.pageNumber)),virtualViewer.createNavigationOptionsLabels(),"redaction"===$("input[name='radio']:checked").val()?virtualViewer.navigationButtonHandler(!0):virtualViewer.navigationButtonHandler(!1)),virtualViewer.currentPointArray&&(virtualViewer.currentPointArray=[],this.endpoint=0),!1}}}},u.prototype.annotateMousemove=function(e){e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var t=i.getActivePaneState();if(this.dragging===!0){var n=this.clickPointConverter(e,null,!1);if(this.dragStopLeft=n.getX(),this.dragStopTop=n.getY(),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_POSTIT){var o=Math.abs(this.dragStartLeft-this.dragStopLeft),r=Math.abs(this.dragStartTop-this.dragStopTop),s=1.25*virtualViewer.collapsedStickySize(t.getZoomDecimal());o<s&&(this.dragStopLeft<this.dragStartLeft?this.dragStopLeft=this.dragStartLeft-s:this.dragStopLeft=this.dragStartLeft+s),r<s&&(this.dragStopTop<this.dragStartTop?this.dragStopTop=this.dragStartTop-s:this.dragStopTop=this.dragStartTop+s)}e.shiftKey&&this.setDragStopForShiftLockDrawing(),this.limitRubberband(),n.setX(this.dragStopLeft),n.setY(this.dragStopTop),virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_FREEHAND?virtualViewer.currentPointArray[virtualViewer.currentPointArray.length]=n:virtualViewer.currentPointArray[this.endPoint]=n,virtualViewer.currentPointArray.length>1?virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1):virtualViewer.currentPreviewAnnObject=null,virtualViewer.paintCanvases()}return!1},u.prototype.setDragStopForShiftLockDrawing=function(){var e=Math.abs(this.dragStartLeft-this.dragStopLeft),t=Math.abs(this.dragStartTop-this.dragStopTop),n=Math.min(t,e);if(!(virtualViewer.currentPointArray.length>2)){if(virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_LINE||virtualViewer.getCurrentAnnType()===a.annotationTypes.SANN_ARROW)return void(n===e?this.dragStopLeft=this.dragStartLeft:this.dragStopTop=this.dragStartTop);this.dragStopTop<this.dragStartTop?this.dragStopTop=this.dragStartTop-n:this.dragStopTop=this.dragStartTop+n,this.dragStopLeft<this.dragStartLeft?this.dragStopLeft=this.dragStartLeft-n:this.dragStopLeft=this.dragStartLeft+n}},u.prototype.zoomMousemove=function(e){if(e||(e=window.event),this.dragging===!0){var t=this.clickPointConverter(e);this.dragStopLeft=t.getX(),this.dragStopTop=t.getY(),this.limitRubberband(),virtualViewer.currentPointArray[this.endPoint]=t;var a={isCrop:!1,isRubberbandZoom:!0};virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1,null,null,a),virtualViewer.paintCanvases()}return!1},u.prototype.zoomMouseup=function(n){var o=i.getActivePaneState(),r=o.getPageNumber(),l=virtualViewer.getActiveOuterDiv();n||(n=window.event);var u=this.dragMode===a.dragModes.zoom,d={isCrop:!1,isRubberbandZoom:u},c=virtualViewer.createPreviewAnnotation(!0,r,o,d);c.setPreview(!1),virtualViewer.currentPreviewAnnObject=null,virtualViewer.textSelectionAllowed()?this.setDragMode(a.dragModes.selectText):this.setDragMode(a.dragModes.pan),virtualViewer.currentPointArray=[],this.dragging=!1;var g=this.clickPointConverter(n,o,!1);if(this.isCurrentAnnPolygon()&&(g.x<0||g.x>o.getRequestedWidthForPage(r)||g.y>o.getRequestedHeightForPage(r)||g.y<=0))return void(this.dragging=!0);this.dragStopLeft=g.getX(),this.dragStopTop=g.getY(),this.limitRubberband();var v=Math.abs(this.dragStopTop-this.dragStartTop),p=Math.abs(this.dragStopLeft-this.dragStartLeft);if(o.getRequestedWidthForPage(r)<1||o.getRequestedHeightForPage(r)<1)return void s.call("zoomRubberbandError",{documentId:o.getDocumentId(),currentZoom:o.getZoom(),exceptionMessage:"An error has occurred and page dimensions appear to be less than one pixel."});if(0===p||0===v)return void s.call("zoomRubberbandError",{documentId:o.getDocumentId(),currentZoom:o.getZoom(),exceptionMessage:"The Rubberband Zoom box is too small."});var h,m=Math.min(this.dragStopTop,this.dragStartTop),f=Math.min(this.dragStopLeft,this.dragStartLeft),y=m/o.getRequestedHeightForPage(r),b=f/o.getRequestedWidthForPage(r),P=v,T=v/o.getRequestedHeightForPage(r),A=p;90!==o.getRotationForPage(r)&&270!==o.getRotationForPage(r)||(P=A,A=v,T=P/o.getRequestedWidthForPage(r)),h=P>=A?l.height()/P:l.width()/A;var I=o.getZoom(),S=Math.round(I*h);o.setZoomMode(a.zoomModes.fitCustom),S>(t.maxZoomPercent||500)&&(S=t.maxZoomPercent||500),o.setZoom(S),virtualViewer.zoomLoop(o),S=o.getZoom(),h=S/I;var w=o.getImageManager();w.scaleDocumentByPercentage(o.getZoomDecimal()),virtualViewer.sizeScroller({state:o});var C=b*o.getRequestedWidthForPage(r),D=virtualViewer.getScrollSpeed(o);180===o.getRotationForPage(r)?(y=1-y-T,C=o.getRequestedWidthForPage(r)-b*o.getRequestedWidthForPage(r),C-=A*h):90===o.getRotationForPage(r)?(C=o.getRequestedHeightForPage(r)-y*o.getRequestedHeightForPage(r),C-=A*h,y=b):270===o.getRotationForPage(r)&&(C=y*o.getRequestedHeightForPage(r),y=1-b-T);var M=virtualViewer.findPagePosition(r,o)+y*D;l.scrollLeft(0);var x=virtualViewer.getVisualPageLeft({page:r,state:o})+C;return virtualViewer.skipScrollEvent=!0,l.scrollLeft(x),l.scrollTop(M),virtualViewer.getIsAnnButtonSticky()&&virtualViewer.setCurrentAnnType(virtualViewer.getCurrentStickyAnnType()),s.call("zoomRubberband",{documentId:o.getDocumentId(),currentZoom:o.getZoom()}),this.endPoint=0,virtualViewer.currentPointArray=[],e.cursorNormal(),this.setDragMode(a.dragModes.pan),!1},u.prototype.documentLinkClick=function(e){l.clearDocumentLinkPopover();let t=i.getActivePaneState();if(t){let a=this.clickPointConverter(e),n=virtualViewer.overDocumentLink(a),o=t.getPageText(t.getPageNumber());n&&l.showDocumentLinkPopover({x:e.clientX,y:e.clientY},n,o)}},u.prototype.selectTextMousedown=function(t){var a=t.currentTarget||t.target,s=$(a).closest(".split");if("button"!==t.target.localName&&s.length){var l="Split",u=s.attr("id").slice(l.length);
virtualViewer.setActivePane(u)}var d=i.getActivePaneState();if(d){t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var c=$(virtualViewer.getActiveOuterDiv()),g=c.find(".vvCanvas"),v=g.offset().left+g.width(),p=g.offset().top+g.height();if(!(t.clientX>v||t.clientY>p)){var h=this.clickPointConverter(t),m=o.getAnnotationAtPoint(h,d);if(this.annDragging=!1,this.dragging=!1,r.getMagnifierEnabled()&&r.isMagnifierAtPoint(t))return void this.autoSwitchToMagnifierMode(t);if(m)return e.cursorNormal(),virtualViewer.setCurrentAnnObject(m),void this.autoSwitchToMoveAnnotationMode(t);var f=!1,y=!1;switch(t.which){case 1:f=!0;break;case 2:break;case 3:y=!0}f&&(this.selectTextDrag=!0,virtualViewer.selectTextStartPoint=new n(h.x/d.getRequestedWidthForPage(d.pageNumber),h.y/d.getRequestedHeightForPage(d.pageNumber)),virtualViewer.selectTextEndPoint=new n(h.x/d.getRequestedWidthForPage(d.pageNumber),h.y/d.getRequestedHeightForPage(d.pageNumber)),virtualViewer.paintCanvases(d))}}},u.prototype.selectTextMousemove=function(t){this.selectTextDrag&&this.selectTextDragUpdate(t);let a=i.getCurrentState(0);if(i.getCurrentState(1)){let e=$(t.target).closest(".split");"Split1"===e.attr("id")&&(a=i.getCurrentState(1))}if(a&&a.getDocumentLinks()){e.cursorNormal();var n=this.clickPointConverter(t,a,!1);virtualViewer.overDocumentLink(n)&&e.cursorPointer()}},u.prototype.selectTextDragUpdate=function(e){e||(e=window.event);var t=this.clickPointConverter(e),a=i.getActivePaneState();virtualViewer.selectTextEndPoint=new n(t.x/a.getRequestedWidthForPage(a.pageNumber),t.y/a.getRequestedHeightForPage(a.pageNumber)),virtualViewer.paintCanvases()},u.prototype.selectTextMouseup=function(){if((this.annDragging||this.selectTextDrag||this.dragging)&&(this.annDragging=this.dragging=!1,virtualViewer.paintCanvases(),this.selectTextDrag=!1,s.callbackExists("textSelect"))){var e={text:virtualViewer.getUserFriendlySelectedText()};s.call("textSelect",e)}if(virtualViewer.getIsAnnButtonSticky())return void($(".selectedAnn").length&&virtualViewer.turnOnAnnotationButton(virtualViewer.getCurrentAnnType(),$(".selectedAnn"),!0))},u.prototype.annotationMoveMousedown=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=i.getActivePaneState();if(3!==e.which){e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e));var a=this.clickPointConverter(e,t);if(r.getMagnifierEnabled()&&r.isMagnifierAtPoint(e))return void this.autoSwitchToMagnifierMode(e);var n=o.getAnnotationAtPoint(a,t);if(virtualViewer.getCurrentAnnObject()!==n&&virtualViewer.hideAnnPopUp(),!n)return virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null),this.autoSwitchToPanMode(e),virtualViewer.delayedPaintCanvases(),!1;n!==virtualViewer.getCurrentAnnObject()&&virtualViewer.setCurrentAnnObject(n);var s=n.getBoundingBox(n.collapsed);n.slope=s.getSlope();var l=n.getPointRotatedForAnn(a),u=l.getX(),d=l.getY(),c=n.getWidthRatio(),g=n.getHeightRatio(),v=o.getLayerWithAnn(n),p=t.getUndoObject(t.getPageNumber());p.referenceAnn=n,p.unchangedAnn=n.clone(),p.layer=v,this.checkAnnotationMinimize(n,l)||(this.annDragOffsetX=u-n.box.one.getX()*c,this.annDragOffsetY=d-n.box.one.getY()*g,this.annDragging=!0,n.useLineResize()?this.annLineEnd=n.findLineEndpoint(l,c,g):n.collapsed||(this.annCorner=s.findCorner(l,c,g),this.annCorner&&o.markLayerWithAnnDirty(n)))}},u.prototype.annotationMoveMousemove=function(e){if(e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.annDragging){var t=virtualViewer.getCurrentAnnObject();if(!t)return;var a=this.clickPointConverter(e,null,!1),r=t.getPointRotatedForAnn(a),s=r.getX(),l=r.getY(),u=new n(s-this.annDragOffsetX,l-this.annDragOffsetY),d=new n(s,l),c=i.getActivePaneState(),g=t.pageWidth*t.getWidthRatio(c),v=t.pageHeight*t.getHeightRatio(c);u.getX()<0?u=new n(0,u.getY()):u.getX()+t.box.getWidth()*t.getWidthRatio()>g&&(u=new n(g-t.box.getWidth()*t.getWidthRatio(),u.getY())),u.getY()<0?u=new n(u.getX(),0):u.getY()+t.box.getHeight()*t.getHeightRatio()>v&&(u=new n(u.getX(),v-t.box.getHeight()*t.getHeightRatio())),d.getX()<0?d=new n(0,d.getY()):d.getX()>g&&(d=new n(g,d.getY())),d.getY()<0?d=new n(d.getX(),0):d.getY()>v&&(d=new n(d.getX(),v));var p=!1;p=null!==this.annCorner||null!==this.annLineEnd?t.useLineResize()?t.stretchLine(this.annLineEnd,d.getX(),d.getY()):t.stretch(this.annCorner,d.getX(),d.getY(),e.shiftKey):t.move(u),c.getNewAnnList().indexOf(t)!==-1||c.getTrueAnnChange()||c.setTrueAnnChange(!0),virtualViewer.hideAnnPopUp(),p&&(t.markRevised(),o.markLayerWithAnnDirty(t),virtualViewer.paintCanvases())}},u.prototype.annotationMoveMouseup=function(t){if(t.preventDefault(),(0!==$("#vvAnnPopUp").filter(":hidden").length||this.annDragging)&&virtualViewer.getCurrentAnnObject()){var n=i.getActivePaneState();t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t)),this.annDragging=!1,this.annCorner=null,this.annLineEnd=null,virtualViewer.getCurrentAnnObject()&&virtualViewer.getCurrentAnnObject().fixBoundingBox();var r=virtualViewer.getCurrentAnnObject(),s=o.getLayerWithAnn(r),l=n.getDocumentModel().getAnnotationsModifiedSinceInit(),u=n.getUndoObject(n.getPageNumber());u.modifiedAnn=r.clone(),u.layer=s,u.type="modify",r&&l&&r.markRevised(),u.modifiedAnn.isSameAs(u.unchangedAnn)||u.unchangedAnn&&n.pushUndoObject(n.getPageNumber(),u),n.resetUndoObject(),o.checkLayerPermission(o.getCurrentLayer(),a.permissionLevels.PERM_EDIT)===!1&&(alert(e.getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer.")),virtualViewer.undoAnnotation()),this.setDragMode(a.dragModes.pan),virtualViewer.paintCanvases()}},u.prototype.magnifierMousedown=function(t){t.preventDefault();var a=i.getActivePaneState();if(a){t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var o=$("#vvMagnifierCanvas"),s=o.offset();virtualViewer.hideAnnPopUp(),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var l=r.isMagnifierAtPoint(t);if(!l)return virtualViewer.paintCanvases(),this.autoSwitchToPanMode(t),!1;this.dragStartLeft=t.clientX,this.dragStartTop=t.clientY;var u=new n(s.left+o[0].width,s.top+o[0].height),d=e.getNubSize();this.annDragOffsetX=this.dragStartLeft-s.left,this.annDragOffsetY=this.dragStartTop-s.top,this.dragging=!0,this.dragStartLeft>u.x-2*d&&this.dragStartLeft<u.x+2*d&&this.dragStartTop>u.y-2*d&&this.dragStartTop<u.y+2*d&&(this.magnifierCorner=3)}},u.prototype.magnifierMouseup=function(e){return e.preventDefault(),e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.dragging=!1,this.magnifierCorner=null,this.setDragMode(a.dragModes.pan),r.isCloseButtonAtPoint(e)?void r.toggleMagnifier():void virtualViewer.paintCanvases()},u.prototype.magnifierMousemove=function(e){e.preventDefault();var t=$("#vvMagnifierCanvas"),a=$("#vvImageCanvas");if(e||(e=window.event),Modernizr.touchevents&&(e=this.fixTouchEvent(e)),this.dragging){var o=e.clientX,i=e.clientY,s=a.offset(),l=new n(o-this.annDragOffsetX,i-this.annDragOffsetY),u=new n(o,i),d=a.width(),c=a.height();l.x=Math.max(l.x,s.left),l.x+t.width()>d+s.left&&(l.x=d-t.width()+s.left),l.y=Math.max(l.y,s.top),l.y+t.height()>c+s.top&&(l.y=c-t.height()+s.top),u.x=Math.max(u.x,s.left),u.x=Math.min(u.x,d+s.left),u.y=Math.max(u.y,s.top),u.y=Math.min(u.y,c+s.top),null!==this.magnifierCorner||null!==this.annLineEnd?r.stretchMagnifier(u.x-s.left,u.y-s.top):(t.css("left",l.x-s.left),t.css("top",l.y-s.top)),virtualViewer.hideAnnPopUp(),r.paintMagnifierCanvas()}},u.prototype.cropMousemove=function(e){var t=i.getActivePaneState();if(e||(e=window.event),this.dragging===!0){var a=this.clickPointConverter(e);this.dragStopLeft=a.getX(),this.dragStopTop=a.getY(),this.limitRubberband(),virtualViewer.currentPointArray[this.endPoint]=a;var n={isCrop:!0,isRubberbandZoom:!1};virtualViewer.currentPreviewAnnObject=virtualViewer.createPreviewAnnotation(!1,t.getPageNumber(),t,n),virtualViewer.paintCanvases(t)}},u.prototype.cropMouseup=function(t){var n=i.getActivePaneState();t.preventDefault(),t||(t=window.event),Modernizr.touchevents&&(t=this.fixTouchEvent(t));var o=this.clickPointConverter(t,n,!1);this.dragging=!1,this.dragStopLeft=o.getX(),this.dragStopTop=o.getY(),this.limitRubberband();var r=Math.abs(this.dragStartLeft-this.dragStopLeft),s=Math.abs(this.dragStartTop-this.dragStopTop);(r>=2||s>=2)&&this.dragStartLeft>0&&this.dragStartTop>0&&(virtualViewer.showCropDialog(n),this.setDragMode(a.dragModes.pan),e.cursorNormal(),virtualViewer.currentPreviewAnnObject=null,virtualViewer.currentPointArray=[])},u.prototype.guideMousedown=function(t){t||(t=window.event);var n=1;if($(t.target).closest("#vvOuterDiv").length&&(n=0),virtualViewer.setActivePane(n),this.dragging=!1,e.cursorGuides(),(virtualViewer.horizontalGuide.locked||!virtualViewer.horizontalGuide.visible)&&(virtualViewer.verticalGuide.locked||!virtualViewer.verticalGuide.visible)){Modernizr.touchevents&&(t=this.fixTouchEvent(t));var i=this.clickPointConverter(t),r=o.isAnnotationAtPoint(i);if(r)return e.cursorNormal(),void this.setDragMode(a.dragModes.pan);if(this.panToolPreference>0)return void this.panMousedown(t)}virtualViewer.updateGuidePositions(t),virtualViewer.horizontalGuide.locked=virtualViewer.horizontalGuide.visible,virtualViewer.verticalGuide.locked=virtualViewer.verticalGuide.visible,virtualViewer.paintCanvases()},u.prototype.guideMouseup=function(e){this.dragging=!1},u.prototype.guideDoubleClick=function(t){e.cursorGuides(),this.getDragMode()===a.dragModes.guides&&(virtualViewer.horizontalGuide.locked=!1,virtualViewer.verticalGuide.locked=!1,virtualViewer.updateGuidePositions(t),virtualViewer.paintCanvases())},u.prototype.guideMousemove=function(t){return!virtualViewer.horizontalGuide.locked&&virtualViewer.horizontalGuide.visible||!virtualViewer.verticalGuide.locked&&virtualViewer.verticalGuide.visible||!this.dragging?(e.cursorGuides(),void virtualViewer.updateGuidePositions(t)):(this.setDragMode(a.dragModes.pan),e.cursorGrabClosed(),void this.panMousedown(t))},u.prototype.overlayMousedown=function(e){e||(e=window.event);var t=1;$(e.target).closest("#vvOuterDiv").length&&(t=0),virtualViewer.setActivePane(t);var a=i.getActivePaneState(),o=a.getImageManager();if(!o.overlayImage)return void this.autoSwitchToPanMode(e);r.isMagnifierAtPoint(e)&&this.autoSwitchToMagnifierMode(e);var s=!1,l=!1;switch(e.which){case 1:s=!0;break;case 2:break;case 3:l=!0}if(l)return void this.autoSwitchToPanMode(e);if(s){this.dragging=!0;var u=this.clickPointConverter(e);this.dragStartLeft=u.getX(),this.dragStartTop=u.getY();var d=this.clickPageFinder(a,new n(e.clientX,e.clientY)),c=o.getOverlayOffsetForPage(d);if(c){var g,v=a.getRequestedWidthForPage(d)/o.overlayImage.width,p=a.getRequestedHeightForPage(d)/o.overlayImage.height;g=v<p?v:p,this.overlayDragOffset.x=this.dragStartLeft/g-c.offsetX,this.overlayDragOffset.y=this.dragStartTop/g-c.offsetY}}},u.prototype.overlayMouseup=function(e){this.dragging=!1},u.prototype.overlayMousemove=function(e){if(this.dragging){var t=i.getActivePaneState(),a=t.getImageManager(),o=this.clickPointConverter(e);this.dragStopLeft=o.getX(),this.dragStopTop=o.getY();var r=this.clickPageFinder(t,new n(e.clientX,e.clientY)),s=a.getOverlayOffsetForPage(r);if(s){var l,u=a.overlayImage,d=t.getRequestedWidthForPage(r)/u.width,c=t.getRequestedHeightForPage(r)/u.height;l=d<c?d:c,s.offsetX=this.dragStopLeft/l-this.overlayDragOffset.x,s.offsetY=this.dragStopTop/l-this.overlayDragOffset.y,virtualViewer.paintCanvases()}}},u.prototype.checkAnnotationMinimize=function(e,n){if(e.getType()!==a.annotationTypes.SANN_POSTIT)return!1;var o=i.getActivePaneState(),r=n.getX(),s=n.getY(),l=e.getBoundingBox(e.collapsed),u=l.getX2()*e.getWidthRatio(),d=l.getY1()*e.getHeightRatio(),c=e.getMinimizeButtonSize(o);if(!c)return!1;var g=c+Math.ceil(t.annotationDefaults.stickyMargin*o.getZoomDecimal());return r>=u-g&&r<=u&&s>=d&&s<=d+g&&(e.collapsed=!e.collapsed,virtualViewer.paintCanvases(),!0)},u.prototype.fixTouchEvent=function(e){if(Modernizr.touchevents){e&&e.originalEvent&&(e=e.originalEvent);var t=e.changedTouches,a=!1;t&&t.length>0?(e=t[0],a=!0):e.gesture&&e.gesture.touches&&e.gesture.touches.length>0&&(t=e.gesture.touches,t&&t.length>0&&(e=t[0],a=!0)),a&&(e.button=0,e.preventDefault=function(){},e.stopPropagation=function(){})}return e};var v=function(e,t,a){return!(e.clientX<a.left||e.clientX>a.left+t.width())&&!(e.clientY<a.top||e.clientY>a.top+t.height())};u.prototype.limitRubberband=function(){var e=i.getActivePaneState();this.dragStopLeft>e.getRequestedWidthForPage(e.pageNumber)?this.dragStopLeft=e.getRequestedWidthForPage(e.pageNumber):this.dragStopLeft<0&&(this.dragStopLeft=0),this.dragStopTop>e.getRequestedHeightForPage(e.pageNumber)?this.dragStopTop=e.getRequestedHeightForPage(e.pageNumber):this.dragStopTop<0&&(this.dragStopTop=0)},u.prototype.clickPointConverter=function(e,t,a,o){if(t=t||i.getActivePaneState(),!t||!t.pageStates)return null;a!==!1&&(a=!0),o=o||i.getOuterDivFromState(t).find(".vvCanvas").offset();var r=new n(e.clientX-o.left,e.clientY-o.top),s=this.clickPageFinder(t,r);s===-1&&(s=t.pageNumber||0),s<t.pageCount&&s>=0&&s!==t.pageNumber&&this.dragging===!1&&"mousemove"!==e.type&&"mouseout"!==e.type&&a&&virtualViewer.updatePage(s,t);var l=this.globalPosToLocalPos(r,t.pageNumber,t),u=t.getRotationForPage(t.pageNumber),d=this.rotateLocalizedPoint(l,u);return d},u.prototype.findPos=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);var n=virtualViewer.getActiveOuterDiv();return a-=n.scrollTop(),t-=n.scrollLeft(),[t,a]},u.prototype.clickPageFinder=function(e,n,o,r){if(e=e||i.getActivePaneState(),o=o||virtualViewer.getActiveOuterDiv(),r=r||o.find(".vvScroller"),e.isMedia())return-1;var s=virtualViewer.scrollPageFinder(e,o,r),l=virtualViewer.getVisualPageTop({page:s,state:e,currentZeroPage:s}),u=s+t.continuousScrollBufferAfterSize;u||0===u||(u=s+3);var d;u>=e.getPageCount()&&(u=e.getPageCount()-1);for(var c,g=s;g<=u;g++){if(d=e.getRotationForPage(g)||0,c=0===d||180===d?l+e.getRequestedHeightForPage(g):l+e.getRequestedWidthForPage(g),c+=a.spaceBetweenPages,n.y<=c&&n.y>=l)return g;l=c}return-1},u.prototype.rotateLocalizedPoint=function(e,t,a){var o,r=i.getActivePaneState();if(!r||!r.documentFullyLoaded())return e;a||(a=r.pageNumber),t||(t=r.getRotationForPage(a));var s=r.getRequestedWidthForPage(a),l=r.getRequestedHeightForPage(a);return o=0===t?e:90===t?new n(e.y,l-e.x):180===t?new n(s-e.x,l-e.y):new n(s-e.y,e.x)},u.prototype.autoSwitchToSelectTextMode=function(e){this.setDragMode(a.dragModes.selectText),this.selectTextMousedown(e)},u.prototype.autoSwitchToMoveAnnotationMode=function(e){t.readOnlyAnnotationMode||(this.setDragMode(a.dragModes.moveAnnotation),this.annotationMoveMousedown(e))},u.prototype.autoSwitchToAnnotateMode=function(e){t.readOnlyAnnotationMode||(this.setDragMode(a.dragModes.annotate),this.annotateMousedown(e))},u.prototype.autoSwitchToPanMode=function(e){this.setDragMode(a.dragModes.pan),this.panMousedown(e)},u.prototype.autoSwitchToMagnifierMode=function(e){this.setDragMode(a.dragModes.magnifier),this.magnifierMousedown(e)},u.prototype.canEndCurrentPolygon=function(t){var a=e.getNubSize();return t.x>virtualViewer.currentPointArray[0].getX()-a/2&&t.x<virtualViewer.currentPointArray[0].getX()+a/2&&t.y>virtualViewer.currentPointArray[0].getY()-a/2&&t.y<virtualViewer.currentPointArray[0].getY()+a/2&&this.endPoint>1},u.prototype.isCurrentAnnPolygon=function(){var e=virtualViewer.getCurrentAnnType();return e===a.annotationTypes.SANN_POLYGON||e===a.annotationTypes.SANN_FILLED_POLYGON},u.prototype.localPosToGlobalPos=function(e,t,a){a=a||i.getActivePaneState();var o=e[1];o||(o=e.getY());var r=e[0];r||(r=e.getX());var s=i.getOuterDivFromState(a).find(".vvCanvas"),l=s.offset(),u=virtualViewer.getVisualPageTop({page:t,state:a}),d=virtualViewer.getVisualPageLeft({page:t,state:a});return r=r+d+l.left,o=o+u+l.top,new n(r,o)},u.prototype.globalPosToLocalPos=function(e,t,a){if(a=a||i.getActivePaneState()){var o=e[1];o||(o=e.getY());var r=e[0];r||(r=e.getX()),t=t||a.pageNumber;var s=virtualViewer.getVisualPageTop({page:t,state:a}),l=virtualViewer.getVisualPageLeft({page:t,state:a});return r-=l,o-=s,new n(r,o)}};var p=function(e,t){e!==a.dragModes.annotate&&e!==a.dragModes.moveAnnotation||self.autoSwitchToPanMode(t)},h=function(e){var n=d(),o=n.getDragMode();t.readOnlyAnnotationMode&&p(o,e),o===a.dragModes.pan?n.panMousedown(e):o===a.dragModes.annotate?n.annotateMousedown(e):o===a.dragModes.moveAnnotation?n.annotationMoveMousedown(e):o===a.dragModes.zoom?n.annotateMousedown(e):o===a.dragModes.selectText?n.selectTextMousedown(e):o===a.dragModes.guides?n.guideMousedown(e):o===a.dragModes.magnifier?n.magnifierMousedown(e):o===a.dragModes.crop?n.annotateMousedown(e):o===a.dragModes.overlay&&n.overlayMousedown(e),"Explorer"===BrowserDetect.browser&&2===e.button&&S(e)},m=function(e){var n=d(),o=n.getDragMode();t.readOnlyAnnotationMode&&p(o,e),o===a.dragModes.pan?n.panMouseup(e):o===a.dragModes.annotate?n.annotateMouseup(e):o===a.dragModes.moveAnnotation?n.annotationMoveMouseup(e):o===a.dragModes.zoom?n.zoomMouseup(e):o===a.dragModes.selectText?n.selectTextMouseup(e):o===a.dragModes.guides?n.guideMouseup(e):o===a.dragModes.magnifier?n.magnifierMouseup(e):o===a.dragModes.crop?n.cropMouseup(e):o===a.dragModes.overlay&&n.overlayMouseup(e)},f=function(e){var n=d(),o=n.getDragMode();t.readOnlyAnnotationMode&&p(o,e),o===a.dragModes.pan?n.panMousemove(e):o===a.dragModes.annotate?n.annotateMousemove(e):o===a.dragModes.moveAnnotation?n.annotationMoveMousemove(e):o===a.dragModes.zoom?n.zoomMousemove(e):o===a.dragModes.selectText?n.selectTextMousemove(e):o===a.dragModes.guides?n.guideMousemove(e):o===a.dragModes.magnifier?n.magnifierMousemove(e):o===a.dragModes.crop?n.cropMousemove(e):o===a.dragModes.overlay&&n.overlayMousemove(e)},y=function(e){var t=d(),n=t.getDragMode();n===a.dragModes.pan},b=function(e){var t=d(),n=t.getDragMode();switch(n){case a.dragModes.selectText:e=t.fixTouchEvent(e),t.documentLinkClick(e);break;case a.dragModes.pan:let o=i.getActivePaneState();o&&o.getDocumentLinks()&&(e=t.fixTouchEvent(e),t.documentLinkClick(e))}},P=function(e){var t=d(),n=t.getDragMode();return n===a.dragModes.pan?(e=t.fixTouchEvent(e),void t.panMousedown(e)):(e.preventDefault(),e=t.fixTouchEvent(e),void(n===a.dragModes.annotate?t.annotateMousedown(e):n===a.dragModes.zoom?t.annotateMousedown(e):n===a.dragModes.moveAnnotation?t.annotationMoveMousedown(e):n===a.dragModes.magnifier?t.magnifierMousedown(e):n===a.dragModes.crop&&t.annotateMousedown(e)))},T=function(e){var t=d(),n=t.getDragMode();n===a.dragModes.pan?(e=t.fixTouchEvent(e),t.panMousemove(e)):n===a.dragModes.annotate?(e=t.fixTouchEvent(e),t.annotateMousemove(e)):n===a.dragModes.zoom?(e=t.fixTouchEvent(e),t.zoomMousemove(e)):n===a.dragModes.moveAnnotation?(e=t.fixTouchEvent(e),t.annotationMoveMousemove(e)):n===a.dragModes.magnifier?(e.preventDefault(),e=t.fixTouchEvent(e),t.magnifierMousemove(e)):n===a.dragModes.crop&&(e=t.fixTouchEvent(e),t.cropMousemove(e))},A=function(e){var t=d(),n=t.getDragMode();e=t.fixTouchEvent(e),n===a.dragModes.pan?t.panMouseup(e):n===a.dragModes.annotate?t.annotateMouseup(e):n===a.dragModes.moveAnnotation?t.annotationMoveMouseup(e):n===a.dragModes.magnifier?t.magnifierMouseup(e):n===a.dragModes.crop?t.cropMouseup(e):n===a.dragModes.zoom&&t.zoomMouseup(e)},I=function(e){var t=d(),n=t.getDragMode();n===a.dragModes.pan?t.panDoubleClick(e):n===a.dragModes.guides&&t.guideDoubleClick(e)},S=function(e){var t=d();Modernizr.touchevents&&(e=t.fixTouchEvent(e));var a=i.getActivePaneState(),n=virtualViewer.getAnnClipboard();a&&n&&(n.pasteLocation=t.clickPointConverter(e,a,!0))};return d()}),define("vvStampManager",["vvUtility","user-config/config","vvDefines","user-config/toolbar-config"],function(e,t,a,n){function o(e){this.stampArray=[],this.currentImageRubberStamp=-1}return o.prototype.checkStampIntegrity=function(e){return!!e&&(!(!e.stampTitle||"string"!=typeof e.stampTitle)&&!!e.stampData)},o.prototype.getCurrentStamp=function(){return this.stampArray[this.currentImageRubberStamp]},o.prototype.pushStamp=function(e){return!!this.checkStampIntegrity(e)&&(this.stampArray.push(e),!0)},o.prototype.createStampObject=function(t,a,n){if(!t||!a){var o={client:!1,disable:virtualViewer.disableErrorModals.stamp||!1},i=e.getLocalizedValue("errors.stampCreationFailure","Unable to create ImageStamp, invalid URL or title.");return virtualViewer.displayExceptionMessage(i,o),null}var r={},s=document.createElement("canvas"),l=s.getContext("2d"),u=new Image;return u.src=t,u.crossOrigin="Anonymous",u.onload=function(){if(!u.complete)return null;if(!e.validImageObject(u))return null;r.stampWidth?s.width=r.stampWidth:r.stampWidth=s.width=u.width,r.stampHeight?s.height=r.stampHeight:r.stampHeight=s.height=u.height;try{l.drawImage(u,0,0,r.stampWidth,r.stampHeight);var t=s.toDataURL();r.stampData=t.substr(t.indexOf(",")+1)}catch(e){return null}},r.stampData=u,r.stampTitle=a,n&&(r.stampWidth=n.width,r.stampHeight=n.height,r.annotationId=n.annotationId),r},o.prototype.processStampArray=function(e){for(var t=[],a=0;a<e.length;a++){var n=e[a],o=this.createStampObject(n.url,n.stampTitle,{width:n.width,height:n.height,annotationId:n.annotationId});null!==o&&t.push(o)}return t},o.prototype.pushStampArray=function(e){if(!e)return!1;if(!e.length)return this.pushStamp(e),!0;for(var t=0;t<e.length;t++)this.pushStamp(e[t]);return!0},o.prototype.setStampArray=function(e){for(var t=0;t<e.length;t++)if(!this.checkStampIntegrity(e[t]))return!1;this.stampArray=e},o.prototype.clearStampArray=function(){this.stampArray=[]},o.prototype.clearStampDropdown=function(){$(".vvAnnImageRubberStamp ul.dropdown-menu").empty().hide(),$(".vvAnnImageRubberStamp.vvHasSubDropdown").removeClass("vvHasSubDropdown"),this.clearStampArray()},o.prototype.createStampDropdown=function(e){if(n(virtualViewer).annotationToolbarButtons.vvAnnImageRubberStamp){if("Explorer"===BrowserDetect.browser&&BrowserDetect.version<9||!e||!e.length)return void $(".vvAnnImageRubberStamp").attr("aria-disabled","true");$(".vvAnnImageRubberStamp ul.dropdown-menu").empty(),$(".vvAnnImageRubberStamp.vvHasSubDropdown").removeClass("vvHasSubDropdown"),this.addStampsToDropdown(e)}},o.prototype.addStampsToDropdown=function(e){var t=this;if(e){e.length||0===e.length||(e=[e]),(this.stampArray.length||e.length)&&$(".vvAnnImageRubberStamp").addClass("vvHasSubDropdown");var n;this.stampArray.length&&(n={startIndex:this.stampArray.length},Array.isArray(e)||(e=[e]));var o=$.templates("#vvStampDropdownItemTemplate"),i=$(o.render(e,n));i.appendTo(".vvAnnImageRubberStamp ul.dropdown-menu"),$(".vvAnnImageRubberStamp ul.dropdown-menu li").unbind("click"),$(".vvAnnImageRubberStamp ul.dropdown-menu li").on("click",function(){var e=$(this).data("stamp-row-index");t.currentImageRubberStamp=e,virtualViewer.turnOnAnnotationButton(a.annotationTypes.SANN_BITMAP,$(".vvAnnImageRubberStamp")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()}),this.pushStampArray(e),$(".vvAnnImageRubberStamp ul.dropdown-menu").css("display")&&$(".vvAnnImageRubberStamp ul.dropdown-menu").css("display","")}},o}),define("vvPreviewAnnotation",["vvDefines","vvUtility","annotations","vvBoundingBox","vvNoteBase"],function(e,t,a,n,o){"use strict";function i(){}return i.prototype=a.prototype,i.prototype.initPreview=function(a,i,r,s,l,u,d,c){this.type=a.type,this.isHighlight=a.refinedType===e.annotationTypes.SANN_HIGHLIGHT_RECT,this.lineColor=a.lineColor,this.fillColor=a.fillColor,this.opacity="undefined"==typeof a.fillOpacity?1:a.fillOpacity,this.doubleByte=s,this.docDPI=l||72,this.isIDM=u,this.fontName=a.fontFace||null,this.fontSize=0,this.fontBold=a.fontBold||!1,this.fontItalic=a.fontItalic||!1,this.fontStrike=a.fontStrike||!1,this.fontUnderline=a.fontUnderline||!1,this.fontColor=a.fontColor||null,a.fontSize&&this.setFontSize(a.fontSize),a.textString&&this.setTextString(a.textString),a.lineWidth?this.setLineWidthInPoints(a.lineWidth):this.setLineWidthInPixels(1),this.page=d,this.box=i,this.preview=!0,this.annDelete=!1,this.index=-1,this.rotationAngle=0,this.xmlRotate=0,this.wrappedText=[],this.revisionHistory=[],this.currentRevision={},this.createDate=t.toSnowDateString(new Date),this.createUser=c,this.markRevised(null,this.createDate),this.type===e.unsupportedAnnotationTypes.SANN_CIRCLE&&(this.box=new n(i.getX1(),i.getY1(),i.getWidth(),i.getWidth())),r&&(this.pointArray=r,this.fixBoundingBox()),this.annotationTags=[],this.notes=new o,this.noteArray=[]},i}),define("vvScreenReaderManager",["vvUtility","user-config/config","vvTextUtility"],function(e,t,a){function n(){o=this,this.startedPlaying=!1,this.buttonClicked="",this.speechNextPage=!1,this.speechPreviousPage=!1,this.documentIdToBeRead=""}var o;n.prototype.setStartedPlaying=function(e){this.startedPlaying=e},n.prototype.getStartedPlaying=function(){return this.startedPlaying},n.prototype.setButtonClicked=function(e){this.buttonClicked=e},n.prototype.getButtonClicked=function(){return this.buttonClicked},n.prototype.setSpeechNextPage=function(e){this.speechNextPage=e},n.prototype.getSpeechNextPage=function(){return this.speechNextPage},n.prototype.setSpeechPreviousPage=function(e){this.speechPreviousPage=e},n.prototype.getSpeechPreviousPage=function(){return this.speechPreviousPage},n.prototype.setDocumentIdToBeRead=function(e){this.documentIdToBeRead=e},n.prototype.getDocumentIdToBeRead=function(){return this.documentIdToBeRead};var i=function(e){var t=virtualViewer.getActivePaneState();if(t&&virtualViewer.pageHasText())return s(t)},r=function(e){var t=e.join("");return t};n.prototype.setUpScreenReaderDiv=function(e){if(e&&e.getPageCount()){this.setDocumentIdToBeRead(e.getDocumentId());var a=e.getPageNumber(),n=t.continuousScrollBufferBeforeSize||1,o=t.continuousScrollBufferAfterSize||3,i=a-n;i<0&&(i=0);var r=a+o;r>e.pageCount&&(r=e.pageCount);let d=$("#vvScreenReaderDiv").children().length;d&&d===e.getPageCount()||($("#vvScreenReaderDiv").empty(),u(e));for(var s=i;s<=r;s++)virtualViewer.pageHasText(s)&&this.addPageTextToSRDiv(e,s);for(var l=0;l<e.getPageCount();l++)virtualViewer.pageHasText(l)&&(l<i||l>r)&&this.addPageTextToSRDiv(e,l)}},n.prototype.addPageTextToSRDiv=function(e,t){let n=e.getDocumentLinks(t);if(!n)return void l(s(e,t),t);let o=[],i=0,r=e.getPageText(t);if(r&&r.wordRects&&r.wordRects.length){let s=r.wordRects,l=0,u=document.createElement("textarea"),d="",c=$("#p"+t);for(;l<s.length;){for(;i<n.length&&(!n[i].words||!n[i].words.length);)i++;if(!n[i]||n[i]&&l<n[i].words[0])o.push(s[l].word),l++;else{d=o.join(""),u.innerHTML=d,c.append(u.value),o=[];let r=i,g=function(){virtualViewer.focusLink(r,t,e)},v=function(){virtualViewer.isFocusedLink(r,t,e)&&virtualViewer.clearFocusedLink()},p=a.getLinkHtml(n[i],s);p.on("focus",g),p.on("blur",v),c.append(p);let h=n[i].words;l=h[h.length-1]+1,i++}}d=o.join(""),u.innerHTML=d,c.append(u.value)}};var s=function(e,t){return e&&e.getPageText(t)?a.wordRectsToPageString(e.getPageText(t).wordRects):""},l=function(e,t){var a=$("#p"+t);a.length&&a.text(e)},u=function(e){var t=e.getPageCount(),a=document.createDocumentFragment();for(let n=0;n<t;n++){var o="p"+n;$(o).length||$("<p>",{text:"",id:o,tabindex:-1}).appendTo($(a))}$("#vvScreenReaderDiv").append(a)};return n.prototype.playSpeechSynthesisForPage=function(t){var a=virtualViewer.getActivePaneState(),n=t||a.getPageNumber(),s=window.speechSynthesis,l=[],u=e.getLocalizedValue("thumbPageLabel","Page ");l.push(u+(n+1)+", "),l.push(i(n));var d=r(l),c=new window.SpeechSynthesisUtterance(d);window.utterances=[],window.utterances.push(c),c.onend=function(){o.startedPlaying&&(n>=a.getPageCount()-1?o.stopSpeech():("next"===o.buttonClicked?o.speechNextPage||virtualViewer.nextPage():"previous"===o.buttonClicked?o.speechPreviousPage||virtualViewer.previousPage():virtualViewer.nextPage(),o.playSpeechSynthesisForPage(a.getPageNumber())))},s.cancel(),s.speak(c)},n.prototype.stopSpeech=function(){o.startedPlaying=!1,o.buttonClicked="",window.speechSynthesis.cancel()},n}),define("webviewer",["require","vvUtility","vvPoint","vvDocViewStateElement","vvDefines","vvBoundingBox","user-config/config","user-config/toolbar-config","vvAnnotationManager","vvStateManager","vvSearchManager","vvHotkeys","vvDocTabs","vvTextUtility","vvFullThumbManager","vvWatermarks","vvUserPreferences","vvAnnotationPreferences","vvThumbs","vvMagnifier","vvLayerManager","vvDocViewState","vvDocumentNotes","vvDialogs","vvClickEventManager","vvBookmarks","vvStampManager","vvPreviewAnnotation","annotations","vvCallbackManager","vvPrintManager","vvScreenReaderManager","vvColorpicker"],function(e,t,a,n,o,i,r,s,l,u,d,c,g,v,p){function h(){URI.escapeQuerySpace=!1,M=this,this.currentStamp=null,this.documentList=[],this.recentlyViewedList=[],this.newRecentlyViewedList=[],this.viewerSessionID="",this.scrollingLocked=!1,this.zoomLocked=null,this.imageBufferTop=[],this.redactionWarningShown=!1,this.pageManipulationsEnabled=!0,this.annotationsEnabled=!0,this.redactionsEnabled=!0,this.ocrEnabled=!1,this.disableUploadDocument=null,this.overrideLoggingLevel=!1,this.verticalGuide={locked:!1,visible:!1,value:0},this.horizontalGuide={locked:!1,visible:!1,value:0},this.currentPointArray=[],this.clientInstanceId=null,this.disableErrorModals=r.disableErrorModals||{}}function m(){var e=null;return e=r.zoomLevels?r.zoomLevels:o.defaultZoomLevels}function f(e){for(var t=m(),a=0;a<t.length;a++){var n=t[a];if(n>e)return n}return t[t.length-1]}function y(e){for(var t=m(),a=t.length-1;a>-1;a--){var n=t[a];if(n<e)return n}return t[0]}function b(e){var t=["documentId","documentDisplayName","documentByteSize","pageCount","documentFormat"],a=$.inArray(e,t)>-1;return a}function P(e,t){var a,n;if("pageCount"===e)return t.getPageCount();if("documentDisplayName"===e)return t.getDisplayName();if("documentByteSize"===e){var o=t.getDocumentByteSize();return o&&(o=o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),o}if("documentId"===e)return t.getDocumentId();if("dpi"===e)return t.getDPIForPage(t.pageNumber);if("compressionType"===e){var i=t.getCompressionTypeForPage(t.pageNumber);return i||(i="N/A"),i}if("bitDepth"===e)return t.getBitDepthForPage(t.pageNumber);if("pageNumber"===e)return t.pageNumber+1;if("documentFormat"===e)return t.getFormatForPage(t.pageNumber);if(0===e.indexOf("tiffTag")){var r=t.getTiffTag(t.pageNumber,e);return r?T(e,r):"N/A"}if("imageSizePixels"===e)return a=t.getOriginalWidthForPage(t.pageNumber),n=t.getOriginalHeightForPage(t.pageNumber),""+a+" x "+n;if("imageSizeInches"===e){var s=t.getDPIForPage(t.pageNumber);a=t.getOriginalWidthForPage(t.pageNumber),n=t.getOriginalHeightForPage(t.pageNumber);var l=a/s,u=n/s;return""+l.toFixed(2)+" x "+u.toFixed(2)+" inches"}}function T(e,t){var a=o.tiffTagValueHash[e];if(a){var n=a[t];if(n)return n}return t}function A(e){var t=r.maxInfoFieldLength||128,a=""+e;return a.length<t?a:jQuery.trim(a).substring(0,t)+"..."}function I(e){""!==$.trim(e)&&($("#vvClipboardTextarea").html(e),$("#vvClipboard").modal("show"),$("#vvClipboard").focus(function(e){$("#vvClipboardTextarea").select()}))}function S(e,t,a,n){var o=.7,i=o,r=2,s=a.top-t.top,l=t.bottom-t.top,u=Math.floor(s/(l*i)),d=0;if(a.left<t.left&&(d=1),u=Math.max(u,d),u=Math.min(u,r),u!==1/0)for(var c=0;c<u;c++)e.push("\n");return e}function w(e,t,a){var n=.355,o=t.bottom-t.top,i=o*n,r=t.left,s=r-a,l=Math.round(s/i);if(i>0)for(var u=0;u<l;u++)e.push(" ");return e}function C(e,t,a){var n=.1272,o=.355,i=a.top-t.top,r=a.bottom-t.bottom,s=t.bottom-t.top,l=a.bottom-a.top,u=Math.min(s,l),d=u*n,c=(u*o).toFixed(6),g=Math.floor(i/u),v=Math.floor(r/u);if(g>0&&v>0)return e;var p=t.right,h=a.left,m=h-p,f=0;if(c>0&&m>d){f=1;var y=Math.round((m-2.6*d)/c);f+=y}else f=0;for(var b=0;b<f;b++)e.push(" ");return e}function D(e){if(!(virtualViewer.verticalGuide.locked&&virtualViewer.horizontalGuide.locked||(e||(e=window.event),
Z.getDragMode()!==o.dragModes.guides))){var t=u.getCurrentState(0),n=$(e.target).closest(".vvOuter");"vvSplit1Panel"===n.attr("id")&&(t=u.getCurrentState(1));var i=n.find(".vvCanvas").offset(),r=i.top,s=i.left,l=new a(e.clientX,e.clientY-r),d=Math.max(Z.clickPageFinder(t,l,n),0);if(virtualViewer.verticalGuide.locked||(virtualViewer.verticalGuide.value=Math.max(e.clientX-s,1)),!virtualViewer.horizontalGuide.locked){var c=virtualViewer.getVisualPageTop({page:d,state:t}),g=l.getY()-c;virtualViewer.horizontalGuide.value=Math.max(g,1)}M.paintCanvases()}}var M,x=!1,L=null,N=null,V=0,k=0,F=0,R=0,B=0,E=null,O=null,_=null,U=null,z=null,W=null,H=null,j=!1,Q=null,q=null,G=null,Y=null,X=null,Z=null,K=null,J=null,ee=null,te=null,ae=[],ne=!1,oe=!1,ie=0,re=0,se=0,le=0,ue=0,de=null,ce=null,ge=!1,ve=null,pe=r.guideLineWidth||2,he=r.activeGuideColor||"#000099",me=r.lockedGuideColor||"#990000",fe={width:0,height:0},ye=r.panIncrement||30;h.prototype.isInitialized=function(){return!!(q&&X&&this.initializationComplete)},h.prototype.init=function(a){if(this.isInitialized())return void console.error("VirtualViewer has already been initialized.");window.addEventListener("message",Ae,!1),Pe(),c.initializeHotkeys(),this.getServerConfig(),$("[data-localize]").localize("vv",o.localizeOptions);var n=o.localizeOptions.language||navigator.language;t.isValidISOCode(n)&&$("html").prop("lang",n),$.views.converters("decodeUri",function(e){return decodeURIComponent(e)}),$.views.helpers({localize:t.getLocalizedValue,escapeSingleQuotes:function(e){return"string"==typeof e?e.replace(/'/g,"&apos;"):e},placeholderizeWatermarkText:function(e){var a=e.replace(/@@[A-Z]+@@/gi,function(e){var a=e.replace(/@/g,"");return"["+t.getLocalizedValue("watermarksDialog.editText."+a,a)+"]"});return a.length>45&&(a=a.substr(0,45)+"..."),a}}),M.pageManipulationsEnabled=r.pageManipulations,this.initToolbar(),be(),L=this.getScrollbarWidth(),this.validateZoomLevels();var i=document.getElementById("vvOuterDiv");$("[title]").each(function(e){var t=$(this).attr("title");t=$("<div />").html(t).text(),$(this).attr("title",t)}),$("#vvBookmarks").contextmenu(function(){return!1}),De(),X=e("vvMagnifier"),X.initMagnifier(),M.checkPageManipulationsEnabled()&&(o.cacheBuster=!0),document.body.onmousedown=function(e){if(1===e.button)return!1},"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(o.cacheBuster=!0),Y=new(e("vvDocumentNotes")),Q=new(e("vvBookmarks")),Z=e("vvClickEventManager"),K=e("vvCallbackManager"),J=new(e("vvStampManager")),ee=new(e("vvScreenReaderManager")),Z.initEvents(),K.init(),q=e("vvUserPreferences"),q.init(),G=e("vvAnnotationPreferences"),Modernizr.touchevents&&(this.turnOnPanTool(o.panToolPref.panToolWithoutScrollbars),$(document).on("orientationchange",function(){e("vvThumbs").loadVisibleThumbs()}),Te()),$e(),Oe(),We(),Qe(),d.prepareSearch(),Ye(),Xe(),Ke(),Je(),tt(),ke(),Ue(),Bt(),qa(),t.enableTooltips(),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvImageCanvas").contextMenu("vvSelectTextContextMenu",at):$("#vvDummyScroller").contextMenu("vvSelectTextContextMenu",at),et(),this.setDragMode(o.dragModes.pan),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&$(i).on("dragstart",function(){return!1}),$("body").on("contextmenu",function(e){e.target&&"VIDEO"===e.target.tagName||e.target&&"internalDocumentLink"===e.target.id&&$(e.target).hasClass("allowBrowserContextMenu")||e.preventDefault()}),$("body").click(function(e){var t=$(e.target);t.hasClass("vvOuter")||t.hasClass("vvScroller")||t.hasClass("vvInner")||t.hasClass("vvCanvas")||v.clearDocumentLinkPopover()}),$("body").click(function(e){var t=$(e.target);t.hasClass("email-attachment-btn")||t.hasClass("vvEmailAttachmentIcon")||$(".email-attachment-menu").hide().attr("aria-expanded","false")}),$("body").click(function(e){var t=u.getCurrentState(0);if(t){var a=t.getDocumentModel();if(a){var n=$(e.target);if(!(n.hasClass("vvToolbarItem")||n.hasClass("toolbar-icon")||n.hasClass("vvToolbarItemName"))){var o=$("#okCancelDialog").data("bs.modal");if(!o||!o.isShown){var i=$("#vvLayerManagerDiv:visible, #vvUserPreferencesDialog:visible");if(!i.length&&"modal"!==n.attr("data-dismiss")){var r=n.parent();"modal"===r.attr("data-dismiss")||r.hasClass("modal-footer")||0===n.closest(".thumbPanel").length&&a.clearPageSelection()}}}}}}),$("#vvAnnButtonContainer button").on("click",function(){var e=u.getCurrentState(0);if(e){var t=e.getDocumentModel();t&&t.clearPageSelection()}}),$("#vvPageThumbs").scroll(ia),$("#vvDocThumbs").scroll(ia),$("#vvSearch").scroll(ia),$("#vvDocumentNotes").scroll(ia),this.viewerSessionID=t.vvGUID(),document.addEventListener("dragend",function(){virtualViewer.dragging=!1,oa()}),$(document).bind("drag",oa),document.addEventListener("drop",function(e){e.preventDefault(),oa()}),$(window).resize(M.processWindowResize),$("#vvOuterDiv").on("scroll",function(e){var t=M.getCurrentState();t&&(M.paintCanvases(t),0===M.getActivePane()||virtualViewer.scrollingLocked||M.setActivePane(0))}),$("#vvOuterDiv").on("scroll",function(){var e=M.getCurrentState();if(e&&!virtualViewer.skipScrollEvent){var t=Xt(e);e.getPageNumber()!==t&&t<e.pageCount&&t>=0&&M.updatePage(t,e)}else virtualViewer.skipScrollEvent=!1}),$("#vvOuterDiv").on("scroll",function(){if(virtualViewer.scrollingLocked){var e=$("#Split1 .vvOuter");if(e.length){var t=$(this);de&&clearTimeout(de),de=setTimeout(function(){xa(t,e)},5),Math.abs($(this).scrollTop()-le)>=100&&xa(t,e)}}});var s=J.processStampArray(r.initialStamps||[]);J.addStampsToDropdown(s),r.showDocThumbnails!==!0&&r.showPageThumbnails!==!0||this.requestDocumentList(),a&&this.openInTab(M.getDocumentId(0)),r.unsavedChangesNotification&&$(window).bind("beforeunload",function(){for(var e=u.getAllStates(),a=0;a<e.length;a++){var n=e[a].getDocumentModel();if(n.getModifiedSinceInit())return t.getLocalizedValue("browserClose.message","You have unsaved changes in this session.")}}),$("#vvNavOptions").on("change",function(){if("redaction"===$("input[name='radio']:checked").val()){$("#vvAnnotationThumbsButton").prop("disabled",!0).addClass("disabled");var e=At(!0);0===e.length?Dt():(Mt(),M.navigationButtonHandler(!0))}else{var t=M.pagesWithAnnotations();$("#vvAnnotationThumbsButton").prop("disabled",!1).removeClass("disabled");var a=At(!1);0===a.length?Dt():t.length<=1?($("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled")):(Mt(),M.navigationButtonHandler(!1))}}),$("#vvPrevAnnotationButton").on("click",function(e){M.navigationChangeHandler(e)}),$("#vvNextAnnotationButton").on("click",function(e){M.navigationChangeHandler(e)}),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$(window).bind("beforeunload",function(){ee.getStartedPlaying()&&(ee.stopSpeech(),M.toggleSpeechControls())}),$("#vvScreenReaderDiv").on("focus",function(){var e=M.getCurrentState();if(e){var t=$("#vvScreenReaderDiv").find("#p"+e.getPageNumber());t.focus(),$("#vvOuterDiv").addClass("vvScreenReaderActive")}}),$("#vvScreenReaderDiv").on("focusout",function(){$("#vvOuterDiv").removeClass("vvScreenReaderActive")}),$("a.skip").on("click",function(e){e.preventDefault(),$("#vvScreenReaderDiv").focus(),$("#vvOuterDiv").addClass("vvScreenReaderActive")}),Ie(),this.initializationComplete=!0},h.prototype.initViaURL=function(){if(this.isInitialized())return void console.error("VirtualViewer has already been initialized.");vt();var e=gt("documentId");e&&M.setDocumentId(e),"string"!=typeof this.getClientInstanceId()&&this.setClientInstanceId(this.parseClientInstanceId());var t=gt("openerHistoryBack");"true"===t&&window.opener.history.back(1),this.init(!0);var a=gt("pageNumber");a&&window.setTimeout(function(){virtualViewer.setPage(+a)},400)},h.prototype.initSpecifiedDocuments=function(e){if(this.isInitialized())return void console.error("VirtualViewer has already been initialized.");for(var t=0;t<e.length;t++)this.documentList[t]={},e[t].documentId?(this.documentList[t].documentId=e[t].documentId,this.documentList[t].displayName=e[t].displayName):(this.documentList[t].documentId=e[t],this.documentList[t].displayName=null);var a=gt("openerHistoryBack");"true"===a&&window.opener.history.back(1),this.init(!1),this.documentList[0]&&this.openInTab(this.documentList[0].documentId)},h.prototype.openSpecifiedDocuments=function(e){for(var t=e||this.documentList,a=r.maxNumberOfTabs||10,n=Math.min(t.length,a),o=0;o<n;o++)if(t[o].documentId){if(e&&t[o].displayName){var i=this.indexInDocumentList(t[o].documentId);this.documentList[i].displayName=t[o].displayName}this.openInTab(t[o].documentId)}else this.openInTab(t[o])};var be=function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){for(var a=t||0,n=this.length;a<n;a++)if(this[a]===e)return a;return-1})},Pe=function(){var e,t;r.disableToolbarHamburger?(e="#bootstrapHamburger",t="#toolbarHamburger"):(e="#bootstrapHamburgerless",t="#toolbarHamburgerless"),$(e).attr("disabled","disabled"),$(t).attr("disabled","disabled")},Te=function(e){var t;t=e?e.find(".vvScroller")[0]:$("#vvDummyScroller")[0];var a=new Hammer(t);a.get("pinch").set({enable:!0}),a.on("doubletap",function(e){var t=virtualViewer.getCurrentAnnObject();t&&M.annPopUpHandler(null,t)}),a.get("press").set({enable:!0,threshold:4}),a.on("press",function(e){var t=virtualViewer.getCurrentAnnObject();t||$(e.target).trigger($.Event("contextmenu",{pageX:e.center.x,pageY:e.center.y,clientX:e.center.x,clientY:e.center.y}))}),a.on("pinchin",function(e){var t=e.pointers[0].clientX-e.pointers[1].clientX,a=e.pointers[0].clientY-e.pointers[1].clientY;Z.previousPinchDistance=Math.sqrt(Math.pow(t,2)+Math.pow(a,2))}),a.on("pinchout",function(e){var t=e.pointers[0].clientX-e.pointers[1].clientX,a=e.pointers[0].clientY-e.pointers[1].clientY;Z.previousPinchDistance=Math.sqrt(Math.pow(t,2)+Math.pow(a,2))}),a.on("pinchmove",function(e){var t=u.getActivePaneState(),a=t.getZoomDecimal(),n=e.pointers[0].clientX-e.pointers[1].clientX,o=e.pointers[0].clientY-e.pointers[1].clientY,i=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),r=i/Z.previousPinchDistance;if(!(r>.98&&r<1.02)){Z.previousPinchDistance=i;var s=r*a,l={clientX:e.center.x,clientY:e.center.y},d=Z.clickPointConverter(l,t,!1);d.x=d.x*r,d.y=d.y*r,virtualViewer.zoomToLocation(100*s,d.x,d.y)}})},Ae=function(e){var a,n=t.getLocalizedValue("errors.malformedJsonInMessage","VirtualViewer received an invalid command.");try{a=JSON.parse(e.data)}catch(e){return console.error(n),Promise.resolve(e)}switch(a.method){case"openInTab":virtualViewer.openInTab(a.id||a.documentId);case"compareDocuments":virtualViewer.compareDocuments(a.firstDocumentId,a.secondDocumentId,a.options);default:return Promise.resolve(e)}},Ie=function(){if(r.disableImageTabs&&($("#vvImageTabs").remove(),$("#vvSplitPaneDiv").addClass("hiddenImageTabs")),r.disableToolbar){let e=$("#vvToolbar");e.find(".vvImageToolbarGroup").remove(),e.hasClass("vvHamburgerSize")||(e.hide(),$("#vvImageAndThumbs").addClass("disabledToolbar"))}if(r.disableAnnToolbar){let e=$("#vvAnnToolbar");e.find(".vvAnnotationToolbarGroup").remove(),$("#vvAnnToolbarHamburgerItems").remove(),e.hasClass("vvHamburgerSize")||(e.hide(),$("#vvImageAndThumbs").addClass("disabledAnnToolbar"))}};h.prototype.getOriginalPageDimensions=function(){if(!sn({state:!0}))return{};var e=M.getActivePaneState(),t=virtualViewer.scrollPageFinder(e),a=e.getOriginalHeightForPage(t),n=e.getOriginalWidthForPage(t);return{height:a,width:n}},h.prototype.splitScreen=function(a,n){if(!r.splitScreen){var i=t.getLocalizedValue("errors.splitScreenDisabled","Document Comparison has been disabled by the administrator."),s={client:!0,disable:this.disableErrorModals.splitScreen};return void ft(i,s)}if(sn({notVideo:!0})){n=n||"horizontal";var l=1,d=u.getOpenDocumentId(l),c=u.getCurrentState(0);if(!c){var i=t.getLocalizedValue("error.splitNotAllowed","Please open a document before entering compare document mode."),s={client:!0,disable:M.disableErrorModals.splitScreen};return void ft(i,s)}var g=M.getFromDocumentList(a);if(!g){var i=t.getLocalizedValue("errors.documentNotFound","Document not found: ")+a,s={client:!0,disable:M.disableErrorModals.documentNotFound};return void M.displayExceptionMessage(i,s)}if(t.mediaExtensionCheck(g.documentId)||t.mediaExtensionCheck(c.documentId)||t.mediaExtensionCheck(g.displayName)||t.mediaExtensionCheck(c.getDisplayName())){var i=t.getLocalizedValue("errors.splitMediaError","Document comparison is unsupported for video and audio files."),s={client:!0,disable:M.disableErrorModals.splitScreen};return void M.displayExceptionMessage(i,s)}M.destroyInProgressAnnotation(),d&&(u.getStateForDocumentId(d,l).setClosedTab(!0),u.removeStateForDocumentId(d,l)),oe||(Se(n),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvSplitCanvas").contextMenu("vvSelectTextContextMenu",at):$("#vvSplitScroller").contextMenu("vvSelectTextContextMenu",at),$("#vvSplit1Panel").on("scroll",function(){var e=u.getCurrentState(1);e&&(M.paintCanvases(e),0!==M.getActivePane()||M.scrollingLocked||M.setActivePane(1))}),$("#vvSplit1Panel").on("scroll",function(){var e=u.getCurrentState(1);if(e&&!virtualViewer.skipScrollEvent){var t=Xt(e,!1,"#vvSplit1Panel");e.getPageNumber()!==t&&t<e.pageCount&&t>=0&&M.updatePage(t,e)}else virtualViewer.skipScrollEvent=!1}),$("#vvSplit1Panel").on("scroll",function(){if(virtualViewer.scrollingLocked){var e=$("#Split0 .vvOuter");if(e.length&&(e.scrollTop()!==$(this).scrollTop()||e.scrollLeft()!==$(this).scrollLeft())){var t=$(this);de&&clearTimeout(de),de=setTimeout(function(){xa(t,e,!0)},5),Math.abs($(this).scrollTop()-re)>=100&&xa(t,e,!0)}}}),Z.initEvents($("#vvSplit1Panel")),"Explorer"===BrowserDetect.browser&&BrowserDetect.version>8&&BrowserDetect.version<=11?$("#vvSplitCanvas").bind("contextmenu",M.annPopUpHandler):$("#vvSplitScroller").bind("contextmenu",M.annPopUpHandler),Modernizr.touchevents&&Te($("#vvSplit1Panel")));var v=u.openNewState({documentId:a,pageNumber:0,zoomMode:q.getDefaultZoomMode(),paneIndex:l,displayName:g.displayName});null===this.zoomLocked&&(this.zoomLocked=r.zoomLock!==!1),u.setDisplayedState(v,l),oe=!0,M.setActivePane(l),v.setClosedTab(!1),this.zoomLocked?c.getZoomMode()===o.zoomModes.fitCustom?(v.setZoom(c.getZoom()),v.setZoomMode(o.zoomModes.fitCustom)):v.setZoomMode(c.getZoomMode()):(v.setZoomMode(q.getDefaultZoomMode()),v.setZoom(q.getDefaultZoomLevel())),Z.setDragMode(o.dragModes.pan),Yt(v),v.requestDocumentModel(!1),r.multipleDocMode===o.multipleDocModes.viewedDocuments&&e("vvThumbs").loadVisibleThumbs($("#vvDocThumbs")),virtualViewer.paintCanvases(v),X.getMagnifierEnabled()&&(X.toggleMagnifier(),X.initMagnifier(),X.toggleMagnifier()),virtualViewer.sizeScroller({state:u.getCurrentState(0)}),u.getCurrentState(0).isMedia()&&u.getCurrentState(0).getMediaManager().resizeMedia(),M.lockScrolling(r.splitScrollLock),M.getUserPreferences().applyPanToolPreference(),K.call("onSplitScreenComplete",{documentId:v.getDocumentId(),paneIndex:v.currentPaneIndex})}};var Se=function(e){for(var a,n,o,i=r.screenSizes||[50,50],s=i.length,l=[],d=$("#vvSplitPaneDiv"),c=0;c<s;c++)a="#Split"+c,l.push(a);for(c=0;c<l.length;c++)n=$("<div></div>").attr("id",l[c].replace("#","")).addClass("split split-"+e+" vvActivePane"),d.append(n);if(0!==l.length){var g=Split(l,{sizes:r.screenSizes||[50,50],direction:e,onDrag:virtualViewer.paintCanvases});u.setSplit(g),$("#Split0").append($("#vvOuterDiv")),o=$("<div></div>").addClass("vvOuter"),o.attr("id","vv"+l[1].replace("#","")+"Panel"),$(o).width($("#Split1").width()),$(o).height($("#Split1").height()),$("#Split1").append(o);var v=$("<div></div>");$(v).attr("id","vvSplitScroller"),$(v).addClass("vvScroller"),$(o).append(v);var p=$("<div></div>");$(p).attr("id","vvInnerSplitDiv"),$(p).addClass("vvInner"),$(o).append(p);var h=$("<canvas></canvas>");$(h).attr("id","vvSplitCanvas"),$(h).addClass("vvCanvas"),$(p).append(h);var m=$("<button id='vvSplitCloseButton'><span id='vvSplitCloseX' aria-hidden='true' class='close'>&times;</span>&nbsp;</button>").append($("<span id='vvSplitCloseText'></span>").text(t.getLocalizedValue("closeSplitButton.buttonText","Close"))).on("click",function(){var e=u.getCurrentState(1);if(e){var t=e.documentModel;t.getModifiedSinceInit()?M.confirmCloseDialog(e):M.undoSplitScreen()}});m.appendTo(v)}};h.prototype.removeUndoSplit=function(){$("#vvSplitCloseButton").remove(),$("#vvUndoSplitPane").remove()},h.prototype.indexInDocumentList=function(e){for(var t=this.documentList,a=0;a<t.length;a++)if(t[a].documentId===e)return a;return-1},h.prototype.isInDocumentList=function(e){return!!virtualViewer.getFromDocumentList(e)},h.prototype.getFromDocumentList=function(e){for(var t=this.documentList,a=0;a<t.length;a++)if(t[a].documentId===e)return t[a];return null},h.prototype.isOnImage=function(e){var t=u.getActivePaneState(),a=t.getPageNumber(),n=t.getRequestedWidthForPage(a);return!(e.x<0||e.x>n)},h.prototype.getSplitDocumentId=function(){return u.getOpenDocumentId(1)},h.prototype.getActivePane=function(){return ie},h.prototype.setActivePane=function(e){e=e||0,e=parseInt(e,10);var t=!1;return ie!==e&&(t=!0),ie=e,u.setActivePane(e),M.indicateActivePane(e),t&&Ce(e),M.clearFocusedLink(),t},h.prototype.getSplitObjects=function(){return u.splitInstance},h.prototype.getSplit=function(){return oe},h.prototype.getActivePaneState=function(){return u.getActivePaneState()},h.prototype.getActiveOuterDiv=function(){var e=M.getActivePane();return 1===e?$("#vvSplit1Panel"):$("#vvOuterDiv")},h.prototype.getOuterDivFromState=function(e){return u.getOuterDivFromState(e)};var we=function(t){if(t.getDocumentModel()&&t.getDocumentModel().model&&0!==!t.currentPaneIndex){p.fillGridThumbs(t);var a=e("vvThumbs");a.fillPageThumbs(t),a.ensurePageThumbIsVisible(t),a.loadVisibleThumbs($("#vvPageThumbs")),a.loadVisibleThumbs($("#vvDocThumbs")),M.getBookmarks().loadBookmarks(t),M.getDocumentNotes().loadDocumentNotes(),ae=M.pagesWithAnnotations(),ne&&M.showThumbsWithAnnotations()}},Ce=function(e){1===e?($(".thumbTabs").addClass("disabled disabledTab"),$("#vvDocThumbsTab, #vvDocCompareTab").removeClass("disabled disabledTab"),$("#vvMagnifierButton").attr("aria-disabled",!0),p.disableToggleButton(!0),$(".thumbTabs.active.disabled").length&&virtualViewer.openDefaultThumb()):$(".thumbTabs").hasClass("disabled disabledTab")&&($(".thumbTabs").removeClass("disabled disabledTab"),$("#vvMagnifierButton").attr("aria-disabled",!1),p.disableToggleButton(!1))};h.prototype.indicateActivePane=function(e){if(!oe)return void $(".vvActivePane").removeClass("vvActivePane");var t=e;$(".vvActivePane").removeClass("vvActivePane"),$("#Split"+t).addClass("vvActivePane");var a=u.getActivePaneState();La(a)},h.prototype.undoSplitScreen=function(){if($("#vvDocCompare.active").length&&M.openDefaultThumb(),$("#vvDocCompare, #vvDocCompareTab").removeClass("active"),$("#vvDocCompareTab").hide().removeClass("vvAllowedTab"),qa(),oe){var e=u.getCurrentState(1);if(sn({state:!0},e)){M.destroyInProgressAnnotation(),e.setClosedTab(!0),u.removeStateForDocumentId(e.getDocumentId(),1),$("#vvSplitPaneDiv").append($("#vvOuterDiv")),u.splitInstance.destroy(),$(".split").remove(),$("#vvOuterDiv").eq(0).css({height:"100%",width:"100%"}),Ce(0),oe=!1,M.setActivePane(0);var t=u.getCurrentState(0);M.lockScrolling(!1),La(),M.clearCanvases(t),M.delayedPaintCanvases()}}};var De=function(){"Explorer"===BrowserDetect.browser&&BrowserDetect.version<=11?$("#vvImageCanvas").bind("contextmenu",M.annPopUpHandler):$("#vvDummyScroller").bind("contextmenu",M.annPopUpHandler)},Me=function(){if("true"!==$(this).attr("aria-disabled")){if($(this).hasClass("selectedAnn"))return void virtualViewer.disableStickyAnnotationButton();if($(this).hasClass("vvHasSubDropdown")){var e=$(this).parent("li").data("group"),t="#"+e+"Mid";return void(e&&$(t+":visible").length&&$(t+" ul.dropdown-menu").hide())}var a=$(this).data("button-id");if(!a)return void $("#vvToolbar ul.dropdown-menu, #vvAnnToolbar ul.dropdown-menu").hide();var n,o=s(virtualViewer);if(n=$(this).parent("li").hasClass("vvAdvancedSaveOptions")?Ve()[a]:o.imageToolbarButtons[a],n||(n=o.annotationToolbarButtons[a]),n&&(n.clickHandler||n.annType)){var i,r=n.clickHandler;if(!r&&n.annType&&(i=n.annType,r=function(){virtualViewer.turnOnAnnotationButton(i,$("."+a))}),!$("#vvImageAndThumbs:visible").length)return virtualViewer.toggleHamburgerMenu(),void r.call(virtualViewer);var l=$(this).parents(".dropdown-menu");return l.length?void l.parent().on("hidden.bs.dropdown",function(){$(this).off("hidden.bs.dropdown"),r.call(virtualViewer)}):void r.call(virtualViewer)}}},xe=function(e,a){for(var n in e)if(e[n]){if(e[n].localizeKey){var o=e[n].localizeKey+".title";e[n].name=t.getLocalizedValue(o)}e[n].annotationToolbar=a}e.vvSaveDocument&&r.enableAdvancedSaveMenu&&(e.vvSaveDocument.hasSubMenu=!0),e.vvAnnText&&r.enableTextRubberStamp&&(e.vvAnnText.hasSubMenu=!0),e.vvAnnImageRubberStamp&&(e.vvAnnImageRubberStamp.hasSubMenu=!0);for(var i=$($("#vvGenericToolbarItem").render(e)),l=0;l<i.length;l++){var u=$(i[l]).data("group");u&&s(h).toolbarButtonLogicalGroups[u]?$(i[l]).appendTo("."+u).hide().show():a?$(i[l]).appendTo($(".vvMiscAnnTools")):$(i[l]).appendTo($(".vvMiscTools")),a&&$(i[l]).clone().appendTo("#vvAnnToolbarHamburgerItems").addClass("hidden-md hidden-lg")}},Le=function(){$("#vvThumbToggleButton").on("click",virtualViewer.toggleThumbnailPanel),$("#vvFullThumbToggleButton").on("click",virtualViewer.toggleFullscreenThumbs),$("#vvFullThumbLargeButton").on("click",virtualViewer.enlargeFullscreenThumbs),$("#vvFullThumbSmallButton").on("click",virtualViewer.shrinkFullscreenThumbs),$("#vvToolbarHamburger").on("click",virtualViewer.toggleHamburgerMenu),$("a.vvToolbarItem").on("click",Me),$("a.vvToolbarItem").on("click",function(e){e.preventDefault()}),$("a.vvToolbarItem").on("dragstart",function(e){e.preventDefault()}),$("a.vvToolbarItem").on("click",function(e){if(virtualViewer.getEventManager().dragging||"true"===$(this).attr("aria-disabled"))return void e.stopImmediatePropagation()}),$("form.vvJumpToPage").on("submit",function(e){return e.preventDefault(),$(this).blur(),!1}),$(".vvJumpToPageInput").bind("click",function(e){"true"!==$(".vvJumpToPage").attr("aria-disabled")&&$(this).select()}),"Explorer"===BrowserDetect.browser&&$(".vvJumpToPageInput").on("keypress",function(e){13===e.keyCode&&$(this).blur()}),$(".vvJumpToPageInput").on("change",function(e){if("true"!==$(".vvJumpToPage").attr("aria-disabled")){var t=parseInt($(this).val(),10);Na(t-1)&&($("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),M.setPage(t-1))}}),$(".vvMidGroup .vvHasSubDropdown").on("click",function(e){$(this).find('a[data-toggle="dropdown"]').length&&($(this).find(".dropdown-menu").children().length>0&&$(this).find(".dropdown-menu").toggle(),e.stopPropagation(),e.preventDefault())}),$(".vvMidGroup > .dropdown").on("click",function(){$(this).hasClass("selectedAnn")&&virtualViewer.disableStickyAnnotationButton()}),$("#vvAnnToolbar li.vvToolbarItem > a > .icon").data("placement","right"),$("a.vvToolbarItem, #vvToolbarHamburger, #vvFullThumbToggleButton, #vvThumbToggleButton, #vvFullThumbLargeButton, #vvFullThumbSmallButton, .vvToolbarButton, .vvDiffButton").mousedown(function(e){"true"!==$(this).attr("aria-disabled")&&1===e.which&&$(this).addClass("mouseDown")}),$("a.vvToolbarItem, #vvToolbarHamburger, #vvFullThumbToggleButton, #vvThumbToggleButton, #vvFullThumbLargeButton, #vvFullThumbSmallButton, .vvToolbarButton, .vvDiffButton").mouseup(function(e){1===e.which&&($(this).removeClass("mouseDown"),$(this).blur())}),$("a.vvToolbarItem, #vvToolbarHamburger, #vvFullThumbToggleButton, #vvThumbToggleButton, #vvFullThumbLargeButton, #vvFullThumbSmallButton, .vvToolbarButton, .vvDiffButton").mouseleave(function(){$(this).removeClass("mouseDown")})};h.prototype.initToolbar=function(){var e=$("#vvAnnToolbar"),a=$("#vvToolbarItems"),n=$("#vvAnnToolbarItems");$("#vvToolbar").prop("aria-label",t.getLocalizedValue("utilityToolbar.title"),"Main Toolbar"),e.prop("aria-label",t.getLocalizedValue("annToolbar.title"),"Annotation Toolbar");var o=s(virtualViewer),i=o.toolbarButtonLogicalGroups;for(var l in i)i[l]&&i[l].localizeKey&&(i[l].groupTitle=t.getLocalizedValue(i[l].localizeKey+".title"),i[l].id=l);for(var u=$($("#vvGenericGroupItem").render(i)),d=0;d<u.length;d++){var c=$(u[d]);c.hasClass("vvImageToolbarGroup")||c.hasClass("vvMidImageToolbarGroup")?a.append(c):(c.hasClass("vvAnnotationToolbarGroup")||c.hasClass("vvMidAnnotationToolbarGroup"))&&e.append(c)}xe(o.imageToolbarButtons),xe(o.annotationToolbarButtons,!0),Ne(),$(".vvToolbarItem.vvEndSubGroup").after($("<span></span>").addClass("hidden-xs vvSubGroupSeparator")),Le(),r.disableToolbarHamburger&&(a.children().removeClass("hidden-xs"),e.removeClass("hidden-xs"),e.find(".hidden-xs").removeClass("hidden-xs"),n.find("span.toolbar-icon").removeClass("hidden-xs"),$("#vvAnnToolbarHamburgerItems").addClass("hidden-xs")),a.addClass("overflowScroll"),$("li.vvHasSubDropdown").on("show.bs.dropdown",function(e){$(e.relatedTarget).tooltip("hide")}),$("#vvAnnToolbarHamburgerItems").appendTo($("#vvToolbarItems")),$(".vvMiscTools").children().length<=1&&$(".vvMiscTools").hide()},h.prototype.toggleHamburgerMenu=function(e){e&&e.stopImmediatePropagation(),"true"===$("#vvToolbarItems").attr("aria-expanded")?($("#vvImageAndThumbs").show(),$("#vvToolbarItems").attr("aria-expanded","false"),$("#vvToolbarItems").hide()):($("#vvImageAndThumbs").hide(),$("#vvToolbarItems").attr("aria-expanded","true"),$("#vvToolbarItems").show(),virtualViewer.disableStickyAnnotationButton())};var Ne=function(){if(r.enableAdvancedSaveMenu){var e=Ve();for(var a in e)if(e[a]&&e[a].localizeKey){var n=e[a].localizeKey+".title";e[a].name=t.getLocalizedValue(n)}var o=$($("#vvGenericToolbarItem").render(e)).addClass("vvAdvancedSaveOptions");o.appendTo("li.vvSaveDocument ul.dropdown-menu"),$("li.vvSaveDocument ul.dropdown-menu a[data-tooltip='tooltip']").attr("data-tooltip","")}else $(".vvSaveDocument.vvHasSubDropdown, .vvSaveDocument.dropdown").removeClass("vvHasSubDropdown dropdown"),$("a.vvSaveDocument.dropdown-toggle").attr("data-toggle","")},Ve=function(){return{vvAdvancedSave:{clickHandler:virtualViewer.saveDocument,localizeKey:"utilityToolbar.saveDocument.saveMenuOption"},vvAdvancedSaveRedactions:{clickHandler:function(){var t=function(){virtualViewer.getDocumentModel().setPagesModifiedSinceInit(!0),virtualViewer.saveDocument(null,{burnRedactions:!0,includeRedactionTags:!0})};r.enableAdvancedSaveWarning?e("vvDialogs").permanentChangeDialog(t):t()},localizeKey:"utilityToolbar.saveDocument.saveWithRedactionsMenuOption"},vvAdvancedSaveRedactionsAnnotations:{clickHandler:function(){var t=function(){virtualViewer.getDocumentModel().setPagesModifiedSinceInit(!0),virtualViewer.saveDocument(null,{burnRedactions:!0,includeRedactionTags:!0,includeTextAnnotations:!0,includeNonTextAnnotations:!0,copyAnnotations:!1})};r.enableAdvancedSaveWarning?e("vvDialogs").permanentChangeDialog(t):t()},localizeKey:"utilityToolbar.saveDocument.saveWithRedactionsAnnotationsMenuOptions"}}};h.prototype.validateZoomLevels=function(){var e=!0;if(r.zoomLevels)for(var t=0;t<r.zoomLevels.length;t++){var a=r.zoomLevels[t];t>0&&a<=r.zoomLevels[t-1]&&(e=!1),a<=0&&(e=!1)}else e=!1;e||(r.zoomLevels=o.defaultZoomLevels)};var ke=function(){$("#vvToggleDiffHighlightingBtn").on("click",function(){$(this).prop("disabled")||($(this).toggleClass("vvDiffHighlightVisible"),$(this).toggleClass("vvDiffHighlightNotVisible"),u.getCurrentDiff().showHighlights=!u.getCurrentDiff().showHighlights,virtualViewer.paintCanvases())}),$("#vvLockScrollingBtn").on("click",function(){$(this).prop("disabled")||virtualViewer.lockScrolling(!virtualViewer.scrollingLocked)}),$("#vvRefreshDiffBtn").on("click",function(){if(!$(this).prop("disabled")){var e=u.getCurrentDiff();if(!e||e.diffDisabled)return void virtualViewer.performDiff(!1,!0);e.startDiff(),Ka()}}),$("#vvDocCompareInternal").on("scroll",function(){var e=$("#fixedPageLabel").data("currentPage"),a=e||0,n=$(".diffPageContainer[pageNumber='"+a+"']"),o=n.position();if(n.hasClass("in")&&o.top<=0&&o.top+n.height()>0){if(t.getLocalizedValue("thumbPageLabel","Page ")+(a+1)===$("#fixedPageLabel").text())return;return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(a+1)),void $("#fixedPageLabel").data("currentPage",a)}var i=$(".diffPageContainer.collapse");if(n.position().top>0){for(var r=a-1;r>=0;r--)if(i.eq(r).hasClass("in")){if(o=i.eq(r).position(),o.top<=0&&o.top+i.eq(r).height()>0)return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(r+1)),void $("#fixedPageLabel").data("currentPage",r);if(o.top+i.eq(r).height()<0)return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",r)}return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",0)}for(var s=a+1;s<i.length;s++)if(i.eq(s).hasClass("in")){if(o=i.eq(s).position(),o.top<=0&&o.top+i.eq(s).height()>0)return $("#fixedPageLabel").text(t.getLocalizedValue("thumbPageLabel","Page ")+(s+1)),void $("#fixedPageLabel").data("currentPage",s);if(o.top>0)return $("#fixedPageLabel").text(""),void $("#fixedPageLabel").data("currentPage",a)}$("#fixedPageLabel").text(""),$("#fixedPageLabel").data("currentPage",0)})},$e=function(){e("vvDialogs").init(),$("#vvRedactionWarningDialogOKButton").text(t.getLocalizedValue("redactionWarningDialog.okButton","OK")),$("#vvRedactionWarningDialogOKButton").click(function(e){$("#vvRedactionWarningDialog").modal("hide")}),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.redactedVersionTitle","Creating a Redacted Version")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.redactedVersionText","error")+"</p>"),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.searchAndRedactTitle","Search and Redact")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.searchAndRedactText","error")+"</p>"),$("#vvRedactionWarningDialogText").append("<p><b>"+t.getLocalizedValue("redactionWarningDialog.visualVerificationTitle","Visual Verification")+"</b></p>"),$("#vvRedactionWarningDialogText").append("<p>"+t.getLocalizedValue("redactionWarningDialog.visualVerificationText","error")+"</p>"),$("#vvOverwriteDialogOverwriteButton").click(function(){var e=u.getActivePaneState(),t=e.getDocumentId();M.saveDocument(t,{skipOverwriteDialog:!0}),$("#vvOverwriteDialog").modal("hide")}),$("#vvOverwriteDialogSaveAsButton").click(function(){$("#vvOverwriteDialog").modal("hide"),M.saveDocumentAsDialog()}),$("#vvConfirmCropDialogOK").click(function(){if(virtualViewer.cropPageClient()){var e=u.getActivePaneState();g.updateTabName(e)}else virtualViewer.delayedPaintCanvases();$("#vvConfirmCropDialog").modal("toggle")}),$("#vvConfirmCropDialog").on("hidden.bs.modal",function(){Z.clean(),virtualViewer.delayedPaintCanvases()}),$("#vvConfirmCropDialogCancel").click(function(){u.getActivePaneState().removeCropOnPage(),virtualViewer.delayedPaintCanvases()}),$("#pictureControlsClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvPictureControlsDialogResetButton").click(function(e){var t=u.getActivePaneState();if(t){var a=t.getDocumentModel().getModifiedSinceInit();a&&(t.setContrastForPage(t.pageNumber,o.defaultContrastValue),t.setCachedContrastForPage(t.pageNumber,o.defaultContrastValue),t.setBrightnessForPage(t.pageNumber,o.defaultBrightnessValue),t.setCachedBrightnessForPage(t.pageNumber,o.defaultBrightnessValue),t.setGammaForPage(t.pageNumber,o.defaultGammaValue),t.setCachedGammaForPage(t.pageNumber,o.defaultGammaValue)),t.resetPageManipulations(t.pageNumber),Wt(t)}}),$("#vvPictureControlsDialogOKButton").click(function(e){var t=u.getActivePaneState();
if(t){var a=t.pageNumber;t.setCachedContrastForPage(a,t.getContrastForPage(a)),t.setCachedBrightnessForPage(a,t.getBrightnessForPage(a)),t.setCachedGammaForPage(a,t.getGammaForPage(a))}}),$("#vvPictureControlsDialogCancelButton,#pictureControlsClose").click(function(e){var t=u.getActivePaneState();if(t){var a=t.getCachedContrastForPage(t.pageNumber),n=t.getCachedBrightnessForPage(t.pageNumber),o=t.getCachedGammaForPage(t.pageNumber);t.setContrastForPage(t.pageNumber,a),t.setBrightnessForPage(t.pageNumber,n),t.setGammaForPage(t.pageNumber,o),t.resetPageManipulations(t.pageNumber),Wt(t,!0)}}),$("#imageInfoClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvImageInfoTitle").html(t.getLocalizedValue("imageInfo.dialogTitle","Document & Page Properties")),$("#vvImageInfoDialogOKButton").text(t.getLocalizedValue("aboutDialog.okButton","OK")),$("#aboutClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvAboutDialogText").html(t.getLocalizedValue("aboutDialog.text",o.aboutDialogTextContents)),$("#vvAboutDialogTitle").html(t.getLocalizedValue("aboutDialog.productName",o.productName)+" "+t.getLocalizedValue("aboutDialog.versionPrefix","v")+o.productVersion),$("#vvAboutDialogOKButton").text(t.getLocalizedValue("aboutDialog.okButton","OK")),$("#vvAboutDialogCancelButton").text(t.getLocalizedValue("aboutDialog.helpButton","Help")),$("#vvAboutDialogOKButton").click(function(e){$("#vvAboutDialog").modal("hide")}),$("#vvAboutDialogCancelButton").click(function(e){window.open(r.helpURL,r.helpWindowName,r.helpWindowParams),$("#vvAboutDialog").modal("hide")});var a=t.getLocalizedValue("clipboardDialog.clipboardTitleStart","Copy to clipboard"),n="Ctrl-C",i=navigator.platform.toUpperCase().indexOf("MAC")>=0;i&&(n="Command-C");var s=a+": "+n;$("#vvClipboardTitle").html(s),c.initKeyboardHintsContent();var l=$("#vvExportUnsupportedFileDialog");l.find(".download-button").click(function(){M.downloadDocument(l.data().documentId),l.modal("hide")}),l.on("hidden.bs.modal",function(){var e=u.getStateForDocumentId(l.data().documentId);e&&(e.closedTab||M.closeTab(e.getTabNumber(),!0),u.removeStateForDocumentId(e.getDocumentId(),e.currentPaneIndex)),j=!1}),$("#vvDownloadEmailAttachmentDialog").find(".download-button").click(function(){let e=$("#vvDownloadEmailAttachmentDialog");M.downloadEmailAttachment(e.data("emailAttachment")),e.data("emailAttachment",null),e.modal("hide")});var d=$("#vvPasswordProtectedFileDialog");d.find(".download-button").click(function(){M.downloadDocument(d.data().documentId),d.modal("hide")}),d.on("hidden.bs.modal",function(){var e=u.getStateForDocumentId(d.data().documentId);e&&(e.closedTab||M.closeTab(e.getTabNumber(),!0),u.removeStateForDocumentId(e.getDocumentId(),e.currentPaneIndex)),j=!1}),$("#bookmarksClose").attr("title",t.getLocalizedValue("commonDialog.closeButton","Close")),$("#vvBookmarkDialogOKButton").click(function(e){var t=virtualViewer.getCurrentState().documentModel,a=t.getSelectedPageNumbers()[0],n=$("#vvBookmarkDialogNoteInput").val();null===M.getBookmarks().editingBookmark?M.addBookmark(n,a):M.getBookmarks().saveEditedBookmark(n),$("#vvBookmarkDialogNoteInput").val(""),$("#vvBookmarkDialog").modal("hide")}),$("#vvBookmarkDialogCancelButton").click(function(e){$("#vvBookmarkDialogNoteInput").val(""),M.getBookmarks().editingBookmark=null}),$("#vvBookmarkDialog").on("hidden.bs.modal",function(e){$("#vvBookmarkDialogNoteInput").val(""),M.getBookmarks().editingBookmark=null}),$("#vvBookmarkDialog").on("shown.bs.modal",function(e){$("#vvBookmarkDialogNoteInput").focus()}),$("#vvUploadLocalFileForm .file-clicker").click(function(e){$(this).attr("disabled")||(e.preventDefault(),$("#vvUploadLocalFileForm input[type=file]").click())}),$("#vvUploadLocalFileForm input[type=file]").change(function(){var e=$(this).val(),t=e.substring(e.lastIndexOf("/")+1);t=t.substring(e.lastIndexOf("\\")+1),$("#vvUploadLocalFileForm .upload-file-info").text(t)}),$("#vvUploadLocalFilesDialog").on("show.bs.modal",function(){$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1),$("#vvUploadLocalFileForm")[0].reset(),$("#vvUploadLocalFilesDialog .upload-file-info").text("")}),$("#vvUploadLocalFileDialogOK").click(virtualViewer.uploadDocument),Wa(),$("#vvCurrentExceptionOKButton").click(function(){H=null}),$("#vvCurrentExceptionDialog").on("hidden.bs.modal",function(){H=null})},Fe=function(e){var t=e.getPageNumber(),a=e.getPageCount();$(".vvGoToFirstPage").attr("aria-disabled",t<=0||a<=1),$(".vvGoToPreviousPage").attr("aria-disabled",t<=0||a<=1),$(".vvGoToNextPage").attr("aria-disabled",a<=1||t+1===a),$(".vvGoToLastPage").attr("aria-disabled",a<=1||t+1===a)};h.prototype.applyToolbarButtonConfigurations=function(e){Re(e)};var Re=function(e){e=e||u.getActivePaneState(),M.disableUploadDocument?$(".vvFileUpload").remove():null!==M.disableUploadDocument&&q.fileUploadVisible&&q.imageControlToolbar[0].on?$(".vvFileUpload").show():$(".vvFileUpload").hide(),r.disableUserPreferences&&$(".vvUserPreferences").remove(),e&&!e.isMedia()&&e.documentFullyLoaded()?Be(!1,e):Be(!0,e),r.readOnlyAnnotationMode&&e&&Ee();for(var t=$(".vvMidGroup"),a=0;a<t.length;a++){var n=$(t[a]).find("li.vvToolbarItem"),o=$(t[a]);n.length?n.not(".disabled").length?(o.children("button").removeClass("disabled"),o.attr("aria-disabled",!1).removeClass("disabled"),o.children(".dropdown-toggle").attr("aria-disabled",!1)):(o.children("button").addClass("disabled"),o.attr("aria-disabled",!0).addClass("disabled"),o.children(".dropdown-toggle").attr("aria-disabled",!0)):o.remove(),n.hasClass("vvPreferenceDisabled")&&!n.hasClass("vvPreferenceEnabled")?o.addClass("vvHidden"):o.removeClass("vvHidden")}Modernizr.speechsynthesis||$(".vvSpeechSynthesis").remove()},Be=function(e,t){t=t||u.getActivePaneState(),e?($(".vvJumpToPageInput").prop("disabled",!0),$(".vvToolbarItem").attr("aria-disabled","true").addClass("disabled"),$(".vvMediaEnabled").attr("aria-disabled","false").removeClass("disabled"),$(".vvMidGroup > li > a.dropdown-toggle").attr("aria-disabled","false").removeClass("disabled"),p.disableToggleButton(!0)):($(".vvJumpToPageInput").prop("disabled",!1),$(".vvToolbarItem").attr("aria-disabled","false").removeClass("disabled"),r.oneLayerPerAnnotation&&!t.imageLayers&&$(".vvLayerManager").attr("aria-disabled",!0).addClass("disabled"),virtualViewer.checkRedactionsEnabled()||$(".vvRedactionRect").attr("aria-disabled",!0).addClass("disabled"),Fe(t),p.disableToggleButton(!1))},Ee=function(){$("li.vvToolbarItem[data-anntype], li.vvToolbarItem[data-anntype] > a").attr("aria-disabled",!0).addClass("disabled").tooltip("hide")};h.prototype.mediaThumbPrep=function(e){return e&&e.isMedia()?($(".thumbTabs").addClass("disabledTab"),$("#vvDocThumbsTab").removeClass("disabledTab"),M.openDefaultThumb(o.thumbnailTabs.document),p.disableToggleButton(!0),!0):($(".thumbTabs").removeClass("disabledTab"),!1)};var Oe=function(){Re();var e=!1;$(".vvRubberbandZoom").on("mousedown",function(){e=!0,t.cursorAnnotate()}),$(".vvRubberbandZoom").on("focus",function(){if(e===!1){var a=t.getLocalizedValue("utilityToolbar.rubberBandZoomMessage")+"("+_e()+")";$("a.vvRubberbandZoom").attr("title",a).tooltip("fixTitle").tooltip("show")}}),$(".vvRubberbandZoom").on("blur",function(){$("a.vvRubberbandZoom").attr("title",t.getLocalizedValue("utilityToolbar.rubberbandZoom.title")).tooltip("fixTitle"),e=!1})},_e=function(){var e,t=r.hotkeys;return $.each(t,function(t,a){if("Zoom In"===a.defaultValue){if(a.key.indexOf(",")>-1){var n=a.key.split(",");return e=n[0],!1}return e=a.key,!1}}),e},Ue=function(){$("#vvPlayButton").on("click",function(e){var t=M.getActivePaneState();ee.getStartedPlaying()===!1?(ee.setStartedPlaying(!0),ee.playSpeechSynthesisForPage(t.getPageNumber())):window.speechSynthesis.resume()}),$("#vvPauseButton").on("click",function(e){window.speechSynthesis.pause()}),$("#vvNextButton").on("click",function(e){ee.setButtonClicked("next"),ee.getStartedPlaying()&&window.speechSynthesis.cancel(),ee.setSpeechNextPage(!0),M.nextPage(),ze()}),$("#vvPreviousButton").on("click",function(e){ee.setButtonClicked("previous"),ee.getStartedPlaying()&&window.speechSynthesis.cancel(),ee.setSpeechPreviousPage(!0),M.previousPage(),ze()}),$("#vvStopButton").on("click",function(e){ee.stopSpeech()})},ze=function(){var e=u.getActivePaneState(),t=e.getPageNumber(),a=e.getPageCount(),n=t<=0||a<=1,o=a<=1||t+1===a;n?$(".vvPreviousButton").attr("aria-disabled",n).addClass("nonselectable disabled"):$(".vvPreviousButton").attr("aria-disabled",n).removeClass("nonselectable disabled"),o?$(".vvNextButton").attr("aria-disabled",o).addClass("nonselectable disabled"):$(".vvNextButton").attr("aria-disabled",n).removeClass("nonselectable disabled")},We=function(){$("#vvThumbsTabs").css("visibility","visible"),$("#vvSearch").css("visibility","visible"),$("#vvNotesTab").css("visibility","visible"),$("#vvBookmarksTab").css("visibility","visible"),$("#vvUPToolbarConfigTab").css("visibility","visible"),$("#vvUPAnnotationPropTab").css("visibility","visible"),$("#vvUPCustomTextStampsTab").css("visibility","visible"),$("#vvUPNotesTemplateTab").css("visibility","visible"),$("#vvUPMediaTab").css("visibility","visible"),$("#vvUPGeneralTab").css("visibility","visible"),$(".thumbTabs > a").on("dragstart",function(e){e.preventDefault()});var a=e("vvThumbs");if(r.showThumbnailPanel===!1||r.showPageThumbnails===!1&&r.showDocThumbnails===!1&&r.showSearch===!1?virtualViewer.toggleThumbnailPanel(!1):$("#vvThumbs").width()>$("#vvImageAndThumbs").width()/3?virtualViewer.toggleThumbnailPanel(!1):virtualViewer.toggleThumbnailPanel(!0),r.enableDocumentNotes===!1&&$("#vvNotesTab").hide().removeClass("vvAllowedTab"),r.showPageThumbnails===!1&&($("#vvPageThumbsTab").hide().removeClass("vvAllowedTab"),$("#vvThumbs li:eq(1) a").tab("show")),r.showDocThumbnails===!1&&$("#vvDocThumbsTab").hide().removeClass("vvAllowedTab"),r.showSearch===!1&&$("#vvSearchTab").hide().removeClass("vvAllowedTab"),r.showBookmarkThumbnails===!1&&$("#vvBookmarksTab").hide().removeClass("vvAllowedTab"),r.showAnnotationList===!1&&$("#vvAnnotationsListTab").hide().removeClass("vvAllowedTab"),r.showDocumentFilter){$("#vvDocThumbs").addClass("show-control-panel");var n=null,o=$("#vvDocThumbsSearch .displayNameSearch");o.attr("placeholder",t.getLocalizedValue("documentFilterPlaceholderText","Filter")),o.addClear({symbolClass:"text_clear_symbol icon",onClear:function(){virtualViewer.filterDocumentThumbsByDisplayName()}}),o.keydown(function(){n&&clearTimeout(n),n=setTimeout(function(){virtualViewer.filterDocumentThumbsByDisplayName(o.val())},200)})}g.prepareTabs(),$("#vvDocThumbsTab").on("click",function(e){setTimeout(function(e){a.loadVisibleThumbs($("#vvDocThumbs"))},200),r.showDocumentFilter&&setTimeout(function(e){$("#vvDocThumbsSearch").find(".form-control").first().focus()})}),$("#vvPageThumbsTab").on("shown.bs.tab",function(e){setTimeout(function(e){a.loadVisibleThumbs($("#vvPageThumbs")),a.ensurePageThumbIsVisible(M.getActivePaneState())},200),M.getActivePaneState()&&He()}),$("#vvSearchTab").on("shown.bs.tab",function(){setTimeout(function(e){a.loadVisibleThumbs($("#vvSearchResults")),d.updateSearchButtons()},200),$("#vvSearchTermField").focus()}),$("#vvAnnotationsListTab").on("shown.bs.tab",function(){$("#vvAnnotationsList").find(".form-control").first().focus()}),$("#vvNotesTab").on("shown.bs.tab",function(){$("#vvDocumentNotes").find(".form-control").first().focus()})},He=function(){r.showAnnNavToggle?($("#vvAnnotationIndicatorToggle").show(),virtualViewer.showAnnotationNaviPanel($("#vvPageThumbs").hasClass("vvAnnotationNavigation"))):($("#vvAnnotationIndicatorToggle").hide(),$("#vvPageThumbs").removeClass("vvAnnotationNavigation vvAnnotationNavigationHidden"))},je=function(e){if($("#vvNotesTab").removeClass("disabled"),e.isVirtualDocument()){$("#vvNotesTab").addClass("disabledTab"),$("#vvNotesTab").removeAttr("data-toggle");var a=t.getLocalizedValue("errors.virtualDocumentNotes","Notes are not yet supported for Virtual Documents.");$("#vvNotesTabSpan").attr("title",a),$("#vvBookmarksTab").addClass("disabledTab"),$("#vvBookmarksTab").removeAttr("data-toggle"),a=t.getLocalizedValue("errors.virtualDocumentBookmarks","Bookmarks are not yet supported for Virtual Documents."),$("#vvBookmarksTabSpan").attr("title",a)}},Qe=function(){if($(".vvAnnPopUpButton").each(function(){var e=$(this).val();$(this).val($("<div />").html(e).text())}),$("#vvAnnLineColorChoices, #vvAnnFillColorChoices, #vvAnnTextColorChoices").colorpicker({onChange:Ma}),r.annotationTags.length>0){$("#vvAddTagButton").html(t.getLocalizedValue("annotationTag.addButton","Add Tag")+"<div class='vvAnnTagInnerButton'>+</div>");for(var e=0;e<r.annotationTags.length;e++)$("#vvAnnTagList").append(ea(r.annotationTags[e]))}$(".vvTagOption").on("click",function(){var e=virtualViewer.getCurrentAnnObject(),a=u.getActivePaneState(),n=!0,o=$(this).text();if(""===o)n=!1;else{0===e.annotationTags.length&&$("#vvAnnTagChosen").show();for(var i=0;i<e.annotationTags.length;i++)if(e.annotationTags[i]===o){n=!1;break}}if(t.isRedactionLayer(e.layerName)&&1===e.annotationTags.length&&n&&(e.annotationTags=[],$("#vvAnnTagChosen").children().remove()),n){e.annotationTags.push(o);var r=Jt(o);$("#vvAnnTagChosen").append(r),r.find(".vvAnnTagCloseButton").on("click",ta),e.markRevised(),l.markLayerWithAnnDirty(e),a.getNewAnnList().indexOf(e)===-1&&a.setTrueAnnChange(!0),Kt(o)}});let a=t.fontNames();for(var n=0;n<a.length;n+=1)$("#vvAnnTextFaceSelect").append("<option>"+a[n]+"</option>");for(var i=0;i<o.fontSizes.length;i+=1)$("#vvAnnTextSizeSelect").append("<option>"+o.fontSizes[i]+"</option>");$("#vvAnnotationRevisionHistory").on("hide.bs.collapse",function(e){$("#vvAnnPopUpForm").removeClass("vvDisplayingRevisionHistory")}),$("#vvAnnotationRevisionHistory").on("show.bs.collapse",function(e){$("#vvAnnPopUpForm").addClass("vvDisplayingRevisionHistory")}),$("#vvAnnPopUp .vvAnnThicknessCell").click(function(){var e=$(this).children(".vvAnnThicknessElement").css("width");e=parseInt(e.replace(/px/i,""),10),$("#vvAnnPopUp .vvAnnThicknessCell").attr("aria-pressed","false"),$(this).attr("aria-pressed","true"),$("#vvAnnLineSizeValue").html(e);var t=u.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=l.getLayerWithAnn(a),o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,a.setLineWidthInPoints(e),o.modifiedAnn=a.clone(),o.type="modify",a&&a.markRevised(),o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),l.markLayerWithAnnDirty(a),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnTextFaceSelect").change(function(e){var t=u.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=l.getLayerWithAnn(a),o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,a&&a.markRevised(),a.setFontName($(e.target).val()),a.wrappedTextIsStale=!0,a.fitBoxToText(),o.modifiedAnn=a.clone(),o.type="modify",o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),l.markLayerWithAnnDirty(a),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnTextSizeSelect").change(function(e){var t=u.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=l.getLayerWithAnn(a),i=t.getUndoObject(t.getPageNumber());i.referenceAnn=a,i.unchangedAnn=a.clone(),i.layer=n,a&&a.markRevised();var r=1;a.docDPI>o.minimumAnnotationDPI&&t.getDPIForPage(a.page)&&t.getDPIForPage(a.page)<10&&(r=a.pageWidth/t.getOriginalWidthForPage(a.page)||1,90!==a.rotateAngle&&270!==a.rotateAngle||(r=a.pageHeight/t.getOriginalWidthForPage(a.page)||1)),a.setFontSize($(e.target).val()*r),a.wrappedTextIsStale=!0,a.fitBoxToText(),i.modifiedAnn=a.clone(),i.type="modify",i.modifiedAnn.isSameAs(i.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),i),t.resetUndoObject(),l.markLayerWithAnnDirty(a),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()}),$("#vvAnnTextStyle").change(function(e){var t=u.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=l.getLayerWithAnn(a);a.wrappedTextIsStale=!0;var o=t.getUndoObject(t.getPageNumber());o.referenceAnn=a,o.unchangedAnn=a.clone(),o.layer=n,$("#vvAnnTextStyleBold").is(":checked")?a.fontBold=!0:a.fontBold=!1,$("#vvAnnTextStyleItalic").is(":checked")?a.fontItalic=!0:a.fontItalic=!1,$("#vvAnnTextStyleUnderline").is(":checked")?a.fontUnderline=!0:a.fontUnderline=!1,a.fitBoxToText(),o.modifiedAnn=a.clone(),o.type="modify",o.modifiedAnn.isSameAs(o.unchangedAnn)||t.pushUndoObject(t.getPageNumber(),o),t.resetUndoObject(),a&&(a.markRevised(),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0)),l.markLayerWithAnnDirty(a),virtualViewer.delayedPaintCanvases()}),$("#vvAnnPopUpEditTextArea").on("focus",function(){this.select(),r.autoConfirmTextAnnotations||($("#vvAnnPopUpEditTextSaveBtn").show(),$("#vvAnnPopUpEditTextCancelBtn").show())}),$("#vvAnnPopUpEditTextArea").on("input",function(){if(r.autoConfirmTextAnnotations){var e=(u.getActivePaneState(),virtualViewer.getCurrentAnnObject());e.setTextString($("#vvAnnPopUpEditTextArea").val()),e.wrappedTextIsStale=!0,e.fitBoxToText(),virtualViewer.delayedPaintCanvases(),e.markRevised(),l.markLayerWithAnnDirty(e)}}),$("#vvAnnPopUpEditTextSaveBtn").on("click",function(){qe(this)}),$("#vvAnnPopUpEditTextCancelBtn").on("click",function(){var e=(u.getActivePaneState(),virtualViewer.getCurrentAnnObject());$("#vvAnnPopUpEditTextArea").val(e.getTextString()),e.fitBoxToText(),$("#vvAnnPopUpEditTextArea").blur(),$(this).hide(),$("#vvAnnPopUpEditTextSaveBtn").hide(),virtualViewer.delayedPaintCanvases()}),$("#vvAnnCopyButton").click(function(e){l.copyAnn(),virtualViewer.hideAnnPopUp()}),$("#vvAnnFootnoteButton").click(function(e){var t=u.getActivePaneState(),a=virtualViewer.getCurrentAnnObject(),n=$("#vvAnnPopUpEditTextArea").val();l.addFootnote(t,a,n),$("#vvAnnPopUpEditTextArea").val(a.getTextString()),qe(this)}),$("#vvAnnCutButton").click(function(e){l.cutAnn(),virtualViewer.hideAnnPopUp()}),$("#vvAnnDeleteButton").click(function(e){$("#vvDeleteAnnotationDialog").modal("show"),$("#deleteAnnotationButtonConfirm").click(function(e){virtualViewer.hideAnnPopUp(),l.deleteAnn(),$("#vvDeleteAnnotationDialog").modal("hide")})})},qe=function(e){var t=u.getActivePaneState(),a=virtualViewer.getCurrentAnnObject();a.wrappedTextIsStale=!0,a.setTextString($("#vvAnnPopUpEditTextArea").val()),a.fitBoxToText(),a.markRevised(),l.markLayerWithAnnDirty(a),$("#vvAnnPopUpEditTextArea").blur(),"vvAnnFootnoteButton"!==e.id&&$("#vvAnnPopUpEditTextCancelBtn").hide(),t.getNewAnnList().indexOf(a)===-1&&t.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()},Ge=function(e){var t=u.getActivePaneState();"number"!=typeof e&&(e=t.pageNumber),t.getSVGEnabledForPage(e)&&(t.setSVGEnabledForPage(e,!1),t.imageManager.cleanPageFromBuffers(e),t.imageManager.getBestImageFromPage(e,!0))},Ye=function(){$("#vvBrightness .icon").attr("title",t.getLocalizedValue("pictureControls.brightnessIcon.title","Brightness (Icon)")),$("#vvContrast .icon").attr("title",t.getLocalizedValue("pictureControls.contrastIcon.title","Contrast (Icon)")),$("#vvGamma .icon").attr("title",t.getLocalizedValue("pictureControls.gammaIcon.title","Gamma (Icon)")),$("#vvBrightnessSliderVal").attr("title",t.getLocalizedValue("pictureControls.brightnessValue.title","Brightness (Value)")),$("#vvContrastSliderVal").attr("title",t.getLocalizedValue("pictureControls.contrastValue.title","Contrast (Value)")),$("#vvGammaSliderVal").attr("title",t.getLocalizedValue("pictureControls.gammaValue.title","Gamma (Value)"))},Xe=function(){$("#vvDocumentNoteAdderAuthor").html(t.encodeForHTML(Y.getUsername())),$("#vvDocumentNoteAddButton").click(function(){$("#vvDocumentNoteContentInput").val()&&(Y.addNewNote(),M.docHasNotes()&&$("#vvNotesTabSpan").addClass("docNotesExist"))}),$("#vvAnnotationNoteAddButton").click(function(){$("#vvAnnotationNoteContentInput").val()&&(virtualViewer.getCurrentAnnObject().addNewNote(),virtualViewer.getCurrentAnnObject().markRevised())}),virtualViewer.getDocumentId()||$("#vvDocumentNotes").addClass("hideTabContents")};h.prototype.docHasNotes=function(){var e=M.getDocNotes();return!!e&&e.length>0},h.prototype.getDocNotes=function(){var e=M.getCurrentState();if(e){var t=e.getDocumentModel();if(t){var a=t.model.documentNotes.notes;return a}}};var Ze=function(){Y.clearAllDocumentNotes(),$("#vvNotesTabSpan").removeClass("docNotesExist")},Ke=function(){M.createNoteTemplateContextMenuList()};h.prototype.createNoteTemplateContextMenuList=function(){$("#vvNoteTemplateCMenuList").empty();for(var e=0;e<q.noteTemplateArray.length;e+=1){var t=$("<li>"+M.encodeForHTML(q.noteTemplateArray[e].templateName)+"</li>");$("#vvNoteTemplateCMenuList").append(t),t.click(function(){var e=this.parentElement,t=$(e).children().index(this);$("#vvDocumentNoteContentInput").val(q.noteTemplateArray[t].templateString),$("#jqContextMenu").hide(),$("#jqContextMenuShadow").hide()})}$("#vvDocumentNoteTemplateButton").contextMenu("vvNoteTemplateContextMenu",{bindTarget:"click",onContextMenu:function(e){if(q.noteTemplateArray.length>0)return!0},onShowMenu:function(e,t){if(q.noteTemplateArray.length>0)return t}})};var Je=function(){e("vvThumbs").prepareThumbPanels(),p.prepareFullThumbs(),r.leftSideThumbPanel&&($("#vvThumbs").addClass("leftSidePanel"),$("#vvImagePanel").addClass("leftSideShift"),$("#vvImageCanvas").addClass("shiftCanvasLeft"),$("#vvAnnotationIndicatorToggle").addClass("shiftCanvasLeft"))};h.prototype.openDefaultThumb=function(t){t=t||q.getDefaultTab(),(null===t||t<0)&&(t=r.defaultThumbnailTab);var a=u.getActivePaneState(),n=!!a&&ie<1&&!u.isVideoOpen()&&r.showPageThumbnails,i=!!a&&ie<1&&!a.isVirtualDocument()&&r.enableDocumentNotes,s=!!r.showDocThumbnails,l=!!r.showBookmarkThumbnails&&ie<1,d=!!r.showSearch&&ie<1,c=!!r.showAnnotationList&&ie<1&&!u.isVideoOpen(),g=!u.isVideoOpen()&&u.getCurrentDiff();switch(a&&u.isVideoOpen()&&(t=o.thumbnailTabs.document),(t===o.thumbnailTabs.page&&!n||t===o.thumbnailTabs.search&&!d||t===o.thumbnailTabs.note&&!i||t===o.thumbnailTabs.bookmark&&!l||t===o.thumbnailTabs.document&&!s||t===o.thumbnailTabs.annList&&!c||t===o.thumbnailTabs.docCompare&&!g)&&(t=s?o.thumbnailTabs.document:n?o.thumbnailTabs.page:d?o.thumbnailTabs.search:i?o.thumbnailTabs.note:l?o.thumbnailTabs.bookmark:c?o.thumbnailTabs.annList:g?o.thumbnailTabs.docCompare:null),$("#vvThumbs .active").removeClass("active"),t){case o.thumbnailTabs.page:$("#vvPageThumbsTab").addClass("active"),$("#vvPageThumbs").addClass("active"),e("vvThumbs").loadVisibleThumbs($("#vvPageThumbs"));break;case o.thumbnailTabs.document:$("#vvDocThumbsTab").addClass("active"),$("#vvDocThumbs").addClass("active"),e("vvThumbs").loadVisibleThumbs($("#vvDocThumbs"));break;case o.thumbnailTabs.search:$("#vvSearchTab").addClass("active"),$("#vvSearch").addClass("active");break;case o.thumbnailTabs.note:$("#vvNotesTab").addClass("active"),$("#vvDocumentNotes").addClass("active");break;case o.thumbnailTabs.bookmark:$("#vvBookmarksTab").addClass("active"),$("#vvBookmarks").addClass("active");break;case o.thumbnailTabs.annList:$("#vvAnnotationsListTab").addClass("active"),$("#vvAnnotationsList").addClass("active");break;case o.thumbnailTabs.docCompare:$("#vvDocCompareTab").addClass("active"),$("#vvDocCompare").addClass("active")}};var et=function(){$("#vvCopyTextContainer").length||$("<div></div>").attr("id","vvCopyTextContainer").appendTo("#virtualViewerMain").hide(),$("#vvSelectTextMenuCopy").on("click",virtualViewer.copyTextUserEventHandler)},tt=function(){e("vvLayerManager").prepareLayerDialog()};h.prototype.docThumbContextMenu={bindings:{vvSplitImage:function(e){var t=$(e).data("thumbInfo").documentId,a=M.getCurrentState(1);if(a){var n=a.documentModel;n.getModifiedSinceInit()?M.confirmCloseDialog(a,t):M.splitScreen(t,"horizontal")}else M.splitScreen(t,"horizontal");M.performDiff()}},offsetHeight:10,onContextMenu:function(e){var a=$(e.currentTarget).data().thumbInfo.documentId,n=$(e.currentTarget).data().thumbInfo.displayName;return!(t.mediaExtensionCheck(a)||t.mediaExtensionCheck(n)||u.isVideoOpen())&&(!!r.splitScreen&&!($("#vvImagePanel").width()<2*$("#vvThumbs").width()&&Modernizr.touchevents))}};var at={bindings:{vvOcrContextMenuOcr:function(){M.performOCR({force:!0})},vvSelectTextMenuPaste:function(){var e=M.getActivePaneState();if(e.isPageCropped(e.getPageNumber())){var a=t.getLocalizedValue("errors.cropBlock","Cannot Annotate on Crop Preview. Save the crop then Annotate."),n={client:!0,disable:M.disableErrorModals.cropBlock};M.displayExceptionMessage(a,n)}else l.pasteAnn()},vvUndoSplitPane:function(e){var t=u.getCurrentState(1);t.documentModel.getModifiedSinceInit()?M.confirmCloseDialog(t):M.undoSplitScreen()},vvSelectTextMenuCopy:function(e){},vvSelectTextMenuHighlight:function(e){M.createHighlightFromSelection()},vvSelectTextMenuRedact:function(e){M.createRedactionFromSelection()},vvSelectTextMenuReloadDocumentForPrintArea:function(e){M.reloadAndIgnoreXlsxPrintArea()}},offsetHeight:100,onContextMenu:function(e){e||(e=window.event),Modernizr.touchevents&&(e=Z.fixTouchEvent(e));var t=u.getActivePaneState();if(u.isVideoOpen()||!t)return!1;var a=Z.clickPointConverter(e),n=l.isAnnotationAtPoint(a),i=Z.annDragging,r=virtualViewer.isOnImage(a),s=virtualViewer.getSelectedTextRects(),d=virtualViewer.getEventManager().getDragMode();if(!r)return!1;if(n||i)return!1;var c={documentId:t.getDocumentId()};return!K.callWithReturn("disableTextContextMenu",c)&&(!(!M.ocrEnabled&&!oe)||!!(d===o.dragModes.selectText&&s&&s.length>0||null!==ce&&void 0!==ce))},onShowMenu:function(e,t){var a=virtualViewer.getEventManager().getDragMode(),n=virtualViewer.getSelectedTextRects(),i=virtualViewer.getActivePaneState();r.readOnlyAnnotationMode&&($("#vvSelectTextMenuHighlight",t).remove(),$("#vvSelectTextMenuRedact",t).remove()),i&&i.documentFullyLoaded()&&"xlsx"===i.getDocFormat()||$("#vvSelectTextMenuReloadDocumentForPrintArea",t).remove(),a===o.dragModes.selectText&&n&&n.length>0?virtualViewer.checkRedactionsEnabled()||$("#vvSelectTextMenuRedact",t).remove():($("#vvSelectTextMenuCopy",t).remove(),$("#vvSelectTextMenuHighlight",t).remove(),$("#vvSelectTextMenuRedact",t).remove()),null!==ce&&void 0!==ce||$("#vvSelectTextMenuPaste",t).remove(),oe||$("#vvUndoSplitPane",t).remove(),M.ocrEnabled||$("#vvOcrContextMenuOcr",t).remove();var s={documentId:virtualViewer.getActivePaneState().getDocumentId()};return K.call("onShowSelectTextContextMenu",s),t}};h.prototype.pageThumbContextMenuOptions={offsetHeight:400,bindings:{vvSelectPagesAll:function(e){M.selectAll()},vvSelectPagesNone:function(e){M.selectNone()},vvDeletePages:function(e){$("#vvPageThumbs").trigger("vvDeletePages")},vvCutPages:function(e){$("#vvPageThumbs").trigger("vvCutPages")},vvCopyPages:function(e){$("#vvPageThumbs").trigger("vvCopyPages")},vvInsertPagesBefore:function(e){$("#vvPageThumbs").trigger("vvPastePages",$(e).closest(".vvThumbBox").data("thumbInfo").pageNumber)},vvInsertPagesAfter:function(e){$("#vvPageThumbs").trigger("vvPastePages",$(e).closest(".vvThumbBox").data("thumbInfo").pageNumber+1)},vvCopyPagesToNewDocument:function(e){M.copyToNewDocument(!1)},vvCutPagesToNewDocument:function(e){M.copyToNewDocument(!0)},vvAddBookmark:function(e){$("#vvBookmarkDialog").modal("show");var a=t.getLocalizedValue("bookmarkDialog.title","Create New Bookmark");$("#vvBookmarkTitle").text(a);var n=virtualViewer.getCurrentState().documentModel,o=n.getSelectedPageNumbers()[0];Q.pageToAdd=o},vvPrintPages:function(e){var t=virtualViewer.getSelectedPageNumbers();M.printDocumentDialog(t)},vvExportPages:function(e){var t=virtualViewer.getSelectedPageNumbers();M.exportDocumentDialog(t)}},onContextMenu:function(e){return!("vvPageThumbs"===e.target.id&&M.getPageCount()>0)},onShowMenu:function(e,t){var a=virtualViewer.getDocumentModel(),n=$(e.target).closest(".vvThumbBox"),o=n.data("thumbInfo").pageNumber,i=u.getActivePaneState();a.isPageSelected(o)||e.ctrlKey||e.metaKey||e.shiftKey||(a.clearPageSelection(),a.addPageToSelection(o));var s=function(e){var a=e?e.sessionGUID:null;e&&e.model&&0!==e.model.length&&(r.enableCopyPasteBetweenSessions!==!1||a===virtualViewer.viewerSessionID)||($("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove())},l={documentId:i.getDocumentId()};return M.checkPageManipulationsEnabled()&&!K.callWithReturn("disablePageManipulationContextMenuOptions",l)||($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvDeletePages",t).remove(),$("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove(),$("#vvCutPagesToNewDocument",t).remove(),$("#vvSelectPagesAll",t).remove(),$("#vvSelectPagesNone",t).remove()),0===a.getSelectedPageNumbers().length&&($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvCopyPagesToNewDocument",t).remove(),$("#vvCutPagesToNewDocument",t).remove()),a.getSelectedPageNumbers().length>1&&$("#vvAddBookmark",t).remove(),i.isVirtualDocument()&&$("#vvAddBookmark",t).remove(),r.pageManipulationsNewDocumentMenu||($("#vvCopyPagesToNewDocument",t).remove(),$("#vvCutPagesToNewDocument",t).remove()),0===i.getPageCount()&&($("#vvCutPages",t).remove(),$("#vvCopyPages",t).remove(),$("#vvDeletePages",t).remove(),$("#vvSelectPagesAll",t).remove(),$("#vvSelectPagesNone",t).remove(),$("#vvInsertPagesBefore",t).remove(),$("#vvInsertPagesAfter",t).remove()),this.offsetHeight=t.height(),$a(s),t}},h.prototype.getServerConfig=function(){var e=!0;r.synchronousInit&&(e=!1);var t=new URI(r.servletPath);t.addQuery("action","getServerConfig");var a=t.query();t.query(""),$.ajax({url:t.toString(),type:"POST",data:a,dataType:"json",async:e,success:function(e){pt(e)},error:function(e){mt(e)||console.log("getServerConfig: error")}})};var nt=function(e){e=e||virtualViewer.getActiveOuterDiv();var t,a=M.getScrollbarWidth();t=!a||a<10?r.canvasBufferSpace||10:2*a;var n=e.width()-t;return n<0&&(n=0),n};h.prototype.getOuterDivClientWidth=function(e){return nt(e)};var ot=function(e){e=e||virtualViewer.getActiveOuterDiv();var t=e.height(),a=e.find(".vvInner"),n=Math.floor(a.offset().top)-Math.floor(e.offset().top);t-=n;var o,i=M.getScrollbarHeight();return o=!i||i<10?r.canvasBufferSpace||10:i,t-=o};h.prototype.getOuterDivClientHeight=function(e){return ot(e)},h.prototype.getScrollbarWidth=function(){var e,t=virtualViewer.getActiveOuterDiv(),a=t.width(),n=t[0].clientWidth,o=r.canvasBufferSpace||10;return 0===a||0===n?null:(a&&n&&(e=a-n),o+e)},h.prototype.getScrollbarHeight=function(){var e,t=virtualViewer.getActiveOuterDiv(),a=t.height(),n=t[0].clientHeight,o=r.canvasBufferSpace||10;return 0===a||0===n?null:(a&&n&&(e=a-n),o+e)},h.prototype.turnOnPanTool=function(e){if(Modernizr.touchevents){var a=navigator.userAgent.toLowerCase();(a.match(/(iphone|ipod|ipad)/)||a.match(/(android)/)||a.match(/(iemobile)/))&&(e=o.panToolPref.panToolWithoutScrollbars)}var n=$(".vvOuter");switch(n.removeClass("panMode withScroll"),n.css({overflow:""}),e){case o.panToolPref.noPanTool:this.setDragMode(o.dragModes.selectText),t.cursorNormal();break;case o.panToolPref.panToolWithScrollbars:n.addClass("withScroll");case o.panToolPref.panToolWithoutScrollbars:default:n.addClass("panMode"),this.setDragMode(o.dragModes.pan)}Z.setPanToolMode(e);var i=virtualViewer.getCurrentState(0);i&&i.isMedia()&&u.getOuterDivFromState(i).css({overflow:"hidden"}),virtualViewer.delayedPaintCanvases()},h.prototype.copyToNewDocument=function(a){var n=M.getSelectedPageNumbers();if(a&&n.length>=virtualViewer.getPageCount()){var o=t.getLocalizedValue("errors.onePageLimit","Document must contain at least 1 page"),i={client:!0,disable:M.disableErrorModals.pageLimit};return ft(o,i),!1}if(U){this.setFullScreenThumbsVisibility(!1);var r=U(),s="TIFF",l=n[0];"PDF"===M.getCurrentState(0).getFormatForPage(l)&&(s="PDF");for(var d=[],c=0;c<n.length;c++)d[c]=n[c]+1;d=d.toString(),
M.saveDocument(M.getDocumentId(0),{newDocumentId:r,newDisplayName:r,burnRedactions:!1,includeRedactionTags:!1,includeTextAnnotations:!1,includeNonTextAnnotations:!1,copyAnnotations:!0,includeDocumentNotes:!1,includeWatermarks:!1,saveAsFormat:s,pageRangeType:"complex",pageRangeValue:d,copyWatermarks:!0,useCut:a,pageNums:n})}else{var g=u.getActivePaneState(),v="pdf",p=M.getSaveAsDocumentNameGenerator(),h=p(g.getDocumentId(),g.getDisplayName(),v);M.copySelection(!1,function(){e("vvDialogs").copyToNewDialog(h,a,n)})}},h.prototype.createTextAnnContextMenuList=function(){if(s(virtualViewer).annotationToolbarButtons.vvAnnText){if($(".vvAnnText .dropdown-menu").empty(),!r.enableTextRubberStamp||!q.customStampArray.length)return $(".vvAnnText.vvHasSubDropdown, .vvAnnText.dropdown").removeClass("vvHasSubDropdown dropdown"),void $("a.vvAnnText.dropdown-toggle").attr("data-toggle","");$(".vvAnnText").addClass("vvHasSubDropdown dropdown"),$("a.vvAnnText.dropdown-toggle").attr("data-toggle","dropdown");var e=t.getLocalizedValue("textAnnContextMenu.newTextAnn","New Text Ann"),a=$.templates("#vvStampDropdownItemTemplate");$(a.render({displayName:e})).appendTo(".vvAnnText .dropdown-menu").on("click",function(){virtualViewer.currentStamp=null,virtualViewer.turnOnAnnotationButton(o.annotationTypes.SANN_EDIT,$(".vvAnnText")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()}),$(a.render(q.customStampArray)).appendTo(".vvAnnText .dropdown-menu").on("click",function(){var e=$(this).data("stamp-row-index");virtualViewer.currentStamp=e,virtualViewer.turnOnAnnotationButton(o.annotationTypes.SANN_EDIT,$(".vvAnnText")),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu()})}},h.prototype.openInTab=function(e){if(e){e=e.trim();var t=M.getStateForDocumentId(e,0),a=virtualViewer.getFromDocumentList(e)||{documentId:e,displayName:null};lt();for(var n=0;n<M.newRecentlyViewedList.length;n++)if(e===M.newRecentlyViewedList[n].documentId){a.displayName||(a.displayName=M.newRecentlyViewedList[n].displayName);break}if(this.addToRecentlyViewed(a),r.multipleDocMode===o.multipleDocModes.viewedDocuments&&this.requestDocumentList(),$("#vvImagePanel").width()<$("#vvThumbs").width()&&virtualViewer.toggleThumbnailPanel(!1),t&&g.tabExists(e))return void this.switchToTab(t);if(g.canAddTab()){this.setFullScreenThumbsVisibility(!1),t?t.getClosedTab()&&(t.setZoomMode(q.getDefaultZoomMode()),t.setZoom(q.getDefaultZoomLevel())):(t=u.openNewState({documentId:e,pageNumber:0,zoomMode:q.getDefaultZoomMode(),paneIndex:0,displayName:a.displayName}),t.setZoom(q.getDefaultZoomLevel()),newState=!0),g.addTab(t,newState);var i=Boolean(t.documentFullyLoaded()&&t.getImageManager()&&t.getImageManager().getOriginalFromPage(t.pageNumber));t&&(i||t.isMediaLoaded())||this.displayWaitIndicator(!0,t),r.disableImageTabs&&t.setClosedTab(!1),this.switchToTab(t,!0)}}},h.prototype.switchToTab=function(a,n){if(a){oe&&M.setActivePane(0),this.clearFocusedLink();var i,s=M.getDocumentId(0);s!==a.getDocumentId()&&(i=M.getStateForDocumentId(s,0)),a.isMedia()&&p.open&&virtualViewer.toggleFullscreenThumbs(),Re(a),this.setPreviousAnnObject(this.getCurrentAnnObject()),this.destroyInProgressAnnotation(),this.hideAnnPopUp(),v.clearDocumentLinkPopover(),M.clearCanvases(a,$("#vvImageCanvas")[0]);var l=e("vvThumbs"),c=null;if(l.removeThumbs($("#vvPageThumbs")),$(".thumbTabs").removeClass("disabledTab"),p.removeAllThumbs(),p.fillGridThumbs(a),d.handleSearchOnTabSwitch(a,i),$("#vvThumbs li:eq(0) a").tab("show"),je(a),He(),i&&(c=i.getZoom(),i.documentModel&&i.isMedia()&&i.getMediaManager().hideMediaDiv(),ut(i)),u.setDisplayedState(a,0),Q.switchTabs(i,a),a.requestDocumentModel(!1,function(){Wt(a)}),r.fitLastBetweenDocuments&&c&&(a.setZoomMode(o.zoomModes.fitCustom),a.setZoom(c)),Sa(a),this.sizeScroller({state:a}),l.highlightActiveThumbnail(),La(),this.resetGuides(),t.cursorNormal(),this.setDragMode(o.dragModes.pan),$("#vvDocumentNoteContentInput").val(""),a.isMedia()){this.mediaThumbPrep(a);var h=a.getMediaManager();h.showMediaDiv(),h.resizeMedia(),p.disableToggleButton(!0)}else this.setPageCore(a.pageNumber,a),$("#vvDocumentNotes").removeClass("hideTabContents"),p.disableToggleButton(!1);g.selectTab(a),r.positionLastBetweenDocuments&&i?n?dt(a,i):(ct(a,i),a.clearCachedScroll()):ct(a),M.openDefaultThumb(),X.getMagnifierEnabled()&&X.getMagnifiedImage(a),r.collapseStickiesByDefault&&M.collapseAllStickyNotes(!0),r.enableDocumentNotes&&a.documentModel&&a.documentModel.model.documentNotes&&Y.loadDocumentNotes(),virtualViewer.fillAnnotationList(),we(a),Wt(a),"#vvScreenReaderDiv".length&&($("#vvScreenReaderDiv").empty(),ee.setUpScreenReaderDiv(a)),Ua(),a.getDocumentId()===ee.getDocumentIdToBeRead()&&ee.getStartedPlaying()&&"none"===$("#vvScreenReaderControlsPopUp")[0].style.display&&M.toggleSpeechControls();var m={documentId:a.documentId};K.call("switchToTab",m),i&&(m={currentTabDocumentId:a.documentId,previousTabDocumentId:i.documentId},K.call("switchBetweenTabs",m))}},h.prototype.onDocumentModelError=function(e){virtualViewer.closeDocument(e.documentId,e.paneIndex,null,!0)},h.prototype.onDocumentModelLoad=function(e){var t=u.getStateForDocumentId(e.documentId,e.paneIndex);if(t&&!t.closedTab&&(M.requestAnnotations(t),u.displayedDocuments[t.currentPaneIndex]===t.getDocumentId())){if(Sa(t),M.sizeScroller({state:t}),La(),Re(),t.isMedia())return M.mediaThumbPrep(t),t.getMediaManager().fixMediaDivs(t),void t.getMediaManager().getMedia(t);var a=u.getCurrentDiff();oe&&(!a||a.diffDisabled||a.diffDisabledUntilSave?a?Ka():M.performDiff():M.performDiff(!1,!0)),ee.setUpScreenReaderDiv(t),0===t.currentPaneIndex&&we(t);let e=t.getDocumentModel().model;e.emailAttachmentInfo&&e.emailAttachmentInfo.length&&g.addEmailAttachmentsDropdown(t.getTabNumber(),e.emailAttachmentInfo,it)}};var it=function(e){let t=$(this).data("attachmentIndex");if("number"==typeof t){let e=$(this).data("documentId"),i=u.getStateForDocumentId(e,0);if(i){let e=i.getDocumentModel().model.emailAttachmentInfo,s=e[t];if(s.downloadOnly)return void $("#vvDownloadEmailAttachmentDialog").addClass("downloadOnly").removeClass("attachmentError").data("emailAttachment",s).modal("show");var a=function(e){$("#vvDownloadEmailAttachmentDialog").addClass("attachmentError").removeClass("downloadOnly").data("emailAttachment",s).modal("show")},n=function(e){let t=e.documentIdToReload;virtualViewer.openInTab(t),r.multipleDocMode!==o.multipleDocModes.viewedDocuments&&virtualViewer.requestDocumentList()};virtualViewer.createDocumentFromAttachment(s,n,a)}}};h.prototype.closeLastTab=function(t){t=t||M.getActivePaneState(),(r.splitScreen||oe)&&M.undoSplitScreen(),r.showAnnNavToggle&&($("#vvPageThumbs").hasClass("vvAnnotationNavigation")&&virtualViewer.showAnnotationNaviPanel(!1),$("#vvAnnotationIndicatorToggle").hide()),p.removeAllThumbs(),$("#vvFullThumbs").is(":visible")&&M.toggleFullscreenThumbs(),M.clearCanvases(t,$("#vvImageCanvas")[0]),$("#vvDummyScroller").height(0),e("vvThumbs").removeThumbs($("#vvPageThumbs")),t.isMedia()&&t.getMediaManager().hideMediaDiv(),M.openDefaultThumb()},h.prototype.closeDocument=function(e,t,a,n){var o=u.getStateForDocumentId(e,t);o&&o.currentPaneIndex===t&&(e===ee.getDocumentIdToBeRead()&&ee.getStartedPlaying()&&(ee.stopSpeech(),M.toggleSpeechControls()),"none"!==$("#vvScreenReaderControlsPopUp")[0].style.display&&M.toggleSpeechControls(),t>0?a?this.splitScreen(a):this.undoSplitScreen():this.closeTab(e,n),Re(),o.clearNewAnnList(),o.clearNewWMList(),u.removeStateForDocumentId(e,t))},h.prototype.closeTab=function(e){"string"==typeof e&&""!==e||"number"==typeof e||(e=g.activeTab);var a=g.findTab(e);if(a<0&&!j){var n=t.getLocalizedValue("errors.tabIndexOutOfBounds","Tab index out of bounds."),o={client:!0,disable:this.disableErrorModals.tabs};return void ft(n,o)}g.isOnlyTab(a)&&(M.closeLastTab(M.getActivePaneState()),Q.bookmarkArray.length>0&&Q.clearAllBookmarks(),M.docHasNotes()&&Ze(),X.getMagnifierEnabled()&&X.toggleMagnifier(),$("#vvDocumentNotes").addClass("hideTabContents"));var i=g.getIdFromTab(a),r=M.getStateForDocumentId(i);if(sn({state:!0,fullThumbsAllowed:!0},r)){r.isMedia()&&r.getMediaManager().player.pause(),$("#vvAnnPopUp").length&&M.hideAnnPopUp(),r.setTabNumber(null),r.setClosedTab(!0),g.removeTab(a);var r=M.getStateForDocumentId(g.getActiveTabId());r&&this.switchToTab(r),u.removeStateForDocumentId(i,0);var s={closedDocumentId:i};K.call("afterTabClosed",s)}},h.prototype.confirmCloseDialog=function(t,a){if(!t||!t.documentModel.getModifiedSinceInit())return void Re();var n=function(){t.closedTab=!0,M.saveDocument(t.getDocumentId(),{documentPaneIndex:t.currentPaneIndex,skipOverwriteDialog:!0}),M.closeDocument(t.getDocumentId(),t.currentPaneIndex,a)},o=function(){M.closeDocument(t.getDocumentId(),t.currentPaneIndex,a)},i=t.getDisplayName()||t.getDocumentId();e("vvDialogs").confirmChangesDialog(n,o,i,this.willSavingOverwriteCurrentFormat(t))},h.prototype.updateTabName=function(e,t){g.updateTabName(e,t)},h.prototype.getActiveTab=function(){return g.getActiveTab()},h.prototype.addToRecentlyViewed=function(e){if(r.orderViewedDocumentsByFirstOpened){let t=rt(e);if(t>-1)return}else this.removeFromRecentlyViewed(e);let t=r.recentlyViewedDocumentsListLength||o.mostRecentlyViewedListLength;M.newRecentlyViewedList.length===t&&M.newRecentlyViewedList.pop(),M.newRecentlyViewedList.unshift(e),st()},h.prototype.updateInRecentlyViewed=function(e,t){let a=rt(e);a!==-1&&(r.orderViewedDocumentsByFirstOpened?(M.newRecentlyViewedList[a].documentId=t.documentId,M.newRecentlyViewedList[a].displayName=t.displayName):(M.newRecentlyViewedList.splice(a,1),M.newRecentlyViewedList.unshift(t)),st())},h.prototype.removeFromRecentlyViewed=function(e){let t=rt(e);t>-1&&M.newRecentlyViewedList.splice(t,1),st()};var rt=function(e){for(var t=0;t<M.newRecentlyViewedList.length;t++){var a=M.newRecentlyViewedList[t].documentId;if(a===e.documentId)return t}return-1},st=function(){if(r.disableRecentlyViewedCookie)return!1;var e=new Date;e.setDate(e.getDate()+365);var t=JSON.stringify(M.newRecentlyViewedList);t&&(document.cookie="newRecentlyViewedList="+encodeURIComponent(t)+";expires="+e.toGMTString()+";samesite=strict")},lt=function(){if(r.disableRecentlyViewedCookie)return!1;if(document.cookie.length>0){var e="newRecentlyViewedList",t=document.cookie.indexOf(e+"="),a=-1;if(t!==-1){t+=e.length+1,a=document.cookie.indexOf(";",t),a===-1&&(a=document.cookie.length);var n=decodeURIComponent(document.cookie.substring(t,a));if(!n.startsWith("[{"))return!1;for(var o=JSON.parse(n),i=0;i<o.length;i+=1)M.newRecentlyViewedList[i]={},M.newRecentlyViewedList[i].documentId=o[i].documentId,M.newRecentlyViewedList[i].displayName=o[i].displayName,M.newRecentlyViewedList[i]||M.newRecentlyViewedList.splice(i,1);return!0}if(e="recentlyViewedList",t=document.cookie.indexOf(e+"="),t!==-1){t+=e.length+1,a=document.cookie.indexOf(";",t),a===-1&&(a=document.cookie.length),this.recentlyViewedList=decodeURIComponent(document.cookie.substring(t,a)).split(",");for(var s=0;s<this.recentlyViewedList.length;s+=1)M.newRecentlyViewedList[s]={},M.newRecentlyViewedList[s].documentId=decodeURIComponent(this.recentlyViewedList[s]),M.newRecentlyViewedList[s]||M.newRecentlyViewedList.splice(s,1);return!0}return!1}return!1};h.prototype.resetGuides=function(){this.horizontalGuide.visible=!1,this.horizontalGuide.locked=!1,this.verticalGuide.visible=!1,this.verticalGuide.locked=!1};var ut=function(e){if(e=e||M.getActivePaneState(),e&&!e.isMedia()){var t=u.getOuterDivFromState(e);e.setCachedScrollLeft(t.scrollLeft()),e.setCachedScrollTop(t.scrollTop())}},dt=function(e,t){e=e||u.getActivePaneState(),t&&(e.setCachedScrollLeft(t.getCachedScrollLeft()),e.setCachedScrollTop(t.getCachedScrollTop()))},ct=function(e,t){e=e||u.getActivePaneState(),t=t||e;var a=u.getOuterDivFromState(e),n=t.getCachedScrollLeft(),o=t.getCachedScrollTop();if("number"!=typeof n||"number"!=typeof o)return!1;var i=nt(a);return i<=n&&M.sizeScroller({state:e}),a.scrollLeft(n),a.scrollTop(o),!0};h.prototype.parseClientInstanceId=function(){var e="clientInstanceId",t=document.cookie.indexOf(e+"="),a=null;if(t!==-1){t=t+e.length+1;var n=document.cookie.indexOf(";",t);n===-1&&(n=document.cookie.length),a=decodeURIComponent(document.cookie.substring(t,n))}return a||(a=gt("clientInstanceId")),a},h.prototype.getClientInstanceId=function(){return"string"!=typeof this.clientInstanceId&&this.setClientInstanceId(this.parseClientInstanceId()),this.clientInstanceId},h.prototype.setClientInstanceId=function(e){this.clientInstanceId=e},h.prototype.requestDocumentModel=function(e,t,a){e||(e=u.getActivePaneState()),e.requestDocumentModel(t,a)},h.prototype.requestDocumentList=function(){var t=e("vvThumbs"),a=new URI(r.servletPath);a.addQuery("action","getDocumentList"),a.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query("");var i=[];if(this.documentList&&r.showDocThumbnails)for(var s=$("#vvDocThumbs .vvThumbBox.vvDocumentIndicator"),l=0;l<s.length;l++)i.push($(s[l]).data().thumbInfo.documentId);r.multipleDocMode===o.multipleDocModes.availableDocuments?$.ajax({url:a.toString(),type:"POST",data:n,dataType:"json",success:function(e){if(mt(e)!==!0){if(e.documentList){M.documentList=[];for(var a=0;a<e.documentList.length;a+=1)M.documentList[a]=decodeURIComponent(e.documentList[a]),M.documentList[a]={},M.documentList[a].documentId=decodeURIComponent(e.documentList[a].documentId),e.documentList[a].displayName&&(M.documentList[a].displayName=decodeURIComponent(e.documentList[a].displayName))}else M.documentList=[];t.fillDocThumbs(M.documentList),t.ensureDocThumbIsVisible(),t.loadVisibleThumbs($("#vvDocThumbs")),M.addDocumentViewedIndicatorBatch(i)}},error:function(e){mt(e)||console.log("requestDocumentList: "+e.statusText)}}):r.multipleDocMode===o.multipleDocModes.specifiedDocuments?(t.fillDocThumbs(M.documentList),t.loadVisibleThumbs($("#vvDocThumbs")),M.addDocumentViewedIndicatorBatch(i)):r.multipleDocMode===o.multipleDocModes.viewedDocuments&&(lt()&&(this.documentList=M.newRecentlyViewedList.slice()),t.fillDocThumbs(this.documentList),t.loadVisibleThumbs($("#vvDocThumbs")),M.addDocumentViewedIndicatorBatch(i))};var gt=function(e){var t=new URI(window.location.href);return t.query(!0)[e]},vt=function(){var e=new URI(window.location.href);if(e.fragment()){var t=window.location.href.split("#");t.pop(),window.location=t.join()}};h.prototype.reloadDocumentModel=function(t,a,n){var o=this.getStateForDocumentId(t,a);o=o||this.getActivePaneState(),sn({state:!0,documentId:t,fullThumbsAllowed:!0},o)&&(0===o.currentPaneIndex&&u.displayedDocuments[o.currentPaneIndex]===o.getDocumentId()&&e("vvThumbs").removeThumbs($("#vvPageThumbs")),o.requestDocumentModel(!0,n))},h.prototype.reloadAndIgnoreXlsxPrintArea=function(e,t,a){var n=this.getStateForDocumentId(e,t);if(n=n||this.getActivePaneState(),sn({state:!0,documentId:e,fullThumbsAllowed:!0},n)){var o=function(){n.nukePageStates(),p.nukeThenReload(n),p.ensureThumbIsVisible(n),p.fillGridThumbs(n),Wt(n,!0),virtualViewer.reloadAnnotations(e,t),virtualViewer.delayedPaintCanvases(1e3),"function"==typeof a&&a()};n.requestDocumentModel(!0,o,{ignoreXlsxPrintArea:!0})}},h.prototype.reloadDocument=function(e,t,a){var n=this.getStateForDocumentId(e,t);if(n=n||this.getActivePaneState(),sn({state:!0,documentModel:!0,documentId:e,fullThumbsAllowed:!0},n)){var o=function(){n.nukePageStates(),p.nukeThenReload(n),p.ensureThumbIsVisible(n),p.fillGridThumbs(n),Wt(n,!0),virtualViewer.reloadAnnotations(e,t),virtualViewer.delayedPaintCanvases(1e3),"function"==typeof a&&a()};this.reloadDocumentModel(e,t,o)}},h.prototype.reloadAnnotations=function(e,a){var n=this.getStateForDocumentId(e,a);if(n=n||this.getActivePaneState(),sn({state:!0,documentModel:!0,documentId:e,fullThumbsAllowed:!0},n)){if(n.getPagesAddedOrRemovedSinceInit())return message=t.getLocalizedValue("errors.reloadAnnotationDisabled","Reloading Annotations is disabled on documents where pages have been manipulated. Please reload entire document."),virtualViewer.displayExceptionMessage(message),!1;$("#vvAnnPopUp:visible").length&&virtualViewer.hideAnnPopUp(),n.clearAllLayers(),n.rollbackModelLayers(),this.requestAnnotations(n,{reloadAnnotations:!0,force:!1})}};var pt=function(e){_a(e.disableUploadDocument),M.ocrEnabled=e.ocrEnabled,r.enableCacheObfuscation=e.cacheObfuscationEnabled,"boolean"!=typeof r.enableCustomOpacity&&(r.enableCustomOpacity=e.canSaveCustomOpacity)};h.prototype.defaultSaveAsDocumentCallback=function(e){var t=virtualViewer.getStateForDocumentId(e.newDocumentId);if(t){if(!t.getClosedTab()){var a=t.getTabNumber();M.closeTab(a,!0)}u.removeStateForDocumentId(t.documentId,t.currentPaneIndex),M.removeFromRecentlyViewed({documentId:t.documentId})}M.openInTab(e.newDocumentId),M.requestDocumentList()},h.prototype.defaultUploadDocumentCallback=function(e){M.openInTab(e.uploadedDocumentId),M.requestDocumentList()},h.prototype.onPageLoaded=function(e){var t=u.getStateForDocumentId(e.documentId,e.paneIndex);if(t){var a=e.loadedPageNumber,n=e.searchableStatusBeforeLoad,i=!1;t.getZoomMode()!==o.zoomModes.fitCustom&&a===t.pageNumber&&(i=!0),M.determineEffectiveZoom(a,t),i&&ma(t),M.delayedPaintCanvases(),Re();for(var s=0;s<M.newRecentlyViewedList.length;s++)if(t.getDocumentId()===M.newRecentlyViewedList[s].documentId){M.newRecentlyViewedList[s].displayName=t.getDisplayName(),st();break}ht(n);var l=!!r.preferServerDisplayName,d=e.newDisplayName;if(t.isVirtualDocument())t.getDisplayName()||M.setDisplayName(e.documentId);else if((r.multipleDocMode===o.multipleDocModes.specifiedDocuments||r.multipleDocMode===o.multipleDocModes.viewedDocuments)&&M.documentList.length>0){for(var c=0;c<M.documentList.length;c++)if(M.documentList[c].documentId===e.documentId){t.getDisplayName()&&!l||(M.documentList[c].displayName&&!l?M.setDisplayName(M.documentList[c].displayName):d&&(M.documentList[c].displayName=d,M.setDisplayName(d,e.documentId)));break}}else!d||t.getDisplayName()&&!l||M.setDisplayName(d,e.documentId);0===e.paneIndex&&(je(t),g.updateTabName(t)),Ua()}};var ht=function(e){if(u.getCurrentDiff()&&null===e){var t=u.getCurrentDiff();t.diffDisabled||t.diffDisabledUntilSave||null!==t.oldDocument.state.getIsSearchable()&&null!==t.newDocument.state.getIsSearchable()&&virtualViewer.performDiff(!1,!0)}};h.prototype.handleTimeoutException=function(e,a){var n,o="";if(e&&(n=u.getStateForDocumentId(e,a)),!n)return o=t.getLocalizedValue("errors.requestTimeoutError","A request to the server took longer than expected, and was not completed."),e&&(o=e+": "+o),void console.error(o);++n.demerits>=(r.maximumTimeoutsOnDocument||3)?(n.markBadDocument(!0),o=e+t.getLocalizedValue("errors.requestTimeoutDocumentFinalError"," has experienced several server timeouts, and will not be available in the current session."),M.closeTab(n.getTabNumber(),!0)):o=e+": "+t.getLocalizedValue("errors.requestTimeoutError","A request to the server took longer than expected, and was not completed.");var i={client:!1,disable:M.disableErrorModals.timeout};ft(o,i),M.displayWaitIndicator(!1),M.displaySaveIndicator(!1)},h.prototype.handle500Status=function(e,a,n){let o=e.responseJSON||t.tryParseJsonFromBuffer(e);if(!o)return!1;switch(o.snowboundErrorCode){case-69:return virtualViewer.handleTimeoutException(a,n),!0;case 0:default:return!1}},h.prototype.checkServerException=function(e,t,a,n){return mt(e,t,a,n)};var mt=function(e,a,n,o){if(o=o||{},500===e.status&&virtualViewer.handle500Status(e,a,n))return!0;e.responseJSON&&(e=e.responseJSON),e.responseJSON||e.exceptionMessage||e.snowboundErrorCode||(e=t.tryParseJsonFromBuffer(e)||{});var i=e.exceptionMessage,r=e.snowboundErrorCode;if(r===-69)return virtualViewer.handleTimeoutException(a,n),!0;if(!i)return e.status&&200!==e.status;if(H)return!0;i=decodeURIComponent(i),a=a||virtualViewer.getDocumentId(n);var s={documentId:a,displayName:null};if(!o.suppressDownloadDialogs){if(i.includes("Format not supported"))return M.exportUnsupportedFile(a),virtualViewer.removeFromRecentlyViewed(s),!0;if(i.includes("Encrypted or Password Protected File")||i.includes("Password Protected Document"))return M.passwordProtectedFile(a),virtualViewer.removeFromRecentlyViewed(s),!0}return i.includes("A document by this name already exists.")&&(i=t.getLocalizedValue("uploadExistingDocument","A document by this name already exists. Please rename the file and try again")),i.includes("Document not found")&&(o.disable=M.disableErrorModals.documentNotFound,virtualViewer.removeFromRecentlyViewed(s)),"Internal error"===i&&(i=t.getLocalizedValue("errors.genericServerError","An error occurred while processing a server request")),ft(i,o),M.displayWaitIndicator(!1),M.displaySaveIndicator(!1),!0};h.prototype.displayExceptionMessage=function(e,t){ft(e,t)};var ft=function(e,t){t=t||{e:null},console.error(e,t.e);var a=virtualViewer.disableErrorModals||{},n=t.client&&a.client||!t.client&&a.server||t.disable;n||(H=$("#vvCurrentExceptionDialog"),H.modal("show"),$("#vvCurrentExceptionText").text(e))};h.prototype.exportUnsupportedFile=function(t){j=!0,e("vvThumbs").removeThumbs($("#vvPageThumbs")),M.displayWaitIndicator(!1),M.displaySaveIndicator(!1);var a=$("#vvExportUnsupportedFileDialog");a.data().documentId=t,a.modal("show")},h.prototype.passwordProtectedFile=function(t){j=!0,e("vvThumbs").removeThumbs($("#vvPageThumbs")),M.displayWaitIndicator(!1),M.displaySaveIndicator(!1);var a=$("#vvPasswordProtectedFileDialog");a.data().documentId=t,a.modal("show")},h.prototype.requestAnnotations=function(e,t){var a=e.getDocumentModel(),n=e.getPageNumber();if(t=t||{},a&&!e.isMedia()){var i=null;if(t.force&&e.clearAllLayers(),i=e.getLayersForPage(n),!i){var s=new URI(r.servletPath);s.addQuery("action","getAnnotationModel"),s.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),s.addQuery("modelJSON",JSON.stringify(a.model)),o.cacheBuster===!0&&s.addQuery("cacheBuster",Math.random()),s.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var u=s.query();s.query("");var d=a.model.layerManager.layers.length;$.ajax({url:s.toString(),type:"POST",data:u,dataType:"json",success:function(n){if(mt(n,e.getDocumentId(),e.currentPaneIndex))return void K.call("annotationLoadError",{documentId:e.getDocumentId(),paneIndex:e.currentPaneIndex,statusText:n.status,exceptionMessage:n.exceptionMessage});for(var o=n,i=0;i<d;i+=1){var r=a.model.layerManager.layers[i],s=decodeURIComponent(r.annotationId),u=o[s];if(!u)break;for(var c=0;c<u.length;c+=1){var g=u[c];if(g)l.parseLayer($.parseXML(g),e,c);else{var v=l.createAnnotationLayer(s,c,e.pageStates[c]);v.isRedaction=r.isRedaction,v.permissionLevel=r.permissionLevel,v.doubleByte=r.defaultDoubleByte,e.addLayerToPage(c,v)}}}0===M.pagesWithAnnotationsCore(e).length&&virtualViewer.showAnnotationNaviPanel(!1),$("#vvImageCanvas")&&virtualViewer.delayedPaintCanvases(),t.reloadAnnotations&&(e.removeAnnotationsOnCroppedPages(),virtualViewer.removeAllAnnotationIndicators()),virtualViewer.getCurrentState()===e&&virtualViewer.showAllAnnotationIndicators(),virtualViewer.fillAnnotationList(),e.documentModel.setAnnotationsModifiedSinceInit(!1,e),K.call("annotationLoadCompleted",{documentId:e.getDocumentId(),paneIndex:e.currentPaneIndex})},error:function(t){mt(t,e.getDocumentId(),e.currentPaneIndex)||console.log("requestAnnotations: "+t.statusText),K.call("annotationLoadError",{documentId:e.getDocumentId(),paneIndex:e.currentPaneIndex,statusText:t.statusText})}})}}},h.prototype.getPagePropertyByFieldId=function(e){if(sn({state:!0,fullThumbsAllowed:!0}))return P(e,M.getActivePaneState())},h.prototype.getPagePropertyByCaption=function(e){if(sn({state:!0,fullThumbsAllowed:!0}))for(var t=0;t<r.imageInfoFields.length;t++){var a=r.imageInfoFields[t].fieldCaption;if(a===e){var n=r.imageInfoFields[t].fieldId;return P(n,M.getCurrentState())}}},h.prototype.getPageProperties=function(){if(sn({state:!0,notVideo:!0,fullThumbsAllowed:!0})){retVal=[];for(var e,a,n,o,i=0;i<r.imageInfoFields.length;i++){e=r.imageInfoFields[i].fieldId;var s=r.imageInfoFields[i].fieldCaption;a=t.getLocalizedValue("imageInfo."+e,s),n=P(e,u.getActivePaneState()),n||(n="N/A"),o=A(n),retVal[i]={},retVal[i].fieldId=e,retVal[i].fieldValue=o,retVal[i].fieldCaption=a}return retVal}},h.prototype.setPageDisplayNames=function(e){var t=u.getActivePaneState();sn({state:!0,documentModel:!0,fullThumbsAllowed:!0},t)&&t.setPageDisplayNames(e)},h.prototype.pageHasText=function(){if(sn({state:!0,notVideo:!0,fullThumbsAllowed:!0})){var e=u.getActivePaneState(),t=e.getPageText(e.getPageNumber());return!!t&&t.wordRects.length>0}},h.prototype.getIsAnnButtonSticky=function(){return ge},h.prototype.undoAnnotation=function(){if(sn({state:!0,documentModel:!0,notVideo:!0})){virtualViewer.hideAnnPopUp();var e=u.getActivePaneState(),t=e.getUndoObjectArray(e.getPageNumber()),a=e.getUndoIndex(e.getPageNumber());if(!(a<0)&&t[a]){var n=t[a],o=n.referenceAnn,i=n.layer;if("modify"===n.type)n.unchangedAnn&&o&&(o.copyFrom(n.unchangedAnn),l.markLayerDirty(i),virtualViewer.delayedPaintCanvases(),M.pageContainsAnnotations(M.getPageNumber())&&!M.pageHasIndicator(e.getPageNumber())&&(virtualViewer.showAnnotationIndicator(e.getPageNumber()),M.addToPagesWithAnnotations(e.getPageNumber())));else if(i.anns.length>0){l.markLayerDirty(i);var r=i.anns.pop();e.pushPoppedObject(e.getPageNumber(),r),virtualViewer.setPreviousAnnObject(virtualViewer.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null),virtualViewer.delayedPaintCanvases(),!M.pageContainsAnnotations(e.getPageNumber())&&M.pageHasIndicator(e.getPageNumber())&&(virtualViewer.removeAnnotationIndicators(e.getPageNumber()),M.removeFromPagesWithAnnotations(e.getPageNumber()))}a>=0&&(a--,e.setUndoIndex(e.getPageNumber(),a))}}},h.prototype.redoAnnotation=function(){if(sn({state:!0,documentModel:!0,notVideo:!0})){var e=u.getActivePaneState(),t=e.getUndoObjectArray(e.getPageNumber()),a=e.getUndoIndex(e.getPageNumber())+1;if(t[a]){var n=t[a],o=n.referenceAnn,i=n.layer;if("modify"===n.type)n.modifiedAnn&&o&&(o.copyFrom(n.modifiedAnn),l.markLayerDirty(i),virtualViewer.delayedPaintCanvases(),!M.pageContainsAnnotations(e.getPageNumber())&&M.pageHasIndicator(e.getPageNumber())&&(virtualViewer.removeAnnotationIndicators(e.getPageNumber()),M.removeFromPagesWithAnnotations(e.getPageNumber())));else if(e.getPoppedObjectArray(e.getPageNumber()).length>0){var r=e.popPoppedObject(e.getPageNumber());i.anns.push(r),l.markLayerDirty(i),virtualViewer.clearCanvases(e),virtualViewer.delayedPaintCanvases(),M.pageContainsAnnotations(e.getPageNumber())&&!M.pageHasIndicator(e.getPageNumber())&&(virtualViewer.showAnnotationIndicator(e.getPageNumber()),M.addToPagesWithAnnotations(e.getPageNumber()))}(0===a||a<=t.length-1)&&e.setUndoIndex(e.getPageNumber(),a)}}},h.prototype.getAnnClipboard=function(){return ce},h.prototype.setAnnClipboard=function(e){ce=e};var yt=function(){return r.autoLayerPrefix},bt=function(){return r.autoLayerSuffix},Pt=function(e,a){var n,i=yt(),r=bt(),s=o.autoLayerName;if(a=a||M.getActivePaneState(),!a.autoLayerCounter){a.autoLayerCounter=0;for(var l=a.getLayerNames(),u=0;u<l.length;u++)for(var d=l[u],c=d.split("-"),g=0;g<c.length;g++)if(c[g]===o.autoLayerName&&c[g+1]){var v=parseInt(c[g+1],10);a.autoLayerCounter=Math.max(v,a.autoLayerCounter);break}a.autoLayerCounter++}var p=a.autoLayerCounter;return n=e?o.redactionLayerPrefix+"-"+t.vvGUID():i&&r?i+"-"+s+"-"+p+"."+r:i&&!r?i+"-"+s+"-"+p:!i&&r?s+"-"+p+"."+r:s+"-"+p,a.autoLayerCounter++,n};h.prototype.createAutoLayer=function(e){return Tt(e)};var Tt=function(e){var t=virtualViewer.getActivePaneState(),a=Pt(e,t);return l.createLayer(a)};h.prototype.consolidateAnnotationLayers=function(){if(sn({state:!0,documentModel:!0,notVideo:!0})&&r.enableConsolidateAnnotationLayer&&!r.oneLayerPerAnnotation){var e=u.getActivePaneState(),a=e.getLayerNames(),n=r.consolidateLayerName||"Master Layer",o={client:!0,disable:M.disableErrorModals.annotations};if(!a.length){var i=t.getLocalizedValue("errors.noLayersExist","No Layers Exist.");return void ft(i,o)}if(a.indexOf(n)>-1){var i=t.getLocalizedValue("errors.masterLayerExists","Please delete your current Master Layer to create another.");return void ft(i,o)}l.createLayer(n),g.updateTabName(e);for(var s=0;s<e.getPageCount();s++)for(var d=e.getLayersForPage(s),c=d[n],v=Object.keys(d),p=0;p<v.length;p++){var h=d[v[p]];if(h&&h.layerName!==n)for(var m=0;m<h.anns.length;m++){var f=h.anns[m].clone();f.setLayerName(n),e.getOriginalWidthForPage(s)||c.pageWidth||(c.pageWidth=f.pageWidth,c.pageHeight=f.pageHeight,c.docDPI=f.docDPI),c.anns.push(f),e.setViewedForPage(s,!0)}}}};var At=function(e){var a=u.getActivePaneState(),n=a.getLayerNames(),o=[],i=[];if(!n)return[];for(var r=0;r<a.getPageCount();r++){var s=a.getLayersForPage(r);if(s)for(var l=Object.keys(s),d=0;d<l.length;d++){var c=s[l[d]];if(c)for(var g=c.anns,v=0;v<g.length;v++){var p=g[v];o.indexOf(p)!==-1||p.annDelete||(t.isRedactionLayer(c)?e&&i.push(p):o.push(p))}}}return e?i:o};h.prototype.getRedactionsFromLayers=function(){return At(!0)},h.prototype.getAnnotationCount=function(){return At(!1).length},h.prototype.getRedactionCount=function(){return At(!0).length},h.prototype.getRedactionPages=function(){for(var e=At(!0),t=[],a=0;a<e.length;a++)t.indexOf(e[a].page)===-1&&t.push(e[a].page);return t};var It=function(t){M.setPage(t.page),M.setCurrentAnnObject(t),M.getActiveOuterDiv().scrollTop(M.getScrollSpeed()*t.page+t.getAdjustedTop()),e("vvThumbs").highlightActiveThumbnail()},St=function(e,t){for(var a,n=0;n<t.length;n++)if(t[n].page===e){a=t[n];break}return a},wt=function(e,a){e||(e=M.getRedactionPages()),a||(a=At(!0));var n;if(M.getCurrentAnnObject()&&t.isRedactionLayer(l.getLayerWithAnn(M.getCurrentAnnObject()))){var o=a.indexOf(M.getCurrentAnnObject())-1;a[o]&&(n=a[o])}if(!M.getCurrentAnnObject()||!t.isRedactionLayer(l.getLayerWithAnn(M.getCurrentAnnObject()))){var i=M.getCurrentState().getPageNumber();if(e.indexOf(i)>-1)n=St(i,a);else{var r=M.closestLowest(i,e);n=St(r,a)}}return n};h.prototype.goToPreviousRedaction=function(){var e,t=At(!0),a=M.getRedactionPages(),n=a[0];!a||M.getCurrentState().getPageNumber()<n||(e=wt(a,t),e&&"true"!==$("#vvPrevAnnotationButton").prop("disabled")&&(It(e),xt(e,t)))};var Ct=function(e,a){e||(e=M.getRedactionPages()),a||(a=At(!0));var n;if(M.getCurrentAnnObject()&&t.isRedactionLayer(l.getLayerWithAnn(M.getCurrentAnnObject()))){var o=a.indexOf(M.getCurrentAnnObject())+1;a[o]&&(n=a[o])}if(!M.getCurrentAnnObject()||!t.isRedactionLayer(l.getLayerWithAnn(M.getCurrentAnnObject()))){var i=M.getCurrentState().getPageNumber();if(e.indexOf(i)>-1)n=St(i,a);else{var r=M.closestHighest(i,e);n=St(r,a)}}return n};h.prototype.goToNextRedaction=function(){var e,t=At(!0),a=M.getRedactionPages(),n=a[a.length-1];!a||M.getCurrentState().page>n||(e=Ct(a,t),e&&(It(e),xt(e,t)))};var Dt=function(){$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"),$("#vvAnnotationThumbsButton").prop("disabled",!0).addClass("disabled").tooltip("hide")},Mt=function(){$("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled")},xt=function(e,t){$("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"),e===t[t.length-1]?$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide"):e===t[0]&&$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide")};h.prototype.toggleAnnotationVisibility=function(e){if(sn({state:!0,documentModel:!0,notVideo:!0})){var t=u.getActivePaneState();t.getLayerManager().toggleAllAnnotationLayersVisibility(e,t)}},h.prototype.event=function(e,t,a){
if(r.enableEventNotification!==!1){a=a||{},e=e||u.getActivePaneState();var n=new URI(r.servletPath),i={action:"eventNotification",KEY_EVENT:t,clientInstanceId:virtualViewer.getClientInstanceId(),overrideLoggingLevel:virtualViewer.loggingOverride()};i=$.extend(i,a),i.KEY_DOCUMENT_ID||(i.KEY_DOCUMENT_ID=e.getDocumentId()),o.cacheBuster&&(i.cacheBuster=Math.random()),$.ajax({url:n.toString(),type:"POST",data:i,dataType:"json",success:function(e){mt(e)===!0},error:function(t){mt(t,a.KEY_DOCUMENT_ID,e?e.currentPaneIndex:null)===!0}})}};var Lt=function(e){M.event(e,"VALUE_EVENT_PAGE_REQUESTED",{KEY_EVENT_PAGE_REQUESTED_NUMBER:e.pageNumber})},Nt=function(){for(var e=u.getActivePaneState(),t={KEY_EVENT_PAGE_REQUESTED_NUMBER:e.pageNumber},a=e.getLayerNames(),n=0;n<a.length;n+=1)t["KEY_EVENT_SAVE_ANNOTATION_LAYER_NAME"+n]=a[n];M.event(e,"VALUE_EVENT_SAVE_ANNOTATION",t)},Vt=function(e,t){for(var a=u.getActivePaneState(),n={KEY_EVENT_ROTATE_PAGE:e,VALUE_EVENT_ROTATE_DEGREES:t},o=0;o<e.length;o+=1)n["KEY_EVENT_ROTATE_PAGE"+o]=e[o];M.event(a,"VALUE_EVENT_ROTATE_PAGE",n)};h.prototype.createPreviewAnnotation=function(e,t,a,n){if(!r.readOnlyAnnotationMode||n.isCrop||n.isRubberbandZoom)return $t(e,t,a)};var kt=function(e,t,a,n){"use strict";var s=t.dragStartLeft,l=t.dragStartTop,u=t.dragStopLeft-s,d=t.dragStopTop-l;if(e===o.annotationTypes.SANN_BITMAP&&r.enableSingleClickImageRubberStamp){var c=J.stampArray[J.currentImageRubberStamp],g=n.getZoom();u=c.stampWidth*(g/100),d=c.stampHeight*(g/100),s+u>n.getRequestedWidthForPage(a)&&(s=n.getRequestedWidthForPage(a)-u),l+d>n.getRequestedHeightForPage(a)&&(l=n.getRequestedHeightForPage(a)-d)}return new i(s,l,u,d)},$t=function(t,a,n){"use strict";n=n||u.getActivePaneState(),a||0===a||(a=n.getPageNumber()),Z.dragMode===o.dragModes.crop&&(O=o.annotationTypes.SANN_RECTANGLE);var i=kt(O,Z,a,n),s=n.getCurrentLayerOnPage(a)||l.createAnnotationLayer("temp",a,n.pageStates[a]),d=s.docDPI;s.isIDM&&(d=200);var c=G.getAnnotationPreference(O);t||(c=G.getInProgressAnnotationPreference(O),c.lineWidth&&(c.lineWidth*=n.getZoomDecimal())),"number"==typeof M.currentStamp&&M.currentStamp>-1&&$.extend(c,q.customStampArray[M.currentStamp]);var g=s.doubleByte;"boolean"!=typeof g&&(g=r.base64EncodeAnnotations),r.oneLayerPerAnnotation&&(g=r.base64EncodeAnnotations);var v=new(e("vvPreviewAnnotation"));if(v.initPreview(c,i,M.currentPointArray,g,d,s.isIDM,a,virtualViewer.getUsername()),s.pageWidth&&s.pageHeight?(v.setPageWidth(s.pageWidth),v.setPageHeight(s.pageHeight)):(v.setPageWidth(n.getRequestedWidthForPage(a)),v.setPageHeight(n.getRequestedHeightForPage(a))),t||(v.setPageWidth(n.getRequestedWidthForPage(a)),v.setPageHeight(n.getRequestedHeightForPage(a))),s.isFilenet&&(v.isFilenet=!0),s.isDaeja&&(v.isDaeja=!0),s.isIDM&&(v.isIDM=!0,v.getType()===o.annotationTypes.SANN_POSTIT&&v.setFontSize(200,!0)),v.getType()===o.annotationTypes.SANN_BITMAP){var p=J.getCurrentStamp();v.bitmapData=p.stampData,p.annotationId&&(v.annId=p.annotationId)}return v},Ft=function(e){return"string"!=typeof e&&(e=$("#vvAnnotationsListFilter input").val()),e?void $(".vvAnnotationItem").each(function(){var t=$(this),a=t.find(".vvAnnotationListInfoCreated .vvAnnotationListInfoUser div").text().toLowerCase(),n=t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoUser div").text().toLowerCase();return e=e.toLowerCase(),a.indexOf(e)!==-1||n.indexOf(e)!==-1?void t.show():void t.hide()}):void $(".vvAnnotationItem").show()},Rt=function(e){e.preventDefault();var t=$(this).text().trim();Ft(t),$("#vvAnnotationsListFilter input").val(t)};h.prototype.updateAnnotationListItem=function(e){if(r.showAnnotationList){var t=virtualViewer.getListItemFromAnnotation(e);if(t&&t.length){if(e.getDelete())return void t.remove();e.getTextString()&&t.find(".vvAnnotationListInfoText").text(e.getTextString()),t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoUser .vvAnnInfoEntry").text(e.getMostRecentModifyUser()),t.find(".vvAnnotationListInfoModified .vvAnnotationListInfoDate .vvAnnInfoEntry").text(e.getMostRecentModifyDateFormatted()),Ft()}}};var Bt=function(){var e=$("#vvAnnotationsListFilter input");e.on("keypress",Ft);var a=null;e.addClear({symbolClass:"text_clear_symbol icon",onClear:function(){Ft("")}}),e.keydown(function(){a&&clearTimeout(a),a=setTimeout(function(){Ft(e.val())},200)}),e.prop("placeholder",t.getLocalizedValue("annotationInfoList.filterByUser","Filter by User")),$("#vvFilterOptionsDropdownOptions li a").on("click",function(t){t.preventDefault(),Ft(""),e.val("")})};h.prototype.getListItemFromAnnotation=function(e){if(!e)return $();var t=$(".vvAnnPage"+e.page);if(!t||!t.length)return $();var a=t.find(".vvAnnotationItem").filter(function(){var t=$(this);return t.data("layername")===e.layerName&&t.data("ordinal")===e.ordinal});return a};var Et=function(e){var t=$(this),a=t.data("layername");if(a){for(var n,o=t.data("ordinal"),i=t.data("type"),r=u.getCurrentState(),s=r.getLayerFromPage(t.data("pagenumber"),a)||{anns:[]},l=s.anns,d=0;d<l.length;d++)if(l[d].ordinal===o&&l[d].type===i){n=l[d];break}n&&It(n)}};h.prototype.addUsersToDropDown=function(e,t){var a=$("#vvFilterOptionsDropdownOptions .vvAnnotationListUserOption a").filter(function(){var a=$(this).text().trim();if(a===e||a===t)return!0}),n={};e&&a.eq(0).text().trim()!==e&&a.eq(1).text().trim()!==e&&(n[e]=!0),t&&a.eq(0).text().trim()!==t&&a.eq(1).text().trim()!==t&&(n[t]=!0);var o=$($("#vvAnnotationListUserOptionTemplate").render(n));o.appendTo($("#vvFilterOptionsDropdownOptions")),o.on("click",Rt)},h.prototype.addSingleAnnotationListItem=function(e){if(r.showAnnotationList&&!this.getListItemFromAnnotation(e).length){var t=$($("#annotationListItemTemplate").render(e));t.on("click",Et),this.addUsersToDropDown(e.getMostRecentModifyUser(),e.createUser);var a=this.pagesWithAnnotationsCore(u.getCurrentState()),n=a.indexOf(e.page);if(n!==-1){var o=$(".vvAnnotationListPageDiv.vvAnnPage"+e.page);if(o.length&&o.data("pagenumber")===e.page)return void o.append(t);var i=$("<div></div>").addClass("vvAnnotationListPageDiv vvAnnPage"+e.page).data("pagenumber",e.page).append(t);if(o.length)return void o.before(i);$("#vvAnnotationsListInternal").append(i),Ft()}}},h.prototype.fillAnnotationList=function(){var e=u.getCurrentState();if(r.showAnnotationList&&e){var t=$("#vvAnnotationsListInternal");t.empty();for(var a=$("#annotationListItemTemplate"),n={},o=0;o<e.getPageCount();o++){for(var i=$("<div></div>").addClass("vvAnnotationListPageDiv vvAnnPage"+o).data("pagenumber",o),s=e.getAnnotationsForPage(o,!0)||[],l=0;l<s.length;l++){var d=$(a.render(s[l]));d.on("click",Et),i.append(d);var c=s[l].getMostRecentModifyUser(),g=s[l].createUser;n[c]=!0,n[g]=!0}s.length&&t.append(i)}n[q.getUsername()]=!0,$("#vvFilterOptionsDropdownOptions .vvAnnotationListUserOption").remove();var v=$($("#vvAnnotationListUserOptionTemplate").render(n));v.appendTo($("#vvFilterOptionsDropdownOptions")),v.on("click",Rt)}},h.prototype.thumbsWithAnnotations=function(){var e=M.getCurrentState();if(sn({state:!0,documentModel:!0,notVideo:!0},e)){for(var t=[],a=$("#vvPageThumbs .vvThumbBox"),n=0;n<e.getPageCount();n+=1)M.pageContainsAnnotations(n)&&t.push(a.eq(n));return t}},h.prototype.showThumbsWithAnnotations=function(){var a=M.getCurrentState();if(ne||$("#vvRedactionNavigationOption")[0].checked)$("#vvRedactionNavigationOption")[0].checked||($("#vvAnnotationThumbsButton").removeClass("ann-filter-on"),$("#vvPageThumbs .vvThumbBox").show(),M.showAllAnnotationIndicators(),ne=!1,$("#vvAnnotationThumbsButton").attr("title",t.getLocalizedValue("annotationNavigation.showThumbsWithAnnotationsOn","Turn Filter On")));else{$("#vvAnnotationThumbsButton").addClass("ann-filter-on");for(var n=0;n<a.getPageCount();n++)M.pageHasAnnotation(n)?M.removeAnnotationIndicators(n):$("#vvPageThumbs .vvThumbBox:eq("+n+")").hide();ne=!0,$("#vvAnnotationThumbsButton").attr("title",t.getLocalizedValue("annotationNavigation.showThumbsWithAnnotationsOff","Turn Filter Off")),e("vvThumbs").loadVisibleThumbs()}},h.prototype.showAnnotationIndicator=function(e){if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&r.showAnnIndicators&&!this.pageHasIndicator(e)){var t=$("#vvPageThumbs .vvThumbBox").eq(e);$("<div></div>",{class:"vvAnnotationIndicatorCheckmark icon"}).prependTo(t)}},h.prototype.removeAnnotationIndicators=function(e){sn({fullThumbsAllowed:!0})&&r.showAnnIndicators&&"number"==typeof e&&$("#vvPageThumbs .vvThumbBox:eq("+e+") .vvAnnotationIndicatorCheckmark").remove()},h.prototype.removeAllAnnotationIndicators=function(){sn({fullThumbsAllowed:!0})&&$("#vvPageThumbs").find(".vvAnnotationIndicatorCheckmark").remove()},h.prototype.showAllAnnotationIndicators=function(){if(r.showAnnIndicators&&sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})){var e=this.getCurrentState();if(e.isVirtualDocument())for(var t=0;t<e.getPageCount();t++)this.pageHasAnnotation(t,e)&&this.showAnnotationIndicator(t);else{var a=this.pagesWithAnnotations();ae=a;for(var n=0;n<a.length;n+=1)this.showAnnotationIndicator(a[n])}}},h.prototype.addDocumentViewedIndicator=function(t){e("vvThumbs").toggleDocViewedIndicator([t],!0)},h.prototype.removeDocumentViewedIndicator=function(t){e("vvThumbs").toggleDocViewedIndicator([t],!1)},h.prototype.addDocumentViewedIndicatorBatch=function(t){e("vvThumbs").toggleDocViewedIndicator(t,!0)},h.prototype.removeAllDocumentViewedIndicator=function(){$("#vvDocThumbs .vvThumbBox.vvDocumentIndicator").removeClass("vvDocumentIndicator"),$("#vvDocThumbs .vvThumbBox .vvDocumentIndicatorCheckmark").remove()},h.prototype.pageHasAnnotation=function(e,t){if(t=t||u.getCurrentState(),!t.pageStates||e>=t.getPageCount())return!1;for(var a=t.pageStates[e].annotationLayers||{},n=Object.keys(a),o=0;o<n.length;o++){var i=n[o];if(a[i]&&0!==a[i].anns.length)for(var r=a[i].anns,s=0;s<r.length;s++)if(!r[s].annDelete)return!0}return!1},h.prototype.closestHighest=function(e,t){for(var a=t.length-1,n=t[a],o=0;o<t.length;o++)t[o]>e&&t[o]<n&&(n=t[o]);return n};var Ot=function(e,t){var a,n=t.indexOf(e);return a=n===-1?M.closestHighest(e,t):t[n+1]};h.prototype.goToNextPageWithAnn=function(){var t=M.pagesWithAnnotations(),a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0})){var n,o=a.pageNumber,i=t[t.length-1];if($("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"),!t.length||o>=i)return void $("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide");n=Ot(o,t),virtualViewer.setPage(n),e("vvThumbs").highlightActiveThumbnail()}},h.prototype.closestLowest=function(e,t){for(var a=t[0],n=0;n<t.length;n++)t[n]<e&&t[n]>a&&(a=t[n]);return a};var _t=function(e,t){var a,n=t.indexOf(e);return a=n===-1?M.closestLowest(e,t):t[n-1]};h.prototype.goToPrevPageWithAnn=function(){var t=M.pagesWithAnnotations(),a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0})){var n,o=a.pageNumber;if($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),!o||!t.length||o<=t[0])return void $("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled").tooltip("hide");n=_t(o,t),virtualViewer.setPage(n),e("vvThumbs").highlightActiveThumbnail()}};var Ut=function(e,t){var a=t.length-1;t.length<=1?($("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled")):e===t[0]?($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!0).addClass("disabled")):e>=t[a]?($("#vvNextAnnotationButton").prop("disabled",!0).addClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled")):($("#vvNextAnnotationButton").prop("disabled",!1).removeClass("disabled"),$("#vvPrevAnnotationButton").prop("disabled",!1).removeClass("disabled"))};h.prototype.navigationButtonHandler=function(e){if(e){var t=At(!0),a=Ct(),n=wt();a&&xt(a,t),n&&xt(a,t)}else{var o=M.pagesWithAnnotations(),i=M.getActivePaneState().getPageNumber(),r=_t(i,o);r&&Ut(r,o);var s=Ot(i,o);s&&Ut(s,o)}},h.prototype.showAnnotationNaviPanel=function(e){var t=$("#vvPageThumbs");if(t.hasClass("vvAnnotationNavigation")&&!e||e===!1)return t.removeClass("vvAnnotationNavigation"),void t.addClass("vvAnnotationNavigationHidden");if(!sn({state:!0,notVideo:!0}))return t.removeClass("vvAnnotationNavigation"),void t.addClass("vvAnnotationNavigationHidden");var a=M.pagesWithAnnotations();t.addClass("vvAnnotationNavigation"),t.removeClass("vvAnnotationNavigationHidden"),M.createNavigationOptionsLabels(),a.length<=1&&($("#vvPrevAnnotationButton").attr("aria-disabled",!0),$("#vvNextAnnotationButton").attr("aria-disabled",!0))},h.prototype.navigationChangeHandler=function(e){"redaction"===$("input[name='radio']:checked").val()&&"vvNextAnnotationButton"===e.target.id?M.goToNextRedaction():"vvNextAnnotationButton"===e.target.id&&M.goToNextPageWithAnn(),"redaction"===$("input[name='radio']:checked").val()&&"vvPrevAnnotationButton"===e.target.id?M.goToPreviousRedaction():"vvPrevAnnotationButton"===e.target.id&&M.goToPrevPageWithAnn()},h.prototype.createNavigationOptionsLabels=function(){var e=M.getAnnotationCount(),t=M.getRedactionCount();$("#vvAnnotationNavigationOptionLabel").html("Annotations: "+e),$("#vvRedactionNavigationOptionLabel").html("Redactions: "+t)},h.prototype.pageHasIndicator=function(e){var t=$("#vvPageThumbs .vvThumbBox:eq("+e+") .vvAnnotationIndicatorCheckmark");return!!t.length},h.prototype.pagesWithAnnotations=function(){return this.pagesWithAnnotationsCore()},h.prototype.pagesWithAnnotationsCore=function(e){var t=[];if(e=e||u.getCurrentState(),e.isMedia())return[];if(!sn({state:!0,notVideo:!0,fullThumbsAllowed:!0},e))return[];for(var a=0;a<e.getPageCount();a++)M.pageHasAnnotation(a,e)&&t.push(a);return t},h.prototype.removeFromPagesWithAnnotations=function(e){var t=ae.indexOf(e);t>-1&&ae.splice(t,1)},h.prototype.addToPagesWithAnnotations=function(e){return ae.indexOf(e)===-1&&(ae.push(e),ae.sort()),ae},h.prototype.getVisibleAnnotationPages=function(){return ae},h.prototype.getDragMode=function(){return Z.getDragMode()},h.prototype.setDragMode=function(e){Z.setDragMode(e)},h.prototype.findPos=function(e){return zt(e)};var zt=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);var n=virtualViewer.getActiveOuterDiv();return a-=n.scrollTop(),t-=n.scrollLeft(),[t,a]},Wt=function(e,t){if(!e||!e.getDocumentId())return null;var a=e.getPageNumber(),n=a-r.continuousScrollBufferBeforeSize,o=a+r.continuousScrollBufferAfterSize;n||0===n||(n=a-1),o||0===o||(o=a+3);var i=[];t?e.getImageManager().nukeBuffers():e.getImageManager().cleanBuffers();for(var s=n;s<=o;s++)if(!(s<0)){if(s>=e.getPageCount())break;i.push(s)}for(var l=0;l<i.length;l++)e.requestPage(i[l],t,t)};h.prototype.resetSVGSupport=function(e){var t=u.getActivePaneState();t.resetSVGSupport(e)};var Ht=function(e,t,a,n){if(e=e||u.getActivePaneState()){a=a||M.getOuterDivFromState(e),n=n||a.find(".vvScroller"),t=t||a.find(".vvCanvas");var o=!1;r.leftSideThumbPanel&&t.css("left","auto");var i=ot(a),s=nt(a);return Math.abs(t[0].width-s)>1&&(t[0].width=s,o=!0),Math.abs(t[0].height-i)>1&&(t[0].height=i,o=!0),o}};h.prototype.positionCanvases=function(e,t,a,n){return Ht(e,t,a,n)},h.prototype.getTransformedPageLeft=function(e){var t=$.extend({},e),a=t.state||u.getActivePaneState(),n=t.page;n||0===n||(n=a.pageNumber);var o=t.pageHeight||a.getRequestedHeightForPage(n),i=t.pageWidth||a.getRequestedWidthForPage(n),r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n));var s=t.outerDiv||virtualViewer.getOuterDivFromState(a),l=t.dummyScroller||s.find(".vvScroller"),d=t.canvas||s.find(".vvCanvas"),c=$(l).width()-$(s).width();c<0&&(c=0);var g,v=($(d).width()+c)/2-$(s).scrollLeft();return g=90===r?v+o/2:270===r?v-o/2:180===r?v+i/2:v-i/2},h.prototype.getVisualPageLeft=function(e){var t=$.extend({},e),a=t.state||u.getActivePaneState(),n=a.validatePageNumber(t.page);if(n<0)return 0;var o=t.pageHeight||a.getRequestedHeightForPage(n),i=t.pageWidth||a.getRequestedWidthForPage(n),r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n)||0);var s=t.outerDiv||virtualViewer.getOuterDivFromState(a),l=t.dummyScroller||s.find(".vvScroller"),d=t.canvas||s.find(".vvCanvas"),c=l.width()-s.width();c<0&&(c=0);var g,v=($(d).width()+c)/2-s.scrollLeft();return 90===r||270===r?g=v-o/2:180!==r&&0!==r||(g=v-i/2),g},h.prototype.getVisualPageTop=function(e){var t=$.extend({},e),a=t.state||u.getActivePaneState(),n=a.validatePageNumber(t.page);if(n<0)return 0;var o=t.pageHeight||a.getRequestedHeightForPage(n),i=t.pageWidth||a.getRequestedWidthForPage(n),r=t.rotateAngle;r||0===r||(r=a.getRotationForPage(n)||0);var s=t.currentTransformedTop;return s||0===s||(s=virtualViewer.getTransformedPageTop(t)),0===r||90===r?s:180===r?s-o:270===r?s-i:s},h.prototype.getTransformedPageTop=function(e){var t=$.extend({},e),a=t.state||u.getActivePaneState(),n=t.outerDiv||virtualViewer.getOuterDivFromState(a),i=t.dummyScroller||n.find(".vvScroller"),r=(t.canvas||n.find(".vvCanvas"),t.page);r||0===r||(r=a.pageNumber),a=a||u.getActivePaneState();var s=t.pageHeight||a.getRequestedHeightForPage(r),l=t.pageWidth||a.getRequestedWidthForPage(r),d=t.rotateAngle;d||0===d||(d=a.getRotationForPage(r));var c,g=t.currentZeroPage||Xt(a,n,i),v=-virtualViewer.scrollerToPaint(a,g,n,i);if(r<g)for(var p=g-1;p>=r;p--)c=a.getRotationForPage(p),v-=90===c||270===c?a.getOriginalWidthForPage(p)*a.getZoomDecimal():a.getOriginalHeightForPage(p)*a.getZoomDecimal(),v-=o.spaceBetweenPages;else if(r>g)for(var h=g+1;h<=r;h++)c=a.getRotationForPage(h-1),v+=90===c||270===c?a.getOriginalWidthForPage(h-1)*a.getZoomDecimal():a.getOriginalHeightForPage(h-1)*a.getZoomDecimal(),v+=o.spaceBetweenPages;return 180===d?v+s:270===d?v+l:v},h.prototype.clearCanvases=function(e,t){e||(e=u.getActivePaneState()),t||(t=e.currentPaneIndex>0&&M.getActivePane()>0?$("#vvSplitCanvas")[0]:$("#vvImageCanvas")[0]);var a=t.getContext("2d");a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,t.width,t.height),a.restore(),$(".vvAnnSelected").removeClass("vvAnnSelected")},h.prototype.delayedPaintCanvases=function(e){F&&window.clearTimeout(F);var t=e||50;F=window.setTimeout(M.paintCanvases,t)},h.prototype.paintCanvases=function(){if(u.getActivePaneState()){if(!r.splitScreen||!oe)return void jt(u.getCurrentState(0));for(var e=0;e<u.displayedDocuments.length;e++)jt(u.getCurrentState(e))}};var jt=function(a){if(a=a||u.getActivePaneState()){var n=virtualViewer.getOuterDivFromState(a),o=n.find(".vvCanvas"),i=n.find(".vvScroller"),s=n.find(".vvInner"),c=virtualViewer.positionCanvases(a,o,n,i);c||virtualViewer.clearCanvases(a,o[0]),$("#vvAnnPopUp:visible").length&&c&&aa(),c&&oe&&X.adjustForWindowResize();var g=n.parents(".split");n.width(g.width()),n.height(g.height());var v=n.offset();s.css("left",v.left+10),s.css("top",v.top+20),o=o[0];var p=o.getContext("2d"),h=(n.width(),a.getImageManager()),m=Xt(a,n,i),f=m+r.continuousScrollBufferAfterSize;f||0===f||(f=m+3);var y,b,P,T,A;if(f>=a.getPageCount()&&(f=a.getPageCount()-1),a.isVideo())return void a.getMediaManager().resizeVideo();if(a.pageStates){for(var I=m;I<=f;I++)if(!(I<0||I>=a.getPageCount())&&h&&a.pageStates[I]){P=a.getRotationForPage(I)||0;var S=a.getRequestedWidthForPage(I),w=a.getRequestedHeightForPage(I),C={page:I,state:a,pageWidth:S,pageHeight:w,rotateAngle:P,dummyScroller:i,outerDiv:n,canvas:o,currentZeroPage:m};y=virtualViewer.getTransformedPageLeft(C),b=virtualViewer.getTransformedPageTop(C),C.currentTransformedTop=b;var D=virtualViewer.getVisualPageTop(C);if(D>n[0].offsetHeight)break;if(p.save(),T=Math.sin(t.degreesToRadians(P)),A=Math.cos(t.degreesToRadians(P)),p.setTransform(A,T,-T,A,y,b),Qt(a,o,p,I),a&&a.watermarks&&a.watermarks.length>0&&e("vvWatermarks").paintPageWatermarks(I,a,p),a.documentId===u.getActivePaneState().documentId&&0===M.getActivePane()&&d.getCurrentSearchResults().length>0&&d.paintDocumentSearchResults(a,o,p,I),a.isPageCropped(I)||(I===a.pageNumber&&M.getActivePane()===a.currentPaneIndex&&tn(o,p,a),Ja(a.currentPaneIndex,I,o,p)),a.getDocumentLinks(I)&&virtualViewer.focusedLink&&virtualViewer.focusedLink.pageIndex===I&&virtualViewer.focusedLink.pane===a.currentPaneIndex){let e=a.getDocumentLinks(I)[virtualViewer.focusedLink.linkIndex];var x=t.getPixelImageRectFromPercents(e.rect,I,a);M.drawBox(x,p,"#555555",a)}p.restore(),l.paintAnnotations(a,o,p,I);var L=virtualViewer.currentPreviewAnnObject;L&&a.documentId===u.getActivePaneState().documentId&&L.page===I&&l.paintAnnotation(a,o,p,L),p.save(),p.setTransform(A,T,-T,A,y,b),qt(a,I,p),p.restore(),virtualViewer.horizontalGuide&&virtualViewer.horizontalGuide.visible&&(p.save(),p.translate(virtualViewer.getVisualPageLeft(C),D),nn(o,p,a,I),p.restore())}on(o,p),X.getMagnifierEnabled()&&X.paintMagnifierCanvas(),virtualViewer.createNavigationOptionsLabels()}}};h.prototype.getScrollSpeed=function(e){e=e||u.getActivePaneState();var t=r.scrollSpeed||30,a=e.getZoomDecimal();a<0&&(a=0);var n=100,i=t*n*Math.sqrt(a),s="Explorer"===BrowserDetect.browser||"Edge"===BrowserDetect.browser,l="Firefox"===BrowserDetect.browser;if(s||l){var d=i*e.getPageCount(),c=s?o.maxHtmlHeightMicrosoft||15e5:o.maxHtmlHeightFirefox||17e6;d>c&&(i=c/e.getPageCount())}return i},h.prototype.sizeScroller=function(e){e||(e={});var t=e.state||u.getActivePaneState(),a=e.outerDiv||M.getOuterDivFromState(t),n=e.scroller||a.find(".vvScroller"),o=e.canvas||a.find(".vvCanvas");if(t){var i=ot(a),r=nt(a),s=virtualViewer.getScrollSpeed(t),l=t.pageCount*s+a[0].offsetHeight;1===t.getPageCount()&&t.getRequestedWidthForPage(0)&&!t.isMedia()?t.widthIsOnXAxis(0)&&t.getRequestedHeightForPage(0)<i?l=i:!t.widthIsOnXAxis(0)&&t.getRequestedWidthForPage(0)<i&&(l=i):t.isMedia()&&(l=20),$(n).height(l);for(var d=r,c=0;c<t.getPageCount();c++)t.widthIsOnXAxis(c)?d<t.getRequestedWidthForPage(c)&&(d=t.getRequestedWidthForPage(c)):d<t.getRequestedHeightForPage(c)&&(d=t.getRequestedHeightForPage(c));$(n).width(d-(L||0)/2),e.applyAndResetCachedScroll&&(ct(t),t.clearCachedScroll()),Ht(t,o,a,n)}};var Qt=function(e,t,a,n){var o=e.getImageManager(),i=o.getBestImageFromPage(n);if(o.checkIsImageComplete(i)){var r=e.getRequestedWidthForPage(n),s=e.getRequestedHeightForPage(n);if(0===r||0===s){if(!e.pageStates[n].imageInfoLoaded)return;virtualViewer.determineEffectiveZoom(n,e),r=e.getRequestedWidthForPage(n),s=e.getRequestedHeightForPage(n)}if(a.save(),e.getHorizontalFlipForPage()&&(a.translate(r,0),a.scale(-1,1)),e.getVerticalFlipForPage()&&(a.translate(0,s),a.scale(1,-1)),e.isPageCropped(n)){var l=e.getOriginalWidthForPage(n)/r,u=e.getPageCropBox(n),d=Math.ceil(u.cropTop/l),c=Math.ceil(u.cropLeft/l),g=Math.ceil(u.cropWidth/l),v=Math.ceil(u.cropHeight/l);try{a.drawImage(i,u.cropLeft,u.cropTop,u.cropWidth,u.cropHeight,c,d,g,v),e.pageStates[n].pageAlreadyRendered||(K.call("onPageLoadAndRendered",{documentId:e.documentId,pageNumber:n}),e.pageStates[n].pageAlreadyRendered=!0)}catch(e){console.log("Error drawing cropped image: "+e)}finally{a.restore()}}else try{a.drawImage(i,0,0,r,s),e.pageStates[n].pageAlreadyRendered||(K.call("onPageLoadAndRendered",{documentId:e.documentId,pageNumber:n}),e.pageStates[n].pageAlreadyRendered=!0)}catch(e){console.log("Error drawing full image: "+e)}finally{a.restore()}}},qt=function(e,t,a){if(e&&e.getImageManager()){var n=e.getImageManager(),o=n.getOverlayOffsetForPage(t);if(o&&n.checkIsImageComplete(n.overlayImage)){var i,r,s,l=e.getRequestedWidthForPage(t),u=e.getRequestedHeightForPage(t),d=n.overlayImage,c=l/d.width,g=u/d.height;c<g?(i=l,r=d.height*c,s=c):(i=d.width*g,r=u,s=g);try{n.stripWhite(d),a.drawImage(d,o.offsetX*s,o.offsetY*s,i,r)}catch(e){console.log("exception: "+e)}}}};h.prototype.centerScrollbar=function(){Gt()};var Gt=function(e){var t,a,n;if(e||(e=u.getActivePaneState()),e.pageCount){a=u.getOuterDivFromState(e),n=a.find(".vvScroller"),t=a.find(".vvCanvas");var o=e.pageNumber,i=a.width();if(n.width()>e.getRequestedWidthForPage(o)){var r=n.width()-i;r<0&&(r=0);var s=r/2;a.scrollLeft(s)}}},Yt=function(e,t){return R&&clearTimeout(R),e?void(R=setTimeout(function(){Wt(e,t)},150)):void(R=setTimeout(function(){u.getCurrentState(0)&&Wt(u.getCurrentState(0),!1),u.getCurrentState(1)&&Wt(u.getCurrentState(1),!1)},150))};h.prototype.scrollPageFinder=function(e,t,a){return Xt(e,t,a)};var Xt=function(e,t,a){e=e||u.getActivePaneState(),t=t||M.getOuterDivFromState(e),a=a||t.find(".vvScroller");var n=$(t).scrollTop(),o=virtualViewer.getScrollSpeed(e),i=Math.floor(n/o);return i>=e.pageCount&&(i=e.pageCount-1),i};h.prototype.scrollerToPaint=function(e,t,a,n){e=e||u.getActivePaneState(),a=a||M.getOuterDivFromState(e),n=n||a.find(".vvScroller"),null!==t&&void 0!==t||(t=e.pageNumber);var o=$(a).scrollTop(),i=virtualViewer.getScrollSpeed(e),r=o%i/i,s=e.getRequestedHeightForPage(t),l=e.getRotationForPage(t);return 90!==l&&270!==l||(s=e.getRequestedWidthForPage(t)),t===e.getPageCount()-1&&o/i-1>=t&&(r+=1),r*s},h.prototype.emailDocument=function(t){if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})){var a=u.getActivePaneState(),n=a.getDocumentId();e("vvWatermarks").saveWatermarks(a);var i=a.getDocumentModel(),s=new URI(r.servletPath);t=t||{};var l={action:"emailDocument",format:t.format,pageRangeType:t.pageRangeType||"all",pageRangeValue:t.pageRangeValue,pageCount:i.getDocumentLength(),includeTextAnnotations:t.includeTextAnnotations,includeNonTextAnnotations:t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:"string"==typeof t.fromAddress?t.fromAddress:r.emailDefaults.prepopulateFrom,toAddresses:"string"==typeof t.toAddresses?t.toAddresses:r.emailDefaults.prepopulateTo,ccAddresses:"string"==typeof t.ccAddresses?t.ccAddresses:r.emailDefaults.prepopulateCC,bccAddresses:"string"==typeof t.bccAddresses?t.bccAddresses:r.emailDefaults.prepopulateBCC,subject:t.subject,emailBody:t.emailBody,documentId:n,clientInstanceId:M.getClientInstanceId(),cacheBuster:Math.random(),overrideLoggingLevel:virtualViewer.loggingOverride(),modelJSON:JSON.stringify(i.model),annotations:JSON.stringify(a.getAnnotationLayers(!0,!1,!1,t.burnRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,"PDF"===t.format,o.permissionLevels.PERM_PRINT))};return K.call("emailDocumentBegin",{format:t.format,pageRangeType:l.pageRangeType,pageRangeValue:t.pageRangeValue,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:l.fromAddress,toAddresses:l.toAddresses,ccAddresses:l.ccAddresses,bccAddresses:l.bccAddresses,subject:l.subject,emailBody:l.emailBody,documentId:n,clientInstanceId:M.getClientInstanceId()}),N?l.smtpServer=N:r.emailDefaults.smtpServerOverride&&(l.smtpServer=r.emailDefaults.smtpServerOverride),null!==M.getOverlayPath()&&(l.overlayPath=M.getOverlayPath()),$.ajax({url:s.toString(),type:"POST",dataType:"json",data:l,success:function(e){mt(e)?K.call("emailDocumentError",{format:t.format,pageRangeType:l.pageRangeType,pageRangeValue:t.pageRangeValue,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:l.fromAddress,toAddresses:l.toAddresses,ccAddresses:l.ccAddresses,bccAddresses:l.bccAddresses,subject:l.subject,emailBody:l.emailBody,documentId:n,clientInstanceId:M.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText}):K.call("emailDocument",{format:t.format,pageRangeType:l.pageRangeType,pageRangeValue:t.pageRangeValue,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,fromAddress:l.fromAddress,toAddresses:l.toAddresses,ccAddresses:l.ccAddresses,bccAddresses:l.bccAddresses,subject:l.subject,emailBody:l.emailBody,documentId:n,clientInstanceId:M.getClientInstanceId()}),Da(!1)},error:function(e){mt(e,a.getDocumentId(),a.currentPaneIndex),Da(!1),K.call("emailDocumentError",{format:t.format,fromAddress:l.fromAddress,toAddresses:l.toAddresses,ccAddresses:l.ccAddresses,bccAddresses:l.bccAddresses,subject:l.subject,emailBody:l.emailBody,documentId:n,clientInstanceId:M.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText})}}),!0}},h.prototype.setSmtpServerOverride=function(e){N=e},h.prototype.getSmtpServerOverride=function(){return N},h.prototype.exportDocument=function(e){return M.exportDocumentCore(e)},h.prototype.printMultipleDocuments=function(t,a){e("vvPrintManager").printMultipleDocuments(t,a)},h.prototype.exportMultipleDocuments=function(e,a){if(a=a||{},"string"==typeof e?e=[e]:a.exportDocumentList&&(e=virtualViewer.documentList),!e||!e.length)throw new Error("no document IDs provided");(!a.exportFormat||"pdf"!==a.exportFormat.toLowerCase()&&"tiff"!==a.exportFormat.toLowerCase())&&(a.exportFormat="PDF");var n={action:"exportDocuments",format:a.exportFormat,clientInstanceId:M.getClientInstanceId(),cacheBuster:i,overrideLoggingLevel:virtualViewer.loggingOverride()};a.fileExtension="pdf"===a.exportFormat.toLowerCase()?"pdf":"tif",z?n.exportFileName=encodeURIComponent(z(a.fileExtension,e)):n.exportFileName=t.getLocalizedValue("exportDefaultName","ExportedDocument")+"."+a.fileExtension;var i=null;o.cacheBuster===!0&&(i=Math.random());var s=$("#autoFormTemplate").render({action:r.servletPath,data:n}),l=$(s);return e.forEach(function(e){var t=e;"string"!=typeof e&&(t=e.documentId),l.append("<input type='hidden' name='documentIdArray[]' value='"+encodeURIComponent(t)+"' />");let a=u.getStateForDocumentId(t);if(a&&a.documentFullyLoaded()&&a.getDocumentModel().getPagesModifiedSinceInit()){let e=a.getDocumentModel().model;l.append("<input type='hidden' name='"+t+".modelJson' value='"+JSON.stringify(e)+"' />")}}),K.call("exportMultipleDocumentsBegin",{documentIds:e,format:a.exportFormat,filename:n.exportFileName,clientInstanceId:M.getClientInstanceId()}),l.appendTo($("body")),BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&l.attr("target","_blank"),Zt(function(t){K.call("exportMultipleDocumentsError",{documentIds:e,format:a.exportFormat,filename:n.exportFileName,clientInstanceId:M.getClientInstanceId(),exceptionMessage:t})},{suppressDownloadDialogs:!0}),l.submit(),l.remove(),!0},h.prototype.exportDocumentCore=function(t,a){if(a=a||u.getActivePaneState(),t=t||{},sn({state:!0,notVideo:!0,fullThumbsAllowed:!0},a)){var n={action:"newExport",format:t.exportFormat,includeTextAnnotations:t.includeTextAnnotations,includeNonTextAnnotations:t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,pageRangeType:t.pageRangeType,pageRangeValue:t.pageRangeValue,annotations:JSON.stringify(a.getAnnotationLayers(!0,!1,!1,t.burnRedactions,t.includeTextAnnotations,t.includeNonTextAnnotations,"PDF"===t.exportFormat,o.permissionLevels.PERM_PRINT)),clientInstanceId:M.getClientInstanceId()};z&&(n.exportFileName=encodeURIComponent(z(t.fileExtension))),K.call("exportDocumentBegin",{documentId:a.getDocumentId(),format:t.exportFormat,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,pageRangeType:t.pageRangeType,pageRangeValue:t.pageRangeValue,filename:n.exportFileName,clientInstanceId:M.getClientInstanceId()});var i;a.getDocumentModel()?(e("vvWatermarks").saveWatermarks(a),i=a.getDocumentModel().model):i={documentId:encodeURIComponent(a.documentId)
},n.modelJSON=JSON.stringify(i);var s=a.getPageCount();s||(s=1),n.pageCount=s;var l=$("#autoFormTemplate").render({action:r.servletPath,data:n}),d=$(l);d.appendTo($("body")),BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&d.attr("target","_blank");var c=a.getDocumentId();return Zt(function(e){K.call("exportDocumentError",{documentId:c,format:t.exportFormat,includeAnnotations:t.includeTextAnnotations&&t.includeNonTextAnnotations,includeRedactions:t.burnRedactions,includeRedactionTags:t.includeRedactionTags,includeDocumentNotes:t.includeDocumentNotes,includeWatermarks:t.includeWatermarks,pageRangeType:t.pageRangeType,pageRangeValue:t.pageRangeValue,filename:n.exportFileName,clientInstanceId:M.getClientInstanceId(),exceptionMessage:e})}),d.submit(),d.remove(),!0}};var Zt=function(e,a){a=a||{};let n=function(){var n=$(this).contents().find("body").text().substr(0,1e3);try{var o=JSON.parse(n);mt(o,null,null,a)&&e(o.exceptionMessage)}catch(a){var i=t.getLocalizedValue("errors.exportError","Error while exporting document. Unable to display detailed error."),r={client:!1,disable:M.disableErrorModals.export};ft(i,r),e("JSON parsing exception")}};$("#vvDownloadFrame").off("load").on("load",n)};h.prototype.downloadDocument=function(t){var a=t.indexOf("."),n=t.substring(a+1),o=virtualViewer.getStateForDocumentId(t);o||(o=new(e("vvDocViewState"))(t)),M.exportDocumentCore({exportFormat:"Original",fileExtension:n,includeTextAnnotations:!1,includeNonTextAnnotations:!1,burnRedactions:!1,includeRedactionTags:!1,includeDocumentNotes:!1,includeWatermarks:!1,pageRangeType:"all",pageRangeValue:"undefined"},o)},h.prototype.downloadEmailAttachment=function(e){if(e){var a={action:"downloadEmailAttachment",clientInstanceId:M.getClientInstanceId(),attachment:JSON.stringify(e)},n=$("#autoFormTemplate").render({action:r.servletPath,data:a}),o=$(n);o.appendTo($("body")),BrowserDetect.OS&&"i"===BrowserDetect.OS[0]&&o.attr("target","_blank");var i=$("#vvDownloadFrame");i.off("load").on("load",function(){var e=i.contents().find("body").text().substr(0,1e3);try{var a=JSON.parse(e);mt(a)}catch(e){var n={client:!1,disable:!1};ft(t.getLocalizedValue("errors.downloadEmailAttachment","An error occurred while downloading this email attachment."),n)}}),o.submit(),o.remove()}},h.prototype.determineEffectiveZoom=function(e,t,a,n){if(t=t||u.getActivePaneState(),t&&t.pageStates&&t.pageStates.length){e||0===e||(e=t.getPageNumber()),a=a||virtualViewer.getActiveOuterDiv(),n=n||a.find(".vvScroller");var i=t.getZoomMode();i||0===i||(i=r.defaultZoomMode||o.zoomModes.fitWindow);var s=t.getZoom();s||(s=100);var l=t.getOriginalHeightForPage(e),d=t.getOriginalWidthForPage(e),c=1;if(d&&l){var g=!1;if(0!==e||x||(x=1),n.width()>a.width()&&0===a.scrollLeft()&&1===x&&(g=!0,x=!0),x){var v=nt(),p=ot(),h=t.getRotationForPage(e),m=v/d,f=p/l,y=s/100,b=p/d,P=v/l,T=i===o.zoomModes.fitWidth,A=i===o.zoomModes.fitHeight;(T||A||i===o.zoomModes.fitWindow)&&(d&&l&&i===o.zoomModes.fitWindow&&(m>=f?A=!0:T=!0),T&&(c=q.zoomPreferences.fitWidthPercentage||1,y=90===h||270===h?P:m,y*=c),A&&(y=90===h||270===h?b:f),e===t.pageNumber&&t.setZoomMode(o.zoomModes.fitCustom),t.setZoomDecimal(y),M.sizeScroller({state:t,outerDiv:a,scroller:n})),t.zoomPage(y,e),g&&Gt(t)}}}},h.prototype.collapsedStickySize=function(e){e=e||this.getActivePaneState().getZoomDecimal();var t=r.collapseStickiesSize||50,a=t*e;return a<5&&(a=5),Modernizr.touch&&(a*=2),a},h.prototype.findPagePosition=function(e,t){t||(t=virtualViewer.getCurrentState()),null!==e&&void 0!==e||(e=t.pageNumber);var a=virtualViewer.getScrollSpeed(t);return Math.ceil(a*e)};var Kt=function(e){var t=r.annotationTags.indexOf(e);if(t!==-1){var a=$("#vvAnnTagList .vvTagOption").eq(t),n=M.isRedaction(M.getCurrentAnnObject()),o=$("<div></div>").text(e).text();a.length&&a.text()===o&&(n&&$("#vvAnnTagList .vvTagOption").removeClass("disabled"),a.toggleClass("disabled",!a.hasClass("disabled")))}},Jt=function(e){var t=$("<div></div>").addClass("vvAnnTagChosenBox"),a=$("<span></span>").addClass("vvAnnTagCloseButton vvAnnTagInnerButton").data("tagname",e).text("x").on("click",ta),n=$("<span></span>").addClass("vvAnnTagContent").text(e);return t.append(a).append(n),t},ea=function(e){var t=$("<li></li>").addClass("vvTagOption dropdown-item"),a=$("<a></a>").text(e);return t.append(a),t},ta=function(){var e=virtualViewer.getCurrentAnnObject(),t=$(this).data("tagname");Kt(t);for(var a=0;a<e.annotationTags.length;a++)if(e.annotationTags[a]===t){e.annotationTags.splice(a,1);break}$(this).parent().remove(),e.markRevised(),l.markLayerWithAnnDirty(e)};h.prototype.hideAnnTagsPopUp=function(e){if(r.annotationTags.length>0){if(e)return void $("#vvAnnTag").hide();$("#vvAnnTag").show()}};var aa=function(e,t,n){var i,r,s=$("#vvImagePanel").height(),l=$("#vvImagePanel").width(),d=$("#vvAnnPopUp").height(),c=$("#vvAnnPopUp").width(),g=15;e&&e.x&&e.y?(i=e.x,r=e.y):(i=0,r=0),t=t||virtualViewer.getCurrentAnnObject(),n=n||u.getActivePaneState();var v=!1,p=Z.localPosToGlobalPos(new a(t.getAdjustedLeft(),t.getAdjustedTop()),t.page,n),h=p.x+t.getAdjustedWidth();i?i<p.x+t.getAdjustedWidth()/2&&(v=!0):t.getType()!==o.annotationTypes.SANN_EDIT&&t.getType()!==o.annotationTypes.SANN_POSTIT||(v=!0),i=!v&&l-h>c?h+g:p.x-c-g,r||(r=p.y),i+$("#vvAnnPopUp").width()>l&&(i=l-$("#vvAnnPopUp").width()),i<0&&(i=0),r+d>s&&(r=s-d),r<0&&(r=0);var m=s-r-$("#vvAnnPopUp .btn-group-wrap").height()-15;$("#vvAnnPopUpForm").css("max-height",m+"px"),$("#vvAnnPopUp").css("top",r),$("#vvAnnPopUp").css("left",i)};h.prototype.annPopUpHandler=function(e,n,i){if(i=i||u.getActivePaneState(),u.isVideoOpen())return!1;if(r.readOnlyAnnotationMode)return!1;var s,d=0,c=0;if(e){Modernizr.touchevents&&(e=Z.fixTouchEvent(e)),e.preventDefault(),e.stopPropagation(),d=e.clientX,c=e.clientY;var g=Z.clickPointConverter(e);s=l.getAnnotationAtPoint(g,i)}if(n&&(s=n),l.checkLayerPermission(l.getCurrentLayer(),o.permissionLevels.PERM_EDIT)===!1)return void alert(t.getLocalizedValue("errors.editAnnOnLayerPermission","You do not have permission to edit annotations on this layer."));var v=Z.dragging;return!s||v?(virtualViewer.hideAnnPopUp(),void virtualViewer.delayedPaintCanvases(i)):(M.setCurrentAnnObject(s),void(s.collapsed||($("#vvAnnPopUpForm").removeClass(),$("#vvAnnotationNotesArea").collapse("hide"),$("#vvAnnotationRevisionHistory").collapse("hide"),$("#vvAnnLineColorChoices").colorpicker("reset"),$("#vvAnnFillColorChoices").colorpicker("reset"),$("#vvAnnTextColorChoices").colorpicker("reset"),$("#vvAnnPopUp").show(),na(s),aa(new a(d,c),s,i),$("#jqContextMenu").hide(),$("#jqContextMenuShadow").hide(),virtualViewer.delayedPaintCanvases())))};var na=function(e){var a=l.getLayerWithAnn(e)||l.getCurrentLayer();t.isRedactionLayer(a)||e.getType()===o.annotationTypes.SANN_BITMAP||$("#vvAnnPopUpForm").addClass("vvAnnHasColor"),$("#vvAnnPopUpEditTextSaveBtn").hide(),$("#vvAnnPopUpEditTextCancelBtn").hide(),$("#vvAnnFootnoteButton").hide();var n=e.getLineWidthInPoints();$("#vvAnnPopUp .vvAnnThicknessCell").attr("aria-pressed","false"),$("#vvAnnThicknessCell-"+n).attr("aria-pressed","true"),$("#vvAnnLineSizeValue").html(n);var i=$("#vvAnnPopUpEditTextArea");if(i.blur(),e.getTextString()&&(i.val(e.getTextString()),$("#vvAnnFootnoteButton").show()),e.getFontColor()){$("#vvAnnPopUpForm").addClass("vvAnnHasText"),$("#vvAnnTextSizeLabel").height()>$("#vvAnnTextFaceLabel").height()?$("#vvAnnTextFaceLabel").height($("#vvAnnTextSizeLabel").height()):$("#vvAnnTextSizeLabel").height($("#vvAnnTextFaceLabel").height()),$("#vvAnnPopUpForm").addClass("vvAnnHasFill");let t=e.getType()===o.annotationTypes.SANN_EDIT;$("#vvAnnFillColorChoices").data().colorpicker.toggleOpacityControls(t).allowContinuousOpacity(r.enableCustomOpacity&&t).color(e.getFillColorRGB()).opacity(e.getOpacity()),$("#vvAnnTextColorChoices").colorpicker("color",e.getFontColor())}else if(e.getFillColor()){$("#vvAnnPopUpForm").addClass("vvAnnHasFill");let t=r.enableCustomOpacity&&e.getRefinedType()!==o.annotationTypes.SANN_HIGHLIGHT_RECT;$("#vvAnnFillColorChoices").data().colorpicker.toggleOpacityControls(t).allowContinuousOpacity(!0).color(e.getFillColorRGB()).opacity(e.getOpacity()).setMinimumOpacity(e.isFillOnly()?1:0)}else e.getLineColor()&&($("#vvAnnPopUpForm").addClass("vvAnnHasLine"),$("#vvAnnLineColorChoices").colorpicker("color",e.getLineColorRGB()));if(r.enableAnnotationCommenting&&($("#vvAnnPopUpForm").addClass("vvAnnHasNotes"),$("#vvAnnotationNotesInternal").children().remove(),e.noteArray&&e.loadAnnotationNotes()),$("#vvAnnTagChosen").empty(),r.annotationTags.length>0&&$("#vvAnnPopUpForm").addClass("vvAnnTags"),$("#vvAnnTagList .vvTagOption").removeClass("disabled"),e.annotationTags.length>0){$("#vvAnnPopUpForm").addClass("vvAnnTags");for(var s=0;s<e.annotationTags.length;s++){var u=Jt(e.annotationTags[s]);$("#vvAnnTagChosen").append(u),Kt(e.annotationTags[s])}}if(e.getFontName()&&$("#vvAnnTextFaceSelect").val(t.toTitleCase(e.getFontName())),e.getFontSize()){var d=1,c=virtualViewer.getActivePaneState();e.docDPI>o.minimumAnnotationDPI&&c.getDPIForPage(e.page)&&c.getDPIForPage(e.page)<10&&(d=e.pageWidth/c.getOriginalWidthForPage(e.page)||1,90!==e.rotateAngle&&270!==e.rotateAngle||(d=e.pageHeight/c.getOriginalWidthForPage(e.page)||1));var g=t.findClosestFontSize(e.getFontSize()/d);$("#vvAnnTextSizeSelect").val(g)}e.getFontBold()===!0?$("#vvAnnTextStyleBold").prop("checked",!0):$("#vvAnnTextStyleBold").prop("checked",!1),e.getFontItalic()===!0?$("#vvAnnTextStyleItalic").prop("checked",!0):$("#vvAnnTextStyleItalic").prop("checked",!1),e.getFontUnderline()===!0?$("#vvAnnTextStyleUnderline").prop("checked",!0):$("#vvAnnTextStyleUnderline").prop("checked",!1),e.getType()===o.annotationTypes.SANN_BITMAP&&$("#vvAnnPopUpForm").removeClass("vvAnnHasLine vvAnnHasFill vvAnnHasText vvAnnHasColor"),e&&e.loadAnnotationInformation()};h.prototype.hideAnnPopUp=function(){var e=this.getCurrentAnnObject();e&&(e.editing=!1),$("#vvAnnPopUp").hide()};var oa=function(e){$(".vvThumbDivider").remove(),$("#vvImageTabs .dragOverTab").removeClass("dragOverTab")};h.prototype.cleanupDrag=oa,$.event.special.vvDeletePages={_default:function(e){M.cutSelection(!0)}},$.event.special.vvCutPages={_default:function(e){M.cutSelection(!1)}},$.event.special.vvCopyPages={_default:function(e){M.copySelection()}},$.event.special.vvPastePages={_default:function(e,t){M.pasteSelection(t)}};var ia=function(t){t||(t=window.event),V&&clearTimeout(V),V=setTimeout(e("vvThumbs").loadVisibleThumbs,200)};h.prototype.processWindowResize=function(e){e||(e=window.event),ra(!0);var t=u.getActivePaneState(),a=null;t&&(a=t.getZoomMode()),K.call("onWindowResize",{defaultZoomMode:r.defaultZoomMode,currentZoomMode:a})};var ra=function(t){for(var a=u.getActivePaneState(),n=$(".vvOuter"),o=0;o<n.length;o++){var i=$(n[o]).find(".vvCanvas");i[0].width=nt($(n[o])),i[0].height=ot($(n[o])),"Explorer"===BrowserDetect.browser&&BrowserDetect.version<9&&(i.children().width(outerDiv.width()),i.children().height(outerDiv.width()))}e("vvThumbs").loadVisibleThumbs(),p.updateThumbImages(),g.autoTabCollapse(),$("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),a&&(virtualViewer.sizeScroller({state:a}),t&&virtualViewer.determineEffectiveZoom(),virtualViewer.delayedPaintCanvases()),a&&a.isMedia()&&a.getMediaManager().resizeMedia(),X.adjustForWindowResize(),sa(),null===L&&(L=M.getScrollbarWidth())},sa=function(){var e=$("#virtualViewerMain"),t=e.width(),a=e.height();if(!(Math.abs(fe.width-t)<3&&Math.abs(fe.height-a)<3)){fe.width=t,fe.height=a;var n,o=s(virtualViewer),i=o.toolbarButtonLogicalGroups;r.windowHorizontalThreshold||0==r.windowHorizontalThreshold?n=r.windowHorizontalThreshold:(n=30*(Object.keys(o.imageToolbarButtons).length+2),n+=30*Object.keys(o.toolbarButtonLogicalGroups).length,o.imageToolbarButtons.vvJumpToPage&&(n+=120));var l;r.windowVerticalThreshold||0===r.windowVerticalThreshold?l=r.windowVerticalThreshold:(l=30*Object.keys(o.annotationToolbarButtons).length,l+=30*Object.keys(o.toolbarButtonLogicalGroups).length,l+=30);var u=481,d=$("#vvToolbar"),c=$("#vvAnnToolbar"),g=$("#vvImageAndThumbs");if(t<u&&!r.disableToolbarHamburger){if(d.hasClass("vvHamburgerSize"))return;r.disableToolbar&&(d.show(),g.removeClass("disabledToolbar")),r.disableAnnToolbar&&(c.show(),g.removeClass("disabledToolbar")),d.removeClass("vvLargeSize vvMediumSize"),d.addClass("vvHamburgerSize"),c.removeClass("vvLargeSize vvMediumSize"),g.removeClass("smallLeft mediumLeft largeLeft"),g.addClass("smallLeft");for(var v in i){var p=i[v],h=$("."+v).first();h.removeClass("vvLargeSize vvMediumSize"),h.addClass("vvHamburgerSize")}}else{r.disableToolbar&&d.hide(),r.disableAnnToolbar&&c.hide(),d.removeClass("vvHamburgerSize");var m=!1;for(var v in i){var p=i[v],h=$("."+v).first(),f=p.collapseThreshold;h.removeClass("vvHamburgerSize"),0!==h.children().length?"number"==typeof f&&f>-1?p.annotationToolbar?a<=f?(h.removeClass("vvLargeSize").addClass("vvMediumSize").width(32),m=!0):h.addClass("vvLargeSize").removeClass("vvMediumSize").width(28):t<=f?(h.removeClass("vvLargeSize").addClass("vvMediumSize"),m=!0):h.addClass("vvLargeSize").removeClass("vvMediumSize"):p.annotationToolbar?a<=l?(h.removeClass("vvLargeSize").addClass("vvMediumSize").width(32),m=!0):h.addClass("vvLargeSize").removeClass("vvMediumSize").width(28):t<=n?(h.removeClass("vvLargeSize").addClass("vvMediumSize"),m=!0):h.addClass("vvLargeSize").removeClass("vvMediumSize"):h.hide()}m&&!r.disableAnnToolbar?(d.addClass("vvPushOverForAnnToolbar"),c.addClass("vvCenterAnnButtons"),g.removeClass("smallLeft mediumLeft largeLeft"),g.addClass("largeLeft")):(d.removeClass("vvPushOverForAnnToolbar"),c.removeClass("vvCenterAnnButtons"),g.removeClass("smallLeft mediumLeft largeLeft"),g.addClass("mediumLeft")),Ie()}}};h.prototype.getUserPreferences=function(){return q},h.prototype.exportUserPreferences=function(){return q.exportUserPreferences()},h.prototype.importUserPreferences=function(e){return q.importUserPreferences(e)},h.prototype.getDocumentNotes=function(){return Y},h.prototype.getDocumentId=function(e){return u.getOpenDocumentId(e)},h.prototype.getCurrentState=function(e){return u.getCurrentState(e)},h.prototype.setDocumentId=function(e){u.displayedDocuments[0]=e},h.prototype.setUsername=function(e){var t=virtualViewer.getUserPreferences();t.saveUsername(e)},h.prototype.getUsername=function(){return virtualViewer.getUserPreferences().getUsername()},h.prototype.setFitWidthPercentage=function(e,t){return!!q&&(!!(e&&"number"==typeof e&&e>=.5&&e<=1)&&(q.zoomPreferences.fitWidthPercentage=e,t&&(q.zoomPreferences.mode=o.zoomModes.fitWidth,u.getActivePaneState().setZoomMode(o.zoomModes.fitWidth)),!!q.saveZoomPreferences(!0)&&(t&&M.fitWidthOpenDocuments(),q.updateDialogZoomPreferences(),!0)))},h.prototype.setDisplayName=function(t,a){if(t=t||"",a=a||u.getOpenDocumentId(),!a)return null;var n=u.getStateForDocumentId(a);if(this.updateInRecentlyViewed({documentId:a},{documentId:a,displayName:t}),e("vvThumbs").updateDocumentDisplayName(a,t),n)return n.setDisplayName(t),g.updateTabName(n),n.getDisplayName();var o=this.indexInDocumentList(a);return o===-1?null:(this.documentList[o].displayName=t,t)},h.prototype.getDisplayName=function(){return sn({state:!0,fullThumbsAllowed:!0})?u.getActivePaneState().getDisplayName():null},h.prototype.getStateForDocumentId=function(e,t){return u.getStateForDocumentId(e,t)},h.prototype.getDocumentIdForPage=function(e,t){return la(e,t)};var la=function(e,t){var a=t.getDocumentId(),n=t.getDocumentModel();return t.getDocumentId()?(n&&n.model.pageData.length&&(a=decodeURIComponent(n.model.pageData[e].documentId)),a):null};h.prototype.getPageIndexForPage=function(e,t){return ua(e,t)};var ua=function(e,t){var a=e;t=t||virtualViewer.getActivePaneState();var n=virtualViewer.getDocumentModel(t);return t?(n&&(a=n.model.pageData[e].pageIndex),a):null};h.prototype.exportDocumentDialog=function(t){sn({state:!0,notVideo:!0,fullThumbsAllowed:!0})&&e("vvDialogs").exportDialog(t)},h.prototype.showCropDialog=function(e){if($("#vvConfirmCropDialog").modal("toggle"),null!==e&&void 0!==e||(e=u.getActivePaneState()),e.isVirtualDocument()){var a=$("#vvConfirmCropDialogText").text();$("#vvConfirmCropDialogText").text(a+" "+t.getLocalizedValue("errors.virtualDocumentSaving","You can't save to original on Virtual Documents. Use Export or Save As."))}},h.prototype.cropPageClient=function(e,t,a,n,o){var i=u.getActivePaneState();if(!sn({state:!0,documentModel:!0,notVideo:!0}))return!1;if("number"==typeof e&&K.call("cropDocumentBegin",{documentId:i.getDocumentId(),page:i.pageNumber}),!r.enableCrop&&void 0!==r.enableCrop)return K.call("cropDocumentError",{documentId:i.getDocumentId(),page:i.pageNumber,exceptionMessage:"Crop was disabled."}),!1;if(i.isPageCropped(o)&&i.removeCropOnPage(o),"number"!=typeof e||"number"!=typeof a||"number"!=typeof n||"number"!=typeof t){if(null===Z.dragStartTop||null===Z.dragStopTop||null===Z.dragStartLeft||null===Z.dragStopLeft)return K.call("cropDocumentError",{documentId:i.getDocumentId(),page:i.pageNumber,exceptionMessage:"Insufficient position data was available and the page could not be cropped."}),!1;e=Z.dragStartTop,t=Z.dragStartLeft,a=Z.dragStopTop,n=Z.dragStopLeft,o=i.pageNumber}var s=Math.abs(e-a),l=Math.abs(t-n);e>a&&(e=a),t>n&&(t=n);var d=1/i.getZoomDecimal();i.deleteAllAnnsOnPage(o),r.showAnnIndicators&&M.pageHasIndicator(o)&&M.removeAnnotationIndicators(o),i.resetSVGSupport(!1),null!==o&&void 0!==o||(o=i.pageNumber);var c=i.getPageCropBox(o);return i.isPageCropped(o)?(c.cropTop+=Math.floor(e*d),c.cropLeft+=Math.floor(t*d),c.cropWidth=Math.floor(l*d),c.cropHeight=Math.floor(s*d)):(c={},c.cropTop=Math.floor(e*d),c.cropLeft=Math.floor(t*d),c.cropWidth=Math.floor(l*d),c.cropHeight=Math.floor(s*d)),i.setPageCropBox(o,c),Z.clean(),i.setIsSearchable(!1),virtualViewer.delayedPaintCanvases(),i.documentModel.setPagesModifiedSinceInit(!0,o),u.getCurrentDiff()&&(u.getCurrentDiff().diffDisabledUntilSave=!0,Ka()),K.call("cropDocument",{documentId:i.getDocumentId(),page:i.pageNumber}),!0},h.prototype.cropPageHandler=function(e){return e},h.prototype.cropPageButton=function(){if(sn({state:!0,documentModel:!0,notVideo:!0}))if(r.enableCrop)t.cursorAnnotate(),O=o.annotationTypes.SANN_RECTANGLE,M.currentPointArray=[],virtualViewer.setDragMode(o.dragModes.crop);else{var e={client:!0,disable:virtualViewer.disableErrorModals.adminDisabled};ft(t.getLocalizedValue("errors.cropDisabled","Crop has been disabled by the administrator."),e)}},h.prototype.removeCropOnPage=function(e){if(sn({state:!0,documentModel:!0,notVideo:!0})){var t=u.getActivePaneState();t.removeCropOnPage(e),virtualViewer.delayedPaintCanvases()}},h.prototype.removeAllCrop=function(){if(sn({state:!0,documentModel:!0,notVideo:!0}))for(var e=u.getActivePaneState(),t=0;t<e.pageCount;t++)virtualViewer.removeCropOnPage(t)},h.prototype.createDocumentFromAttachment=function(e,t,a){let n=new URI(r.servletPath);n.addQuery("action","createDocumentFromAttachment"),n.addQuery("clientInstanceId",M.getClientInstanceId()),n.addQuery("attachment",JSON.stringify(e));let o=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",dataType:"json",data:o,success:function(e){return e&&e.documentIdToReload&&(e.documentIdToReload=decodeURIComponent(e.documentIdToReload)),mt(e,null,null,{server:!0})?void a(e):void t(e)},error:function(e){mt(responseData,null,null,{server:!0}),a(e)}})},h.prototype.uploadDocument=function(e){var a=$("#vvUploadLocalFileForm");if(!M.isUploadDocumentEnabled()){a[0].reset(),$("#vvUploadLocalFilesDialog").modal("hide");var n={client:!0,disable:virtualViewer.disableErrorModals.adminDisabled};return void ft(t.getLocalizedValue("errors.uploadDisabled","Upload document has been disabled by the administrator."),n)}if(a.find("input[type=file]").val()){var o=$("#vvUploadLocalFileForm .upload-file-info").text();K.call("uploadDocumentBegin",{filename:o,clientInstanceId:M.getClientInstanceId()});var i=new FormData(a[0]);i.append("action","uploadDocument"),i.append("clientInstanceId",M.getClientInstanceId()),i.append("filename",encodeURI(o)),$("#vvUploadLocalFilesDialog .btn").attr("disabled",!0),$.ajax({url:r.servletPath,type:"POST",cache:!1,contentType:!1,processData:!1,data:i,dataType:"json",success:function(e){return $("#vvUploadLocalFilesDialog .btn").attr("disabled",!1),mt(e)===!0?void K.call("uploadDocumentError",{filename:o,clientInstanceId:M.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText}):(K.call("uploadDocument",{uploadedDocumentId:decodeURIComponent(e.documentIdToReload),clientInstanceId:M.getClientInstanceId()}),p.open&&virtualViewer.toggleFullscreenThumbs(),a[0].reset(),void $("#vvUploadLocalFilesDialog").modal("hide"))},error:function(e){if(K.call("uploadDocumentError",{filename:o,clientInstanceId:M.getClientInstanceId(),exceptionMessage:e.exceptionMessage,statusText:e.statusText}),a[0].reset(),!virtualViewer.handle500Status(e)){var n=t.getLocalizedValue("errors.uploadFailure","Could not upload document.");e&&e.responseJSON&&e.responseJSON.exceptionMessage&&(n=e.responseJSON.exceptionMessage);var i={client:!0,disable:virtualViewer.disableErrorModals.adminDisabled};ft(n,i)}$("#vvUploadLocalFilesDialog .btn").attr("disabled",!1)}})}};var da=function(e,t){return e.includeRedactionTags!==!1&&(e.includeRedactionTags=!0),"current"===e.pageRangeType&&"number"!=typeof e.pageRangeValue&&(e.pageRangeValue=t.getPageNumber()),e.newDocumentId||("undefined"==typeof e.copyAnnotations&&(e.copyAnnotations=!0),"undefined"==typeof e.copyWatermarks&&(e.copyWatermarks=!0)),e};h.prototype.saveDocument=function(a,n){var o,i;if(n=n||{},i=n.documentPaneIndex,a){if(!u.getStateForDocumentId(a,i))return;o=u.getStateForDocumentId(a,i)}else o=u.getActivePaneState(),a=o.getDocumentId();if(sn({state:!0,documentModel:!0,notVideo:!0,documentId:a,fullThumbsAllowed:!0},o)){if(n=da(n,o),r.enableSaveOverwriteWarning!==!1&&!n.skipOverwriteDialog&&!n.newDocumentId&&M.willSavingOverwriteCurrentFormat(o))return void $("#vvOverwriteDialog").modal("show");var s=!1;M.willSavingOverwriteCurrentFormat(o)&&!n.newDocumentId&&(s=!0),n.newDocumentId?K.call("saveAsDocumentBegin",{documentId:o.getDocumentId(),newDocumentId:n.newDocumentId,clientInstanceId:M.getClientInstanceId()}):K.call("saveDocumentBegin",{documentId:o.getDocumentId(),clientInstanceId:M.getClientInstanceId()}),M.displaySaveIndicator(!0),i=o.currentPaneIndex,n.newDocumentId||n.saveAsFormat||o.resetDocFormat();var l=o.getDocumentModel();e("vvWatermarks").saveWatermarks(o),Q.saveBookmarks(),o.getImageManager().cleanBuffers(),M.updateAnnotationForNewDimensions(),o.clearNewAnnList(),o.clearNewWMList(),o.resetCachedPictureControlValues();var d=[];if(n.newDocumentId||l.getModifiedSinceInit()){if(o.isDocumentCropped())for(var c=0;c<o.pageCount;c++)o.isPageCropped(c)&&d.push(c);var v=new URI(r.servletPath);v.addQuery("action","saveDocumentModel"),v.addQuery("clientInstanceId",M.getClientInstanceId()),v.addQuery("cacheBuster",Math.random()),v.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),v.addQuery("includeRedactions",n.burnRedactions),v.addQuery("includeTextAnnotations",n.includeTextAnnotations),v.addQuery("includeNonTextAnnotations",n.includeNonTextAnnotations);var h=l.model;if(n.newDocumentId){h=t.deepObjCopy(l.model),h.documentId=encodeURIComponent(n.newDocumentId),n.newDisplayName?h.displayName=encodeURIComponent(n.newDisplayName):h.displayName=encodeURIComponent(n.newDocumentId);var m=n.createNew;m&&delete h.documentNotes,v.addQuery("pageRangeType",n.pageRangeType),v.addQuery("pageRangeValue",n.pageRangeValue),v.addQuery("copyAnnotations",n.copyAnnotations),v.addQuery("copyWatermarks",n.copyWatermarks),v.addQuery("format",n.saveAsFormat),v.addQuery("documentId",encodeURIComponent(n.newDocumentId)),v.addQuery("oldDocumentId",encodeURIComponent(a))}else h.bookmarks&&0===Q.bookmarkArray.length&&delete h.bookmarks,v.addQuery("copyAnnotations",n.copyAnnotations),v.addQuery("copyWatermarks",n.copyWatermarks),v.addQuery("documentId",a);v.addQuery("includeRedactionTags",n.includeRedactionTags),v.addQuery("includeWatermarks",n.includeWatermarks),v.addQuery("modelJSON",JSON.stringify(h));var f=o.getAnnotationLayers(!0,!0,n.newDocumentId,n.burnRedactions,n.includeTextAnnotations,n.includeNonTextAnnotations,"PDF"===n.saveAsFormat);v.addQuery("annotations",JSON.stringify(f)),null!==M.getOverlayPath()&&v.addQuery("overlayPath",M.getOverlayPath());var y=v.query();v.query(""),$.ajax({url:v.toString(),type:"POST",dataType:"json",data:y,async:!1,success:function(t){var o=null,c=null;if(Nt(),mt(t)===!0){M.displaySaveIndicator(!1);var v={documentId:a,saveAsDocumentId:n.newDocumentId,exceptionMessage:t.exceptionMessage,statusText:t.statusText};return n.newDocumentId?K.call("saveAsDocumentError",v):K.call("saveDocumentError",v),void(f.length>0&&K.call("saveAnnotationsError",v))}if(t.documentIdToReload&&(c=decodeURIComponent(t.documentIdToReload)),n.newDocumentId){if(n.useCut){var h=M.getStateForDocumentId(a);M.deleteSelection({pageNums:n.pageNums},h)}return K.call("saveAsDocument",{oldDocumentId:a,newDocumentId:c,clientInstanceId:M.getClientInstanceId()}),void M.displaySaveIndicator(!1)}if(K.call("saveDocument",{documentId:a,clientInstanceId:M.getClientInstanceId(),documentIdToReload:c}),K.call("saveAnnotations",{documentId:a,clientInstanceId:M.getClientInstanceId(),documentIdToReload:c}),r.reloadDocumentOnSave===!0){var m=c,y=a;m&&"undefined"!==m||(m=y),o=u.getStateForDocumentId(y,i),o.documentId=m;var b=o.getDisplayName();b||(b=y),o.setDisplayName(b),u.removeStateForDocumentId(y,i),u.setStateForDocumentId(m,o,i),u.displayedDocuments[i]!==y&&u.displayedDocuments[i]||u.setDisplayedState(o,i);var P={documentId:y,displayName:o.getDisplayName()},T=M.getStateForDocumentId(m),A={documentId:m,displayName:T.getDisplayName()};M.updateInRecentlyViewed(P,A),g.updateDocumentId(y,m),o.getDocumentModel().cleanAfterSave(m,null,s),M.requestDocumentList(),o.clearAllLayers();var I=function(e){ca(e,d)};o.closedTab||M.reloadDocumentModel(m,i,I),M.displaySaveIndicator(!1)}else{o=u.getStateForDocumentId(a,i);let t=!1;if((l.getPagesModifiedSinceInit()||s)&&0===i&&a===u.getOpenDocumentId()&&(t=!0),l.cleanAfterSave(a,o,s),ca(o,d),t){let t=e("vvThumbs");t.fillPageThumbs(o),t.loadVisibleThumbs($("#vvPageThumbs")),p.nukeThenReload(o)}}},error:function(e){console.log("saveDocument: "+e.statusText),M.displaySaveIndicator(!1);var t={client:!1,disable:M.disableErrorModals.server};mt(e,a,i,t);var o={documentId:a,saveAsDocumentId:n.newDocumentId,exceptionMessage:e.exceptionMessage,statusText:e.statusText};n.newDocumentId?K.call("saveAsDocumentError",o):K.call("saveDocumentError",o),f.length>0&&K.call("saveAnnotationsError",o)}})}else o=u.getActivePaneState(),o.saveAnnotationLayers(),g.updateTabName(o)}};var ca=function(e,t){if(M.displaySaveIndicator(!1),!e.closedTab){if(e.resetAfterSave(),Yt(e),X.getMagnifiedImage(e,e.pageNumber),t.length>0)for(var a=0;a<t.length;a++)e.removePageText(t[a]);if(d.rerunCurrentSearch(),g.updateTabName(e),e.getDocumentModel().model.emailAttachmentInfo||g.clearEmailAttachmentsDropdown(e.getTabNumber()),u.getCurrentDiff()){var n=1-e.currentPaneIndex;u.getCurrentState(n).getDocumentModel().getPagesModifiedSinceInit()||(u.getCurrentDiff().diffDisabledUntilSave=!1,M.performDiff())}}};h.prototype.saveAllDocuments=function(){g.forEachTab(M.saveDocument)},h.prototype.updateAnnotationForNewDimensions=function(){for(var e=this.getActivePaneState(),t=0;t<e.pageCount;t++)for(var a=e.pageStates[t],n=a.annotationLayers||{},o=e.layerNames,i=0;i<o.length;i++){var r=n[o[i]];if(r)for(var s=r.pageHeight,l=r.pageWidth,u=0;u<r.anns.length;u++){var d=r.anns[u],c=d.pageHeight,g=d.pageWidth,v=d.getRotationAngle();if(90!=v&&270!=v||(c=d.pageWidth,g=d.pageHeight),s!=c||l!=g){var p=(s/c).toFixed(2),h=(l/g).toFixed(2);if(p!=h)continue;var m=s/c;d.scaleAnn(m),d.setPageHeight(s),d.setPageWidth(l)}}}},h.prototype.rotateClock=function(){M.rotateImageBy(90)},h.prototype.rotateCounter=function(){M.rotateImageBy(-90)},h.prototype.rotateImageBy=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t)){var a=t.getPageNumber();M.rotatePageBy(a,e)}},h.prototype.rotateAllPagesBy=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t)){for(var a=0;a<t.getPageCount();a+=1)M.rotatePageBy(a,e);virtualViewer.setPage(0),g.updateTabName(t)}},h.prototype.rotateSelectedPagesBy=function(e,t){var a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},a)){if(!ga(t))throw"Invalid degree entry";for(var n=0;n<e.length;n+=1){if(!va(e[n],a))throw"Invalid page entry";M.rotatePageBy(e[n],t)}g.updateTabName(a)}},h.prototype.rotateImageTo=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t))return M.rotatePageTo(t.getPageNumber(),e)},h.prototype.rotatePageTo=function(t,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){var o=n.getRotationForPage(t);if(K.call("rotationBegin",{documentId:n.getDocumentId(),rotationAngle:o,page:t}),!ga(a))throw K.call("rotationError",{documentId:n.getDocumentId(),rotationAngle:o,page:t,exceptionMessage:"The requested angle was invalid."}),"Invalid degree entry";if(!va(t,n))throw K.call("rotationError",{documentId:n.getDocumentId(),rotationAngle:o,page:t,exceptionMessage:"The requested page was invalid."}),"Invalid page entry";a===-90?a=270:a===-180?a=180:a===-270&&(a=90),n.setRotationForPage(t,0),n.setRotationForPage(t,a),e("vvThumbs").rotateThumb(n,t,a),p.rotateThumb(n,t,a),g.updateTabName(n),Ca(),virtualViewer.determineEffectiveZoom(t,n),virtualViewer.sizeScroller({state:n}),Vt(t,a);var i=(o-a)%360;return K.call("rotation",{page:t,degrees:a,rotatedTo:a,rotatedBy:i}),M.delayedPaintCanvases(n),!0}},h.prototype.rotatePageBy=function(t,a){var n=u.getActivePaneState();if(!sn({state:!0,documentModel:!0,notVideo:!0},n))return!1;var o=n.getRotationForPage(t);if(K.call("rotationBegin",{documentId:n.getDocumentId(),rotationAngle:o,page:t}),!ga(a))throw K.call("rotationError",{documentId:n.getDocumentId(),rotationAngle:o,page:t,exceptionMessage:"The requested rotation amount was invalid."}),"Invalid degree entry";if(!va(t,n))throw K.call("rotationError",{documentId:n.getDocumentId(),rotationAngle:o,page:t,exceptionMessage:"The requested page was invalid."}),"Invalid page entry";var i=o;return i+=a,i<0&&(i+=360),i>=360&&(i-=360),n.setRotationForPage(t,i),e("vvThumbs").rotateThumb(n,t,i),p.rotateThumb(n,t,i),g.updateTabName(n),Ca(),virtualViewer.determineEffectiveZoom(t,n),Vt(t,a),virtualViewer.sizeScroller({state:n}),K.call("rotation",{documentId:n.documentId,page:t,degrees:a,rotatedTo:i,rotatedBy:a}),r.rotateTextAnnotations||l.staleAnnTextWrapping(n,t),M.delayedPaintCanvases(n),!0};var ga=function(e){return 0===Math.abs(e)||90===Math.abs(e)||180===Math.abs(e)||270===Math.abs(e)},va=function(e,t){var a=t.getPageCount();return"number"==typeof e&&(e===parseInt(e,10)&&(!(e<0)&&!(e>=a)))},pa=function(e){e=e||u.getActivePaneState();var t=e.getPageNumber(),a=M.getOuterDivFromState(e),n=a.scrollTop()-virtualViewer.findPagePosition(t,e);n/=virtualViewer.getScrollSpeed(e);var o=a.find(".vvScroller").width()-a.width();o<0&&(o=0);var i=(a.find(".vvCanvas").width()+o)/2,r=i-e.getRequestedWidthForPage(t)/2,s=a.scrollLeft(),l=s+r;return{zoom:e.getZoom(),page:t,yPositionOnPage:n,pageLeftPosition:l,centered:r>=0||Math.floor(o/2)===s}},ha=function(e,t){t=t||u.getActivePaneState();var a=u.getOuterDivFromState(t),n=virtualViewer.findPagePosition(e.page,t);if(n+=e.yPositionOnPage*virtualViewer.getScrollSpeed(t),a.scrollTop(n),e.pageLeftPosition<=0||e.centered)Gt(t);else{var o=e.pageLeftPosition*t.getZoom()/e.zoom,i=Math.max(a.find(".vvScroller").width()-a.width(),0),r=(a.find(".vvCanvas").width()+i)/2,s=r-t.getRequestedWidthForPage(e.page)/2;a.scrollLeft(s+o)}};h.prototype.getNextZoomLevelDown=function(e){return y(e)},h.prototype.zoomIn=function(e){var t=u.getActivePaneState(),a=u.getInactivePaneState();
if(sn({state:!0,documentModel:!0,notVideo:!0},t)){var n=t.getZoom();return e||(e=n,e=f(e)),K.call("zoomDocumentBegin",{documentId:t.getDocumentId(),currentZoom:n,newZoom:e}),e>(r.maxZoomPercent||500)?(e=r.maxZoomPercent||500,void K.call("zoomDocumentError",{documentId:t.getDocumentId(),currentZoom:t.getZoom(),newZoom:e,exceptionMessage:"The new zoom is higher than the maximum allowed zoom level. See the setting maxZoomPercent in config.js."})):(ma(t,e),this.zoomLocked&&oe&&ma(a,e),t.getZoom())}},h.prototype.zoomOut=function(e){var t=u.getActivePaneState(),a=u.getInactivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t)){var n=t.getZoom();return e||(e=n,e=y(e)),K.call("zoomDocumentBegin",{documentId:t.getDocumentId(),currentZoom:n,newZoom:e}),e===n?void K.call("zoomDocumentError",{documentId:t.getDocumentId(),currentZoom:t.getZoom(),newZoom:e,exceptionMessage:"The document is already zoomed out as far as possible. See the setting zoomLevels in config.js."}):(ma(t,e),this.zoomLocked&&oe&&ma(a,e),t.getZoom())}};var ma=function(e,t,a){a=a||pa(e),e=e||u.getActivePaneState(),t=t||e.getZoom(),e.setZoomMode(o.zoomModes.fitCustom),e.setZoom(t);for(var n=0;n<e.pageCount;n++)e.zoomPage(e.getZoomDecimal(),n);Ca();var i=e.getImageManager();i.scaleDocumentByPercentage(e.getZoomDecimal()),virtualViewer.sizeScroller({state:e}),ha(a,e),virtualViewer.delayedPaintCanvases(),K.call("zoomDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()})};h.prototype.setZoomPercent=function(e){sn({state:!0,documentModel:!0,notVideo:!0})&&(this.setZoomPercentCore(e),virtualViewer.delayedPaintCanvases())},h.prototype.setZoomPercentCore=function(e,t){t=t||u.getActivePaneState();var a=e||r.zoomLevels[0];if(a&&sn({state:!0,notVideo:!0,fullThumbsAllowed:!0},t)){K.call("zoomDocumentBegin",{documentId:t.getDocumentId(),currentZoom:t.getZoom(),currentZoomMode:t.getZoomMode()}),a>(r.maxZoomPercent||500)?a=r.maxZoomPercent||500:a<r.zoomLevels[0]&&(a=r.zoomLevels[0]);var n=t.pageNumber;t.setZoomMode(o.zoomModes.fitCustom),t.setZoom(a),sn({documentModel:!0,fullThumbsAllowed:!0},t)&&(Sa(t),K.call("zoomDocument",{documentId:t.getDocumentId(),currentZoom:t.getZoom()}),virtualViewer.setPageCore(n,t),virtualViewer.sizeScroller({state:t}),Gt(t),this.zoomLocked&&oe&&(t=u.getInactivePaneState(),t.setZoomMode(o.zoomModes.fitCustom),t.setZoom(a),Sa(t),virtualViewer.setPageCore(n,t),virtualViewer.sizeScroller({state:t}),Gt(t)))}},h.prototype.zoomToLocation=function(e,t,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)&&e&&(t||0===t)&&(a||0===a)){M.setZoomPercentCore(e,n);var o=virtualViewer.findPagePosition(n.pageNumber,n),i=M.getActiveOuterDiv();i.scrollLeft(t),i.scrollTop(o+a),M.delayedPaintCanvases()}},h.prototype.flipX=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e)){var t=!e.getHorizontalFlipForPage();e.setHorizontalFlipForPage(null,t),M.delayedPaintCanvases()}},h.prototype.flipY=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e)){var t=!e.getVerticalFlipForPage();e.setVerticalFlipForPage(null,t),M.delayedPaintCanvases()}},h.prototype.textSelectionAllowed=function(){var e=u.getActivePaneState(),t=e.getHorizontalFlipForPage()===!1&&e.getVerticalFlipForPage()===!1&&!e.isDocumentCropped();return t},h.prototype.getStampManager=function(){return J},h.prototype.clearImageStamps=function(){J.clearStampDropdown()},h.prototype.createImageStamp=function(e,a,n){if(!e||!a){var o={client:!1,disable:M.disableErrorModals.stamp||!1},i=t.getLocalizedValue("errors.stampCreationFailure","Unable to create ImageStamp, invalid URL or title.");ft(i,o)}var r=J.createStampObject(e,a,n);null!==r&&J.addStampsToDropdown(r)},h.prototype.createImageStampArray=function(e){var t=[];t=J.processStampArray(e),J.addStampsToDropdown(t)},h.prototype.createImageStampArrayFromFunction=function(e){virtualViewer.createImageStampArray(e())},h.prototype.invertImage=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e)){var t=e.getPageNumber(),a=e.getInvertImageForPage(t);K.call("invertImageBegin",{documentId:e.getDocumentId(),page:t,currentImageInverted:a,invertImage:!a}),a=!a,a?Ge():e.setSVGEnabledForPage(t,!0),e.setInvertImageForPage(t,a),M.delayedPaintCanvases()}},h.prototype.despeckleImage=function(){var e=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0},e)&&(e.setDespeckleForPage(e.pageNumber),e.imageManager.throttledRequestImageBatch(e))},h.prototype.setAntiAliasOff=function(e){var t=virtualViewer.getStateForDocumentId(M.getDocumentId());t.setAntiAliasOffForPage(t.pageNumber,e),t.imageManager.throttledRequestImageBatch(t)},h.prototype.setBrightness=function(e){var a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},a)){if(isNaN(e))throw"Invalid input, value must be a number";t.isInteger(e)||(e=Math.round(e)),Ge(),a.setBrightnessForPage(a.getPageNumber(),e),M.delayedPaintCanvases()}},h.prototype.setBrightnessForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";if(t.isInteger(a)||(a=Math.round(a)),!ba(a))throw"Invalid brightness value, must be between -125 and 125";for(var o=0;o<e.length;o++)Ge(e[o]),n.setBrightnessForPage(e[o],a);Ge(),g.updateTabName(n),M.delayedPaintCanvases()}},h.prototype.adjustBrightnessForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a));for(var o=0;o<e.length;o++){var i=n.getBrightnessForPage(e[o]),r=a+i;r<-125&&(r=-125),r>125&&(r=125),Ge(e[o]),n.setBrightnessForPage(e[o],r)}g.updateTabName(n),M.delayedPaintCanvases()}},h.prototype.increaseBrightnessForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Ge(e[o]),fa(n,e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}};var fa=function(e,t,a){var n=e.getBrightnessForPage(t),o=n+a;o>125&&(o=125),e.setBrightnessForPage(t,o)};h.prototype.decreaseBrightnessForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Ge(e[o]),ya(n,e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}};var ya=function(e,t,a){var n=e.getBrightnessForPage(t),o=n-a;o<-125&&(o=-125),e.setBrightnessForPage(t,o)},ba=function(e){return e>=-125&&e<=125};h.prototype.setContrast=function(e){var a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},a)){if(isNaN(e))throw"Invalid input, value must be a number";t.isInteger(e)||(e=Math.round(e)),Ge(),a.setContrastForPage(a.getPageNumber(),e),$("#vvContrastDisplay").html(e),M.delayedPaintCanvases()}},h.prototype.setContrastForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";if(t.isInteger(a)||(a=Math.round(a)),!ba(a))throw"Invalid contrast value, must be between -125 and 125";for(var o=0;o<e.length;o++)Ge(e[o]),n.setContrastForPage(e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}},h.prototype.adjustContrastForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a));for(var o=0;o<e.length;o++){var i=n.getContrastForPage(e[o]),r=a+i;r<-125&&(r=-125),r>125&&(r=125),Ge(e[o]),n.setContrastForPage(e[o],r)}g.updateTabName(n),M.delayedPaintCanvases()}},h.prototype.increaseContrastForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Ge(e[o]),Pa(n,e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}};var Pa=function(e,t,a){var n=e.getContrastForPage(t),o=n+a;o>125&&(o=125),e.setContrastForPage(t,o)};h.prototype.decreaseContrastForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Ge(e[o]),Ta(n,e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}};var Ta=function(e,t,a){var n=e.getContrastForPage(t),o=n-a;o<-125&&(o=-125),e.setContrastForPage(t,o)};h.prototype.setGamma=function(e){var a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},a)){if(isNaN(e))throw"Invalid input, value must be a number";t.isInteger(e)||(e=Math.round(e)),Ge(),a.setGammaForPage(a.getPageNumber(),e),$("#vvGammaDisplay").html(e),M.delayedPaintCanvases()}},h.prototype.setGammaForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";if(t.isInteger(a)||(a=Math.round(a)),a<0||a>400)throw"Invalid gamma value, must be between 0 and 400";for(var o=0;o<e.length;o++)Ge(e[o]),n.setGammaForPage(e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}},h.prototype.adjustGammaForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a));for(var o=0;o<e.length;o++){var i=n.getGammaForPage(e[o]),r=a+i;r<0&&(r=0),r>400&&(r=400),Ge(e[o]),n.setGammaForPage(e[o],r)}g.updateTabName(n),M.delayedPaintCanvases()}},h.prototype.increaseGammaForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Ge(e[o]),Aa(n,e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}};var Aa=function(e,t,a){var n=e.getGammaForPage(t),o=n+a;o>400&&(o=400),e.setGammaForPage(t,o)};h.prototype.decreaseGammaForSelectedPages=function(e,a){var n=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},n)){if(isNaN(a))throw"Invalid input, value must be a number";t.isInteger(a)||(a=Math.round(a)),a=Math.abs(a);for(var o=0;o<e.length;o++)Ge(e[o]),Ia(n,e[o],a);g.updateTabName(n),M.delayedPaintCanvases()}};var Ia=function(e,t,a){var n=e.getGammaForPage(t),o=n-a;o<0&&(o=0),e.setGammaForPage(t,o)};h.prototype.getBrightness=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e))return e.getBrightnessForPage()},h.prototype.getBrightnessForPage=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t))return t.getBrightnessForPage(e)},h.prototype.getContrast=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e))return e.getContrastForPage()},h.prototype.getContrastForPage=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t))return t.getContrastForPage(e)},h.prototype.getGamma=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e))return e.getGammaForPage()},h.prototype.getGammaForPage=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},t))return t.getGammaForPage(e)},h.prototype.zoomLoop=function(e){Sa(e)};var Sa=function(e){if(e=e||u.getActivePaneState(),e&&e.pageStates&&e.pageStates.length){var t=e.pageNumber;virtualViewer.determineEffectiveZoom(t,e);for(var a=0;a<e.getPageCount();a++)e.zoomPage(e.getZoomDecimal(),a);var n=e.getImageManager();n.scaleDocumentByPercentage(e.getZoomDecimal()),Ca(),Gt(e);var o=u.getOuterDivFromState(e);o.scrollTop(virtualViewer.findPagePosition(t,e)),virtualViewer.paintCanvases(e)}};h.prototype.fitWidthOpenDocuments=function(){var e=u.getAllStates();e.forEach(function(e){e.isMedia()||M.fitWidthCore(e)})},h.prototype.fitWidth=function(){this.fitWidthCore()},h.prototype.fitWidthCore=function(e){if(e=e||u.getActivePaneState(),sn({state:!0,notVideo:!0},e)){if(K.call("fitDocumentBegin",{documentId:e.getDocumentId(),currentZoom:e.getZoom(),newFitMode:o.zoomModes.fitWidth}),e.setZoomMode(o.zoomModes.fitWidth),!e.pageStates)return void K.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()});wa(e),oe&&this.zoomLocked&&wa(u.getInactivePaneState())}},h.prototype.fitHeight=function(){this.fitHeightCore()},h.prototype.fitHeightCore=function(e){if(e=e||u.getActivePaneState(),sn({state:!0,notVideo:!0},e)){if(K.call("fitDocumentBegin",{documentId:e.getDocumentId(),currentZoom:e.getZoom(),newFitMode:o.zoomModes.fitHeight}),e.setZoomMode(o.zoomModes.fitHeight),!e.pageStates)return void K.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()});wa(e),oe&&this.zoomLocked&&wa(u.getInactivePaneState())}},h.prototype.fitWindow=function(){this.fitWindowCore()},h.prototype.fitWindowCore=function(e){if(e=e||u.getActivePaneState(),!e.isMedia()&&sn({state:!0,notVideo:!0},e)){if(K.call("fitDocumentBegin",{documentId:e.getDocumentId(),currentZoom:e.getZoom(),newFitMode:o.zoomModes.fitWindow}),e.setZoomMode(o.zoomModes.fitWindow),!e.pageStates)return void K.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()});wa(e),oe&&this.zoomLocked&&wa(u.getInactivePaneState())}};var wa=function(e){e=e||u.getActivePaneState();var t=e.pageNumber;Sa(e),virtualViewer.setPageCore(t,e),virtualViewer.sizeScroller({state:e});var a=u.getOuterDivFromState(e);a.scrollTop(virtualViewer.findPagePosition(t,e)),Gt(e),K.call("fitDocument",{documentId:e.getDocumentId(),currentZoom:e.getZoom()})};h.prototype.getPageCount=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e))return e.pageCount},h.prototype.firstPage=function(){var e=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e)&&"true"!==$(".vvGoToFirstPage").attr("aria-disabled")&&0!==e.getPageNumber()&&M.setPage(0)},h.prototype.nextPage=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e)&&!("true"===$(".vvGoToNextPage").attr("aria-disabled")||e.getPageNumber()+1>=e.getPageCount())){var t=e.getPageNumber();M.setPage(t+1)}},h.prototype.previousPage=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e)&&"true"!==$(".vvGoToPreviousPage").attr("aria-disabled")&&0!==e.getPageNumber()){var t=e.getPageNumber();M.setPage(t-1)}},h.prototype.lastPage=function(){var e=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e)&&("true"===$(".vvGoToLastPage").attr("aria-disabled")||e.getPageNumber()+1>=e.getPageCount()||M.setPage(e.getPageCount()-1))},h.prototype.panUp=function(){var e=document.getElementById("vvOuterDiv");e.scrollTop-=ye},h.prototype.panDown=function(){var e=document.getElementById("vvOuterDiv");e.scrollTop+=ye},h.prototype.panLeft=function(){var e=document.getElementById("vvOuterDiv");e.scrollLeft-=ye},h.prototype.panRight=function(){var e=document.getElementById("vvOuterDiv");e.scrollLeft+=ye},h.prototype.thumbPageDown=function(){vvPageThumbs.scrollTop+=$("#vvPageThumbs").height()},h.prototype.thumbPageUp=function(){vvPageThumbs.scrollTop-=$("#vvPageThumbs").height()},h.prototype.updatePage=function(t,a){if(a=a||u.getActivePaneState(),!a||!a.pageStates||a.pageStates.length<1)return!1;if(t!==a.pageNumber&&K.call("pageChangeBegin",{documentId:a.getDocumentId(),currentPage:a.pageNumber,newPage:t}),!Na(t))return t!==a.pageNumber&&K.call("pageChangeError",{documentId:a.getDocumentId(),currentPage:a.pageNumber,newPage:t,exceptionMessage:"The new page was invalid."}),!1;virtualViewer.deselectAllText(a),Ca(),v.clearDocumentLinkPopover(),r.collapseStickiesByDefault&&M.collapseAllStickyNotes(!0);var n=a.pageNumber;a.setPageNumber(t),Yt(),La(a);var o=e("vvThumbs");return 0===M.getActivePane()&&(o.highlightActiveThumbnail(a),o.ensurePageThumbIsVisible(a),o.ensureSearchThumbIsVisible(a),p.highlightActiveThumbnail(a),p.ensureThumbIsVisible(a)),Ca(),t!==n&&K.call("pageChange",{documentId:a.getDocumentId(),page:t}),Lt(a),!0};var Ca=function(){virtualViewer.hideAnnPopUp(),virtualViewer.setPreviousAnnObject(M.getCurrentAnnObject()),virtualViewer.setCurrentAnnObject(null)};h.prototype.setPage=function(e){return M.setPageCore(e)},h.prototype.setPageCore=function(t,a){if(a=a||u.getActivePaneState(),sn({state:!0,documentModel:!1,notVideo:!0,fullThumbsAllowed:!0},a)&&virtualViewer.updatePage(t,a)){if(r.showAnnIndicators){var n=M.pagesWithAnnotations();$("#vvRedactionNavigationOption")[0].checked||Ut(t,n)}d.updateSearchButtons(),virtualViewer.skipScrollEvent=!0;var o=M.getOuterDivFromState(a);o.scrollTop(virtualViewer.findPagePosition(t,a)),e("vvThumbs").ensurePageThumbIsVisible(a),p.ensureThumbIsVisible(a)}},h.prototype.displayWaitIndicator=function(e,t){B&&clearTimeout(B);var a=!1;if(t=t||u.getActivePaneState(),t&&(a=t.isMedia()),e){$("#waitIndicatorProgressBar").hide();var n=r.waitDialogTimeout||1e3;B=setTimeout(function(){a?$("#vvVideoWaitIndicator").modal("show"):H||$("#vvWaitIndicator").modal("show")},n)}else clearTimeout(B),$("#vvWaitIndicator").modal("hide"),$("#vvVideoWaitIndicator").modal("hide")},h.prototype.displaySaveIndicator=function(e){r.enableSaveNotification&&(e?$("#vvSaveDocumentIndicator").show():$("#vvSaveDocumentIndicator").hide())},h.prototype.displayOcrWaitIndicator=function(e){e?$("#vvOcrIndicator").modal("show"):$("#vvOcrIndicator").modal("hide")};var Da=function(e){e?$("#vvEmailIndicator").modal("show"):$("#vvEmailIndicator").modal("hide")};h.prototype.saveDocumentAsDialog=function(){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},t)){var a="pdf",n=M.getSaveAsDocumentNameGenerator(),o=n(t.getDocumentId(),t.getDisplayName(),a);e("vvDialogs").saveAsDialog({documentName:{documentName:o}})}},h.prototype.willSavingOverwriteCurrentFormat=function(e){if(e=e||u.getActivePaneState(),!sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e))return!1;var t="tif"===e.getDocFormat()||"pdf"===e.getDocFormat(),a=e.isCompoundDocument(),n=e.documentModel.getPagesModifiedSinceInit();return!(t&&!a||!n||e.isVirtualDocument())},h.prototype.printDocumentDialog=function(t){sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&e("vvDialogs").printDialog(t)};h.prototype.printDocument=function(t){var a;t&&t.documentId&&(a=u.getStateForDocumentId(t.documentId)),sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},a)&&e("vvPrintManager").printDocument(t)};var Ma=function(e,t){var a=u.getActivePaneState(),n=M.getCurrentAnnObject(),o=l.getLayerWithAnn(n),i=a.getUndoObject(a.getPageNumber());i.referenceAnn=n,i.unchangedAnn=n.clone(),i.layer=o,n&&n.markRevised(),"vvAnnTextColorChoices"===this.element[0].id&&n.setFontColor(e),"vvAnnFillColorChoices"===this.element[0].id&&(n.setFillColor(e),n.setOpacity(t)),"vvAnnLineColorChoices"===this.element[0].id&&n.setLineColor(e),i.modifiedAnn=n.clone(),i.type="modify",i.modifiedAnn.isSameAs(i.unchangedAnn)||a.pushUndoObject(a.getPageNumber(),i),a.resetUndoObject(),l.markLayerWithAnnDirty(n),a.getNewAnnList().indexOf(n)===-1&&a.setTrueAnnChange(!0),virtualViewer.delayedPaintCanvases()};h.prototype.showRedactionWarningDialog=function(){"true"!==localStorage.ne7owv6art3itt5ild7ed3oick9jiz1go5huec9eav7fups5ew&&M.annotationsEnabled&&r.disableRedactionWarningDialog!==!0&&(M.redactionWarningShown||($("#vvRedactionWarningDialog").modal("show"),M.redactionWarningShown=!0))},h.prototype.createHighlightFromSelection=function(){var e=M.mergeTextRects(virtualViewer.getSelectedTextRects()),a=M.getCurrentState(),n=a.getPageNumber();if(M.checkAnnotationsEnabled(!0)){var i=l.getCurrentLayer();if(i||r.oneLayerPerAnnotation||(i=l.createDefaultLayer(a)),i&&t.isRedactionLayer(i)&&(i=a.getLayerFromPage(n,"Default"),i||(i=l.createDefaultLayer(a))),e.length){for(var s=0;s<e.length;s++){r.oneLayerPerAnnotation===!0&&(Tt(),i=l.getCurrentLayer());var u=t.getPixelImageRectFromPercents(e[s],n,a);M.createAnnotationFromRect(u,o.annotationTypes.SANN_HIGHLIGHT_RECT,i,n,!0)}M.delayedPaintCanvases(),M.pageContainsAnnotations(M.getPageNumber())&&!M.pageHasIndicator(a.getPageNumber())&&(virtualViewer.showAnnotationIndicator(a.getPageNumber()),M.addToPagesWithAnnotations(a.getPageNumber())),virtualViewer.createNavigationOptionsLabels()}}},h.prototype.createRedactionFromSelection=function(){var e=M.mergeTextRects(virtualViewer.getSelectedTextRects()),a=M.getCurrentState(),n=a.getPageNumber();if(e.length){for(var o=0;o<e.length;o++){var i=l.getRedactionLayer(n),r=t.getPixelImageRectFromPercents(e[o],n,a);M.createRedactionFromRect(r,i,n,!0)}M.delayedPaintCanvases(),M.pageContainsAnnotations(M.getPageNumber())&&!M.pageHasIndicator(a.getPageNumber())&&(virtualViewer.showAnnotationIndicator(a.getPageNumber()),M.addToPagesWithAnnotations(a.getPageNumber())),virtualViewer.createNavigationOptionsLabels()}},h.prototype.createRedactionFromRect=function(e,t,a,n,i,r){if(M.checkRedactionsEnabled(!0))return t||(t=l.getRedactionLayer(a)),M.showRedactionWarningDialog(),M.createAnnotationFromRect(e,o.annotationTypes.SANN_REDACTION_RECT,t,a,n,i,r)},h.prototype.createAnnotationFromRect=function(t,n,o,s,u,d,c){"use strict";var g=this.getActivePaneState();s||0===s||(s=g.getPageNumber());var v=new i(t.left,t.top,t.width(),t.height());o||(o=l.getCurrentLayer(s),g.getLayersForPage(s)&&o||(o=l.createDefaultLayer(g)));var p,h,m;c?(p=c.dpi||72,h=c.pageWidth,m=c.pageHeight):(p=g.getDPIForPage(s)||72,h=g.getOriginalWidthForPage(s),m=g.getOriginalHeightForPage(s)),o.anns&&o.anns.length||g.imageInfoLoaded(s)||c?o.anns&&o.anns.length||o.pageWidth||(o.docDPI||(o.docDPI=p),o.pageWidth=h*o.docDPI/p,o.pageHeight=m*o.docDPI/p):(l.initializeLayerFromFirstPage(g,s,o),o.pageWidth=g.getRequestedWidthForPage(s)/g.getZoomDecimal(),o.pageHeight=g.getRequestedHeightForPage(s)/g.getZoomDecimal(),h=o.pageWidth,m=o.pageHeight,p=o.docDPI);var f=o.doubleByte;"boolean"!=typeof f&&(f=r.base64EncodeAnnotations);var y=G.getAnnotationPreference(n);"undefined"==typeof y.fillOpacity&&(y.fillOpacity=r.annotationDefaults.highlightOpacity);var b=new(e("vvPreviewAnnotation"));b.initPreview(y,v,[new a(v.getX1(),v.getY1()),new a(v.getX2(),v.getY2())],f,p,o.isIDM,s,virtualViewer.getUsername()),b.setPreview(!1),this.currentPreviewAnnObject=null,this.currentPointArray=[],b.setPageWidth(h),b.setPageHeight(m),b.fixForPaste(s,g,o);var P=l.addAnnotation(b,s,o,!0,d);if(!P)return null;let T=this.getCurrentAnnObject();this.setCurrentAnnObject(P),K.call("annotationCreation",{documentId:g.getDocumentId(),annotationLayerId:P.layerName,annotationId:P.annId,type:P.getRefinedType(),createDate:P.getCreateDate()}),this.setCurrentAnnObject(T);var A=g.getUndoObject(s);return A.modifiedAnn=void 0,A.layer=o,A.type="add",g.pushUndoObject(s,A),u||this.delayedPaintCanvases(),this.createNavigationOptionsLabels(),P},h.prototype.destroyInProgressAnnotation=function(){this.setCurrentAnnObject(null),this.currentPreviewAnnObject=null,this.disableStickyAnnotationButton(),Z.dragging=!1,this.currentPointArray=[],O=null,this.delayedPaintCanvases()},h.prototype.turnOnAnnotationButton=function(e,a,n){if(M.checkAnnotationsEnabled(!0)&&a&&"true"!==a.attr("aria-disabled")){var i=u.getActivePaneState();if(i&&!i.isMedia()){if(M.getCurrentAnnObject()||M.currentPreviewAnnObject||M.getDragMode()===o.dragModes.annotate){if(M.setCurrentAnnObject(null),M.currentPreviewAnnObject=null,M.hideAnnPopUp(),M.delayedPaintCanvases(),e===O&&M.getDragMode()===o.dragModes.annotate)return void M.disableStickyAnnotationButton();M.disableStickyAnnotationButton()}if(e===o.annotationTypes.SANN_REDACTION_RECT){if(!M.checkRedactionsEnabled(!0))return;M.showRedactionWarningDialog()}var s=r.stickyAnnButtons[e];s&&(te=e),s&&ge&&M.getCurrentAnnType()===e&&!n||(O=e,M.currentPointArray=[],O===o.annotationTypes.SANN_EDIT&&0===q.customStampArray.length&&(M.currentStamp=null),this.hideAnnPopUp(),t.cursorAnnotate(),$(".selectedAnn").removeClass("selectedAnn"),a.addClass("selectedAnn"),a.parents("li").addClass("selectedAnn"),s&&(ge=!0),this.setDragMode(o.dragModes.pan),this.setDragMode(o.dragModes.annotate))}}},h.prototype.disableStickyAnnotationButton=function(){$(".selectedAnn").removeClass("selectedAnn"),ge=!1,t.cursorNormal(),M.currentPointArray=[],Z.endPoint=0,this.setDragMode(o.dragModes.pan)},h.prototype.toggleLayerManager=function(){var e=this.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e)){if("true"===$("#vvLayerManagerButton").attr("aria-disabled")||$("#vvLayerManagerDiv:visible").length)return void $("#vvLayerManagerDiv").modal("hide");var t=e.getLayerManager();t.showLayerDialog(e)}},h.prototype.showWatermarksManager=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&e("vvDialogs").watermarksDialog()},h.prototype.removeWatermarksFromPage=function(t){var a=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0},a)&&("number"!=typeof t&&(t=a.getPageNumber()),e("vvWatermarks").removeWatermarksFromPage(t,a),M.delayedPaintCanvases())},h.prototype.removeAllWatermarks=function(){var t=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0},t)&&(e("vvWatermarks").removeAllWatermarks(t),M.delayedPaintCanvases())},h.prototype.addWatermark=function(a,n){var o=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},o)){if(!a){var i=t.getLocalizedValue("watermarksDialog.errors.noText","Watermark must contain text."),r={client:!0};return void ft(i,r)}e("vvWatermarks").addWatermark(o,a,n),M.delayedPaintCanvases()}},h.prototype.sendDocument=function(t){var a;if(t?a=u.getStateForDocumentId(t):(a=u.getActivePaneState(),t=a.getDocumentId()),sn({state:!0,documentModel:!0,notVideo:!0,documentId:t,fullThumbsAllowed:!0},a)){var n=new URI(r.servletPath);n.addQuery("action","sendDocument"),e("vvWatermarks").saveWatermarks(a);var i=a.getDocumentModel().model;n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),n.addQuery("modelJSON",JSON.stringify(i)),n.addQuery("annotations",JSON.stringify(a.getAnnotationLayers(!0,!0,!0,r.sendDocumentWithAnnotations))),n.addQuery("includeTextAnnotations",r.sendDocumentWithAnnotations),n.addQuery("includeNonTextAnnotations",r.sendDocumentWithAnnotations),n.addQuery("includeRedactions",r.sendDocumentWithAnnotations),n.addQuery("includeWatermarks",r.sendDocumentWithWatermarks),n.addQuery("includeDocumentNotes",r.sendDocumentWithNotes),n.addQuery("stampStatus",""),null!==M.getOverlayPath()&&n.addQuery("overlayPath",M.getOverlayPath()),o.cacheBuster===!0&&n.addQuery("cacheBuster",Math.random()),n.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var s=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",data:s,dataType:"json",success:function(e){mt(e)!==!0&&K.call("sendDocument")},error:function(e){mt(e,a.getDocumentId(),a.currentPaneIndex)===!0}})}},h.prototype.lockScrolling=function(e){oe?this.scrollingLocked=!!e:this.scrollingLocked=!1;var t=$("#vvLockScrollingBtn");this.scrollingLocked?(t.removeClass("vvDiffScrollingUnlocked"),t.addClass("vvDiffScrollingLocked")):(t.removeClass("vvDiffScrollingLocked"),t.addClass("vvDiffScrollingUnlocked"))},h.prototype.toggleZoomLock=function(){this.zoomLocked=!this.zoomLocked},h.prototype.setZoomLock=function(e){this.zoomLocked=e};var xa=function(e,t,a){var n=$(e).scrollTop(),o=$(e).scrollLeft();if($(t).scrollTop()!==n||$(t).scrollLeft()!==o){var i=le,r=ue;a&&(i=re,r=se),re=n,se=o,le=n,ue=o,i!==n&&$(t).scrollTop(n),r!==o&&$(t).scrollLeft(o)}},La=function(e){var t,a;e||(e=u.getActivePaneState()),e&&(a=e.getPageNumber(),t=e.getPageCount(),Fe(e)),$(".vvJumpToPageInput").val(a+1),$(".vvJumpToPageTotal").attr("title",""),0!==t?$(".vvJumpToPageTotal").html(t):$(".vvJumpToPageTotal").html(1)},Na=function(e){if(!e&&0!==e)return Va(!0),!1;var t=u.getActivePaneState(),a=t.getPageCount();return e<0||a>0&&e>=a?(Va(!0),!1):(Va(!1),!0)},Va=function(e){if(e){$(".vvJumpToPageInput").attr("aria-invalid",!0);var a=t.getLocalizedValue("utilityToolbar.paginationOoBMessage");return void $(".vvJumpToPageInput").attr("title",a).tooltip("fixTitle").tooltip("show")}$(".vvJumpToPageInput").attr("aria-invalid",!1),$(".vvJumpToPageInput").removeAttr("title").removeAttr("data-original-title").tooltip("fixTitle").tooltip("hide")};h.prototype.getPageNumber=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},e))return e?e.getPageNumber():void 0},h.prototype.getOriginalWidth=function(){return originalWidth},h.prototype.setOriginalWidth=function(e){originalWidth=e},h.prototype.getDocumentModel=function(e){return e||(e=u.getActivePaneState()),e?e.getDocumentModel():null},h.prototype.setDocumentModel=function(e){var t=u.getActivePaneState();t.setDocumentModel(e)},h.prototype.getZoomPercent=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e))return e.getZoomDecimal()},h.prototype.getCurrentAnnObject=function(){return E},h.prototype.setCurrentAnnotationId=function(e){if(!sn({state:!0}))return null;let a=M.getCurrentAnnObject();return a?(e||(e=t.vvGUID()),a.annId=e,e):null},h.prototype.setCurrentAnnObject=function(e){let t=u.getActivePaneState();e&&t&&K.call("annotationSelection",{documentId:t.getDocumentId(),annotationLayerId:e.layerName,annotationId:e.annId,type:e.getRefinedType()}),E=e},h.prototype.getPreviousAnnObject=function(){return _},h.prototype.setPreviousAnnObject=function(e){_=e},h.prototype.collapseAllStickyNotes=function(e,t){var a=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},a)){var n=a.getLayersForPage(M.getPageNumber());if(n){var i=Object.keys(n);if(i&&n)for(var r=0;r<i.length;r+=1)for(var s=n[i[r]],l=s.anns,d=0;d<l.length;d+=1){var c=l[d];c.getType()===o.annotationTypes.SANN_POSTIT&&(c.collapsed=e,c.editing=!1)}t&&virtualViewer.delayedPaintCanvases()}}},h.prototype.zoomRubberband=function(){var e=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0},e)&&(O=o.annotationTypes.SANN_RECTANGLE,M.currentPointArray=[],Z.endPoint=0,M.setDragMode(o.dragModes.zoom))},h.prototype.setFullScreenThumbsVisibility=function(e){var t=$("#vvSplitPaneDiv"),a=u.getActivePaneState();a&&!a.isMedia()&&(e?(t.hide(),t.addClass("nonselectable"),virtualViewer.hideAnnPopUp(),$("#vvImagePanel").addClass("fullThumbs"),$("#vvThumbs").hide(),$("#vvFullThumbs").show(),$("#vvFullThumbSmallButton").show(),$("#vvFullThumbLargeButton").show(),$("#vvThumbToggleButton").hide(),p.toggleToolbarsForFullscreen(!1),virtualViewer.toggleThumbnailPanel(!1),p.fillGridThumbs(),p.displaySelectedThumb(u.getActivePaneState()),p.updateButtonColors(),p.shallowRotateUpdate(),p.setOpen(!0)):(t.show(),t.removeClass("nonselectable"),$("#vvImagePanel").removeClass("fullThumbs"),$("#vvThumbs").show(),$("#vvToolbarItems").show(),$("#vvFullThumbs").hide(),$("#vvFullThumbSmallButton").hide(),$("#vvFullThumbLargeButton").hide(),$("#vvThumbToggleButton").show(),p.toggleToolbarsForFullscreen(!0),p.setOpen(!1),virtualViewer.toggleThumbnailPanel(!0),virtualViewer.setPage(a.getPageNumber(),a),virtualViewer.paintCanvases()))},h.prototype.toggleFullscreenThumbs=function(){p.open?virtualViewer.setFullScreenThumbsVisibility(!1):virtualViewer.setFullScreenThumbsVisibility(!0)},h.prototype.enlargeFullscreenThumbs=function(){p.enlargeFullscreenThumbs()},h.prototype.shrinkFullscreenThumbs=function(){p.shrinkFullscreenThumbs()};var ka=function(e,t){virtualViewer.localClipboard=e;var a=encodeURIComponent(JSON.stringify(e)),n=function(e){if(t)if(virtualViewer.localClipboard)t();else{var a={client:!0,disable:M.disableErrorModals.pageManipulation,e:e};ft(e.message,a);
}},o=localforage.setItem("vvClipboard",a);t?o.then(t,n):o.then(function(){},n)},$a=function(e){var t=function(t){var a=null;try{a=JSON.parse(decodeURIComponent(t))}catch(e){a=null}var n=a?a.sessionGUID:null,o=virtualViewer.localClipboard;o&&(!a||o.timestamp>a.timestamp)?a=o:r.enableCopyPasteBetweenSessions===!1&&n!==virtualViewer.viewerSessionID&&(a=o),a?(Ra(a),e(a)):e(null)},a=function(){e(virtualViewer.localClipboard?virtualViewer.localClipboard:null)},n=localforage.getItem("vvClipboard");n.then(t,a)};h.prototype.createClipObject=function(){var t={},a=virtualViewer.getDocumentModel(),n=virtualViewer.getCurrentState(),o=n.getImageManager(),i=a.getSelectedPageNumbers();return 0!==i.length&&(t.pageNums=i,t.pageState=n.copyPages(i,0),t.layerNames=n.getLayerNames(),t.model=a.copySelection(),t.bookmarks=Q.copyBookmarksForPageRange(i),t.watermarks=e("vvWatermarks").copyWatermarksForPageRange(n,i),t.imageManager=o.copyPages(i),t.timestamp=Date.now(),t.sessionGUID=virtualViewer.viewerSessionID,t)},h.prototype.copySelection=function(e,t){if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})){var a={};if(M.checkPageManipulationsEnabled(e)){if(a=virtualViewer.createClipObject()){ka(a,t);var n={pages:a.pageNums,documentId:u.getActivePaneState().documentId};return K.call("pageCopied",n),!0}return!1}return!1}},h.prototype.deleteSelection=function(a,n){n=n||virtualViewer.getCurrentState();var o,i=n.getDocumentModel();o=a.pageNums?a.pageNums:i.getSelectedPageNumbers();var r=n.getImageManager();if(0===o.length)return!1;if(o.length>=n.getPageCount()){var s=t.getLocalizedValue("errors.onePageLimit","Document must contain at least 1 page"),l={client:!0,disable:M.disableErrorModals.pageLimit};return ft(s,l),!1}var d=o[0];M.removeAllAnnotationIndicators();for(var c=0,v=0;v<o.length;v+=1)M.removeFromPagesWithAnnotations(o[v]),c++;n.getDocumentModel().setPagesModifiedSinceInit(!0,n),i.cutSelection(o),n.cutPages(o,0),r.cutPages(o),Q.deleteBookmarks(o),p.deleteGridThumbs(o),Q.shiftBookmarks(o[0],o,!1),e("vvWatermarks").removePages(n,o);var h=e("vvThumbs");h.fillPageThumbs(n);for(var m=M.pagesWithAnnotations(),f=0;f<m.length;f+=1)virtualViewer.showAnnotationIndicator(m[f]);return Yt(n,!0),n.getPageCount()>0&&h.loadVisibleThumbs($("#vvPageThumbs")),K.call("pageDeleted",{pages:o}),g.updateTabName(n),u.getCurrentDiff()&&virtualViewer.performDiff(!0,!0),n.pageNumber>=n.pageCount&&(n.pageNumber=n.pageCount),n.setPagesAddedOrRemovedSinceInit(!0),virtualViewer.setPage(d),virtualViewer.fillAnnotationList(),!0},h.prototype.getThumbsList=function(){return p.thumbList},h.prototype.cutSelection=function(e,t,a){if(!sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0}))return!1;var n={};return!!M.checkPageManipulationsEnabled(t)&&(e!==!0&&(n=virtualViewer.createClipObject(),ka(n,a)),virtualViewer.deleteSelection(n),d.handleSearchOnPageManipulation(),!0)},h.prototype.pasteClip=function(a,n,o,i){var s=a?a.sessionGUID:null;if(r.enableCopyPasteBetweenSessions===!1&&s!==virtualViewer.viewerSessionID){var l=t.getLocalizedValue("errors.copyingBetweenSessionsDisabled","Copying between sessions has been disabled by the administrator."),c={client:!0,disable:this.disableErrorModals.adminDisabled};return void ft(l,c)}n=n||u.getActivePaneState(),o=o||0;var v=n.getDocumentModel();v.setPagesModifiedSinceInit(!0,n),Ea(a,n),v.paste(a.model,o),n.pastePages(a.pageState,o),n.setPageCount(v.getDocumentLength()),n.fixAnnPages();var h=n.getImageManager();h.getPastedPages(a.imageManager.length,o),Q.shiftBookmarks(o,a.pageNums,!0);for(var m=Q.shiftPastePageNumbers(a.pageNums,a.bookmarks,o),f=0;f<m.length;f++){var y=m[f];M.addBookmark(y.note,y.page)}e("vvWatermarks").pastePagesWithWatermarks(n,a,o);var b=e("vvThumbs");b.fillPageThumbs(n),p.nukeThenReload(n);for(var f=0;f<a.imageManager.length;f++)virtualViewer.pageContainsAnnotations(o+f)&&virtualViewer.addToPagesWithAnnotations(o+f);virtualViewer.removeAllAnnotationIndicators(),i||(b.loadVisibleThumbs($("#vvPageThumbs")),virtualViewer.setPage(o));for(var P=o;P<n.pageStates.length&&n.pageStates[P].imageInfoRequested;P++)n.pageStates[P].imageInfoRequested=!1;d.handleSearchOnPageManipulation(),u.getCurrentDiff()&&virtualViewer.performDiff(!0,!0),Yt(n,!0),n.setPagesAddedOrRemovedSinceInit(!0),virtualViewer.showAllAnnotationIndicators(),virtualViewer.fillAnnotationList(),g.updateTabName(n),K.call("pagePasted",{pages:a.pageNums})};var Fa=function(e){var t=e&&e.model[0]&&e.pageState[0];return t};h.prototype.clipIsVVObject=Fa;var Ra=function(e){for(var t=[],a=0;a<e.pageState.length;a++){var o=e.pageState[a],i=e.model[a],r=new n;r.initPageStateFromObject(o);for(var s=e.layerNames,u=0;u<s.length;u++){var d=o.annotationLayers[s[u]];if(d){var c=l.createAnnotationLayer(d.layerName,i.pageIndex,r);c.isIDM=d.isIdm,c.doubleByte=d.doubleByte;for(var g=0;g<d.anns.length;g++){var v=d.anns[g];c.anns[g]=Oa(v,c)}r.annotationLayers[s[u]]=c}}t.push(r)}e.pageState=t};h.prototype.fixClipState=Ra;var Ba=function(e){for(var t=0;t<e.pageState.length;t++)if(e.pageState[t]&&e.pageState[t].annotationLayers)for(var a=Object.keys(e.pageState[t].annotationLayers),n=0;n<a.length;n++){var o=a[n];if(e.pageState[t].annotationLayers[o])for(var i=e.pageState[t].annotationLayers[o],r=0;r<i.anns.length;r++)i.anns[r].markRevised()}},Ea=function(e,a){var n=a.layerNames,o=[];if(!r.oneLayerPerAnnotation){for(var i=0;i<e.layerNames.length;i++){var s=e.layerNames[i];n.includes(s)||o.push(s)}return a.layerNames=o.concat(n),void Ba(e)}for(var u=0;u<e.pageState.length;u++){for(var d={},c=0;c<e.layerNames.length;c++)for(var g=e.layerNames[c],v=e.pageState[u].annotationLayers[g],p=0;p<v.anns.length;p++){var h=Pt(t.isRedactionLayer(v)),m=l.createAnnotationLayer(h,null,e.pageState[u]);m.permissionLevel=v.permissionLevel,o.push(m.layerName);var f=v.anns[p];f.layerName=m.layerName,m.anns.push(f),d[m.layerName]=m}e.pageState[u].annotationLayers=d}Ba(e),e.layerNames=o,a.layerNames=o.concat(n)},Oa=function(t,a){var n=new(e("annotations"));return n.init(null,t,t.page,t.pageWidth,t.pageHeight,t.layerName,a.doubleByte,t.index,t.docDPI,a.isIDM),n};h.prototype.pasteSelection=function(e,a,n){sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&$a(function(o){return e=e||0,o?void(M.checkPageManipulationsEnabled(n)&&virtualViewer.pasteClip(o,null,e,a)):void alert(t.getLocalizedValue("errors.clipboardEmpty","There are no pages on the clipboard."))})},h.prototype.selectPage=function(e,t){if(M.checkPageManipulationsEnabled(t)){var a=M.getDocumentModel();a.addPageToSelection(e)}},h.prototype.deselectPage=function(e,t){if(M.checkPageManipulationsEnabled(t)){var a=M.getDocumentModel();a.removePageFromSelection(e)}},h.prototype.selectRange=function(e,t){if(M.checkPageManipulationsEnabled(t)){var a=M.getDocumentModel();a.selectRange(e)}},h.prototype.selectAll=function(e){if(M.checkPageManipulationsEnabled(e)){var t=M.getDocumentModel();t.selectAll()}},h.prototype.selectNone=function(e){if(M.checkPageManipulationsEnabled(e)){var t=M.getDocumentModel();t.clearPageSelection()}},h.prototype.isPageSelected=function(e,t){if(M.checkPageManipulationsEnabled(t)){var a=M.getDocumentModel();return a.isPageSelected(e)}},h.prototype.getSelectedPageNumbers=function(e){if(M.checkPageManipulationsEnabled(e)){var t=M.getDocumentModel();return t.getSelectedPageNumbers()}},h.prototype.showAboutDialog=function(){$("#vvAboutDialog").modal("show")};var _a=function(e){M.disableUploadDocument=!!e,M.disableUploadDocument?$(".vvFileUpload").remove():$(".vvFileUpload").show()};h.prototype.isUploadDocumentEnabled=function(){return!this.disableUploadDocument},h.prototype.disableUploadDocumentForSession=function(){_a(!0)},h.prototype.showUploadLocalFileDialog=function(){if(this.isUploadDocumentEnabled())return void $("#vvUploadLocalFilesDialog").modal("show");var e=t.getLocalizedValue("errors.uploadDisabled","Upload document has been disabled by the administrator."),a={client:!0,disable:this.disableErrorModals.adminDisabled};ft(e,a)},h.prototype.showUserPreferencesDialog=function(){r.disableUserPreferences||(q.updateDialog(),$("#vvUserPreferencesDialog").modal("show"))},h.prototype.toggleSpeechControls=function(){var e=$("#vvScreenReaderControlsPopUp");"none"===e[0].style.display?(e.show(),ze()):e.hide()};var Ua=function(){var e=u.getActivePaneState();e&&!e.isSearchable?("none"!==$("#vvScreenReaderControlsPopUp")[0].style.display&&M.toggleSpeechControls(),$(".vvSpeechSynthesis").hide()):$(".vvSpeechSynthesis").show()};h.prototype.showPictureControlsDialog=function(){var e=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0},e)){if($("#vvPictureControlsDialog").modal("show"),$("#vvBrightnessSlider").slider({labelledby:"vvBrightnessSliderLabel"}),$("#vvContrastSlider").slider({labelledby:"vvContrastSliderLabel"}),$("#vvGammaSlider").slider({labelledby:"vvGammaSliderLabel"}),$("#vvBrightness .slider").attr("title",t.getLocalizedValue("pictureControls.brightnessSlider.title","Brightness (Slider)")),$("#vvContrast .slider").attr("title",t.getLocalizedValue("pictureControls.contrastSlider.title","Contrast (Slider)")),$("#vvGamma .slider").attr("title",t.getLocalizedValue("pictureControls.gammaSlider.title","Gamma (Slider)")),!e)return void $("#vvPictureControlsDialogOKButton").prop("disabled",!0);$("#vvPictureControlsDialog [title]").attr("data-tooltip","tooltip"),$("#vvPictureControlsDialogOKButton").prop("disabled",!1);var a=e.getBrightnessForPage(e.pageNumber);$("#vvBrightnessSliderVal").text(a),$("#vvBrightnessSlider").slider("setValue",a);var n=e.getDocumentId(),o=e.currentPaneIndex;$("#vvBrightnessSlider").slider().on("slideStop slide",function(e){$("#vvBrightnessSliderVal").text(e.value),Ge();var t=e.value,a=r.pictureControlsTimeout||200;k&&clearTimeout(k),k=setTimeout(function(e){var a=u.getStateForDocumentId(n,o);a.setBrightnessForPage(a.getPageNumber(),t),g.updateTabName(a)},a)});var i=e.getContrastForPage(e.pageNumber);$("#vvContrastSliderVal").text(i),$("#vvContrastSlider").slider("setValue",i),$("#vvContrastSlider").slider().on("slideStop slide",function(e){$("#vvContrastSliderVal").text(e.value),Ge();var t=e.value,a=r.pictureControlsTimeout||200;k&&clearTimeout(k),k=setTimeout(function(e){var a=u.getStateForDocumentId(n,o);a.setContrastForPage(a.getPageNumber(),t),g.updateTabName(a)},a)});var s=e.getGammaForPage(e.pageNumber);$("#vvGammaSliderVal").text(s),$("#vvGammaSlider").slider("setValue",s),$("#vvGammaSlider").slider().on("slideStop slide",function(e,t){$("#vvGammaSliderVal").text(e.value),Ge();var a=e.value,i=r.pictureControlsTimeout||200;k&&clearTimeout(k),k=setTimeout(function(e){var t=u.getStateForDocumentId(n,o);t.setGammaForPage(t.getPageNumber(),a),g.updateTabName(t)},i)})}},h.prototype.emailDocumentDialog=function(){var t=u.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},t)&&e("vvDialogs").emailDialog({displayName:t.getDisplayName(),prepopulateFrom:r.emailDefaults.prepopulateFrom,prepopulateTo:r.emailDefaults.prepopulateTo,prepopulateCC:r.emailDefaults.prepopulateCC,prepopulateBCC:r.emailDefaults.prepopulateBCC})},h.prototype.setProperty=function(e,t){var a=M.getActivePaneState();sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&a.setDocumentModelProperty(e,t)},h.prototype.getProperty=function(e){var t=M.getCurrentState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},t))return t.getDocumentModelProperty(e)},h.prototype.showImageInfo=function(){sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&(this.updateImageInfoDialog(),$("#vvImageInfoDialog").modal("show"))},h.prototype.hideImageInfo=function(){$("#vvImageInfoDialog").modal("hide")},h.prototype.toggleImageInfo=function(){var e=$("#vvImageInfoDialog").data("bs.modal")&&$("#vvImageInfoDialog").data("bs.modal").isShown;return!sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})||e?void this.hideImageInfo():void this.showImageInfo()},h.prototype.updateImageInfoDialog=function(){if(!r.imageInfoFields)return $("#vvImageInfoText").html("No Image Info Available");var e=u.getActivePaneState(),a="<div class='vvImageInfoContents'>";a+="<h4 class='vvImageInfoHeader'>"+t.getLocalizedValue("imageInfo.documentInfoHeader","Document Info")+"</h4>",a+='<table class="vvImageInfoTable" width=100%>';for(var n,o,i,s,l,d=null,c=0;c<r.imageInfoFields.length;c++)n=r.imageInfoFields[c].fieldId,i=r.imageInfoFields[c].fieldCaption,o=t.getLocalizedValue("imageInfo."+n,i),d=c%2===0?"vvImageInfoOddRow":"vvImageInfoEvenRow",b(n)&&(a+="<tr class='"+d+"'><td width=50%>",s=P(n,e),s||(s="N/A"),l=A(s),a+=o+'</td><td title="'+s+'">'+l,a+="</td></tr>");a+="<tr><td><h4 class='vvImageInfoPageHeader'>"+t.getLocalizedValue("imageInfo.pageInfoHeader","Page Info")+"</h4></td></tr>";for(var g=0;g<r.imageInfoFields.length;g++)n=r.imageInfoFields[g].fieldId,i=r.imageInfoFields[g].fieldCaption,o=t.getLocalizedValue("imageInfo."+n,i),d=g%2===0?"vvImageInfoOddRow":"vvImageInfoEvenRow",b(n)||(a+="<tr class='"+d+"'><td width=50%>",s=P(n,e),s||(s="N/A"),l=A(s),a+=o+'</td><td title="'+s+'">'+l,a+="</td></tr>");a+="</table>",a+="</div>",$("#vvImageInfoText").html(a)},h.prototype.toggleKeyboardHints=function(){var e=$("#vvKeyboardHints").data("bs.modal")&&$("#vvKeyboardHints").data("bs.modal").isShown;e?this.hideKeyboardHints():this.showKeyboardHints()},h.prototype.hideKeyboardHints=function(){$("#vvKeyboardHints").modal("hide")},h.prototype.showKeyboardHints=function(){$("#vvKeyboardHints").modal("show")},h.prototype.pageContainsAnnotations=function(e){var t=u.getActivePaneState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},t))return t.pageContainsAnnotations(e)},h.prototype.toggleThumbnailPanel=function(t){var a=e("vvThumbs");return $("#vvImageAndThumbs:visible").length||virtualViewer.toggleHamburgerMenu(),t===!0||t===!1?(a.setThumbPanelVisibility(t),void qa()):void(r.leftSideThumbPanel?a.setThumbPanelVisibility($("#vvImagePanel").hasClass("noThumbsLeftSide")):a.setThumbPanelVisibility($("#vvImagePanel").hasClass("noThumbs")))},h.prototype.setDocumentIdGenerator=function(e){U=e},h.prototype.setExportDocumentNameGenerator=function(e){z=e},h.prototype.setSaveAsDocumentNameGenerator=function(e){W=e},h.prototype.getSaveAsDocumentNameGenerator=function(){return W||virtualViewer.defaultSaveAsDocumentNameGenerator},h.prototype.defaultSaveAsDocumentNameGenerator=function(e,t,a){var n="",o="pdf"===a;return n=t?t:e,n="Copy-"+n,n+=o?".pdf":".tif"},h.prototype.removeCallback=function(e,t){return K.removeCallback(e,t)},h.prototype.setCallback=function(e,t){return K.setCallback(e,t)},h.prototype.getCallbackManager=function(){return K},h.prototype.setPageChangeCompletedHandler=function(e){K.setCallback("pageChange",e)},h.prototype.setRotationCompletedHandler=function(e){K.setCallback("rotation",e)},h.prototype.setTextSelectHandler=function(e){K.setCallback("textSelect",e)},h.prototype.setSaveDocumentCompletedHandler=function(e){K.setCallback("saveDocument",e)},h.prototype.setSaveAsDocumentCompletedHandler=function(e){K.setCallback("saveAsDocument",e)},h.prototype.setUploadDocumentCompletedHandler=function(e){K.setCallback("uploadDocument",e)},h.prototype.setSendDocumentCompletedHandler=function(e){K.setCallback("sendDocument",e)},h.prototype.setSaveAnnotationsCompletedHandler=function(e){K.setCallback("saveAnnotations",e)},h.prototype.setImageLoadCompletedHandler=function(e){K.setCallback("imageLoadCompleted",e)},h.prototype.setImageLoadRequestedHandler=function(e){K.setCallback("imageLoadRequested",e)},h.prototype.searchText=function(e,t,a,n,o){if(sn({state:!0,documentModel:!0,notVideo:!0}))return d.searchDocumentText(e,t,a,n,o)},h.prototype.searchAnnotationText=function(e){if(sn({state:!0,documentModel:!0,notVideo:!0}))return d.searchAnnotationText(e)},h.prototype.getCurrentSearchResults=function(){return d.getCurrentSearchResults()},h.prototype.clearSearchResults=function(){if(sn({state:!0,documentModel:!0,notVideo:!0}))return d.clearSearchResults()},h.prototype.getAllTextForDocument=function(e){e=e||virtualViewer.getActivePaneState(),setTimeout(function(){for(var t=0;t<e.getPageCount();t++)virtualViewer.getAllText(t,e)},0)},h.prototype.getAllText=function(e,t){r.enableTextExtraction&&(t||(t=u.getActivePaneState()),e=t.validatePageNumber(e),null===t.getPageText(e)&&Ha(e,t))},h.prototype.cancelCurrentSearch=function(){d.cancelCurrentSearch()},h.prototype.isDocumentSearchable=function(){var e=u.getActivePaneState();return sn({state:!0,notVideo:!0,fullThumbsAllowed:!0})?e.getIsSearchable():null},h.prototype.nextSearchResult=function(){d.nextSearchResult()},h.prototype.previousSearchResult=function(){d.previousSearchResult()},h.prototype.redactSearchMatch=function(e,a,n){var o=u.getCurrentState();if(o){for(var i=l.getRedactionLayer(a),r=[],s=this.mergeTextRects(e.rectangles),d=0;d<s.length;d+=1){var c=s[d],g=t.getPixelImageRectFromPercents(c,a,o,n),v=n;o.imageInfoLoaded(a)&&(v={dpi:o.getDPIForPage(a),pageWidth:o.getOriginalWidthForPage(a),pageHeight:o.getOriginalHeightForPage(a)}),r.push(this.createRedactionFromRect(g,i,a,!0,!1,v))}return this.pageHasIndicator(a)||(this.showAnnotationIndicator(a),this.addToPagesWithAnnotations(a)),this.delayedPaintCanvases(),this.createNavigationOptionsLabels(),r}};var za=function(e){var t;return void 0===e||""===e?t=!1:(t=!0,$("#redactAllTagError").is(":visible")&&$("#redactAllTagError").hide()),t},Wa=function(){$("#tagAllRedactionsOKButton").click(function(){var e=$("#vvAnnTagSearchSelect").children(":selected").text(),t=za(e);t?(M.addRedactionTagsToSearch(d.getSearchedRedactions(),e,t),$("#vvTagAllRedactionsDialog").hide()):$("#redactAllTagError").show()}),$("#tagAllRedactionsCancelButton").click(function(e){$("select").each(function(){this.selectedIndex=0}),$("#vvTagAllRedactionsDialog").hide()})};h.prototype.showTagAllRedactionsDialog=function(){if(sn({state:!0,documentModel:!0,notVideo:!0})&&($("#vvTagAllRedactionsDialog").show(),$("#redactAllTagError").hide(),!r.annotationTags.length>0))throw"Please add tags for the redactions"},h.prototype.addRedactionTagsToSearch=function(e,t,a){var n,o=e;a||(a=!0);for(var i=0;i<o.length;i++){n=o[i];for(var r=0;r<n.annotationTags.length;r++)if(n.annotationTags[r]===t){a=!1;break}n.layerName.includes("vvRedaction")&&1===n.annotationTags.length&&n.annotationTags[0]!==t&&n.annotationTags.splice(0,1),a&&(n.annotationTags.push(t),n.markRevised(),l.markLayerWithAnnDirty(n))}var s=virtualViewer.getCurrentAnnObject();s&&$("#vvAnnPopUp:visible").length&&virtualViewer.annPopUpHandler(null,s)},h.prototype.enterGuideMode=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&(t.cursorGuides(),this.setDragMode(o.dragModes.guides))},h.prototype.enterPanMode=function(){this.setDragMode(o.dragModes.pan)},h.prototype.enterSelectTextMode=function(){if(sn({state:!0,documentModel:!0,notVideo:!0})){if(!this.pageHasText())return void alert(t.getLocalizedValue("errors.noText","No selectable text on this page"));t.cursorSelectText(),this.setDragMode(o.dragModes.selectText)}},h.prototype.toggleSelectTextMode=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&(Z.getDragMode()!==o.dragModes.selectText?this.pageHasText()?this.setDragMode(o.dragModes.selectText):alert(t.getLocalizedValue("errors.noText","No selectable text on this page")):this.setDragMode(o.dragModes.pan))},h.prototype.toggleHGuide=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&this.toggleGuide(this.horizontalGuide,this.verticalGuide)},h.prototype.toggleVGuide=function(e,t){sn({state:!0,documentModel:!0,notVideo:!0})&&this.toggleGuide(this.verticalGuide,this.horizontalGuide)},h.prototype.toggleGuide=function(e,a){if(sn({state:!0,documentModel:!0,notVideo:!0})){var n=Z.getDragMode();n!==o.dragModes.guides?(e.locked=!1,e.visible=!0):a.visible?(a.visible=!1,e.visible=!0):e.visible=!e.visible,a.locked=!1,e.locked=!1,a.visible||e.visible?this.setDragMode(o.dragModes.guides):(t.cursorNormal(),this.setDragMode(o.dragModes.pan)),M.delayedPaintCanvases()}},h.prototype.toggleCrosshairGuide=function(){var e=this.verticalGuide.visible||this.horizontalGuide.visible;sn({state:!0,documentModel:!0,notVideo:!0})&&(this.resetGuides(),e?(t.cursorNormal(),this.setDragMode(o.dragModes.pan)):(this.setDragMode(o.dragModes.guides),this.verticalGuide.visible=this.horizontalGuide.visible=!0),this.delayedPaintCanvases())},h.prototype.toggleBothGuidesVisibility=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&(this.verticalGuide=this.verticalGuide||{},this.horizontalGuide=this.horizontalGuide||{},this.verticalGuide.visible=!this.verticalGuide.visible,this.horizontalGuide.visible=!this.horizontalGuide.visible,this.delayedPaintCanvases())},h.prototype.toggleVGuideVisibility=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&(this.verticalGuide=this.verticalGuide||{},this.verticalGuide.visible=!this.verticalGuide.visible,this.delayedPaintCanvases())},h.prototype.toggleHGuideVisibility=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&(this.horizontalGuide=this.horizontalGuide||{},this.horizontalGuide.visible=!this.horizontalGuide.visible,this.delayedPaintCanvases())};var Ha=function(e,t){if(t||(t=u.getActivePaneState()),t.getIsSearchable()||t.getPageIsSearchable(e)){var a=new URI(r.servletPath);a.addQuery("action","getAllTextForPage"),a.addQuery("pageIndex",ua(e,t)),a.addQuery("documentId",la(e,t)),a.addQuery("clientInstanceId",M.getClientInstanceId()),a.addQuery("pageCount",t.getPageCount()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride()),null!==M.getOverlayPath()&&a.addQuery("overlayPath",M.getOverlayPath());var n=t.getDocumentId(),i=t.currentPaneIndex,s=a.query();a.query(""),$.ajax({url:a.toString(),type:"POST",dataType:"json",data:s,success:function(t){ja(t,e,n,i),virtualViewer.deselectAllText()},error:function(e){mt(e,n,i)||console.log("getAllTextForPage"+e.statusText)}})}},ja=function(e,t,a,n){var o=u.getStateForDocumentId(a,n);if(o&&!o.tabClosed&&(e.documentLinks&&(e.documentLinks.sort(v.rectSort),o.setDocumentLinks(t,e.documentLinks)),e.wordRects)){e.wordRects=v.cleanWordRects(e.wordRects),e.wordRects.sort(v.rectSort),v.assignWordsToLinks(e.wordRects,o.getDocumentLinks(t)),o.addPageText({wordRects:e.wordRects},t);var i=u.getCurrentDiff();i&&(i.processPageTextForDiff(t),i.diffPage(t),Ka(t)),ee.addPageTextToSRDiv(o,t)}};h.prototype.getDocumentCompareData=function(e){var t=u.getCurrentDiff();return t?t.changeObjects[e]?t.allChangeObjectsToRects(e):(this.getAllText(e,t.oldDocument.state),this.getAllText(e,t.newDocument.state),[]):[]},h.prototype.getDocumentCompareReport=function(e){if(sn({state:!0,documentModel:!0,notVideo:!0})){var t=u.getCurrentDiff();return t.diffIsComplete?e?void e(t.getChangeReport()):t.getChangeReport():(t.diffReportCallback=e,this.getAllTextForDocument(t.oldDocument.state),this.getAllTextForDocument(t.newDocument.state),e?void 0:t.getChangeReport())}},h.prototype.compareDocuments=function(e,t,a){if(a=a||{},e&&t&&sn({notVideo:!0})){M.openInTab(e);var n=M.getCurrentState(1);if(n){var o=n.documentModel;o.getModifiedSinceInit()?M.confirmCloseDialog(n,t):M.splitScreen(t,a.splitScreenDirection||"horizontal")}else M.splitScreen(t,a.splitScreenDirection||"horizontal");M.performDiff(a.skipOcrPrompt,!0)}},h.prototype.performDiff=function(t,a){var n=u.getCurrentDiff();if(n&&!a)return void Ka();var o=new(e("vvDiffManager"));if($("#vvDocCompareInternal").empty(),o.init(u.getCurrentState(0),u.getCurrentState(1)),u.setDiff(o),!(u.getCurrentState(0).getIsSearchable()!==!1&&u.getCurrentState(1).getIsSearchable()!==!1||M.ocrEnabled))return Ga(),o.setDiffDisabled(!0),void Ka();if((u.getCurrentState(0).getIsSearchable()===!1||u.getCurrentState(1).getIsSearchable()===!1)&&null!==u.getCurrentState(0).getIsSearchable()&&null!==u.getCurrentState(1).getIsSearchable()){var i=function(){u.getCurrentState(0).getIsSearchable()===!1&&virtualViewer.performOCR(u.getCurrentState(0)),u.getCurrentState(1).getIsSearchable()===!1&&virtualViewer.performOCR(u.getCurrentState(1))};if(!t)return void e("vvDialogs").ocrDialog(function(){setTimeout(i,0)},function(){o.setDiffDisabled(!0),Ka()});i()}Qa()};var Qa=function(){var e=u.getCurrentDiff();e.startDiff(),Ga(),Ka()},qa=function(){$("#vvThumbsTabs").removeClass("vvShrinkTabsToFitSevenThumbs vvShrinkTabsToFitSixThumbs vvFiveThumbs");var e=$(".thumbTabs.vvAllowedTab").length;7===e?$("#vvThumbsTabs").addClass("vvShrinkTabsToFitSevenThumbs"):6===e?$("#vvThumbsTabs").addClass("vvShrinkTabsToFitSixThumbs"):5===e&&$("#vvThumbsTabs").addClass("vvFiveThumbs")},Ga=function(){$("#vvDocCompareTab").show().addClass("vvAllowedTab"),qa(),$("#vvThumbs .active").removeClass("active"),$("#vvDocCompareTab, #vvDocCompare").addClass("active")};h.prototype.performOCR=function(e){var t=$.extend({},e);this.displayOcrWaitIndicator(!0),t.state=t.state||u.getActivePaneState();var a=new URI(r.servletPath);a.escapeQuerySpace(!1),a.addQuery("action","performOCR"),a.addQuery("documentId",t.state.getDocumentId()),a.addQuery("clientInstanceId",M.getClientInstanceId()),a.addQuery("forceOcr",t.force),a.addQuery("ocrLanguage",t.ocrLanguage),null!==M.getOverlayPath()&&a.addQuery("overlayPath",M.getOverlayPath()),o.cacheBuster===!0&&a.addQuery("cacheBuster",Math.random()),a.addQuery("overrideLoggingLevel",virtualViewer.loggingOverride());var n=a.query();a.query("");var i=t.state.getDocumentId(),s=t.state.currentPaneIndex;$.ajax({url:a.toString(),dataType:"json",type:"POST",data:n}).done(function(e){if(!mt(e,i,s)&&"OK"===e.status&&e.ocrWasPerformed){var a=u.getStateForDocumentId(i,s);a.setIsSearchable(!0);for(var n=a.getPageNumber(),o=Math.max(n-r.continuousScrollBufferBeforeSize,0),l=Math.min(n+r.continuousScrollBufferAfterSize,a.getPageCount()-1),d=o;d<=l;d++)virtualViewer.getAllText(d,a);t.onCompleteCallback&&t.onCompleteCallback()}}).always(function(){virtualViewer.displayOcrWaitIndicator(!1)})},h.prototype.toggleColumnSelectionMode=function(){this.columnSelectionMode=!this.columnSelectionMode},h.prototype.enableColumnSelectionMode=function(){this.columnSelectionMode=!0},h.prototype.disableColumnSelectionMode=function(){this.columnSelectionMode=!1},h.prototype.getColorBlobSize=function(){return Modernizr.touchevents?o.annColorBlobSizeTouch:o.annColorBlobSize},h.prototype.selectAllText=function(){var e=u.getActivePaneState();e.pageNumber;sn({state:!0,documentModel:!0,notVideo:!0},e)&&(this.selectTextStartPoint=new a(0,0),this.selectTextEndPoint=new a(1,1),this.delayedPaintCanvases())},h.prototype.deselectAllText=function(){sn({state:!0,fullThumbsAllowed:!0})&&(this.selectTextStartPoint=new a(0,0),this.selectTextEndPoint=new a(0,0),virtualViewer.delayedPaintCanvases())},h.prototype.copyAllText=function(){var e=u.getActivePaneState();e.pageNumber;sn({state:!0,documentModel:!0,notVideo:!0},e)&&(this.selectTextStartPoint=new a(0,0),this.selectTextEndPoint=new a(1,1),Z.getDragMode()===o.dragModes.selectText&&this.delayedPaintCanvases(),this.copySelectedText())},h.prototype.getSelectedTextRects=function(){var e=u.getActivePaneState();if(!this.selectTextStartPoint||!this.selectTextEndPoint||null===this.selectTextStartPoint||null===this.selectTextEndPoint)return[];var t=e.getPageText(e.pageNumber);if(t){var n=t.wordRects,o=[],i=new a(this.selectTextStartPoint.x,this.selectTextStartPoint.y),r=new a(this.selectTextEndPoint.x,this.selectTextEndPoint.y);if(r.y<i.y){var s=r;r=i,i=s}for(var l=0;l<n.length;l++)v.rectIsInArea(i,r,n[l],this.columnSelectionMode)&&o.push(n[l]);return o}};var Ya=function(e){return e.diffDisabled||e.diffDisabledUntilSave?virtualViewer.ocrEnabled&&!e.diffDisabledUntilSave?($(".vvDiffButton").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled"),void $("#vvToggleDiffHighlightingBtn").attr("aria-disabled","true").prop("disabled",!0).addClass("disabled")):($(".vvDiffButton").attr("aria-disabled","true").prop("disabled",!0).addClass("disabled"),void $("#vvLockScrollingBtn").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled")):void $(".vvDiffButton").attr("aria-disabled","false").prop("disabled",!1).removeClass("disabled")},Xa=function(){var e,t=u.getCurrentDiff(),a=parseInt($(this).closest(".diffPageContainer").attr("pageNumber"),10);e=$(this).hasClass("vvChangeRemoved")?t.oldDocument.state:t.newDocument.state,virtualViewer.setActivePane(e.currentPaneIndex);var n=t.focusOnChange(a,parseInt($(this).data("changeIndex"),10));if(n&&n.length){var o=n[0];Za(o,a,e),virtualViewer.paintCanvases()}},Za=function(e,t,a){if(virtualViewer.setPageCore(t,a),a.getOriginalHeightForPage(t)){var n=e.top/a.getOriginalHeightForPage(t)*virtualViewer.getScrollSpeed(a),o=M.getOuterDivFromState(a),i=o.find(".vvScroller").width()-o.width();i<0&&(i=0);var r=(o.find(".vvCanvas").width()+i)/2,s=r-a.getRequestedWidthForPage(t)/2,l=s+e.left*a.getZoomDecimal();o.scrollLeft(l),o.scrollTop(n+virtualViewer.findPagePosition(t,a))}},Ka=function(e){var a=u.getCurrentDiff();Ya(a);var n=a.fillDiffPane(e,Xa);if(!(n||$("#vvLoadMoreButton").length||a.diffDisabled||a.diffDisabledUntilSave)){var o=$("<button></button>").attr({id:"vvLoadMoreButton",type:"button"}).addClass("btn btn-secondary");o.append($("<img />").attr("src","resources/loader.gif")),o.append($("<span></span>").text(t.getLocalizedValue("documentCompare.loadMore","Load More"))),o.appendTo("#vvDocCompareInternal"),o.on("click",function(){var e,t=u.getCurrentState(0).pageNumber;e=$(".diffPageLoading[pageNumber='"+t+"']").length?t:$(".diffPageContainer").last().hasClass("diffPageLoading")?parseInt($(".diffPageContainer").last().attr("pageNumber"),10):parseInt($(".diffPageLoading").first().attr("pageNumber"),10);for(var a=r.continuousScrollBufferAfterSize||1,n=e+a,o=e;o<n;o++)o<u.getCurrentState(0).getPageCount()&&virtualViewer.getAllText(o,u.getCurrentState(0)),o<u.getCurrentState(1).getPageCount()&&virtualViewer.getAllText(o,u.getCurrentState(1))})}};h.prototype.mergeTextRects=function(e){for(var a=[],n=null,o=null,i=0;i<e.length;i++){var r=e[i],s=new t.ImageRect(r.left,r.top,r.right,r.bottom);if(null===n&&(n=s),null!==o){if(s.top===o.top){n.right=s.right,o=s;continue}a.push(n),n=s}o=s}return null!==n&&a.push(n),a},h.prototype.getSelectedText=function(){var e=this.getSelectedTextRects();if(e&&e.length){var t,a=[],n=null,o=1;for(t=0;t<e.length;t++){var i=e[t];i.left<o&&(o=i.left)}for(t=0;t<e.length;t++){var r=e[t],s=r.word.indexOf(";");s!==-1&&(r.word=r.word.slice(0,s+1)),0===t&&(a=w(a,r,o)),null!==n&&(a=S(a,n,r,o),a=C(a,n,r)),0!==r.word.indexOf("%%%%EOT")&&(r.word.indexOf(";")===-1?a.push("&#"+r.word.charCodeAt(0)+";"):a.push(r.word)),n=r}return a.join("")}},h.prototype.getUserFriendlySelectedText=function(){var e=virtualViewer.getSelectedText(),t=$("#vvCopyTextContainer").html(e).text();return $("#vvCopyTextContainer").empty(),t},h.prototype.copyTextUserEventHandler=function(){var e=virtualViewer.getSelectedText();if(e&&r.copySelectedText){$("#vvCopyTextContainer").html(e).show();try{window.getSelection().selectAllChildren(document.getElementById("vvCopyTextContainer"));var t=document.execCommand("copy");t||virtualViewer.copySelectedText()}catch(e){virtualViewer.copySelectedText()}finally{$("#vvCopyTextContainer").hide()}}},h.prototype.copySelectedText=function(){if(r.copySelectedText){var e=virtualViewer.getSelectedText();I(e)}};var Ja=function(e,t,a,n){var o=u.getCurrentDiff();if(o&&o.showHighlights){var i,r,s,l;0===e?(i=o.getOldDocHighlightRects(t),r="rgba(238, 41, 77, 0.2)",o.changeInFocus.removed.page===t&&o.changeInFocus.removed.rects&&o.changeInFocus.removed.rects.length&&(s=o.changeInFocus.removed.rects,l="rgba(238, 41, 77, 0.4)")):(i=o.getNewDocHighlightRects(t),r="rgba(93, 223, 134, 0.2)",o.changeInFocus.added.page===t&&o.changeInFocus.added.rects&&o.changeInFocus.added.rects.length&&(s=o.changeInFocus.added.rects,l="rgba(93, 223, 134, 0.4)"));var d=u.getCurrentState(e);en(i,n,r,d,t),s&&en(s,n,l,d,t)}},en=function(e,a,n,o,i){for(var r={},s=0;s<e.length;s++){
e[s].length||(r=t.getPixelImageRectFromPercents(e[s],i,o),M.highlightImageRect(r,a,n,o));for(var l=0;l<e[s].length;l++)r=t.getPixelImageRectFromPercents(e[s][l],i,o),M.highlightImageRect(r,a,n,o)}},tn=function(e,t,a){if(Z.dragMode===o.dragModes.selectText&&M.textSelectionAllowed()){t.lineWidth=2;var n=M.getSelectedTextRects();if(n){var i=M.mergeTextRects(n);0!==i.length&&an(i,e,t,o.selectedTextColor,a)}}},an=function(e,a,n,o,r){if(e&&e.length){var s=t.getPixelImageRectFromPercents(e[0],r.currentPage,r);M.highlightImageRect(s,n,o,r);var l=new i(0,0,0,0);if(e.length>2)for(l.top=1,l.bottom=0,l.left=1,l.right=0,vIndex=1;vIndex<e.length-1;vIndex++){var u=e[vIndex],d=t.getPixelImageRectFromPercents(u,r.currentPage,r);M.highlightImageRect(d,n,o,r)}if(e.length>1){var c=t.getPixelImageRectFromPercents(e[e.length-1],r.currentPage,r);M.highlightImageRect(c,n,o,r)}}};h.prototype.highlightImageRect=function(e,t,a,n){n=n||M.getActivePaneState();var o=n.getZoom()/100,r=e.top*o,s=e.bottom*o,l=e.left*o,u=e.right*o,d=new i(l,r,u-l,s-r);t.strokeStyle=a,t.fillStyle=a,t.beginPath(),t.moveTo(d.getX1(),d.getY1()),t.lineTo(d.getX2(),d.getY1()),t.lineTo(d.getX2(),d.getY2()),t.lineTo(d.getX1(),d.getY2()),t.closePath(),t.fill()},h.prototype.drawBox=function(e,t,a,n){n=n||M.getActivePaneState();var o=n.getZoom()/100,r=e.top*o,s=e.bottom*o,l=e.left*o,u=e.right*o,d=new i(l,r,u-l,s-r);t.strokeStyle=a,t.beginPath(),t.moveTo(d.getX1(),d.getY1()),t.lineTo(d.getX2(),d.getY1()),t.lineTo(d.getX2(),d.getY2()),t.lineTo(d.getX1(),d.getY2()),t.closePath(),t.stroke()},h.prototype.updateGuidePositions=function(e){return D(e)};var nn=function(e,t,a,n){if(virtualViewer.horizontalGuide&&virtualViewer.horizontalGuide.visible&&e&&t){t.save();var o=a.getRequestedWidthForPage(n),i=a.getRequestedHeightForPage(n);90!==a.getRotationForPage(n)&&270!==a.getRotationForPage(n)||(o=i,i=a.getRequestedWidthForPage(n));var r=0,s=Math.max(virtualViewer.horizontalGuide.value,1);s=Math.min(s,i);var l=o,u=s;virtualViewer.horizontalGuide.locked?t.strokeStyle=me:t.strokeStyle=he,t.beginPath(),t.moveTo(r,s),t.lineTo(l,u),t.lineWidth=pe,t.stroke(),t.restore()}},on=function(e,t){if(t.save(),virtualViewer.verticalGuide&&virtualViewer.verticalGuide.visible&&e&&t){var a=Math.max(virtualViewer.verticalGuide.value,1),n=0,o=a,i=e.height;virtualViewer.verticalGuide.locked?t.strokeStyle=me:t.strokeStyle=he,t.beginPath(),t.moveTo(a,n),t.lineTo(o,i),t.lineWidth=pe,t.stroke(),t.restore()}};h.prototype.countPagesForDocument=function(e,t){var a=-1,n=new URI(r.servletPath);n.addQuery("action","countPages"),n.addQuery("documentId",e),n.addQuery("clientInstanceId",t);var o=n.query();return n.query(""),$.ajax({url:n.toString(),async:!1,type:"POST",data:o,dataType:"json",success:function(e){a=e.pageCount},error:function(t){virtualViewer.checkServerException(t,e)}}),a},h.prototype.addPageToSelection=function(e){var t=M.getCurrentState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},t)){var a=t.getDocumentModel();a.addPageToSelection(e)}},h.prototype.removePageFromSelection=function(e){var t=M.getCurrentState();if(sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0},t)){var a=t.getDocumentModel();a.removePageFromSelection(e)}},h.prototype.disabledToolbarOptionDialog=function(e,t){var a,n,o=e;switch(o){case"save":n=t?t:"Saving this Document is not allowed.",a="Cannot Save Document";break;case"export":n=t?t:"Exporting this Document is not allowed.",a="Cannot Export Document";break;case"send":n=t?t:"Sending this Document is not allowed.",a="Cannot Send Document";break;case"print":n=t?t:"Printing this Document is not allowed.",a="Cannot Print Document"}$("#vvDisableToolbarDialogText").html(n),$("#vvDisableToolbarDialogTitle").html(a),$("#vvDisableToolbarDialog").modal("show")},h.prototype.setOverlayPath=function(e){ve=e},h.prototype.getOverlayPath=function(){return ve},h.prototype.checkPageManipulationsEnabled=function(e,a){var n=null,o=!0;if(M.pageManipulationsEnabled){if(M.getDocumentModel()&&M.getDocumentModel().hasRedactions())n=t.getLocalizedValue("pageManipulations.redactions","Page Manipulations are currently not supported in documents containing redactions."),o=!1;else if(d.searchInProgress())n=t.getLocalizedValue("pageManipulations.searchInProgress","Page Manipulations are disabled while a document search is in progress."),o=!1;else if(a||(a=u.getActivePaneState()),a)for(var i,s,l=0;l<r.restrictedPageManipulationFormats.length;l++)a.getFormatForPage(a.getPageNumber())&&(i=a.getFormatForPage(a.getPageNumber()).toUpperCase()),s=r.restrictedPageManipulationFormats[l].toUpperCase(),i===s&&(n=t.getLocalizedValue("pageManipulations.restrictedFormat","Page Manipulations are disabled for this document format."),o=!1)}else n=t.getLocalizedValue("pageManipulations.disabled","Page Manipulations have been disabled by the administrator in the configuration."),o=!1;if(e&&!o){var c={client:!0,disable:M.disableErrorModals.adminDisabled};ft(n,c)}return o},h.prototype.setPageManipulationsEnabled=function(e){return M.pageManipulationsEnabled=e,M.pageManipulationsEnabled},h.prototype.setAnnotationsEnabled=function(e){return M.annotationsEnabled=e,M.annotationsEnabled},h.prototype.setRedactionsEnabled=function(e){return M.redactionsEnabled=e,Re(),M.redactionsEnabled},h.prototype.checkAnnotationsEnabled=function(e){var a=null;return M.annotationsEnabled||(a=t.getLocalizedValue("errors.annotationsDisabled","Annotations have been disabled by the administrator in the configuration.")),e&&!M.annotationsEnabled&&alert(a),M.annotationsEnabled},h.prototype.checkRedactionsEnabled=function(e){var a=null;return M.redactionsEnabled||(a=t.getLocalizedValue("errors.redactionsDisabled","Redactions have been disabled by the administrator in the configuration."),$("#vvRedactionRectButton").attr("aria-disabled",!0)),e&&!M.redactionsEnabled&&alert(a),M.redactionsEnabled},h.prototype.toggleMagnifier=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&(K.call("magnifierBegin",{documentId:u.getActivePaneState(),currentPage:u.getActivePaneState().pageNumber,magnifierActive:X.getMagnifierEnabled()}),X.setMagnifierEnabled(!X.getMagnifierEnabled()),X.magnifierHandler(),K.call("magnifier",{documentId:u.getActivePaneState(),currentPage:u.getActivePaneState().pageNumber,magnifierActive:X.getMagnifierEnabled()}))},h.prototype.showMagnifierWindow=function(){u.isVideoOpen()||(X.setMagnifierEnabled(!0),X.magnifierHandler())},h.prototype.hideMagnifierWindow=function(){u.isVideoOpen()||(X.setMagnifierEnabled(!1),X.magnifierHandler())},h.prototype.setMagnifierPosition=function(e,t){if(sn({state:!0,notVideo:!0})){var a=$("#vvMagnifierCanvas");a.css("left",e),a.css("top",t),X.paintMagnifierCanvas()}},h.prototype.addBookmark=function(e,t){return!!sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&Q.addBookmark(e,t,!1,!1)},h.prototype.deleteBookmark=function(e){return!!sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&(null!==e&&void 0!==e&&(Q.deleteBookmark(null,e,!1),!0))},h.prototype.editBookmark=function(e){return!!sn({state:!0,documentModel:!0,notVideo:!0,fullThumbsAllowed:!0})&&(null!==e&&void 0!==e&&Q.editBookmark(e))},h.prototype.getMediaPlayer=function(){var e=virtualViewer.getActivePaneState();return sn({state:!0,yesMedia:!0},e)?e.getMediaManager().player:null},h.prototype.playMedia=function(){var e=virtualViewer.getActivePaneState();return!!sn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.play(),!0)},h.prototype.playVideo=function(){return virtualViewer.playMedia()},h.prototype.playAudio=function(){return virtualViewer.playMedia()},h.prototype.pauseMedia=function(){var e=virtualViewer.getActivePaneState();return!!sn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.pause(),!0)},h.prototype.pauseVideo=function(){return virtualViewer.pauseMedia()},h.prototype.pauseAudio=function(){return virtualViewer.pauseMedia()},h.prototype.setMediaPlaybackSpeed=function(e){var t=virtualViewer.getActivePaneState();if(!sn({state:!0,yesMedia:!0},t))return!1;var a=t.getMediaManager().player;return e=e||1,a.playbackRate=e,!0},h.prototype.setVideoPlaybackSpeed=function(e){return virtualViewer.setMediaPlaybackSpeed(e)},h.prototype.setAudioPlaybackSpeed=function(e){return virtualViewer.setMediaPlaybackSpeed(e)},h.prototype.fastForwardMedia=function(){var e=virtualViewer.getActivePaneState();return!!sn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.playbackRate=2,!0)},h.prototype.fastForwardVideo=function(){return virtualViewer.fastForwardMedia()},h.prototype.fastForwardAudio=function(){return virtualViewer.fastForwardMedia()},h.prototype.setMediaTime=function(e){var t=virtualViewer.getActivePaneState();if(!sn({state:!0,yesMedia:!0},t))return null;var a=t.getMediaManager().player;return e=e||0,a.currentTime=e,e},h.prototype.setAudioTime=function(e){return virtualViewer.setMediaTime(e)},h.prototype.setVideoTime=function(e){return virtualViewer.setMediaTime(e)},h.prototype.resetMediaSpeed=function(){var e=virtualViewer.getActivePaneState();return!!sn({state:!0,yesMedia:!0},e)&&(e.getMediaManager().player.playbackRate=1,!0)},h.prototype.getBookmarks=function(){return Q},h.prototype.getEventManager=function(){return Z},h.prototype.getCurrentAnnType=function(){return O},h.prototype.setCurrentAnnType=function(e){O=e},h.prototype.getCurrentStickyAnnType=function(){return te},h.prototype.removeDocumentFromCache=function(e,t){var a=null;t=t||virtualViewer.getClientInstanceId(),o.cacheBuster===!0&&(a=Math.random());var n={action:"removeDocumentFromCache",documentId:e,clientInstanceId:t,cacheBuster:a,overrideLoggingLevel:virtualViewer.loggingOverride()},i=new URI(r.servletPath);$.ajax({url:i.toString(),type:"POST",data:n,dataType:"json",success:function(e){mt(e)===!0},error:function(t){mt(t,e)===!0}})},h.prototype.removeDocumentArrayFromCache=function(e,t){var a=null;t=t||virtualViewer.getClientInstanceId(),o.cacheBuster===!0&&(a=Math.random());var n={action:"removeDocumentFromCache",documentIdArray:e,clientInstanceId:t,cacheBuster:a,overrideLoggingLevel:virtualViewer.loggingOverride()},i=new URI(r.servletPath);$.ajax({url:i.toString(),type:"POST",data:n,dataType:"json",success:function(e){mt(e)===!0},error:function(e){mt(e)===!0}})},h.prototype.seedCache=function(e,t,a){if(!e)return!1;var n=new URI(r.servletPath);n.addQuery("action","seedCache"),n.addQuery("documentId",e),void 0!==a?n.addQuery("clientInstanceId",a):n.addQuery("clientInstanceId",virtualViewer.getClientInstanceId()),t||(t=[]),n.addQuery("pages",t.toString());var o=n.query();n.query(""),$.ajax({url:n.toString(),type:"POST",data:o,dataType:"json",success:function(e){mt(e)===!0},error:function(t){mt(t,e)===!0}})},h.prototype.enterOverlayDragMode=function(){sn({state:!0,documentModel:!0,notVideo:!0})&&this.setDragMode(o.dragModes.overlay)},h.prototype.exitOverlayDragMode=function(){this.setDragMode(o.dragModes.pan)},h.prototype.moveOverlayImagesTogether=function(e){var t=u.getActivePaneState();if(sn({state:!0,notVideo:!0},t)){var a=t.getImageManager();a.pageLockOverlayOffset.locked=!!e}},h.prototype.removeOverlayFromPage=function(e){var t=u.getActivePaneState();if(sn({state:!0,notVideo:!0},t)&&t.getImageManager().overlayImage&&e===t.validatePageNumber(e)){var a=t.getImageManager();return a.overlayDataArray[e]=null,this.delayedPaintCanvases(),e}},h.prototype.addOverlayToPage=function(e,t){var a=u.getActivePaneState();if(sn({state:!0,notVideo:!0},a)&&e===a.validatePageNumber(e)){var n=a.getImageManager();return n.overlayImage&&t===n.overlayDocumentId?(null===n.overlayDataArray[e]&&(n.overlayDataArray[e]=void 0),this.delayedPaintCanvases(),e):this.getOverlayImage(t,{pages:[e]})}},h.prototype.clearOverlayImage=function(){var e=u.getActivePaneState();if(sn({state:!0,notVideo:!0},e)){var t=e.getImageManager();t.cleanOverlayOffset(),t.overlayImage=null,t.overlayDocumentId=null,t.overlayImageStripped=!1,this.delayedPaintCanvases()}},h.prototype.getOverlayImage=function(e,t){"use strict";var a=u.getActivePaneState();if(sn({state:!0,notVideo:!0},a)&&e){var n=a.getImageManager();if(t=t||{},t.lockOverlayMovement===!1?n.pageLockOverlayOffset.locked=!1:n.cleanOverlayOffset(),n.overlayDocumentId===e)return rn(n,t.pages,a),void this.delayedPaintCanvases();n.requestOverlayImage(e,a),rn(n,t.pages,a)}};var rn=function(e,t,a){"use strict";if(t){t.sort(function(e,t){return e||0===e?e-t:1});for(var n=0,o=0;o<a.getPageCount();o++)t[n]===o?(e.overlayDataArray[o]=-1,n++):e.overlayDataArray[o]=null}else for(var i=0;i<a.getPageCount();i++)e.overlayDataArray[i]=-1},sn=function(e,a){var n=null;if(a=a||u.getActivePaneState(),e.documentId&&(a=virtualViewer.getStateForDocumentId(e.documentId),void 0===a||null===a)){n=e.documentId+t.getLocalizedValue("errors.definedDocumentLoaded"," must be fully loaded in the viewer.");var o={disable:!0};return virtualViewer.displayExceptionMessage(n,o),!1}if((e.state||e.documentModel)&&(!a||!a.getImageManager())){n=t.getLocalizedValue("errors.documentFullyLoaded","A document must be fully loaded in the viewer.");var o={disable:!0};return virtualViewer.displayExceptionMessage(n,o),!1}if(a=a||{},!e.documentModel||a.documentFullyLoaded()&&a.getDocumentModel()||(n=t.getLocalizedValue("errors.documentFullyLoaded","A document must be fully loaded in the viewer.")),e.notVideo&&a.isMedia()&&(n=t.getLocalizedValue("errors.notVideo","This API function may not be called on video or audio documents.")),e.notSplit&&oe&&(n=t.getLocalizedValue("errors.notSplit","This API function may not be called when the viewer is in split pane mode.")),!e.yesMedia||a.isMedia()&&a.getMediaManager()||(n=t.getLocalizedValue("errors.yesVideo","This API function must be called on a video or audio document.")),!e.fullThumbsAllowed&&p.open&&(n=t.getLocalizedValue("errors.fullThumbsAPI","This API function cannot be called in full thumbnail view.")),null!==n){var o={disable:!0};return virtualViewer.displayExceptionMessage(n,o),!1}return!0};h.prototype.focusLink=function(e,t,a){let n=a.getDocumentLinks(t)[e];Za(n.rect,t,a),this.focusedLink={linkIndex:e,pageIndex:t,pane:a.currentPaneIndex}},h.prototype.isFocusedLink=function(e,t,a){return!!this.focusedLink&&(this.focusedLink.linkIndex===e&&this.focusedLink.pageIndex===t&&this.focusedLink.pane===a.currentPaneIndex)},h.prototype.clearFocusedLink=function(){this.focusedLink=null},h.prototype.overDocumentLink=function(e){let t=u.getActivePaneState();if(!t||!e||!t.getDocumentLinks())return null;let n=1*e.getX()/t.getRequestedWidthForPage(t.pageNumber),o=1*e.getY()/t.getRequestedHeightForPage(t.pageNumber),i=new a(n,o),r=v.rectIndexOfPoint(t.getDocumentLinks(),i);return r===-1?null:t.getDocumentLinks()[r]},h.prototype.encodeForHTML=function(e){return String(e).replace(/[&<> \/"'`=]/g,function(e){return ln[e]})};var ln={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"," ":"&nbsp;"};return h.prototype.filterDocumentThumbsByDisplayName=function(t){e("vvThumbs").filterDocumentThumbsByDisplayName(t)},h.prototype.loggingOverride=function(e){return"undefined"!=typeof e&&(this.overrideLoggingLevel=!!e),this.overrideLoggingLevel},h.prototype.toggleCaptions=function(e){"use strict";let t=u.getActivePaneState();sn({state:!0,yesMedia:!0},t)&&t.getMediaManager().toggleCaptions(e)},h.prototype.isRedaction=function(e){var a=l.getLayerWithAnn(e);return!!t.isRedactionLayer(a)},h.prototype.lockViewBetweenDocuments=function(){r.previousBetweenDocumentSettings={fitLast:r.fitLastBetweenDocuments,positionLast:r.positionLastBetweenDocuments},r.fitLastBetweenDocuments=!0,r.positionLastBetweenDocuments=!0},h.prototype.unlockViewBetweenDocuments=function(){var e=r.previousBetweenDocumentSettings;e?(r.fitLastBetweenDocuments=e.fitLast,r.positionLastBetweenDocuments=e.positionLast):(r.fitLastBetweenDocuments=!1,r.positionLastBetweenDocuments=!1)},h});var virtualViewer,myFlexSnap,vvConfig;requirejs.config({baseUrl:"js",paths:{"user-config":"../user-config"}}),requirejs(["3rdparty/domReady!","webviewer","user-config/config"],function(e,t){vvConfig=require("user-config/config"),virtualViewer=new t,myFlexSnap=virtualViewer;var a=!1;if("function"==typeof beforeVirtualViewerInit){var n=beforeVirtualViewerInit();a=!!n}a||(virtualViewer.isInitialized()||virtualViewer.initViaURL(),"function"==typeof afterVirtualViewerInit&&afterVirtualViewerInit())}),define("virtualviewer-main",function(){}),define("virtualviewer-built",function(){});